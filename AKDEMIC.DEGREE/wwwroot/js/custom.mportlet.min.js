var mPortletDefaultOptions={tools:{toggle:{collapse:"Colapsar",expand:"Expandir"},reload:"Recargar",remove:"Remover",fullscreen:{on:"Pantalla Completa",off:"Salir de Pantalla Completa"}}},mPortlet=function(t,o){var e=this,l=mUtil.get(t),s=mUtil.get("body");if(l){var n={bodyToggleSpeed:400,tooltips:!0,tools:{toggle:{collapse:mPortletDefaultOptions.tools.toggle.collapse,expand:mPortletDefaultOptions.tools.toggle.expand},reload:mPortletDefaultOptions.tools.reload,remove:mPortletDefaultOptions.tools.remove,fullscreen:{on:mPortletDefaultOptions.tools.fullscreen.on,off:mPortletDefaultOptions.tools.fullscreen.off}},sticky:{offset:300,zIndex:98}},r={construct:function(t){return mUtil.data(l).has("portlet")?e=mUtil.data(l).get("portlet"):(r.init(t),r.build(),mUtil.data(l).set("portlet",e)),e},init:function(t){e.element=l,e.events=[],e.options=mUtil.deepExtend({},n,t),e.head=mUtil.child(l,".m-portlet__head"),e.foot=mUtil.child(l,".m-portlet__foot"),mUtil.child(l,".m-portlet__body")?e.body=mUtil.child(l,".m-portlet__body"):0!==mUtil.child(l,".m-form").length&&(e.body=mUtil.child(l,".m-form"))},build:function(){var t=mUtil.find(e.head,"[m-portlet-tool=remove]");t&&mUtil.addEvent(t,"click",(function(t){t.preventDefault(),r.remove()}));var o=mUtil.find(e.head,"[m-portlet-tool=reload]");o&&mUtil.addEvent(o,"click",(function(t){t.preventDefault(),r.reload()}));var l=mUtil.find(e.head,"[m-portlet-tool=toggle]");l&&mUtil.addEvent(l,"click",(function(t){t.preventDefault(),r.toggle()}));var i=mUtil.find(e.head,"[m-portlet-tool=fullscreen]");i&&mUtil.addEvent(i,"click",(function(t){t.preventDefault(),r.fullscreen()})),r.setupTooltips()},onScrollSticky:function(){window.pageYOffset>e.options.sticky.offset?!1===mUtil.hasClass(s,"m-portlet--sticky")&&(r.eventTrigger("stickyOn"),mUtil.addClass(s,"m-portlet--sticky"),mUtil.addClass(l,"m-portlet--sticky"),r.updateSticky()):mUtil.hasClass(s,"m-portlet--sticky")&&(r.eventTrigger("stickyOff"),mUtil.removeClass(s,"m-portlet--sticky"),mUtil.removeClass(l,"m-portlet--sticky"),r.resetSticky())},initSticky:function(){e.head&&window.addEventListener("scroll",r.onScrollSticky)},updateSticky:function(){var t,o,l;e.head&&(mUtil.hasClass(s,"m-portlet--sticky")&&(t=e.options.sticky.position.top instanceof Function?parseInt(e.options.sticky.position.top.call()):parseInt(e.options.sticky.position.top),o=e.options.sticky.position.left instanceof Function?parseInt(e.options.sticky.position.left.call()):parseInt(e.options.sticky.position.left),l=e.options.sticky.position.right instanceof Function?parseInt(e.options.sticky.position.right.call()):parseInt(e.options.sticky.position.right),mUtil.css(e.head,"z-index",e.options.sticky.zIndex),mUtil.css(e.head,"top",t+"px"),mUtil.isRTL()?(mUtil.css(e.head,"left",l+"px"),mUtil.css(e.head,"right",o+"px")):(mUtil.css(e.head,"left",o+"px"),mUtil.css(e.head,"right",l+"px"))))},resetSticky:function(){e.head&&!1===mUtil.hasClass(s,"m-portlet--sticky")&&(mUtil.css(e.head,"z-index",""),mUtil.css(e.head,"top",""),mUtil.css(e.head,"left",""),mUtil.css(e.head,"right",""))},destroySticky:function(){e.head&&(r.resetSticky(),window.removeEventListener("scroll",r.onScrollSticky))},remove:function(){!1!==r.eventTrigger("beforeRemove")&&(mUtil.hasClass(s,"m-portlet--fullscreen")&&mUtil.hasClass(l,"m-portlet--fullscreen")&&r.fullscreen("off"),r.removeTooltips(),mUtil.remove(l),r.eventTrigger("afterRemove"))},setContent:function(t){t&&(e.body.innerHTML=t)},getBody:function(){return e.body},getSelf:function(){return l},setupTooltips:function(){if(e.options.tooltips){var t=mUtil.hasClass(l,"m-portlet--collapse")||mUtil.hasClass(l,"m-portlet--collapsed"),o=mUtil.hasClass(s,"m-portlet--fullscreen")&&mUtil.hasClass(l,"m-portlet--fullscreen"),i=mUtil.find(e.head,"[m-portlet-tool=remove]");if(i){var n=o?"bottom":"top",r=new Tooltip(i,{title:e.options.tools.remove,placement:n,offset:o?"0,10px,0,0":"0,5px",trigger:"hover",template:'<div class="m-tooltip m-tooltip--portlet tooltip bs-tooltip-'+n+'" role="tooltip">\t\t\t\t\t\t\t<div class="tooltip-arrow arrow"></div>\t\t\t\t\t\t\t<div class="tooltip-inner"></div>\t\t\t\t\t\t</div>'});mUtil.data(i).set("tooltip",r)}var a=mUtil.find(e.head,"[m-portlet-tool=reload]");if(a){n=o?"bottom":"top",r=new Tooltip(a,{title:e.options.tools.reload,placement:n,offset:o?"0,10px,0,0":"0,5px",trigger:"hover",template:'<div class="m-tooltip m-tooltip--portlet tooltip bs-tooltip-'+n+'" role="tooltip">\t\t\t\t\t\t\t<div class="tooltip-arrow arrow"></div>\t\t\t\t\t\t\t<div class="tooltip-inner"></div>\t\t\t\t\t\t</div>'});mUtil.data(a).set("tooltip",r)}var p=mUtil.find(e.head,"[m-portlet-tool=toggle]");if(p){n=o?"bottom":"top",r=new Tooltip(p,{title:t?e.options.tools.toggle.expand:e.options.tools.toggle.collapse,placement:n,offset:o?"0,10px,0,0":"0,5px",trigger:"hover",template:'<div class="m-tooltip m-tooltip--portlet tooltip bs-tooltip-'+n+'" role="tooltip">\t\t\t\t\t\t\t<div class="tooltip-arrow arrow"></div>\t\t\t\t\t\t\t<div class="tooltip-inner"></div>\t\t\t\t\t\t</div>'});mUtil.data(p).set("tooltip",r)}var m=mUtil.find(e.head,"[m-portlet-tool=fullscreen]");if(m){n=o?"bottom":"top",r=new Tooltip(m,{title:o?e.options.tools.fullscreen.off:e.options.tools.fullscreen.on,placement:n,offset:o?"0,10px,0,0":"0,5px",trigger:"hover",template:'<div class="m-tooltip m-tooltip--portlet tooltip bs-tooltip-'+n+'" role="tooltip">\t\t\t\t\t\t\t<div class="tooltip-arrow arrow"></div>\t\t\t\t\t\t\t<div class="tooltip-inner"></div>\t\t\t\t\t\t</div>'});mUtil.data(m).set("tooltip",r)}}},removeTooltips:function(){if(e.options.tooltips){var t=mUtil.find(e.head,"[m-portlet-tool=remove]");t&&mUtil.data(t).has("tooltip")&&mUtil.data(t).get("tooltip").dispose();var o=mUtil.find(e.head,"[m-portlet-tool=reload]");o&&mUtil.data(o).has("tooltip")&&mUtil.data(o).get("tooltip").dispose();var l=mUtil.find(e.head,"[m-portlet-tool=toggle]");l&&mUtil.data(l).has("tooltip")&&mUtil.data(l).get("tooltip").dispose();var i=mUtil.find(e.head,"[m-portlet-tool=fullscreen]");i&&mUtil.data(i).has("tooltip")&&mUtil.data(i).get("tooltip").dispose()}},reload:function(){r.eventTrigger("reload")},toggle:function(){mUtil.hasClass(l,"m-portlet--collapse")||mUtil.hasClass(l,"m-portlet--collapsed")?r.expand():r.collapse()},collapse:function(){if(!1!==r.eventTrigger("beforeCollapse")){mUtil.slideUp(e.body,e.options.bodyToggleSpeed,(function(){r.eventTrigger("afterCollapse")})),mUtil.addClass(l,"m-portlet--collapse");var t=mUtil.find(e.head,"[m-portlet-tool=toggle]");t&&mUtil.data(t).has("tooltip")&&mUtil.data(t).get("tooltip").updateTitleContent(e.options.tools.toggle.expand)}},expand:function(){if(!1!==r.eventTrigger("beforeExpand")){mUtil.slideDown(e.body,e.options.bodyToggleSpeed,(function(){r.eventTrigger("afterExpand")})),mUtil.removeClass(l,"m-portlet--collapse"),mUtil.removeClass(l,"m-portlet--collapsed");var t=mUtil.find(e.head,"[m-portlet-tool=toggle]");t&&mUtil.data(t).has("tooltip")&&mUtil.data(t).get("tooltip").updateTitleContent(e.options.tools.toggle.collapse)}},fullscreen:function(t){if("off"===t||mUtil.hasClass(s,"m-portlet--fullscreen")&&mUtil.hasClass(l,"m-portlet--fullscreen"))r.eventTrigger("beforeFullscreenOff"),mUtil.removeClass(s,"m-portlet--fullscreen"),mUtil.removeClass(l,"m-portlet--fullscreen"),r.removeTooltips(),r.setupTooltips(),e.foot&&(mUtil.css(e.body,"margin-bottom",""),mUtil.css(e.foot,"margin-top","")),r.eventTrigger("afterFullscreenOff");else{if(r.eventTrigger("beforeFullscreenOn"),mUtil.addClass(l,"m-portlet--fullscreen"),mUtil.addClass(s,"m-portlet--fullscreen"),r.removeTooltips(),r.setupTooltips(),e.foot){var o=parseInt(mUtil.css(e.foot,"height")),i=parseInt(mUtil.css(e.foot,"height"))+parseInt(mUtil.css(e.head,"height"));mUtil.css(e.body,"margin-bottom",o+"px"),mUtil.css(e.foot,"margin-top","-"+i+"px")}r.eventTrigger("afterFullscreenOn")}},eventTrigger:function(t){for(i=0;i<e.events.length;i++){var o=e.events[i];o.name==t&&(1==o.one?0==o.fired&&(e.events[i].fired=!0,o.handler.call(this,e)):o.handler.call(this,e))}},addEvent:function(t,o,l){return e.events.push({name:t,handler:o,one:l,fired:!1}),e}};return e.setDefaults=function(t){n=t},e.remove=function(){return r.remove(html)},e.initSticky=function(){return r.initSticky()},e.updateSticky=function(){return r.updateSticky()},e.resetSticky=function(){return r.resetSticky()},e.destroySticky=function(){return r.destroySticky()},e.reload=function(){return r.reload()},e.setContent=function(t){return r.setContent(t)},e.toggle=function(){return r.toggle()},e.collapse=function(){return r.collapse()},e.expand=function(){return r.expand()},e.fullscreen=function(){return r.fullscreen("on")},e.unFullscreen=function(){return r.fullscreen("off")},e.getBody=function(){return r.getBody()},e.getSelf=function(){return r.getSelf()},e.on=function(t,o){return r.addEvent(t,o)},e.one=function(t,o){return r.addEvent(t,o,!0)},r.construct.apply(e,[o]),e}};