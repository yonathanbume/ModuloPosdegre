var diplomas=function(){var a={init:function(){this.report.init(),this.template.init(),this.upload_template.init()},report:{init:function(){a.report.events()},events:function(){$("#btnDownloadExcel").on("click",(function(){a.report.download()}))},download:function(){$("#btnDownloadExcel").addLoader(),$.fileDownload("/admin/entrega-de-diplomas/reporte-excel".proto().parseURL(),{httpMethod:"GET"}).done((function(){$("#btnDownloadExcel").removeLoader(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)})).fail((function(a){$("#btnDownloadExcel").removeLoader(),toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}},template:{init:function(){a.template.events()},events:function(){$("#btnUploadTemplate").on("click",(function(){a.template.download()}))},download:function(){$("#btnUploadTemplate").addLoader(),$.fileDownload("/admin/entrega-de-diplomas/template/reporte-excel".proto().parseURL(),{httpMethod:"GET"}).done((function(){$("#btnUploadTemplate").removeLoader(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)})).fail((function(a){$("#btnUploadTemplate").removeLoader(),toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}},upload_template:{init:function(){a.upload_template.events()},events:function(){$("#upload-excel-form").validate({submitHandler:function(a,t){t.preventDefault(),$("#btn-upload-excel").addLoader();var e=new FormData($(a).get(0));$.ajax({type:"POST",url:$(a).attr("action"),data:e,contentType:!1,processData:!1,success:function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),window.location.href=window.location.href},error:function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)},complete:function(){$("#btn-upload-excel").removeLoader()}})}})}}},t={objects:{}},e={career:function(a){$.ajax({type:"GET",url:`/admin/padron-de-registro/carreras/${a}/get`.proto().parseURL()}).done((function(a){$("#careerId").empty(),$("#careerId").select2({data:a.items})})),$("#careerId").on("change",(function(){var a=$(this).val();e.program_academic(a)})),$("#careerId").trigger("change")},faculty:function(){$.ajax({type:"GET",url:"/admin/padron-de-registro/facultades/get".proto().parseURL()}).done((function(a){$("#facultyId").select2({data:a.items})})),$("#facultyId").on("change",(function(){var a=$(this).val();e.career(a)})),$("#facultyId").trigger("change")},program_academic:function(a){$.ajax({type:"GET",url:`/admin/padron-de-registro/programaacademicos/${a}/get`.proto().parseURL()}).done((function(a){$("#program_academicId").empty(),$("#program_academicId").select2({data:a.items})}))},diploma_status:function(){$("#diplomaStatus").select2(),$("#diplomaStatus").on("change",(function(){t.objects["tbl-datatable-registry-patterns"].draw()}))}},n=function(){$("#searchValue").doneTyping((function(){t.objects["tbl-datatable-registry-patterns"].draw()})),$("#searchBookNumber").doneTyping((function(){t.objects["tbl-datatable-registry-patterns"].draw()})),$("#searchBookNumber").on("blur",(function(){""==$(this).val()?$("#d-zone").hide():$("#d-zone").show()}))},o={ajax:{type:"GET",dataType:"JSON",url:"/admin/entrega-de-diplomas/lista-registro-padrones".proto().parseURL(),data:function(a){a.searchValue=$("#searchValue").val(),a.seachBookNumber=$("#searchBookNumber").val(),a.careerId=$("#careerId").val(),a.facultyId=$("#facultyId").val(),a.academicProgramId=$("#program_academicId").val(),a.diplomaStatus=$("#diplomaStatus").val()}},columns:[{data:"request_name",name:"request_name"},{data:"type",name:"type"},{data:"userName",name:"Usuario"},{data:"user",name:"user"},{data:"dni",name:"dni"},{data:"careerName",name:"carrerName"},{data:"diplomadelivery",name:"diplomadelivery",orderable:!1,render:function(a,t,e,n){var o="";return 0===e.diplomadeliveryNumber&&(o+=`<span class="m-badge m-badge--info m-badge--wide">${e.diplomadelivery}</span>`),1===e.diplomadeliveryNumber&&(o+=`<span class="m-badge  m-badge--brand m-badge--wide">${e.diplomadelivery}</span>`),2===e.diplomadeliveryNumber&&(o+=`<span class="m-badge  m-badge--success m-badge--wide">${e.diplomadelivery}</span>`),o}},{title:"Opciones",orderable:!1,render:function(a,t,e,n){var o="";return o+=`<button data-id="${e.id}" class="btn btn-brand btn-sm m-btn m-btn--icon btn-change-status"><i class="fa fa-sync"></i></button> `,o+=`<button data-id="${e.id}" class="btn btn-info btn-sm m-btn m-btn--icon btn-information"><i class="fa fa-eye"></i></button>`}}]},r=function(){t.objects["tbl-datatable-registry-patterns"]=$("#tbl-datatable-registry-patterns").DataTable(o),t.objects["tbl-datatable-registry-patterns"].on("click",".btn-change-status",(function(a){a.preventDefault();var t=$(this).data("id");$("#change-status-form input[name='registryPatternId']").val(t),$.ajax({type:"GET",url:`/admin/entrega-de-diplomas/obtener-estado-de-entrega/${t}`,success:function(a){$("#change-status-form select[name='deliveryDiploma']").val(a).trigger("change"),$("#modal-status").modal("show")}})})),t.objects["tbl-datatable-registry-patterns"].on("click",".btn-information",(function(a){a.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:`/admin/entrega-de-diplomas/informacion/${t}`,success:function(a){$("#more-info-form input[name='fullname']").val(a.fullname),$("#more-info-form input[name='code']").val(a.code),$("#more-info-form input[name='phone']").val(a.phone),$("#more-info-form input[name='email1']").val(a.email1),$("#more-info-form input[name='email2']").val(a.email2),$("#modal-info").modal("show")}})}))};return{load:function(){e.faculty(),e.diploma_status(),r(),n(),$("#btn-search-filters").on("click",(function(a){a.preventDefault(),t.objects["tbl-datatable-registry-patterns"].draw()})),$("#change-status-form").validate({submitHandler:function(a,e){e.preventDefault(),$("#btn-submit").addLoader(),$.ajax({type:"POST",url:"/admin/entrega-de-diplomas/cambiar-estado".proto().parseURL(),data:$(a).serialize(),success:function(){$("#modal-status").modal("hide"),t.objects["tbl-datatable-registry-patterns"].draw(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)},complete:function(){$("#btn-submit").removeLoader()}}),$("#change-status-form input[name='deliveryDiploma']").val("")}}),a.init()}}}();$((function(){diplomas.load()}));