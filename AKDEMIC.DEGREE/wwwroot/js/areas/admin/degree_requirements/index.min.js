var degreesRequirements=function(){var e=null,t={data:{source:{read:{method:"GET",url:""}}},columns:[{field:"name",title:"Descripción",width:500},{field:"code",title:"Código",width:100},{field:"options",title:"Opciones",sortable:!1,filterable:!1,template:function(e){var t="";return t+=`<button data-id="${e.id}" class="btn btn-info btn-sm m-btn m-btn--icon btn-edit" ><span><i class="flaticon-edit"></i><span>Editar</span></span></button> `,t+=`<button data-id="${e.id}" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete"><span><i class="flaticon-delete-1"></i><span>Eliminar</span></span></button>`}}]},a=function(a){null!==e&&(e.destroy(),e=null),t.data.source.read.url=`/admin/gestion-de-requerimientos/todos/${a}`.proto().parseURL(),(e=$(".m-datatable").mDatatable(t)).on("click",".btn-edit",(function(e){e.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:`/admin/gestion-de-requerimientos/obtener/${t}`.proto().parseURL()}).done((function(e){$("#edit-form").trigger("reset"),$("#edit_requeriment_modal").modal("show"),$("#edit-form select[id ='DegreeId-2']").val(e.degreeid).trigger("change").prop("disabled",!0),$("#edit-form input[name ='Id']").val(e.id),$("#edit-form input[name ='did']").val(e.degreeid),$("#ProcedureId-2").select2({allowClear:!0,placeholder:"Buscar por descripción del trámite TUPA",ajax:{type:"GET",url:"/admin/gestion-de-requerimientos/tramites-TUPA/buscar".proto().parseURL(),delay:1e3,data:function(e){return{searchValue:e.term}},processResults:function(e){return{results:$.map(e,(function(e){return{text:e.text,id:e.id}}))}}},escapeMarkup:function(e){return e},minimumInputLength:1}),$("#ProcedureId-2").on("change",(function(){var e=$(this).val();null!=e&&""!=e&&$.ajax({type:"GET",url:`/admin/gestion-de-requerimientos/tramites-TUPA/${e}`.proto().parseURL()}).done((function(e){null!=e&&($("#edit-form input[name ='Name']").val(e.name).prop("disabled",!0),$("#edit-form input[name ='Code']").val(e.code).prop("disabled",!0))}))})),$("#ProcedureId-2").on("select2:unselecting",(function(){$("#edit-form input[name = 'Name']").val("").prop("disabled",!1),$("#edit-form input[name = 'Code']").val("").prop("disabled",!1)})),null!=e.procedureid?$("#ProcedureId-2").append(`<option value="${e.procedureid}" selected="selected">${e.name}</option>`):$("#ProcedureId-2").html(""),0==e.level?($('#edit-form input[name="Name"]').val(e.name).prop("disabled",!1),$('#edit-form input[name="Code"]').val(e.code).prop("disabled",!1),$('#edit-form input[name="Name"]').val(e.name),$('#edit-form input[name="Code"]').val(e.code)):($('#edit-form input[name="Name"]').val(e.name).prop("disabled",!0),$('#edit-form input[name="Code"]').val(e.code).prop("disabled",!0))}))})),e.on("click",".btn-delete",(function(t){t.preventDefault();var a=$(this).data("id");swal({type:"warning",title:"¿Desea eliminar el registro?",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((t=>{$.ajax({type:"POST",url:`/admin/gestion-de-requerimientos/eliminar/${a}`.proto().parseURL()}).always((function(){swal.close()})).done((function(t){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.reload()})).fail((function(e,t,a){var r=e.responseText;""!=r&&400==e.status?toastr.error(r,_app.constants.toastr.title.error):toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}))})}))};return{load:function(){$.ajax({type:"GET",url:"/admin/gestion-de-requerimientos/grados-titulos".proto().parseURL()}).done((function(e){$(".DegreeId").select2({data:e.items}),$(".select-degrees").select2({data:e.items}).trigger("change")})),$(".select-degrees").on("change",(function(){var e=$(this).val();$(".DegreeId").val(e).trigger("change"),a(e)})),$(".btn-add").on("click",(function(){$("#add_requeriment_modal").modal("show"),$("#DegreeId-1").trigger("change"),$(".ProcedureId").select2({allowClear:!0,placeholder:"Buscar por descripción del trámite TUPA",ajax:{type:"GET",url:"/admin/gestion-de-requerimientos/tramites-TUPA/buscar".proto().parseURL(),delay:1e3,data:function(e){return{searchValue:e.term}},processResults:function(e){return{results:$.map(e,(function(e){return{text:e.text,id:e.id}}))}}},escapeMarkup:function(e){return e},minimumInputLength:1}),$(".ProcedureId").on("change",(function(){var e=$(this).val();""!=e&&$.ajax({type:"GET",url:`/admin/gestion-de-requerimientos/tramites-TUPA/${e}`.proto().parseURL()}).done((function(e){$("#add-form input[name = 'Name']").val(e.name).prop("disabled",!0),$("#add-form input[name = 'Code']").val(e.code).prop("disabled",!0)}))})),$(".ProcedureId").on("select2:unselecting",(function(){$("#add-form input[name = 'Name']").val("").prop("disabled",!1),$("#add-form input[name = 'Code']").val("").prop("disabled",!1)}))})),$("#add-form").validate({submitHandler:function(t,a){$.ajax({type:"POST",url:"/admin/gestion-de-requerimientos/agregar".proto().parseURL(),data:$(t).serialize(),success:function(){$("#add_requeriment_modal").modal("hide"),$("#add-form").resetForm(),$("#add-form input[name = 'Name']").val("").prop("disabled",!1),$("#add-form input[name = 'Code']").val("").prop("disabled",!1),e.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.success(_app.constants.toastr.message.error.create,_app.constants.toastr.title.error)}})}}),$("#edit-form").validate({submitHandler:function(t,a){var r=$(t).serializeArray();r.push({name:"DegreeId",value:$("#edit-form input[name ='did']").val()}),$.ajax({type:"POST",url:"/admin/gestion-de-requerimientos/editar".proto().parseURL(),data:$.param(r),success:function(){$("#edit_requeriment_modal").modal("hide"),e.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.update)},error:function(){toastr.success(_app.constants.toastr.message.error.update,_app.constants.toastr.title.error)}})}})}}}();$((function(){degreesRequirements.load()}));