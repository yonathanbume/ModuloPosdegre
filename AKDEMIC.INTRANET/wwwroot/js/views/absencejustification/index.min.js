var Absences=function(){var t,e=null,a={data:{type:"remote",source:{read:{method:"GET",url:"/justificacion-inasistencias/get".proto().parseURL()}}},columns:[{field:"date",title:"Fecha de la Inasistencia",textAlign:"center",width:180},{field:"registerDate",title:"Fecha de la Solicitud",textAlign:"center",width:220},{field:"approved",title:"Estado",textAlign:"center",width:150,template:function(t){var e={3:{text:_app.constants.request.inProcess.text,value:_app.constants.request.inProcess.value,class:"m-badge--metal"},4:{text:_app.constants.request.approved.text,value:_app.constants.request.approved.value,class:"m-badge--success"},5:{text:_app.constants.request.disapproved.text,value:_app.constants.request.disapproved.value,class:"m-badge--danger"}};return"<span class='m-badge "+e[t.status].class+" m-badge--wide'>"+e[t.status].text+"</span>"}},{field:"options",title:"Opciones",width:180,template:function(t){var e="";return e+="<button class='btn btn-default btn-sm m-btn--icon btn-detail' data-id='"+t.id+"'><span><i class='la la-eye'></i><span>Ver Detalle</span></span></button> ",t.canDelete&&(e+="<button class='btn btn-danger btn-sm m-btn--icon btn-delete' data-id='"+t.id+"'><i class='la la-trash'></i></button>"),e}}]},s=function(){$("#btn-add").on("click",(function(){i.load.create()})),t.on("click",".btn-detail",(function(){var t=$(this).data("id");o.show(t)})),t.on("click",".btn-delete",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",text:"La solicitud será eliminada permanentemente",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarla",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((a=>{$.ajax({url:"/justificacion-inasistencias/eliminar/post",type:"POST",data:{id:e},success:function(e){t.reload(),swal({type:"success",title:"Completado",text:"La solicitud ha sido eliminada con éxito",confirmButtonText:"Excelente"})},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Ocurrió un error al intentar eliminar la solicitud"})}})}))})}))},n={init:function(){this.absences.init()},absences:{init:function(){$.ajax({url:"/personal/inasistencias/get"}).done((function(t){$(".select2-absences").select2({data:t.items,dropdownParent:$("#add_modal")})}))}}},i={submit:{create:function(e){var a=new FormData($(e).get(0)),s=0===$("#File").get(0).files.length;$(e).find("input").prop("disabled",!0),$(e).find("textarea").prop("disabled",!0),$(e).find("select").prop("disabled",!0),$(e).find("#btnCreate").addLoader(),s||($(e).find(".custom-file").append("<div id='space-bar' class='m--space-10'></div><div class='progress m-progress--sm'><div class='progress-bar progress-bar-striped progress-bar-animated m--bg-primary' role='progressbar'></div></div>"),$(".progress-bar").width("0%")),$.ajax({url:$(e).attr("action"),type:"POST",contentType:!1,processData:!1,data:a,xhr:function(){var t=new window.XMLHttpRequest;return s||(t.upload.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total;e=parseInt(100*e),$(".progress-bar").width(e+"%")}}),t}}).always((function(){$(e).find("input").prop("disabled",!1),$(e).find("textarea").prop("disabled",!1),descargar,$(e).find("select").prop("disabled",!1),$(e).find("#btnCreate").removeLoader(),$(".progress").empty().remove(),s||$("#space-bar").remove()})).done((function(){$("#add_modal").modal("toggle"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),t.reload()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=t.responseText?$("#add_form_msg_txt").html(t.responseText):$("#add_form_msg_txt").html(_app.constant.ajax.message.error),$("#add_form_msg").removeClass("m--hide").show()}))}},reset:{create:function(){e.resetForm(),$("#add_form_msg").addClass("m--hide").hide()}},load:{create:function(){$("#add_modal").modal("show"),$("#add_modal").one("hidden.bs.modal",(function(){i.reset.create()}))}}},r=function(){e=$("#add-form").validate({rules:{File:{fileSizeMBs:20}},submitHandler:function(t,e){e.preventDefault(),i.submit.create(t)}})},o={show:function(t){mApp.blockPage(),$.ajax({url:("/justificacion-inasistencias/"+t+"/get").proto().parseURL()}).done((function(e){var a=$("#detail-form").get(0).elements;a.DetailDate.value=e.date,a.DetailRegisterDate.value=e.registerDate;var s={3:{text:_app.constants.request.inProcess.text},4:{text:_app.constants.request.approved.text},5:{text:_app.constants.request.disapproved.text}};a.DetailStatus.value=s[e.status].text,a.DetailJustification.value=e.justification,e.file?($("#fileDiv").show(),$("#fileUrl").attr("href",`/justificacion-inasistencias/${t}/archivo/descargar`.proto().parseURL())):$("#fileDiv").hide(),mApp.unblockPage(),$("#detail_modal").modal("toggle"),$("#detail_modal").on("hidden.bs.modal",(function(){o.reset()}))}))},reset:function(){var t=$("#detail-form").get(0).elements;t.DetailDate.value=null,t.DetailRegisterDate.value=null,t.DetailStatus.value=null,t.DetailJustification.value=null}};return{init:function(){t=$(".m-datatable").mDatatable(a),r(),s(),n.init()}}}();$((function(){Absences.init()}));