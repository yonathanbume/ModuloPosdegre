var isInformationTupa="True"==$("#informationtupa").val()||"true"==$("#informationtupa").val(),procedure=function(){var e={ajax:{objects:{}},datatable:{load:{get:function(){e.datatable.objects["procedure-datatable-get"]=$("#procedure-datatable-get").mDatatable({data:{source:{read:{method:"GET",url:"/tramites/get".proto().parseURL()}}},columns:[{field:"name",title:"Nombre del Trámite"},{field:"duration",title:"Duración",template:function(e){var t="";return t+=e.duration,t+=1!==e.duration?" días":" día"}},{field:"procedureRequirementsCostSum",title:"Costo",template:function(e){var t="";return t+="S/. ",t+=e.procedureRequirementsCostSum.toFixed(2)}},{field:"uit",title:"UITs",template:function(e){var t="";return null!=uit?(t+=(e.procedureRequirementsCostSum/uit.value).toFixed(2),t+=" UITs"):t+="---",t}},{field:"options",title:"Opciones",sortable:!1,filterable:!1,template:function(e){var t="";return t+=`<a class="btn btn-primary btn-sm m-btn m-btn--icon" href="${"/tramites/usuarios/solicitar-tramite".proto().parseURL()}/${e.id}">`,t+='<span><i class="la la-book"></i><span>Ver Detalle</span></span></a> '}}]})}},objects:{}},modal:{objects:{}},validate:{load:{request:function(){e.validate.objects["procedure-modal-request-form"]=$("#procedure-modal-request-form").validate({submitHandler:function(e,t){t.preventDefault(),procedure.ajax.load.request(e,t)}})}},objects:{}}};return{ajax:{getObject:function(t){return e.ajax.objects[t]},load:{request:function(t,a){var r=t.elements;mApp.block(".modal-content"),e.ajax.objects["procedure-ajax-request"]=$.ajax({data:{ProcedureId:r.ProcedureId.value,Comment:r.Comment.value},type:t.method,url:t.action}).always((function(e,t,a){mApp.unblock(".modal-content")})).done((function(e,a,r){_app.modules.form.reset({element:t}),activeUserProcedure.datatable.getObject("active-user-procedure-datatable-get").reload(),procedure.modal.getObject("procedure-modal-request").modal("hide"),toastr.success(_app.constants.toastr.message.success.create,_app.constants.toastr.title.success)})).fail((function(e,t,a){var r=e.responseText;""!=r&&400==e.status?toastr.error(r,_app.constants.toastr.title.error):toastr.error(_app.constants.toastr.message.error.create,_app.constants.toastr.title.error)}))}}},datatable:{getObject:function(t){return e.datatable.objects[t]}},init:function(){e.datatable.load.get(),e.validate.load.request()},modal:{getObject:function(t){return e.modal.objects[t]},load:{request:function(t,a,r){var o=document.getElementById("procedure-modal-request-form");r=r.proto().decode(),_app.modules.form.reset({element:o}),_app.modules.form.fill({element:o,data:{ProcedureId:r.id}}),e.modal.objects["procedure-modal-request"]=$("#procedure-modal-request").modal("show")}}},validate:{getObject:function(t){return e.validate.objects[t]}}}}(),activeUserProcedure=function(){var e={datatable:{load:{get:function(){e.datatable.objects["active-user-procedure-datatable-get"]=$("#active-user-procedure-datatable-get").mDatatable({data:{source:{read:{method:"GET",url:"/tramites/usuarios/activos/get".proto().parseURL()}}},columns:[{field:"procedure.name",title:"Nombre del Trámite"},{field:"dependency.name",title:"Dependencia Actual",template:function(e){var t="";return null!=e.dependency?t+=e.dependency.name:t+="---",t}},{field:"status",title:"Estado",template:function(e){var t="";return t+=userProcedureStatusValues[e.status]}},{field:"parsedCreatedAt",title:"Fecha de Solicitud",template:function(e){var t=new Date(e.createdAt).proto().addDays(e.procedure.duration).proto().toDate(),a=(new Date).proto().toDate(),r="";return r='<span class="m--font-',t<a?r+="danger":t.valueOf()==a.valueOf()?r+="warning":r+="success",r+='">',r+=e.parsedCreatedAt,r+="</span>"}},{field:"options",title:"Opciones",sortable:!1,filterable:!1,template:function(e){var t="";1==e.status?t+=`<a class="btn btn-info btn-sm m-btn m-btn--icon" href="${`/tramites/usuarios/tramite-solicitado/${e.id}`}/"><span><i class="la la-book"></i><span>Continuar</span></span></a>`:(t+='<button class="btn btn-primary btn-sm m-btn m-btn--icon" onclick="activeUserProcedure.redic.detail(this, event, \'',t+=e.proto().encode(),t+='\')"><span><i class="la la-book"></i><span> Ver Detalle </span></span></button> ',10==e.status&&(t+=`<a class="btn btn-primary btn-sm m-btn m-btn--icon" href="${"/tramites/usuarios/continuar-tramite".proto().parseURL()}/${e.id}">`,t+='<span><i class="la la-book"></i><span>Continuar Trámite</span></span></a> '));return t}}],search:{input:$("#search-2")}})}},objects:{}},init:function(){e.datatable.load.get()}};return{datatable:{getObject:function(t){return e.datatable.objects[t]}},init:function(){return e.init()},redic:{detail:function(e,t,a){var r=(a=a.proto().decode()).id;window.location.href=`/tramites/usuarios/detalle-tramite/${r}`}}}}(),historicUserProcedure=function(){var e={datatable:{load:{get:function(){e.datatable.objects["historic-user-procedure-datatable-get"]=$("#historic-user-procedure-datatable-get").mDatatable({data:{source:{read:{method:"GET",url:"/tramites/usuarios/historicos/get".proto().parseURL()}}},columns:[{field:"procedure.name",title:"Nombre del Trámite"},{field:"dependency.name",title:"Dependencia Actual",template:function(e){var t="";return null!=e.dependency?t+=e.dependency.name:t+="---",t}},{field:"procedure.duration",title:"Duración",template:function(e){var t="";return t+=e.procedure.duration,t+=1!==e.procedure.duration?" días":" día"}},{field:"status",title:"Estado",template:function(e){var t="";return 7==e.status?t+='<span style="width: 222px;color: #d48b6f;font-weight: bold;">'+userProcedureStatusValues[e.status]+"</span>":t+=userProcedureStatusValues[e.status],t}},{field:"parsedCreatedAt",title:"Fecha de Solicitud"},{field:"parsedUpdatedAt",title:"Fecha de Finalización"},{field:"options",title:"Opciones",sortable:!1,filterable:!1,overflow:"visible",template:function(e){var t="";return t+='<button class="btn btn-primary btn-sm m-btn m-btn--icon" onclick="historicUserProcedure.modal.redic.detail(this, event, \'',t+=e.proto().encode(),t+='\')"><span><i class="la la-book"></i><span> Ver Detalle </span></span></button> '}}],search:{input:$("#search-3")}})}},objects:{}},init:function(){e.datatable.load.get()},modal:{objects:{}}};return{datatable:{getObject:function(t){return e.datatable.objects[t]}},init:function(){return e.init()},modal:{getObject:function(t){return e.modal.objects[t]},load:{observation:function(t,a,r){var o="";o+="<p>",o+=null!=(r=r.proto().decode()).observation?r.observation:"No hay datos disponibles.",o+="</p>",document.getElementById("historic-user-procedure-modal-observation-content").innerHTML=o,e.modal.objects["historic-user-procedure-modal-observation"]=$("#historic-user-procedure-modal-observation").modal("show")}},redic:{detail:function(e,t,a){var r=(a=a.proto().decode()).id;window.location.href=`/tramites/usuarios/detalle-tramite/${r}`}}}}}();$((function(){procedure.init(),activeUserProcedure.init(),historicUserProcedure.init(),$(".nav-link.m-tabs__link").on("shown.bs.tab",(function(e){procedure.datatable.getObject("procedure-datatable-get").adjustCellsWidth(),activeUserProcedure.datatable.getObject("active-user-procedure-datatable-get").adjustCellsWidth(),historicUserProcedure.datatable.getObject("historic-user-procedure-datatable-get").adjustCellsWidth()}))}));