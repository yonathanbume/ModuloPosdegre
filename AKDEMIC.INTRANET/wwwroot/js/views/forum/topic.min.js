var posts=function(){var t=0,e=$("#table-topics"),a=function(){$(".btn-delete-post").on("click",(function(){var t=$(this).data("postid");swal({title:"¿Está seguro?",text:"El post será eliminado",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({url:"/foro/post/eliminar/post".proto().parseURL(),type:"POST",data:{id:t},success:function(t){if(""===t)swal({type:"success",title:"Completado",text:"El post ha sido eliminada con éxito",confirmButtonText:"Excelente"}),location.reload();else{var e=$("#categoryId").val();swal({type:"success",title:"Completado",text:t,confirmButtonText:"Excelente"}),window.location.href=`/foro/categoria/${e}`.proto().parseURL()}},error:function(){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Al parecer el post tiene información relacionada"})}})}))})})),e.bind("repaginate",(function(){e.find("tbody tr").hide().slice(5*t,5*(t+1)).show()})),e.trigger("repaginate");for(var a=e.find("tbody tr").length,o=Math.ceil(a/5),n=$('<div class="pager"></div>'),i=0;i<o;i++)$('<span class="page-number"></span>').text(i+1).bind("click",{newPage:i},(function(a){t=a.data.newPage,e.trigger("repaginate"),$(this).addClass("active").siblings().removeClass("active")})).appendTo(n).addClass("clickable");n.insertAfter(e).find("span.page-number:first").addClass("active"),$("body").on("click",".message-comments-toggler",(function(){var t=$(this).data("toggle-id"),e=$(this).find("i");$(e).toggleClass("la-angle-down"),$(e).toggleClass("la-angle-up"),$(`.message-comments-level-2.${t}`).collapse("toggle")})),$("body").on("click",".message-reply-button",(function(){var t=$(this).data("id");console.log(t);var e=$(this).data("fullname");$(".citation-div").collapse("show"),$(".citation-target").text(e),$("#PostCitedId").val(t)})),$("body").on("click",".delete-citation-target",(function(){$(".citation-div").collapse("hide"),$(".citation-target").text(""),$("#PostCitedId").val("")})),$(".fileselect-trigger").click((function(){$("#new-post #File").trigger("click")})),$("#new-post #File").change((function(){var t=$(this).val();null!==t&&t.length>0?$(".fileselect-trigger > span").removeClass("d-none"):$(".fileselect-trigger > span").addClass("d-none")})),$("#new-post").find("button[type=submit]").click((function(){mApp.block($("#new-post"))}))};return{init:function(){a()},deleteCitation:function(){$(".deleteCitation").remove(),$("#citedText").text(""),$("#PostCitedId").val(""),$("#PostCitedId").text("")},addCitation:function(t){var e=$(t).data("postid"),a=$(t).data("fullname");$("#citedText").text(a),""==$("#PostCitedId").val()&&$("#citedText").after('<button style={margin-left:5px;} class="deleteCitation btn btn-default" onclick="posts.deleteCitation()" type="button"><i class="fa fa-trash"></i></button>'),$("#PostCitedId").val(e),$("#PostCitedId").text(e)}}}(),comments={ajax:{list:{},load:{create:function(t,e){t.elements;var a=new FormData(form);comments.ajax.list["posts-ajax-create"]=$.ajax({data:{fdata:a},type:t.method,enctype:"multipart/form-data",url:t.action,processData:!1,beforeSend:function(e,a){$(t).addLoader()},complete:function(e,a){$(t).removeLoader()},success:function(t,e,a){toastr.success(_app.constants.toastr.message.success.create,_app.constants.toastr.title.success),location.reload()},error:function(t,e,a){toastr.error(_app.constants.toastr.message.error.create,_app.constants.toastr.title.error)}})}}},validate:{list:{},load:{create:function(){comments.validate.list["new-post"]=$("#new-post").validate({submitHandler:function(t,e){comments.ajax.load.create(t,e)}})}}}};$((function(){posts.init(),comments.validate.load.create()}));