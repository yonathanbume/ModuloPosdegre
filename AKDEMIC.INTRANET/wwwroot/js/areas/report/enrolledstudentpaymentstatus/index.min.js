var InitApp=function(){var t={students:{object:null,options:{bInfo:!0,columnDefs:[{orderable:!1,targets:[]}],ajax:{url:"/reporte/estado-pagos/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){delete t.columns,t.termId=$("#term_select").val(),t.facultyId=$("#faculty_select").val(),t.careerId=$("#career_select").val(),t.type=$("#type_select").val(),t.status=$("#status_select").val(),t.search=$("#search").val()}},columns:[{title:"Código",data:"code",width:"50px"},{title:"Estudiante",data:"name"},{title:"Escuela Profesional",data:"career",width:"250px"},{title:"Plan",data:"curriculum"},{title:"Créditos",data:"credits"},{title:"Estado",data:"paid",render:function(t){return t?'<span class="m-badge m-badge--success m-badge--wide">Pagado</span>':'<span class="m-badge m-badge--danger m-badge--wide">Por pagar</span>'}},{title:"Opciones",data:null,orderable:!1,render:function(t){return`<button class="btn btn-primary m-btn btn-sm m-btn--icon btn-payments" data-object="${t.proto().encode()}"><span><i class="la la-eye"></i><span>Ver pagos</span></span></button>`}}],dom:"Bfrtip",buttons:[{text:"Excel",action:function(){var t=$(this)[0].node;$(t).addClass("m-loader m-loader--right m-loader--primary").attr("disabled",!0),$.fileDownload("/reporte/estado-pagos/reporte-excel".proto().parseURL(),{httpMethod:"GET",data:{termId:$("#term_select").val(),facultyId:$("#faculty_select").val(),careerId:$("#career_select").val(),type:$("#type_select").val(),status:$("#status_select").val(),search:$("#search").val()},successCallback:function(){toastr.success("Archivo descargado satisfactoriamente","Éxito")}}).done((function(){})).fail((function(){alert("Falló la descarga del archivo!")})).always((function(){$(t).removeClass("m-loader m-loader--right m-loader--primary").attr("disabled",!1)}))}}]},init:function(){this.object=$("#students_table").DataTable(this.options),$("#students_table").on("click",".btn-payments",(function(e){var a=$(this).data("object");a=a.proto().decode(),$("#studentId").val(a.id),$("#student-code").text(a.code),$("#student-name").text(a.name),t.payments.load()}))},load:function(){this.object.ajax.reload()}},payments:{object:null,options:{info:!1,paging:!1,ordering:!1,serverSide:!1,ajax:{url:"/reporte/estado-pagos/pagos/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){delete t.columns,t.termId=$("#term_select").val(),t.studentId=$("#studentId").val(),t.type=$("#type_select").val()},dataSrc:""},columns:[{title:"Tipo",data:"type"},{title:"Concepto",data:"description"},{title:"Estado",data:"status",width:"70px"},{title:"Monto",data:"total"}]},load:function(){void 0!==this.object&&null!==this.object?(this.object.clear().draw(),this.object.ajax.reload()):this.object=$("#payments-table").DataTable(this.options),this.object.columns.adjust(),$("#payments-modal").modal("show")}}},e={term:{init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(e){$("#term_select").select2({data:e.items}),null!==e.selected&&($("#term_select").val(e.selected),$("#term_select").trigger("change.select2")),t.students.init(),$("#term_select").on("change",(function(e){t.students.load()}))}))}},faculty:{init:function(){$.ajax({url:"/facultades/get".proto().parseURL()}).done((function(t){t.items.unshift({id:_app.constants.guid.empty,text:"Todas"}),$("#faculty_select").select2({data:t.items,minimumResultsForSearch:10}),e.career.events(),e.faculty.events()}))},events:function(){$("#faculty_select").on("change",(function(){var a=$("#faculty_select").val();a===_app.constants.guid.empty?(t.students.load(),$("#career_select").empty(),$("#career_select").select2({placeholder:"Seleccione una Escuela",disabled:!0})):(console.log(a),t.students.load(),e.career.load($("#faculty_select").val()))}))}},career:{init:function(){$("#career_select").select2({placeholder:"Seleccione una Escuela"})},load:function(t){$.ajax({url:`/facultades/${t}/carreras/get`.proto().parseURL()}).done((function(t){t.items.unshift({id:_app.constants.guid.empty,text:"Todas"}),$("#career_select").empty(),$("#career_select").select2({placeholder:"Seleccione una Escuela",data:t.items,minimumResultsForSearch:10,disabled:!1})}))},events:function(){$("#career_select").on("change",(function(){t.students.load()}))}},status:{init:function(){$("#status_select").select2({minimumResultsForSearch:10}).on("change",(function(){t.students.load()}))}},type:{init:function(){$("#type_select").select2({minimumResultsForSearch:10}).on("change",(function(){t.students.load()}))}},init:function(){e.term.init(),e.faculty.init(),e.career.init(),e.status.init(),e.type.init()}},a=function(){$("#search").doneTyping((function(){t.students.load()}))};return{init:function(){e.init(),a()}}}();$((function(){InitApp.init()}));