var initApp=function(){var e={students:{object:null,options:{pageLength:50,serverSide:!1,ajax:{url:"/reporte/cursos-desaparobados-estudiante/get",type:"GET",data:function(e){delete e.columns,e.termId=$("#term_select").val(),e.facultyId=$("#faculty_select").val(),e.careerId=$("#career_select").val(),e.courses=$("#disapproved_select").val()},dataSrc:""},columns:[{title:"Código",data:"username"},{title:"Nombre completo",data:"fullname"},{title:"Facultad",data:"faculty"},{title:"Escuela Profesional",data:"career"},{title:"Cantidad",data:"count"},{data:null,title:"Opciones",orderable:!1,render:function(e){return`<button data-id="${e.studentId}" class="btn btn-info btn-sm m-btn m-btn--icon btn-courses" title="Cursos desaprobados"><span><i class="la la-list"></i><span>Ver cursos</span></span></button>`}}],dom:"Bfrtip",buttons:[{text:"Excel",action:function(){var e=$(this)[0].node;$(e).addClass("m-loader m-loader--right m-loader--primary").attr("disabled",!0),$.fileDownload("/reporte/cursos-desaparobados-estudiante/reporte-excel".proto().parseURL(),{httpMethod:"GET",data:{termId:$("#term_select").val(),facultyId:$("#faculty_select").val(),careerId:$("#career_select").val(),courses:$("#disapproved_select").val()}}).done((function(){toastr.success("Archivo descargado satisfactoriamente","Éxito")})).fail((function(){toastr.error("Error al descargar el archivo","Error")})).always((function(){$(e).removeClass("m-loader m-loader--right m-loader--primary").attr("disabled",!1)}))}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#data-table").DataTable(this.options),$("#data-table").on("click",".btn-courses",(function(){console.log("entro");var t=$(this).data("id");e.courses.load(t)}))}},courses:{object:null,options:{pageLength:50,serverSide:!1,ajax:{url:"/reporte/cursos-desaparobados-estudiante/get-cursos",type:"GET",data:function(e){delete e.columns,e.termId=$("#term_select").val(),e.studentId=$("#studentId").val()},dataSrc:""},columns:[{title:"Código",data:"code"},{title:"Curso",data:"name"},{title:"Nota",data:"grade"}]},load:function(e){$("#studentId").val(e),null==this.object?this.object=$("#courses-table").DataTable(this.options):this.object.ajax.reload(),$("#courses_modal").modal("toggle")}}},t={term:{init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(t){$("#term_select").select2({data:t.items}),null!==t.selected&&($("#term_select").val(t.selected),$("#term_select").trigger("change.select2")),$("#term_select").on("change",(function(t){e.students.reload()})),e.students.init()}))}},faculty:{init:function(){$.ajax({url:"/facultades/get".proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todas"}),$("#faculty_select").select2({data:e.items,minimumResultsForSearch:10}),t.career.events(),t.faculty.events()}))},events:function(){$("#faculty_select").on("change",(function(){$("#faculty_select").val()===_app.constants.guid.empty?(e.students.reload(),$("#career_select").empty(),$("#career_select").select2({placeholder:"Seleccione una Escuela",disabled:!0})):(e.students.reload(),t.career.load($("#faculty_select").val()))}))}},career:{init:function(){$("#career_select").select2({placeholder:"Seleccione una Escuela"})},load:function(e){$.ajax({url:`/facultades/${e}/carreras/v2/get?hasAll=false`.proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todas"}),$("#career_select").empty(),$("#career_select").select2({placeholder:"Seleccione una Escuela",data:e.items,minimumResultsForSearch:10,disabled:!1})}))},events:function(){$("#career_select").on("change",(function(){e.students.reload()}))}},try:{init:function(){$("#disapproved_select").select2({minimumResultsForSearch:-1}).on("change",(function(){e.students.reload()}))}},init:function(){t.term.init(),t.faculty.init(),t.career.init(),t.try.init()}};return{init:function(){t.init()}}}();$((function(){initApp.init()}));