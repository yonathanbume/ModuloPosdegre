var InitApp=function(){var e=$("#AcademicYear").val(),t=$("#CourseId").val(),a=$("#CurriculumId").val(),n=$("#TermId").val(),s={assistance:{object:null,options:{serverSide:!1,ajax:{url:"/admin/reporte-docentes/detalle/asistencia/get".proto().parseURL(),type:"GET",data:function(e){e.sectionId=$("#section_select2").val()}},columns:[{data:"student",title:"Estudiante"},{data:"absences",title:"Faltas"},{data:"assisted",title:"Asistidas"},{data:"dictated",title:"Dictadas"}],dom:"Bfrtip",buttons:[{text:"Excel",action:function(e,t,a,n){window.location.href=`/admin/reporte-docentes/seccion/${$("#section_select2").val()}/control-asistencia-excel`.proto().parseURL()}},{text:"Pdf",action:function(e,t,a,n){window.location.href=`/admin/reporte-docentes/detalle/${$("#section_select2").val()}/asistencia/pdf?teacherId=${$("#TeacherId").val()}`.proto().parseURL()}}]},reload:function(){null!==$("#section_select2").val()&&(null===this.object?s.assistance.object=$("#assistance-table").DataTable(this.options):s.assistance.object.ajax.reload())}},grade:{reload:function(){$("#grades_partial").html(""),mApp.block("#grades_partial",{message:"Cargando datos..."}),$.ajax({url:`/admin/reporte-docentes/detalle/notas/get?sectionId=${$("#section_select2").val()}`,type:"GET",dataType:"HTML"}).done((function(e){$("#grades_partial").html(e)}))}}},i={academicyear:{load:function(){$.ajax({url:`/planes-estudio/${a}/niveles/get`,type:"GET"}).done((function(t){$("#academicyear-select").select2({placeholder:"Seleccionar ciclo",data:t.items}),$("#academicyear-select").val(e).trigger("change"),console.log(e),i.academicyear.events()}))},events:function(){$("#academicyear-select").on("change",(function(){var e=$(this).val();i.course.load(e)}))},init:function(){this.load()}},course:{init:function(){$.ajax({url:`/planes-estudio/${a}/niveles/${e}/get`,type:"GET"}).done((function(e){$("#course_select2").select2({placeholder:"Seleccionar cursos",data:e.items}),$("#course_select2").val(t).trigger("change"),i.course.events()}))},load:function(e){$.ajax({url:`/planes-estudio/${a}/niveles/${e}/get`,type:"GET"}).done((function(e){$("#course_select2").empty(),$("#course_select2").select2({placeholder:"Seleccionar cursos",data:e.items}).trigger("change")}))},events:function(){$("#course_select2").on("change",(function(){var e=$(this).val();i.sections.load(e)}))}},sections:{init:function(){this.events.init(),this.load(t)},load:function(e){$("#section_select2").empty(),$.ajax({url:`/cursos/${e}/secciones/get?termId=${n}`,type:"GET"}).done((function(e){$("#section_select2").select2({placeholder:"Seleccionar secciones",data:e.items}).trigger("change")}))},events:{onChange:function(){$("#section_select2").on("change",(function(){var e=$(this).val();null!==e&&""!==e&&(s.assistance.reload(),s.grade.reload())}))},init:function(){this.onChange()}}},init:function(){i.academicyear.init(),i.course.init(),i.sections.init()}},c={firstTime:!0,cleanGrades:function(){$("#clean_grades").on("click",(function(){var e=$("#section_select2").val(),t=$("#course_select2").select2("data")[0].text,a=$("#section_select2").text();console.log(t),console.log(a),swal({type:"warning",text:`¿Seguro que desea eliminar las asistencias del curso ${t} - ${a}? Esta acción no es recuperable.`,title:"Eliminar asistencias",confirmButtonText:"Aceptar",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({type:"POST",url:`/admin/reporte-docentes/detalle/${e}/limpiar-asistencias`}).done((function(e){s.assistance.reload(),swal({type:"success",title:"Completado",text:e,confirmButtonText:"Aceptar"})})).fail((function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===e.status?"No hay respuesta del servidor":e.responseText})}))}))})}))},init:function(){this.cleanGrades()}};return{init:function(){i.init(),c.init()}}}();$((function(){InitApp.init()}));