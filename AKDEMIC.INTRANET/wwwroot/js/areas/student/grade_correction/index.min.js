var index=function(){var e={request:{object:null,options:{ajax:{url:"/alumno/correccion-notas/get",type:"GET",data:function(e){e.termId=$("#select_term").val()}},columns:[{data:"courseCode",title:"Código"},{data:"courseName",title:"Curso"},{data:"section",title:"Sección"},{data:"evaluation",title:"Evaluación"},{data:"newGrade",title:"Nueva nota",render:function(e){var t="Sin asignar";return null!=e&&(t=e),t}},{data:"state",title:"Estado",render:function(e){var t="";switch(e){case 1:t='<span class="m-badge m-badge--metal m-badge--wide">Pendiente</span>';break;case 2:t='<span class="m-badge m-badge--primary m-badge--wide">Aprobado</span>';break;case 3:t='<span class="m-badge m-badge--danger m-badge--wide">Rechazado</span>';break;case 4:t='<span class="m-badge m-badge--warning m-badge--wide">Solicitado</span>'}return t}},{data:null,title:"Opciones",render:function(e){return`<button data-object='${e.proto().encode()}' title='Detalles' class="btn-details btn btn-primary m-btn m-btn--icon btn-sm m-btn--icon-only"><i class="la la-eye"></i></a>`}}]},events:{onDetails:function(){$("#data-table").on("click",".btn-details",(function(){var e=$(this).data("object").proto().decode();$("#request_grade_details_modal").find("[name='CourseFullName']").val(`${e.courseCode}-${e.courseName}`),$("#request_grade_details_modal").find("[name='Section']").val(e.section),$("#request_grade_details_modal").find("[name='Evaluation']").val(e.evaluation),$("#request_grade_details_modal").find("[name='OldGrade']").val(e.oldGrade??"Sin asignar"),$("#request_grade_details_modal").find("[name='NewGrade']").val(e.newGrade??"Sin asignar"),$("#request_grade_details_modal").find("[name='Observations']").val(e.observations),$("#request_grade_details_modal").find("[name='Status']").val(e.statusStr),null!=e.filePath&&""!=e.filePath?($(".grade_correction_file_container").removeClass("d-none"),$(".grade_correction_file_path").attr("href",`/documentos/${e.filePath}`)):($(".grade_correction_file_container").addClass("d-none"),$(".grade_correction_file_path").attr("href","")),$("#request_grade_details_modal").modal("show")}))},init:function(){this.onDetails()}},reload:function(){null==e.request.object?e.request.object=$("#data-table").DataTable(e.request.options):e.request.object.ajax.reload()},init:function(){e.request.events.init()}},init:function(){e.request.init()}},t={request:{object:$("#request_grade_correction_modal"),form:{object:$("#request_grade_correction_form").validate({submitHandler:function(a,n){n.preventDefault();var o=new FormData(a);$("#request_grade_correction_form").find(":input").attr("disabled",!0),$.ajax({url:"/alumno/correccion-notas/solicitar",type:"POST",processData:!1,contentType:!1,data:o}).done((function(a){e.request.reload(),t.request.object.modal("hide"),swal({type:"success",title:"Completado",text:"Solicitud registrada satisfactoriamente.",confirmButtonText:"Aceptar"})})).fail((function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===e.status?"No hay respuesta del servidor":e.responseText})})).always((function(){$("#request_grade_correction_form").find(":input").attr("disabled",!1)}))}})},events:{onHidden:function(){t.request.object.on("hidden.bs.modal",(function(e){t.request.form.object.resetForm(),t.request.object.find(".custom-file-label").text("Seleccione un archivo")}))},init:function(){t.request.events.onHidden()}},init:function(){t.request.events.init()}},init:function(){t.request.init()}},a={term:{load:function(){$.ajax({url:"/periodos/get",type:"GET"}).done((function(t){$("#select_term").select2({data:t.items}),$("#select_term").on("change",(function(){e.request.reload()})),$("#select_term").val(t.selected).trigger("change")}))},init:function(){a.term.load()}},courses:{load:function(){$.ajax({url:"/cursos-matriculados-usuario",type:"GET"}).done((function(e){t.request.object.find("[name='StudentSectionId']").select2({placeholder:"Seleccionar curso...",data:e,dropdownParent:t.request.object}),t.request.object.find("[name='StudentSectionId']").val(null).trigger("change"),t.request.object.find("[name='StudentSectionId']").on("change",(function(){a.grades.load($(this).val())}))}))},init:function(){a.courses.load()}},grades:{load:function(e){t.request.object.find("[name='GradeId']").empty(),t.request.object.find("[name='GradeId']").attr("disabled",!0),null==e?t.request.object.find("[name='GradeId']").select2({placeholder:"Seleccionar nota...",disabled:!0}):(mApp.block(t.request.object,{message:"Cargando evaluaciones..."}),$.ajax({url:`/alumno/correccion-notas/get-notas?studentSectionId=${e}`,type:"GET"}).done((function(e){t.request.object.find("[name='GradeId']").select2({placeholder:"Seleccionar nota...",data:e,disabled:!1,dropdownParent:t.request.object}),t.request.object.find("[name='GradeId']").val(null).trigger("change"),mApp.unblock(t.request.object)})))},init:function(){a.grades.load()}},init:function(){a.term.init(),a.grades.init(),a.courses.init()}};return{init:function(){t.init(),e.init(),a.init()}}}();$((()=>{index.init()}));