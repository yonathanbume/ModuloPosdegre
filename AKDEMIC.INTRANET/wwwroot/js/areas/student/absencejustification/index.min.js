var InitApp=function(){const t={1:{title:"Solicitado",class:" m-badge--metal"},2:{title:"Visto docente",class:" m-badge--info"},3:{title:"Observada",class:" m-badge--warning"},4:{title:"Aprobada",class:" m-badge--success"},5:{title:"Rechazada",class:" m-badge--danger"}};var e={justifications:{object:null,options:{ajax:{url:"/alumno/justificacion-inasistencias/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.search=$("#search").val()}},columns:[{title:"F. Solicitud",data:"date"},{title:"Curso",data:"course"},{title:"F. Clase",data:"classDate",orderable:!1},{title:"Estado",data:"status",orderable:!1,className:"text-center",render:function(e){return'<span class="m-badge '+t[e].class+' m-badge--wide">'+t[e].title+"</span>"}},{title:"Opciones",data:null,orderable:!1,render:function(t){var e="";return e=`<button class="btn btn-info m-btn btn-sm m-btn--icon m-btn--icon-only btn-detail" data-object="${t.proto().encode()}" title="Ver detalle"><i class="la la-eye"></i></button>`,1==t.status&&(e+=` <button class="btn btn-danger m-btn btn-sm m-btn--icon m-btn--icon-only btn-delete" data-id="${t.id}" title="Eliminar"><i class="la la-trash"></i></button>`),e}}]},init:function(){this.object=$("#data-table").DataTable(this.options),$("#data-table").on("click",".btn-detail",(function(e){var a=$(this).data("object");a=a.proto().decode(),$("#detail-student").val(a.name),$("#detail-course").val(a.course),$("#detail-class").val(`Clase dictada el ${a.classDate}`),$("#detail-date").val(a.date),$("#detail-status").val(t[a.status].title),$("#detail-description").val(a.description),null!=a.observation&&""!=a.observation?($("#teacher-observation").show(),$("#detail-observation").val(a.observation)):$("#teacher-observation").hide(),a.file?($("#fileDiv").show(),$("#file-url").attr("href",`/alumno/justificacion-inasistencias/${a.id}/archivo/descargar`.proto().parseURL())):$("#fileDiv").hide(),$("#detail_modal").modal("toggle")})),$("#data-table").on("click",".btn-delete",(function(t){var e=$(this).data("id");a.delete.load(e)}))},reload:function(){this.object.ajax.reload()}}},a={create:{object:$("#create-form").validate({submitHandler:function(t){mApp.block("#create-modal .modal-content");var s=new FormData($(t)[0]);$.ajax({url:$(t).attr("action"),type:"POST",data:s,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.justifications.reload(),a.create.clear()})).fail((function(t){null!==t.responseText&&""!==t.responseText?$("#create-form-alert-txt").html(t.responseText):$("#create-form-alert-txt").html(_app.constants.ajax.message.error),$("#create-form-alert").removeClass("m--hide").show()})).always((function(){mApp.unblock("#create-modal .modal-content")}))}}),clear:function(){a.create.object.resetForm()}},delete:{load:function(t){swal({title:"¿Está seguro?",text:"La solicitud será eliminada permanentemente",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarla",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((a=>{$.ajax({url:"/alumno/justificacion-inasistencias/eliminar",type:"POST",data:{id:t},success:function(){e.justifications.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)},complete:function(){swal.close()}})}))})}}},s=function(){$("#search").doneTyping((function(){e.justifications.reload()}))},n={init:function(){this.course.init()},course:{init:function(){$.ajax({url:"/alumno/seccionescurso/get".proto().parseURL()}).done((function(t){$(".select2-courses").select2({data:t.items,placeholder:"Seleccione un curso",dropdwonParent:$("#create-modal"),minimumResultsForSearch:-1}).trigger("change"),n.classes.init($(".select2-courses").val())})),$(".select2-courses").on("change",(function(){n.classes.init($(this).val())}))}},classes:{init:function(t){$.ajax({url:`/alumno/secciones/${t}/inasistencias/get`.proto().parseURL()}).done((function(t){$(".select2-classes").empty(),$(".select2-classes").select2({data:t.items,placeholder:"Inasistencias",dropdwonParent:$("#create-modal"),minimumResultsForSearch:10})}))}}};return{init:function(){e.justifications.init(),s(),n.init()}}}();$((function(){InitApp.init()}));