var Absences=function(){var e=null,t=null;var a={data:{type:"remote",source:{read:{method:"GET",url:`/alumno/inasistencias/periodo/${$("#select-term").val()}/get`.proto().parseURL()}},pageSize:10,saveState:{cookie:!0,webstorage:!0}},columns:[{field:"courseName",title:"Curso",width:200,sortable:!1},{field:"classCount",title:"Total",textAlign:"center",width:80,sortable:!1},{field:"maxAbsences",title:"Máx. Faltas",textAlign:"center",width:100,sortable:!1},{field:"dictated",title:"Dictadas",textAlign:"center",width:80,sortable:!1},{field:"assisted",title:"Asistidas",textAlign:"center",width:80,sortable:!1},{field:"absences",title:"Faltas",textAlign:"center",width:80,sortable:!1},{field:"absencePercentage",title:"% Faltas",textAlign:"center",sortable:!1,width:80,template:function(e){var t=0;return 0!=e.classCount&&(t=e.absences/e.classCount*100),function(e,t){if((""+e).includes("e")){var a=(""+e).split("e"),s="";return+a[1]+t>0&&(s="+"),+(Math.round(+a[0]+"e"+s+(+a[1]+t))+"e-"+t)}return+(Math.round(e+"e+"+t)+"e-"+t)}(t,2)+" %"}},{field:"options",title:"Opciones",width:150,template:function(e){var t="";return t+='<button class="btn btn-primary m-btn btn-sm m-btn--icon btn-detail" ',t+=`data-id="${e.sectionId}" `,t+='><span><i class="la la-list"></i><span> Ver Detalle</span></span></button>',e.isActive&&(t+=` <button class="btn btn-secondary m-btn btn-sm m-btn--icon m-btn--icon-only btn-request" data-id="${e.sectionId}" title="Solicitar justificación"><i class="la la-eraser"></i></button>`),t}}]},s={dom:"Bfrtip",buttons:[{extend:"excel",className:"btn m-btn m-btn--icon",text:"<i class='la la-file-excel-o'></i><span>Excel</span>",titleAttr:"Excel"}],responsive:!0,processing:!0,serverSide:!1,ajax:{url:`/alumno/inasistencias/seccion/${$("#assistance-filter").val()}/get`.proto().parseURL(),dataSrc:""},columns:[{title:"Semana",data:"week"},{title:"Sesión",data:"sessionNumber"},{title:"Fecha",data:"date"},{title:"Día",data:"weekDay"},{title:"Inicio",data:"startTime"},{title:"Fin",data:"endTime"},{title:"Estado",data:null,orderable:!1,render:function(e,t,a){var s=a.isAbsent?0:1,n={0:{text:_app.constants.assistance.absence.text,value:_app.constants.assistance.absence.value,icon:"la la-user-times",class:"m-badge--danger"},1:{text:_app.constants.assistance.assisted.text,value:_app.constants.assistance.assisted.value,icon:"flaticon-user-ok",class:"m-badge--success"}};return`<span class="m-badge ${n[s].class} m-badge--wide"><i class="${n[s].icon}"></i> ${n[s].text}</span>`}}]},n=function(){$("#select-term").on("change",(function(e){o()}))},i={init:function(){e.on("click",".btn-detail",(function(){var e=$(this).data("id");l.show(e)})),e.on("click",".btn-request",(function(){var e=$(this).data("id");r.create.load(e)}))}},l={show:function(e){$("#absences-detail-modal").modal("toggle"),$("#SectionId").val(e),$("#assistance-filter").select2({minimumResultsForSearch:-1}),$("#assistance-filter").val(_app.constants.assistance.absence.value).trigger("change"),$("#assistance-filter").on("change",(function(t){t.preventDefault(),t.stopImmediatePropagation(),c(e)})),$("#absences-detail-modal").one("shown.bs.modal",(function(e){$("#assistance-filter").trigger("change")})),$("#absences-detail-modal").one("hidden.bs.modal",(function(e){null!==t&&(t.destroy(),t=null),$("#assistance-filter").off("change")}))}},c=function(e){null!==t&&(t.destroy(),$("#absences-detail-datatable").empty(),t=null),s.ajax.url=`/alumno/inasistencias/seccion/${e}/get?filter=${$("#assistance-filter").val()}`.proto().parseURL(),t=$("#absences-detail-datatable").DataTable(s)},o=function(){null!==e&&(e.destroy(),e=null),a.data.source.read.url=`/alumno/inasistencias/periodo/${$("#select-term").val()}/get`.proto().parseURL(),e=$(".m-datatable-absences").mDatatable(a),i.init()},r={create:{object:$("#create-form").validate({submitHandler:function(t){mApp.block("#create-modal .modal-content");var a=new FormData($(t)[0]);$.ajax({url:$(t).attr("action"),type:"POST",data:a,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.justifications.reload(),r.create.clear()})).fail((function(e){null!==e.responseText&&""!==e.responseText?$("#create-form-alert-txt").html(e.responseText):$("#create-form-alert-txt").html(_app.constants.ajax.message.error),$("#create-form-alert").removeClass("m--hide").show()})).always((function(){mApp.unblock("#create-modal .modal-content")}))}}),clear:function(){r.create.object.resetForm()},load:function(e){d.classes.load(e),$("#create-modal").modal("toggle")},clear:function(){r.create.object.resetForm()}}},d={init:function(){this.classes.init()},classes:{init:function(){$(".select2-classes").select2()},load:function(e){$.ajax({url:`/alumno/secciones/${e}/inasistencias/get`.proto().parseURL()}).done((function(e){$(".select2-classes").empty(),$(".select2-classes").select2({data:e.items,placeholder:"Inasistencias",dropdwonParent:$("#create-modal"),minimumResultsForSearch:10})}))}}};return{init:function(){o(),n(),d.init()}}}();$((function(){Absences.init()}));