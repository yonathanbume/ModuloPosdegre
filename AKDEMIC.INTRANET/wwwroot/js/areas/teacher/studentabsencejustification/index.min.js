var InitApp=function(){const t={1:{title:"Solicitado",class:" m-badge--metal"},2:{title:"Visto docente",class:" m-badge--info"},3:{title:"Observada",class:" m-badge--warning"},4:{title:"Aprobada",class:" m-badge--success"},5:{title:"Rechazada",class:" m-badge--danger"}};var e={justifications:{object:null,options:{ajax:{url:"/profesor/justificacion-inasistencias-alumnos/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.search=$("#search").val(),t.status=$("#state-select").val()}},columns:[{title:"F. Solicitud",data:"date"},{title:"CÃ³digo",data:"code"},{title:"Estudiante",data:"name"},{title:"Curso",data:"course"},{title:"Estado",data:"status",className:"text-center",render:function(e){return'<span class="m-badge '+t[e].class+' m-badge--wide">'+t[e].title+"</span>"}},{title:"Opciones",data:null,orderable:!1,render:function(t){var e="";return e=`<button class="btn btn-default m-btn btn-sm m-btn--icon m-btn--icon-only btn-detail" data-object="${t.proto().encode()}" title="Ver detalle"><i class="la la-eye"></i></button>`,1==t.status&&(e+=` <button class="btn btn-success m-btn btn-sm m-btn--icon m-btn--icon-only btn-validate" data-object="${t.proto().encode()}" title="Validar"><i class="la la-check"></i></button>`),e}}]},init:function(){this.object=$("#data-table").DataTable(this.options),$("#data-table").on("click",".btn-detail",(function(e){var a=$(this).data("object");a=a.proto().decode(),$("#detail-student").val(a.name),$("#detail-course").val(a.course),$("#detail-teacher").val(a.teacher),$("#detail-class").val(`Clase dictada el ${a.classDate}`),$("#detail-date").val(a.date),$("#detail-status").val(t[a.status].title),$("#detail-description").val(a.description),null!=a.observation&&""!=a.observation?($("#teacher-observation").show(),$("#detail-observation").val(a.observation)):$("#teacher-observation").hide(),a.file?($("#fileDiv").show(),$("#file-url").attr("href",`/admin/justificacion-inasistencias/alumnos/${a.id}/archivo/descargar`.proto().parseURL())):$("#fileDiv").hide(),$("#detail_modal").modal("toggle")})),$("#data-table").on("click",".btn-validate",(function(t){var e=$(this).data("object");e=e.proto().decode(),a.validate.load(e)}))},reload:function(){this.object.ajax.reload()}}},a={create:{object:$("#create-form").validate({submitHandler:function(t){mApp.block("#create-modal .modal-content");var s=new FormData($(t)[0]);$.ajax({url:$(t).attr("action"),type:"POST",data:s,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.justifications.reload(),a.create.clear()})).fail((function(t){console.log(t),null!==t.responseText&&""!==t.responseText?(console.log(t.responseText),$("#create-form-alert-txt").html(t.responseText)):$("#create-form-alert-txt").html(_app.constants.ajax.message.error),$("#create-form-alert").removeClass("m--hide").show()})).always((function(){mApp.unblock("#create-modal .modal-content")}))}}),clear:function(){a.create.object.resetForm()}},validate:{object:$("#validate-form").validate({submitHandler:function(t){mApp.block("#validate-modal .modal-content"),$.ajax({url:$(t).attr("action"),type:"POST",data:$(t).serialize()}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.justifications.reload(),a.validate.clear()})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)})).always((function(){mApp.unblock("#validate-modal .modal-content")}))}}),load:function(t){$("#validate-student").val(t.name),$("#validate-course").val(t.course),$("#validate-class").val(`Clase dictada el ${t.classDate}`),$("#justificationId").val(t.id),$("#validate-observation").val(""),$("#validate-modal").modal("toggle")},clear:function(){a.validate.object.resetForm()}}},s={init:function(){this.classes.init(),this.students.init(),this.course.init(),this.states.init()},course:{init:function(){$.ajax({url:"/profesor/seccionescurso/get".proto().parseURL()}).done((function(t){$(".select2-courses").select2({data:t.items,placeholder:"Seleccione un curso",dropdwonParent:$("#create-modal"),minimumResultsForSearch:-1}),$(".select2-courses").on("change",(function(){s.students.load($(this).val())})),$(".select2-courses").trigger("change")}))}},students:{init:function(){$(".select2-students").select2({placeholder:"Seleccione un estudiante",dropdwonParent:$("#create-modal"),minimumResultsForSearch:10}),$(".select2-students").on("change",(function(){s.classes.load()}))},load:function(t){$.ajax({url:`/profesor/justificacion-inasistencias-alumnos/alumnos/${t}/get`.proto().parseURL()}).done((function(t){$(".select2-students").empty(),$(".select2-students").select2({data:t.items,placeholder:"Seleccione un estudiante",dropdwonParent:$("#create-modal"),minimumResultsForSearch:10}).trigger("change")}))}},classes:{init:function(){$(".select2-classes").select2({placeholder:"Inasistencias",dropdwonParent:$("#create-modal"),minimumResultsForSearch:10})},load:function(){var t=$(".select2-courses").val(),e=$(".select2-students").val();$.ajax({url:`/profesor/justificacion-inasistencias-alumnos/alumno/${e}/inasistencias/${t}/get`.proto().parseURL()}).done((function(t){$(".select2-classes").empty(),$(".select2-classes").select2({data:t.items,placeholder:"Inasistencias",dropdwonParent:$("#create-modal"),minimumResultsForSearch:10})}))}},states:{init:function(){$("#state-select").select2(),$("#state-select").on("change",(function(){e.justifications.reload()}))}}},o=function(){$("#search").doneTyping((function(){e.justifications.reload()}))};return{init:function(){e.justifications.init(),o(),s.init()}}}();$((function(){InitApp.init()}));