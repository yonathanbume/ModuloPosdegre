var InitApp=function(){const t={1:{title:"Solicitado",class:" m-badge--metal"},2:{title:"Visto docente",class:" m-badge--info"},3:{title:"Observada",class:" m-badge--warning"},4:{title:"Aprobada",class:" m-badge--success"},5:{title:"Rechazada",class:" m-badge--danger"}};var a={justifications:{object:null,optionsTeacher:{ajax:{url:"/profesor/justificacion-inasistencias-alumnos/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.search=$("#search").val(),t.status=$("#state-select").val()}},columns:[{title:"F. Solicitud",data:"date",width:"80px"},{title:"Código",data:"code",width:"80px"},{title:"Estudiante",data:"name",width:"400px"},{title:"Curso",data:"course"},{title:"Estado",data:"status",className:"text-center",width:"100px",render:function(a){return'<span class="m-badge '+t[a].class+' m-badge--wide">'+t[a].title+"</span>"}},{title:"Opciones",data:null,orderable:!1,width:"130px",render:function(t){var a="";return a=`<button class="btn btn-default m-btn btn-sm m-btn--icon m-btn--icon-only btn-detail" data-object="${t.proto().encode()}" title="Ver detalle"><i class="la la-eye"></i></button>`,1==t.status&&(a+=` <button class="btn btn-success m-btn btn-sm m-btn--icon m-btn--icon-only btn-validate" data-object="${t.proto().encode()}" title="Validar"><i class="la la-check"></i></button>`),a}}]},optionsDirector:{ajax:{url:"/admin/justificacion-inasistencias/alumnos/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){delete t.columns,t.search=$("#search").val(),t.status=$("#state-select").val()}},columns:[{title:"F. Solicitud",data:"date",width:"80px"},{title:"Código",data:"code",width:"80px"},{title:"Estudiante",data:"name",width:"400px"},{title:"Curso",data:"course"},{title:"Estado",data:"status",className:"text-center",width:"100px",render:function(a){return'<span class="m-badge '+t[a].class+' m-badge--wide">'+t[a].title+"</span>"}},{title:"Opciones",data:null,orderable:!1,width:"130px",render:function(t){var a="";return a=`<button class="btn btn-default m-btn btn-sm m-btn--icon m-btn--icon-only btn-detail" data-object="${t.proto().encode()}" title="Ver detalle"><i class="la la-eye"></i></button>`,2!=t.status&&3!=t.status||(a+=' <button class="btn btn-success m-btn btn-sm m-btn--icon m-btn--icon-only approve" data-id="'+t.id+'" title="Aprobar"><i class="la la-check"></i></button>',a+=' <button class="btn btn-danger m-btn btn-sm m-btn--icon m-btn--icon-only disapprove" data-id="'+t.id+'" title="Rechazar"><i class="la la-remove"></i></button>'),a}}]},init:function(a){this.object=$("#data-table").DataTable(a),$("#data-table").on("click",".btn-detail",(function(a){var e=$(this).data("object");e=e.proto().decode(),$("#detail-student").val(e.name),$("#detail-course").val(e.course),$("#detail-teacher").val(e.teacher),$("#detail-class").val(`Clase dictada el ${e.classDate}`),$("#detail-date").val(e.date),$("#detail-status").val(t[e.status].title),$("#detail-description").val(e.description),null!=e.observation&&""!=e.observation?($("#teacher-observation").show(),$("#detail-observation").val(e.observation)):$("#teacher-observation").hide(),e.file?($("#fileDiv").show(),$("#file-url").attr("href",`/admin/justificacion-inasistencias/alumnos/${e.id}/archivo/descargar`.proto().parseURL())):$("#fileDiv").hide(),$("#detail_modal").modal("toggle")})),$("#data-table").on("click",".btn-validate",(function(t){var a=$(this).data("object");a=a.proto().decode(),e.validate.load(a)})),$("#data-table").on("click",".approve",(function(){var t=$(this).data("id");e.approve.load(t)})),$("#data-table").on("click",".disapprove",(function(){var t=$(this).data("id");e.disapprove.load(t)}))},change:function(t){this.object.clear(),this.object.destroy(),1==t?($("#btn-add").show(),this.init(this.optionsTeacher)):($("#btn-add").hide(),this.init(this.optionsDirector))},reload:function(){this.object.ajax.reload()}}},e={create:{object:$("#create-form").validate({submitHandler:function(t){mApp.block("#create-modal .modal-content");var s=new FormData($(t)[0]);$.ajax({url:$(t).attr("action"),type:"POST",data:s,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),a.justifications.reload(),e.create.clear()})).fail((function(t){console.log(t),null!==t.responseText&&""!==t.responseText?(console.log(t.responseText),$("#create-form-alert-txt").html(t.responseText)):$("#create-form-alert-txt").html(_app.constants.ajax.message.error),$("#create-form-alert").removeClass("m--hide").show()})).always((function(){mApp.unblock("#create-modal .modal-content")}))}}),clear:function(){e.create.object.resetForm()}},validate:{object:$("#validate-form").validate({submitHandler:function(t){mApp.block("#validate-modal .modal-content"),$.ajax({url:$(t).attr("action"),type:"POST",data:$(t).serialize()}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),a.justifications.reload(),e.validate.clear()})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)})).always((function(){mApp.unblock("#validate-modal .modal-content")}))}}),load:function(t){$("#validate-student").val(t.name),$("#validate-course").val(t.course),$("#validate-class").val(`Clase dictada el ${t.classDate}`),$("#justificationId").val(t.id),$("#validate-observation").val(""),$("#validate-modal").modal("toggle")},clear:function(){e.validate.object.resetForm()}},approve:{load:function(t){swal({title:"¿Está seguro?",text:"La solicitud será aprobada",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, continuar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((e=>{$.ajax({url:"/admin/justificacion-inasistencias/alumnos/post",type:"POST",data:{id:t,approved:!0},success:function(){a.justifications.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)},complete:function(){swal.close()}})}))})}},disapprove:{load:function(t){swal({title:"¿Está seguro?",text:"La solicitud será desaprobada",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, continuar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((e=>{$.ajax({url:"/admin/justificacion-inasistencias/alumnos/post",type:"POST",data:{id:t,approved:!1},success:function(){a.justifications.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)},complete:function(){swal.close()}})}))})}}},s={init:function(){this.classes.init(),this.students.init(),this.course.init(),this.type.init(),this.states.init()},course:{init:function(){$.ajax({url:"/profesor/seccionescurso/get".proto().parseURL()}).done((function(t){$(".select2-courses").select2({data:t.items,placeholder:"Seleccione un curso",dropdwonParent:$("#create-modal"),minimumResultsForSearch:-1}),$(".select2-courses").on("change",(function(){s.students.load($(this).val())})),$(".select2-courses").trigger("change")}))}},students:{init:function(){$(".select2-students").select2({placeholder:"Seleccione un estudiante",dropdwonParent:$("#create-modal"),minimumResultsForSearch:10}),$(".select2-students").on("change",(function(){s.classes.load()}))},load:function(t){$.ajax({url:`/profesor/justificacion-inasistencias-alumnos/alumnos/${t}/get`.proto().parseURL()}).done((function(t){$(".select2-students").empty(),$(".select2-students").select2({data:t.items,placeholder:"Seleccione un estudiante",dropdwonParent:$("#create-modal"),minimumResultsForSearch:10}).trigger("change")}))}},classes:{init:function(){$(".select2-classes").select2({placeholder:"Inasistencias",dropdwonParent:$("#create-modal"),minimumResultsForSearch:10})},load:function(){var t=$(".select2-courses").val(),a=$(".select2-students").val();$.ajax({url:`/profesor/justificacion-inasistencias-alumnos/alumno/${a}/inasistencias/${t}/get`.proto().parseURL()}).done((function(t){$(".select2-classes").empty(),$(".select2-classes").select2({data:t.items,placeholder:"Inasistencias",dropdwonParent:$("#create-modal"),minimumResultsForSearch:10})}))}},type:{init:function(){$(".select-view").select2({placeholder:"Seleccione una opción",minimumResultsForSearch:-1}),$(".select-view").on("change",(function(){a.justifications.change($(".select-view").val())}))}},states:{init:function(){$("#state-select").select2(),$("#state-select").on("change",(function(){a.justifications.reload()}))}}},n=function(){$("#search").doneTyping((function(){a.justifications.reload()}))};return{init:function(){a.justifications.init(a.justifications.optionsTeacher),n(),s.init()}}}();$((function(){InitApp.init()}));