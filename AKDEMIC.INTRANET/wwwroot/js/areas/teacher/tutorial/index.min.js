var Tutorial=function(){var t,e,a,o={load:function(){mApp.block(".m-calendar__container",{type:"loader",message:"Cargando..."}),t=$(".m-calendar__container").fullCalendar(n),this.events()},reload:function(){null!==t&&($(t).fullCalendar("destroy"),t=null),this.load()},events:function(){t.on("click",".fc-prev-button",(function(){$(this).prop("disabled",!0),mApp.block(".m-calendar__container",{type:"loader",message:"Cargando..."})})),t.on("click",".fc-next-button",(function(){$(this).prop("disabled",!0),mApp.block(".m-calendar__container",{type:"loader",message:"Cargando..."})}))},updateEvents:function(t,e,a){if(t.start.date()!==t.end.date()&&0!==t.end.hours()&&0!==t.end.minutes())return toastr.error("Rango de horas inválido",_app.constants.toastr.title.error),void a();var o=t.start.hours(),n=t.start.minutes(),s=t.end.hours(),r=t.end.minutes();if(r+=60*s,(n+=60*o)>0&&n<420||r>0&&r<420)return toastr.error("Rango de horas inválido",_app.constants.toastr.title.error),void a();$.ajax({url:"/profesor/tutorias/editartiempo/post".proto().parseURL(),type:"POST",data:{date:t.start.format(_app.constants.formats.datepickerJsMoment),start:t.start.format(_app.constants.formats.timepickerJsMoment),end:t.end.format(_app.constants.formats.timepickerJsMoment),id:t.id}}).done((function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)})).fail((function(t){t.responseText?toastr.error(t.responseText,_app.constants.toastr.title.error):toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),a()}))}},n={allDaySlot:!1,aspectRatio:2,businessHours:{dow:[1,2,3,4,5,6],end:"24:00",start:"07:00"},columnFormat:"dddd",contentHeight:700,defaultView:"agendaWeek",editable:!0,eventRender:function(t,e){e.hasClass("fc-day-grid-event")?(e.data("content",t.description),e.data("placement","top"),mApp.initPopover(e)):e.hasClass("fc-time-grid-event")?e.find(".fc-title").append('<div class="fc-description">'+t.description+"</div>"):0!==e.find(".fc-list-item-title").length&&e.find(".fc-list-item-title").append('<div class="fc-description">'+t.description+"</div>");var a=e.find(".fc-title").clone().children().remove().end().text();e.css("border-color","#"+a.proto().toRGB()).css("border-width","2px")},events:{className:"m-fc-event--primary",error:function(){toastr.error("Ocurrió un problema con el servidor","Error")},url:"/profesor/tutorias/get".proto().parseURL()},eventAfterAllRender:function(){$(".fc-prev-button").prop("disabled",!1),$(".fc-next-button").prop("disabled",!1),mApp.unblock(".m-calendar__container")},eventClick:function(t,e,a){mApp.blockPage(),r.show.detail(t.id,(function(){$("#tabContent a").first().addClass("active").addClass("show"),$("#general").addClass("active").addClass("show"),mApp.unblockPage(),i.load(t.id),$("#edit_modal").modal("show"),$("#edit_modal").one("hidden.bs.modal",(function(){$("#tabContent a").removeClass("active").removeClass("show"),$(".tab-pane").removeClass("active").removeClass("show"),i.destroy()}))}))},eventResize:o.updateEvents,eventDrop:o.updateEvents,firstDay:1,header:{left:"prev,next today",center:"title"},height:600,locale:"es",maxTime:"24:00:00",minTime:"06:00:00",monthNames:monthNames,dayNames:dayNames,monthNamesShort:monthNamesShort,dayNamesShort:dayNamesShort,buttonText:{today:"hoy",month:"mes",week:"semana",day:"día"},slotDuration:"00:30:00",timeFormat:"h(:mm)A"},s={data:{source:{read:{method:"GET",url:"/profesor/tutorias/alumnos/get".proto().parseURL()}}},pagination:!1,columns:[{field:"code",title:"Código",width:120},{field:"name",title:"Nombre Completo",width:250}]},r={show:{create:function(){$("#add_modal").modal("show"),$("#add_modal").one("hidden.bs.modal",(function(){r.reset.create()}))},detail:function(t,e){$.ajax({url:`/profesor/tutorias/${t}/get`.proto().parseURL()}).done((function(t){var a=$("#edit-form").get(0);a.Edit_ClassroomId.value=t.classroomId,a.Edit_SectionId.value=t.sectionId,a.Edit_Id.value=t.id,$("#Edit_Date").datepicker("setDate",t.date),$("#Edit_Start").timepicker("setTime",t.start),$("#Edit_End").timepicker("setTime",t.end),$("#edit-form input").prop("disabled",!0),$("#edit-form select").prop("disabled",!0),t.editable?($("#btnEdit").show(),$("#btnDelete").show(),$("#btnSave").hide(),$("#btnCancelEdit").hide(),$("#separator").show()):($("#btnEdit").hide(),$("#btnDelete").hide(),$("#btnSave").hide(),$("#btnCancelEdit").hide(),$("#separator").hide()),e()})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}},submit:{create:function(t){var e=$(t).serialize();$(t).find("#btnCreate").addLoader(),$(t).find("input").prop("disabled",!0),$(t).find("select").prop("disabled",!0),$.ajax({url:$(t).attr("action"),type:"POST",data:e}).always((function(){$(t).find("#btnCreate").removeLoader(),$(t).find("input").prop("disabled",!1),$(t).find("select").prop("disabled",!1)})).done((function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),$("#add_modal").modal("hide"),o.reload()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=t.responseText?$("#add_form_msg_txt").html(t.responseText):$("#add_form_msg_txt").html(_app.constants.ajax.message.error),$("#add_form_msg").removeClass("m--hide").show()}))},edit:function(t){var e=$(t).serialize();$(t).find("#btnSave").addLoader(),$(t).find("#btnCancelEdit").addLoader(),$(t).find("input").prop("disabled",!0),$(t).find("select").prop("disabled",!0),$.ajax({url:$(t).attr("action"),type:"POST",data:e}).always((function(){$(t).find("#btnSave").removeLoader(),$(t).find("#btnCancelEdit").removeLoader(),$(t).find("input").prop("disabled",!1),$(t).find("select").prop("disabled",!1)})).done((function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),r.switch.editToDetail(),o.reload()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=t.responseText?$("#edit_form_msg_txt").html(t.responseText):$("#edit_form_msg_txt").html(_app.constants.ajax.message.error),$("#edit_form_msg").removeClass("m--hide").show()}))}},reset:{create:function(){e.resetForm();var t=moment(),a=15*Math.ceil(t.minute()/15),o=t.minute(a).format(_app.constants.formats.timepickerJsMoment);$("#Add_Start").timepicker("setTime",o),$("#Add_End").timepicker("setTime",o),$("#Add_SectionId").prop("selectedIndex",0).trigger("change"),$("#Add_ClassroomId").prop("selectedIndex",0).trigger("change")}},switch:{detailToEdit:function(){$("#edit-form input").prop("disabled",!1),$("#edit-form select").prop("disabled",!1),$("#btnEdit").hide(),$("#btnDelete").hide(),$("#btnSave").show(),$("#btnCancelEdit").show()},editToDetail:function(){$("#btnCancelEdit").addLoader(),$("#btnSave").prop("disabled",!0),r.show.detail($("#Edit_Id").val(),(function(){$("#btnCancelEdit").removeLoader(),$("#btnSave").prop("disabled",!1)}))}},delete:function(t){swal({title:"¿Está seguro?",text:"La tutoría será eliminada permanentemente",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarla",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((e=>{$.ajax({url:"/profesor/tutorias/eliminar/post".proto().parseURL(),type:"POST",data:{id:t},success:function(t){$("#edit_modal").modal("hide"),o.reload(),swal({type:"success",title:"Completado",text:"La tutoría ha sido eliminada con éxito",confirmButtonText:"Excelente"})},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Ocurrió un error al intentar eliminar la tutoría"})}})}))})}},i={load:function(t){s.data.source.read.url=`/profesor/tutorias/${t}/alumnos/get`.proto().parseURL(),a=$(".students-datatable").mDatatable(s)},destroy:function(){a.destroy(),a=null}},d=function(){$("#btnAdd").on("click",(function(){r.show.create()})),$("#btnEdit").on("click",(function(){r.switch.detailToEdit()})),$("#btnCancelEdit").on("click",(function(){r.switch.editToDetail()})),$("#btnDelete").on("click",(function(){r.delete($("#Edit_Id").val())})),$(".nav-link").on("shown.bs.tab",(function(t){a.adjustCellsWidth()}))},l={init:function(){this.sections.init(),this.classrooms.init()},sections:{init:function(){$.ajax({url:"/profesor/seccionescurso/get".proto().parseURL()}).done((function(t){$(".select2-sections").select2({data:t.items,placeholder:"Seccíón",minimumResultsForSearch:-1})}))}},classrooms:{init:function(){$.ajax({url:"/aulas/get".proto().parseURL()}).done((function(t){$("#Add_ClassroomId").select2({data:t.items,placeholder:"Aula",dropdownParent:$("#add_modal .modal-body")}),$("#Edit_ClassroomId").select2({data:t.items,placeholder:"Aula",dropdownParent:$("#edit_modal .modal-body")})}))}}},c=function(){var t=new Date;t.setDate(t.getDate()),$(".date-picker").datepicker({startDate:t})},m=function(){$(".timepicker").timepicker().on("changeTime.timepicker",(function(t){var e=t.time.hours,a=t.time.minutes;a+=60*e,"AM"===t.time.meridian&&(360===a||405===a?$(this).timepicker("setTime","12:00 AM"):735===a||60===a||a>180&&a<420?$(this).timepicker("setTime","7:00 AM"):(a>720||a<=180)&&$(this).timepicker("setTime","12:00 AM"))}))},p=function(){e=$("#add-form").validate({submitHandler:function(t,e){e.preventDefault(),r.submit.create(t)}}),$("#edit-form").validate({submitHandler:function(t,e){e.preventDefault(),r.submit.edit(t)}})};return{init:function(){d(),o.load(),l.init(),c(),m(),p()}}}();$((function(){Tutorial.init()}));