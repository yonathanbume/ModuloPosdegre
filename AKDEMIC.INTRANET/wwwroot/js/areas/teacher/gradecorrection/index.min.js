var RequestsTable=function(){var e,t={data:{source:{read:{method:"GET",url:null}}},columns:[{field:"course",title:"Curso"},{field:"section",title:"Sección"},{field:"code",title:"Código"},{field:"student",title:"Estudiante"},{field:"evaluation",title:"Evaluación"},{field:"grade",title:"Nueva Nota"},{field:"state",title:"Estado",sortable:!1,filterable:!1,template:function(e){switch(e.state){case 1:return"<span class='m-badge m-badge--metal m-badge--wide'> Pendiente </span>";case 2:return"<span class='m-badge m-badge--primary m-badge--wide'> Aprobado </span>";case 3:return"<span class='m-badge m-badge--danger m-badge--wide'> Rechazado </span>";case 4:return"<span class='m-badge m-badge--warning m-badge--wide'> Solicitado</span>"}}},{field:"options",title:"Opciones",sortable:!1,filterable:!1,template:function(e){var t="-";return 4==e.state&&e.requestedByStudent&&(t=`<button data-object="${e.proto().encode()}" type="button" title="Asignar nota" class="btn btn-primary m-btn m-btn--icon btn-sm m-btn--icon-only btn-assign-student-request"><i class="la la-edit"></i></button>`),t}}]};return{loadTable:function(n){t.data.source.read.url=("/profesor/correccion-notas/get/"+n).proto().parseURL(),void 0!==e&&e.destroy(),e=$(".m-datatable").mDatatable(t)},reloadTable:function(){e.reload()}}}(),TermSelect={init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(e){$("#select_term").select2({data:e.items}),null!==e.selected&&($("#select_term").val(e.selected),$("#select_term").trigger("change.select2")),RequestsTable.loadTable($("#select_term").val()),$("#select_term").on("change",(function(e){null!=$("#select_term").val()&&RequestsTable.loadTable($("#select_term").val())}))}))}},SelectGroup=function(){var e,t,n,a;return{courseInit:function(){$.ajax({url:"/profesor/correccion-notas/cursos/get".proto().parseURL()}).done((function(s){e=$("#courses").select2({minimumResultsForSearch:-1,placeholder:"Seleccione un curso",data:s.items,dropdownParent:$("#request_modal")}),t=$("#section").select2({minimumResultsForSearch:-1,placeholder:"Seleccione una sección",dropdownParent:$("#request_modal")}),n=$("#student").select2({minimumResultsForSearch:-1,placeholder:"Seleccione un estudiante",dropdownParent:$("#request_modal")}),a=$("#GradeId").select2({minimumResultsForSearch:-1,placeholder:"Seleccione una evaluación",dropdownParent:$("#request_modal")}),$("#courses").on("change",(function(e){null!=$("#courses").val()&&SelectGroup.sectionList($("#courses").val())})),$("#section").on("change",(function(e){null!=$("#section").val()&&SelectGroup.studentList($("#section").val())})),$("#student").on("change",(function(e){null!=$("#student").val()&&SelectGroup.gradeList($("#student").val())}))}))},sectionList:function(e){$.ajax({url:("/profesor/correccion-notas/secciones/get/"+e).proto().parseURL()}).done((function(e){t.empty(),t.select2({minimumResultsForSearch:-1,placeholder:"Seleccione una sección",data:e.items}),t.val(null).trigger("change"),n.empty(),a.empty()}))},studentList:function(e){$.ajax({url:("/profesor/correccion-notas/alumnos/get/"+e).proto().parseURL()}).done((function(e){n.empty(),n.select2({dropdownParent:$("#request_modal"),placeholder:"Seleccione un estudiante",data:e.items}),n.val(null).trigger("change"),a.empty()}))},gradeList:function(e){a.empty(),$.ajax({url:("/profesor/correccion-notas/notas/get/"+e).proto().parseURL()}).done((function(e){a.select2({minimumResultsForSearch:-1,placeholder:"Seleccione una evaluación",data:e.items}),a.val(null).trigger("change")}))},resetSelects:function(){e.val(null).trigger("change.select2"),t.empty().trigger("change.select2"),n.empty().trigger("change.select2"),a.empty().trigger("change.select2")}}}(),InitApp=function(){var e={object:$("#create-form").validate({submitHandler:function(t){mApp.block("#request_modal .modal-content");var n=new FormData($(t)[0]);$.ajax({url:$(t).attr("action"),type:"POST",data:n,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),RequestsTable.reloadTable(),e.reset(),SelectGroup.resetSelects()})).fail((function(e){null!==e.responseText&&""!==e.responseText?$("#create-form-alert-txt").html(e.responseText):$("#create-form-alert-txt").html(_app.constants.ajax.message.error),$("#create-form-alert").removeClass("m--hide").show()})).always((function(){mApp.unblock("#request_modal .modal-content")}))}}),reset:function(){e.object.resetForm()}},t={object:$("#request_student_form").validate({submitHandler:function(e){mApp.block("#request_student_modal .modal-content");var t=new FormData($(e)[0]);$.ajax({url:$(e).attr("action"),type:"POST",data:t,contentType:!1,processData:!1}).done((function(){$("#request_student_modal").modal("hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),RequestsTable.reloadTable()})).fail((function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===e.status?"No hay respuesta del servidor":e.responseText})})).always((function(){mApp.unblock("#request_student_modal .modal-content")}))}}),events:{init:function(){$(".btn-student-request-reject").on("click",(function(){$("#request_student_form").attr("action","/profesor/correccion-notas/denegar-solicitud-estudiante"),$("#request_student_form").find("[name='NewGrade']").attr("required",!1),$("#request_student_form").submit()})),$(".btn-student-request-accept").on("click",(function(){$("#request_student_form").attr("action","/profesor/correccion-notas/aceptar-solicitud-estudiante"),$("#request_student_form").find("[name='NewGrade']").attr("required",!0),$("#request_student_form").submit()}))}},init:function(){this.events.init()}};return{init:function(){t.init()},reset:function(){e.reset()}}}();$((function(){TermSelect.init(),SelectGroup.courseInit(),InitApp.init(),$("#NotTaken").on("change",(function(){console.log("asdasd"),$(this).is(":checked")?$("#create-form").find("[name='NewGrade']").val(null).trigger("change").attr("disabled",!0):$("#create-form").find("[name='NewGrade']").val(null).trigger("change").attr("disabled",!1)})),$("select").on("select2:close",(function(e){$(this).valid()})),$("#request_modal").on("hidden.bs.modal",(function(){InitApp.reset(),SelectGroup.resetSelects(),$("#create_msg").addClass("m--hide")})),$("#ajax_data").on("click",".btn-assign-student-request",(function(){var e=$(this).data("object").proto().decode();$("#request_student_modal").find("[name='CourseFullName']").val(`${e.code}-${e.course}`),$("#request_student_modal").find("[name='Section']").val(e.section),$("#request_student_modal").find("[name='StudentFullName']").val(e.student),$("#request_student_modal").find("[name='Evaluation']").val(`${e.evaluation}- NOTA : ${e.oldGrade}`),$("#request_student_modal").find("[name='NewGrade']").val(null),$("#request_student_modal").find("[name='Observations']").val(e.observations),$("#request_student_modal").find("[name='Id']").val(e.id),""!=e.filePath&&null!=e.filePath?($("#request_student_modal").find(".grade_correction_file_container").removeClass("d-none"),$("#request_student_modal").find(".grade_correction_file_path").attr("href",`/documentos/${e.filePath}`)):($("#request_student_modal").find(".grade_correction_file_container").addClass("d-none"),$("#request_student_modal").find(".grade_correction_file_path").attr("href","")),$("#request_student_modal").modal("show")}))}));