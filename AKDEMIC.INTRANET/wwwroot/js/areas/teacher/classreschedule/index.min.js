var classReschedule=function(){var e={ajax:{objects:{}},datatable:{load:{get:function(){e.datatable.objects["class-reschedule-datatable-get"]=$("#class-reschedule-datatable-get").mDatatable({data:{source:{read:{method:"GET",url:"/profesor/clases/reprogramaciones/get".proto().parseURL()}}},columns:[{field:"class.classSchedule.section.courseTerm.course.fullName",title:"Curso"},{field:"class.classSchedule.section.code",title:"Sección"},{field:"class.startTime",title:"Clase"},{field:"status",title:"Estado",template:function(e){var t="";return t+=classRescheduleStatusValues[e.status]}},{field:"createdAt",title:"Fecha de Solicitud"},{field:"options",title:"Opciones",sortable:!1,filterable:!1,template:function(e){var t="";return t+='<button class="btn btn-primary btn-sm m-btn m-btn--icon" onclick="classReschedule.modal.load.detail(this, event, \'',t+=e.proto().encode(),t+='\')"><span><i class="la la-eye"></i><span> Detalle </span></span></button> ',e.status==classRescheduleStatusIndices.IN_PROCESS&&(t+='<button class="btn btn-danger m-btn btn-sm m-btn--icon m-btn--icon-only" onclick="classReschedule.swal.load.delete(this, event, \'',t+="/profesor/clases/reprogramaciones/eliminar/post".proto().parseURL(),t+="', '",t+=e.proto().encode(),t+='\')"><i class="la la-trash"></i></button>'),t}}]})}},objects:{}},datepicker:{load:{startDate:function(){e.datepicker.objects["class-reschedule-datepicker-start-date"]=$("#class-reschedule-modal-request-form .start-date-datepicker").datepicker({startDate:"0d"})}},objects:{}},modal:{objects:{}},other:{classes:null,sections:null},select2:{load:{class:function(){$("#class-reschedule-modal-request-form .class-select2").on("select2:select",(function(e){var t=$(this).select2("data")[0],s=moment(t.text,_app.constants.formats.datepickerJsMoment);s.isValid()&&classReschedule.datepicker.getObject("class-reschedule-datepicker-start-date").datepicker("setStartDate",s.format(_app.constants.formats.datepickerJsMoment))}))},course:function(){$("#class-reschedule-modal-request-form .course-select2").on("select2:select",(function(t){var s=$(this).select2("data")[0],a=[];for(var c in e.other.sections){var l=e.other.sections[c];l.courseTerm.courseId==s.id&&a.push(l)}$("#class-reschedule-modal-request-form .section-select2").proto().htmlElement((function(e){var t=$(e);t.hasClass("select2-hidden-accessible")&&(t.select2("destroy"),t.html("")),_app.modules.select.fill({data:a,element:e,name:"code"}),t.select2({dropdownParent:t.closest(".modal")}),t.trigger("select2:select")}))}))},section:function(){$("#class-reschedule-modal-request-form .section-select2").on("select2:select",(function(t){var s=$(this).select2("data")[0],a=[];for(var c in e.other.classes){var l=e.other.classes[c];l.sectionId==s.id&&a.push(l)}$("#class-reschedule-modal-request-form .class-select2").proto().htmlElement((function(e){var t=$(e);t.hasClass("select2-hidden-accessible")&&(t.select2("destroy"),t.html("")),_app.modules.select.fill({data:a,element:e,name:"startTime"}),t.select2({dropdownParent:t.closest(".modal")}),t.trigger("select2:select")}))}))},status:function(){$("#class-reschedule-header-form .status-select2").proto().htmlElement((function(e){var t=$(e);_app.modules.select.fill({data:classRescheduleStatusValues,element:e,nullable:!0});var s=t.parents(".modal"),a={};s.length>0&&(a.dropdownParent=s),t.select2(a)})),$("#class-reschedule-header-form .status-select2").on("select2:select",(function(e){var t=$(this).select2("data")[0],s=classReschedule.datatable.getObject("class-reschedule-datatable-get");s.setDataSourceParam("status",t.id),s.load()}))}},objects:{}},swal:{load:{delete:function(t,s){e.swal.objects["class-reschedule-swal-delete"]=swal({preConfirm:function(){return new Promise((function(e,a){classReschedule.ajax.load.delete(t,s)}))},title:"¿Desea eliminar esta solicitud de reprogramación de clase?",type:"warning",showCancelButton:!0,showLoaderOnConfirm:!0})}},objects:{}},timepicker:{load:{init:function(){$(".start-time-timepicker").timepicker({minuteStep:5}).on("changeTime.timepicker",(function(t){var s=t.time.hours,a=t.time.minutes;a+=60*s,"AM"===t.time.meridian&&(360===a||405===a?$(this).timepicker("setTime","12:00 AM"):735===a||60===a||a>180&&a<420?$(this).timepicker("setTime","7:00 AM"):(a>720||a<=180)&&$(this).timepicker("setTime","12:00 AM")),e.validate.objects["class-reschedule-modal-request-form"].element(".start-time-timepicker"),e.validate.objects["class-reschedule-modal-request-form"].element(".end-time-timepicker")})),$(".end-time-timepicker").timepicker({minuteStep:5}).on("changeTime.timepicker",(function(t){var s=t.time.hours,a=t.time.minutes;a+=60*s,"AM"===t.time.meridian&&(360===a||405===a?$(this).timepicker("setTime","12:00 AM"):735===a||60===a||a>180&&a<420?$(this).timepicker("setTime","7:00 AM"):(a>720||a<=180)&&$(this).timepicker("setTime","12:00 AM")),e.validate.objects["class-reschedule-modal-request-form"].element(".start-time-timepicker"),e.validate.objects["class-reschedule-modal-request-form"].element(".end-time-timepicker")}))},endTime:function(){e.timepicker.objects["class-reschedule-datepicker-end-time"]=$("#class-reschedule-modal-request-form .end-time-timepicker").timepicker({minuteStep:5})},startTime:function(){e.timepicker.objects["class-reschedule-datepicker-start-time"]=$("#class-reschedule-modal-request-form .start-time-timepicker").timepicker({minuteStep:5})}},objects:{}},validate:{load:{request:function(){e.validate.objects["class-reschedule-modal-request-form"]=$("#class-reschedule-modal-request-form").validate({rules:{EndTime:{required:!0,timeRange:[$(".start-time-timepicker"),">"]},StartTime:{required:!0,timeRange:[$(".end-time-timepicker"),"<"]}},submitHandler:function(e,t){t.preventDefault(),classReschedule.ajax.load.request(e,t)}})}},objects:{}}};return{ajax:{getObject:function(t){return e.ajax.objects[t]},load:{class:function(){e.ajax.objects["class-reschedule-ajax-class"]=$.ajax({type:"GET",url:"/profesor/clases/get-no-dictadas".proto().parseURL()}).done((function(t,s,a){$(".class-select2").proto().htmlElement((function(s){e.other.classes=t,$("#class-reschedule-modal-request-form .section-select2").proto().htmlElement((function(e){$(e).trigger("select2:select")}))}))})).fail((function(e,t,s){toastr.error(_app.constants.toastr.message.error.get,_app.constants.toastr.title.error)}))},course:function(){e.ajax.objects["class-reschedule-ajax-course"]=$.ajax({type:"GET",url:"/profesor/cursos/get".proto().parseURL()}).always((function(e,t,s){classReschedule.ajax.load.section()})).done((function(e,t,s){$(".course-select2").proto().htmlElement((function(t){var s=$(t),a=s.val();s.hasClass("select2-hidden-accessible")&&(s.select2("destroy"),s.html("")),_app.modules.select.fill({data:e,element:t,name:"courseTerm.course.fullName",selectedValue:a,value:"courseTerm.courseId"}),s.select2({dropdownParent:s.closest(".modal")})}))})).fail((function(e,t,s){toastr.error(_app.constants.toastr.message.error.get,_app.constants.toastr.title.error)}))},delete:function(t,s){e.ajax.objects["class-reschedule-ajax-delete"]=$.ajax({data:{Id:t.id},type:"POST",url:s}).always((function(e,t,s){swal.close()})).done((function(e,t,s){classReschedule.datatable.getObject("class-reschedule-datatable-get").reload(),toastr.success(_app.constants.toastr.message.success.delete,_app.constants.toastr.title.success)})).fail((function(e,t,s){toastr.error(_app.constants.toastr.message.error.delete,_app.constants.toastr.title.error)}))},request:function(t,s){var a=t.elements;mApp.block(".modal-content"),e.ajax.objects["class-reschedule-ajax-request"]=$.ajax({data:{ClassId:a.ClassId.value,Date:a.StartDate.value,StartTime:a.StartTime.value,EndTime:a.EndTime.value,Justification:a.Justification.value,IsPermanent:$(a.IsPermanent).is(":checked")},type:t.method,url:t.action}).always((function(e,t,s){mApp.unblock(".modal-content")})).done((function(e,s,a){_app.modules.form.reset({element:t}),classReschedule.datatable.getObject("class-reschedule-datatable-get").reload(),classReschedule.modal.getObject("class-reschedule-modal-request").modal("hide"),toastr.success(_app.constants.toastr.message.success.create,_app.constants.toastr.title.success)})).fail((function(e,t,s){var a=e.responseText;""!=a&&400==e.status?toastr.error(a,_app.constants.toastr.title.error):toastr.error(_app.constants.toastr.message.error.create,_app.constants.toastr.title.error)}))},section:function(){e.ajax.objects["class-reschedule-ajax-section"]=$.ajax({type:"GET",url:"/profesor/secciones/get".proto().parseURL()}).always((function(e,t,s){classReschedule.ajax.load.class()})).done((function(t,s,a){e.other.sections=t,$("#class-reschedule-modal-request-form .course-select2").proto().htmlElement((function(e){$(e).trigger("select2:select")}))})).fail((function(e,t,s){toastr.error(_app.constants.toastr.message.error.get,_app.constants.toastr.title.error)}))}}},datatable:{getObject:function(t){return e.datatable.objects[t]}},datepicker:{getObject:function(t){return e.datepicker.objects[t]}},init:function(){e.datatable.load.get(),e.datepicker.load.startDate(),e.select2.load.class(),e.select2.load.course(),e.select2.load.section(),e.select2.load.status(),e.timepicker.load.endTime(),e.timepicker.load.startTime(),e.timepicker.load.init(),e.validate.load.request(),classReschedule.ajax.load.course()},modal:{getObject:function(t){return e.modal.objects[t]},load:{detail:function(t,s,a){var c=document.getElementById("class-reschedule-modal-detail-form");a=a.proto().decode(),_app.modules.form.fill({element:c,data:{CourseId:a.class.classSchedule.section.courseTerm.course.fullName,SectionId:a.class.classSchedule.section.code,ClassId:a.class.startTime,StartDate:moment(a.startDateTime,_app.constants.formats.datetimepickerJsMoment).format(_app.constants.formats.datepickerJsMoment),StartTime:moment(a.startDateTime,_app.constants.formats.datetimepickerJsMoment).format(_app.constants.formats.timepickerJsMoment),EndTime:moment(a.endDateTime,_app.constants.formats.datetimepickerJsMoment).format(_app.constants.formats.timepickerJsMoment),Justification:a.justification,IsPermanent:a.isPermanent?"Sí":"No"}}),e.modal.objects["class-reschedule-modal-detail"]=$("#class-reschedule-modal-detail").modal("show")},request:function(t,s){var a=document.getElementById("class-reschedule-modal-request-form");_app.modules.form.reset({element:a}),e.modal.objects["class-reschedule-modal-request"]=$("#class-reschedule-modal-request").modal("show");var c=moment(),l=15*Math.ceil(c.minute()/15),o=c.minute(l).format(_app.constants.formats.timepickerJsMoment);$("#class-reschedule-modal-request-form input[name='StartTime']").val(o),$("#class-reschedule-modal-request-form input[name='EndTime']").val(o)}}},other:{getClasses:function(){return e.other.classes},getSections:function(){return e.other.sections}},select2:{getObject:function(t){return e.select2.objects[t]}},swal:{getObject:function(t){return e.swal.objects[t]},load:{delete:function(t,s,a,c){c=c.proto().decode(),e.swal.objects["class-reschedule-swal-delete"]=swal({preConfirm:function(){return new Promise((function(e,t){classReschedule.ajax.load.delete(c,a)}))},title:_app.constants.swal.title.delete,type:"warning",showCancelButton:!0,showLoaderOnConfirm:!0})}}},timepicker:{getObject:function(t){return e.timepicker.objects[t]}},validate:{getObject:function(t){return e.validate.objects[t]}}}}();$((function(){classReschedule.init()}));