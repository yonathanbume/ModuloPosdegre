var datatable,section=$("#section").val(),initDatatable=function(){var t=function(){$("#form-validation").validate({submitHandler:function(t){console.log($(this.submitButton)),mApp.block(".m-portlet"),$.ajax({url:$(t).attr("action"),type:"POST",data:$(t).serialize(),success:function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(t){null==t.responseText||""==t.responseText?toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error):toastr.error(t.responseText,_app.constants.toastr.title.error)},complete:function(){mApp.unblock(".m-portlet")}})}})},e=function(){$("#publish-btn").on("click",(function(t){t.preventDefault(),$("#form-validation").valid()&&swal({title:"Publicar notas",text:"Una vez publicadas no podrán ser modificadas. ¿Está seguro?",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, publicar",confirmButtonClass:"btn btn-success m-btn m-btn--custom",cancelButtonText:"Cancelar"}).then((function(t){t.value&&(mApp.block(".m-portlet"),$.ajax({url:"/profesor/notas/registrar/publicar".proto().parseURL(),type:"POST",data:$("#form-validation").serialize(),success:function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),swal({type:"success",title:"Notas publicadas",text:"Las notas han sido publicadas y seran visibles para los estudiantes",confirmButtonText:"Aceptar"}).then((function(t){t&&(window.location.href=`/profesor/notas/detalle/${$("#section").val()}`)}))},error:function(t){mApp.unblock(".m-portlet"),toastr.error(t.responseText,_app.constants.toastr.title.error)}}))}))}))};return{init:function(){t(),e()}}}();jQuery(document).ready((function(){initDatatable.init()}));var InitApp=function(){var t={students:{object:null,options:{responsive:!0,processing:!0,serverSide:!1,filter:!1,lengthChange:!1,paging:!1,pageLength:50,ordering:!1,orderMulti:!1,columnDefs:[{orderable:!1,targets:[]}],language:{processing:"<div class='overlay custom-loader-background'><i class='fa fa-cog fa-spin custom-loader-color'></i></div>",lengthMenu:"",infoEmpty:"",zeroRecords:"No existen registros",info:"",infoFiltered:"_MAX_ / _TOTAL_",paginate:{next:">>",previous:"<<"}},ajax:{url:`/profesor/notas/registrar/getalumnos/${section}/${$("#evaluation").val()}`.proto().parseURL(),type:"GET",dataType:"JSON"},columns:[{data:null,title:"#",render:function(t,e,a,n){return n.row+1}},{data:"code",title:"Código",width:70,textAlign:"center"},{data:"student",title:"Estudiante"},{data:null,title:"No rindió",width:70,className:"text-center",render:function(t,e,a,n){return t.status?`RET <input hidden data-id="${t.id}" type="checkbox" class="chck" name="grades[${n.row}].NotTaken" value="true" checked>`:t.pending?t.attended?"<label class='m-checkbox' style='padding-left: 18px'><input data-id='"+t.id+"' type='checkbox' class='chck' name='grades["+n.row+"].NotTaken' value='true'>&nbsp;<span></span></label>":"<label class='m-checkbox' style='padding-left: 18px'><input checked data-id='"+t.id+"' type='checkbox' class='chck' name='grades["+n.row+"].NotTaken' value='true'>&nbsp;<span></span></label>":t.attended?"<label class='m-checkbox' style='padding-left: 18px'><input disabled type='checkbox' class='chck' value='true'>&nbsp;<span></span></label>":"<label class='m-checkbox' style='padding-left: 18px'><input disabled checked type='checkbox' class='chck' value='true'>&nbsp;<span></span></label>"}},{data:null,title:"Nota",className:"text-center",render:function(t,e,a,n){return t.status?`<input hidden name="grades[${n.row}].Id" value="${t.id}">\n                                    <input hidden class="input-student-id" value="${t.studentId}">\n                                    <div class="form-group m-form__group"> RET\n                                        <input hidden type="number" id="input_${t.id}" class="form-control form-control-sm text-right" name="grades[${n.row}].Grade" required value="${t.grade}">\n                                    </div>`:t.pending?`<input hidden name="grades[${n.row}].Id" value="${t.id}">\n                                    <input hidden class="input-student-id" value="${t.studentId}">\n                                    <div class="form-group m-form__group">\n                                        <input tabindex="1" type="number" min="0" max="20" placeholder="0" id="input_${t.id}" class="form-control form-control-sm text-right grade-input" name="grades[${n.row}].Grade" required value="${t.grade}" data-number=${n.row} style="width:100px; font-size: 1rem; margin: auto;">\n                                    </div>`:`<input hidden type="number" id="input_${t.id}" class="form-control form-control-sm text-right" name="grades[${n.row}].Grade" required value="${t.grade}"><input hidden name="grades[${n.row}].Id" value="${t.id}"><div class="form-group m-form__group"> ${t.grade} </div>`}}],fnDrawCallback:function(){e.focusInputGrade(0)}},init:function(){this.object=$("#data-table").DataTable(this.options),$("#data-table").on("change",".chck",(function(){var t=$(this).data("id");this.checked?($(`#input_${t}`).attr("disabled",!0),$(`#input_${t}`).val(0),$(`#input_${t}`).parent().removeClass("has-danger")):$(`#input_${t}`).removeAttr("disabled")})),$("#data-table").on("click focusin",".grade-input",(function(){0==this.value&&(this.value="")})),$("#data-table").on("focusout",".grade-input",(function(){""==this.value&&(this.value="0")}))},reload:function(){this.object.ajax.reload()}}},e={focusInputGrade:function(t){$("#data-table").find(`[name='grades[${t}].Grade']`).focus()},onChangeFocusInput:function(){$("#data-table").on("keypress","input[type=number]",(function(t){if(13==(t.charCode||t.keyCode||0)){var a=$(this).data("number"),n=parseInt(a)+1;e.focusInputGrade(n)}}))},init:function(){$(".grade-input").on("click focusin",(function(){console.log("enmtro"),0==this.value&&(this.value="")})),$(".grade-input").on("focusout",(function(){""==this.value&&(this.value="0")})),this.onChangeFocusInput()}};return{init:function(){t.students.init(),e.init()}}}();$((function(){InitApp.init(),document.getElementById("form-validation").onkeypress=function(t){13==(t.charCode||t.keyCode||0)&&t.preventDefault()}}));