var ReportApp=function(){var e={tableId:"#exams-datatable",currentObject:null,options:{destroy:!0,ajax:{data:function(e,t){e.termId=$(".select2-terms").val(),e.statusId=$(".select2-status").val()},url:`${location.href}/get`,type:"GET"},columns:[{data:"courseName",name:"courseName",title:"Curso",orderable:!1},{data:"sectionCode",name:"sectionCode",title:"Seccion",orderable:!1},{data:"studentName",name:"studentName",title:"Estudiante",orderable:!1},{data:"status",name:"status",title:"Estado",orderable:!1,render:function(e,t,n,a){var s=n.status;return 0===s?'<span class="m-badge m-badge--info m-badge--wide">Registrado</span>':1===s?'<span class="m-badge m-badge--success m-badge--wide">Evaluado</span>':'<span class="m-badge m-badge--danger m-badge--wide">No aplica</span>'}},{data:"Actions",orderable:!1,width:"250px"}],columnDefs:[{targets:-1,className:"text-center",title:"Acciones",orderable:!1,render:function(e,t,n){return 0===n.status?'<button data-id="'+n.id+'" class="btn btn-info btn-sm m-btn m-btn--icon btn-edit"><span><i class="la la-edit"></i><span>Evaluar</span></span></button>':1===n.status?'<button data-id="'+n.id+'" class="btn btn-primary btn-sm m-btn m-btn--icon btn-detail"><span><i class="la la-eye"></i><span>Detalle</span></span></button>':"--"}}],drawCallback:function(){e.updating.fired=!1}},updating:{fired:!1,run:function(){if(null===e.currentObject)return e.initialize(),void(e.updating.fired=!0);e.updating.fired||(e.updating.fired=!0,e.currentObject.draw())}},initialize:function(){e.currentObject=$(e.tableId).DataTable(e.options)},events:function(){$(e.tableId).on("click",".btn-edit",(function(){var e=$(this).data("id");$.ajax({url:`${location.href}/${e}/get`,type:"get"}).done((function(e){$("#cId").val(e.id),$("#StudentName").text(e.studentName),$("#CourseName").text(e.coursName),$("#request-modal-create").modal("show")}))})),$(e.tableId).on("click",".btn-detail",(function(){var e=$(this).data("id");$("#request_detail").modal("show"),$.ajax({url:`${location.href}/${e}/detalles`,type:"get"}).done((function(e){$("#request_detail").find(":input").attr("disabled",!0),$("#request_detail").find("[name='Student']").val(e.fullName),$("#request_detail").find("[name='LastGraded']").val(e.prevFinalScore),$("#request_detail").find("[name='FinalGrade']").val(null==e.teacherExamScore?e.examScore:e.teacherExamScore),$("#request_detail").find(":input").attr("disabled",!1)}))}))}},t={sections:{currentValue:_app.constants.guid.empty,events:function(){$(".select2-status").change((function(){t.sections.currentValue=$(this).val(),e.updating.run()}))},initialize:function(){$(".select2-sections").select2(),$(".select2-status").select2()},update:function(){$.ajax({url:`${location.href}/cursos/${$(".select2-courses").val()}/secciones`,type:"get"}).done((function(e){$(".select2-sections").select2({data:e.items}).prop("disabled",!1)}))},run:function(){this.initialize(),this.events()}},courses:{object:null,run:function(){null!==t.courses.object&&t.courses.object.select2("destroy"),$.ajax({url:`${location.href}/cursos`,type:"get"}).done((function(n){t.courses.object=$(".select2-courses").select2({data:n}).prop("disabled",!1).change((function(){t.sections.update(),e.updating.run()})),e.updating.run()}))}},terms:{load:function(){$.ajax({url:"/ultimos-periodos/get?yearDifference=1",type:"GET"}).done((function(t){$(".select2-terms").select2({data:t.items,placeholder:"Seleccionar periodo"}),$(".select2-terms").on("change",(function(){e.updating.run()}))}))},init:function(){this.load()}},run:function(){this.sections.run(),this.courses.run(),this.terms.init()}},n={createModal:{run:function(){var t=$("#request-modal-create-form").validate({rules:{Score:{required:!0,range:[0,20]}},submitHandler:function(n,a){a.preventDefault(),swal({title:"¿Está seguro?",text:`La nota(${$(n).find("#cScore").val()}) será asignada.`,type:"info",showCancelButton:!0,confirmButtonText:"Sí, asignar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((a=>{$.ajax({url:$(n).attr("action"),data:$(n).serialize(),type:"POST",success:function(n){t.resetForm(),e.currentObject.draw(),$("#request-modal-create").modal("hide"),swal({type:"success",title:"Completado",text:"La nota ha sido asignada",confirmButtonText:"Excelente"})},error:function(e){console.log(e),t.resetForm(),swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:e.responseText})}})}))})}})}},run:function(){this.createModal.run()}};return{run:function(){e.events(),t.run(),n.run()}}}();$((function(){ReportApp.run()}));