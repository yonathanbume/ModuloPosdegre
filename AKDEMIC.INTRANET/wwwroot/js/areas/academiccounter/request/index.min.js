var InitApp=function(){var t={init:function(){t.types.init(),t.students.init(),t.academic_record.init(),$("#term_select").select2(),t.certificatePartial.init()},academic_record:{init:function(){$.ajax({url:"/registros_academicos/get".proto().parseURL()}).done((function(t){$("#academic_record_select").select2({placeholder:"Seleccionar usuario",data:t})}))}},types:{init:function(){$.ajax({url:"/ventanilla/solicitudes/tipos/get".proto().parseURL()}).done((function(e){$("#type_select").select2({data:e.items}).on("change",(function(){18!=$(this).val()||""!=$("#student_select").val()&&null!=$("#student_select").val()?18==$(this).val()&&""!=$("#student_select").val()&&null!=$("#student_select").val()?($("#row_certificatestudies_partial").addClass("d-none"),$("#term_select").select2({disabled:!1}),$(".term-select").show()):25==$(this).val()?($("#row_certificatestudies_partial").removeClass("d-none"),t.certificatePartial.range.load()):($("#row_certificatestudies_partial").addClass("d-none"),$("#term_select").select2("data",null),$(".term-select").hide()):($("#row_certificatestudies_partial").addClass("d-none"),$("#term_select").select2({disabled:!0}),$(".term-select").show())}))}))}},students:{init:function(){$("#student_select").select2({width:"100%",placeholder:"Buscar...",ajax:{url:"/ventanilla/solicitudes/buscar".proto().parseURL(),dataType:"json",data:function(t){return{term:t.term,page:t.page}},processResults:function(t,e){return{results:t.items}},cache:!0},escapeMarkup:function(t){return t},minimumInputLength:3}).on("change",(function(){18==$("#type_select").val()&&($("#term_select").empty(),studentId=$(this).val(),$.ajax({url:`/periodos-por-estudiante/get?studentId=${studentId}`.proto().parseURL()}).done((function(t){$("#term_select").select2({data:t.items,disabled:!1})}))),25==$("#type_select").val()&&t.certificatePartial.range.load()}))}},certificatePartial:{rangeType:{load:function(){$("#range_type_select").select2({placeholder:"Seleccionar tipo",minimumResultsForSearch:-1}).on("change",(function(){t.certificatePartial.range.load()}))},init:function(){this.load()}},range:{load:function(){var t=$("#range_type_select").val(),e=$("#student_select").val();$("#range_start_select").empty(),$("#range_end_select").empty(),1==t?$.ajax({url:`/ventanilla/solicitudes/get-ciclos-alumno?studentId=${e}`}).done((function(t){$("#range_start_select").select2({placeholder:"Seleccionar",data:t}),$("#range_end_select").select2({placeholder:"Seleccionar",data:t})})):$.ajax({url:`/ventanilla/solicitudes/get-periodos-alumno?studentId=${e}`}).done((function(t){$("#range_start_select").select2({placeholder:"Seleccionar",data:t}),$("#range_end_select").select2({placeholder:"Seleccionar",data:t})}))},init:function(){$("#range_start_select").select2({placeholder:"Seleccionar"}),$("#range_end_select").select2({placeholder:"Seleccionar"})}},init:function(){this.rangeType.init(),this.range.init()}}},e={history:{object:null,options:getSimpleDataTableConfiguration({serverSide:!1,url:"/ventanilla/solicitudes/historial/get".proto().parseURL(),data:function(t){delete t.columns,t.studentId=$("#student_select").val(),t.type=$("#type_select").val(),t.academicrecordId=$("#academic_record_select").val()},pageLength:50,orderable:[],columns:[{title:"Fecha emisión",data:"date"},{title:"Nro. constancia",data:"number"},{title:"Personal Asignado",data:"academicrecord"},{title:"Estado",data:"status"},{title:"Observaciones",data:null,render:function(t){return`<button data-id='${t.id}' class="btn btn-primary btn-sm m-btn m-btn--icon btn-observations" <span=""><i class="la la-eye"></i>Observaciones</button>`}}]}),events:{onObservations:function(){$("#data-table").on("click",".btn-observations",(function(){var t=$(this).data("id");$("#recordHistoryId").val(t),e.observation.reload(),$("#observation_modal").modal("show")}))},onFinish:function(){$("#data-table").on("click",".btn-finish",(function(){var t=$(this).data("id");swal({title:"Proceso de Solicitud",text:"¿Seguro que desea finalizar la solicitud?",type:"warning",showCancelButton:!0,confirmButtonText:"Sí",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({url:"/ventanilla/solicitudes/finalizar?id="+t,type:"GET"}).done((function(){e.history.load(),swal({type:"success",title:"Completado",text:"La solicitud ha sido finalizada con éxito",confirmButtonText:"Excelente"})})).fail((function(){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Error al enviar la solicitud"})}))}))})}))},init:function(){this.onObservations(),this.onFinish()}},load:function(){void 0!==this.object&&null!==this.object?this.object.ajax.reload():this.object=$("#data-table").DataTable(this.options)},init:function(){e.history.events.init()}},observation:{object:null,options:getSimpleDataTableConfiguration({url:"/ventanilla/solicitudes/get-observaciones".proto().parseURL(),data:function(t){t.recordHistoryId=$("#recordHistoryId").val()},columns:[{title:"Fecha",data:"date"},{title:"Observación",data:"observation"},{title:"Generado con Estado",data:"status"}]}),reload:function(){e.observation.object.ajax.reload()},init:function(){e.observation.object=$("#table_observations").DataTable(e.observation.options)}},init:function(){e.history.init(),e.observation.init()}},a={onHistoric:function(){$("#btn-history").click((function(){if(""==$("#student_select").val()||null==$("#student_select").val())return toastr.error("Es necesario seleccionar al estudiante",_app.constants.toastr.title.error),!1;e.history.load()}))},onRegisterRequest:function(){$("#btn-create").click((function(){var t=$("#type_select").val(),a=$("#student_select").val(),n=$("#academic_record_select").val(),i=$("#term_select").val(),o=$("#range_type_select").val(),s=$("#range_start_select").val(),r=$("#range_end_select").val();if(""==a||null==a)return toastr.error("Debe completar todos los campos",_app.constants.toastr.title.error),!1;if(18==t&&(""==t||null==t))return toastr.error("Debe completar todos los campos",_app.constants.toastr.title.error),!1;if(""===n||null===n)return toastr.error("Debe completar todos los campos",_app.constants.toastr.title.error),!1;var l=new FormData;l.append("StudentId",a),l.append("RecordType",t),l.append("AcademicRecordStaffId",n),l.append("TermId",i),l.append("RangeType",o),l.append("StartAcademicYear",s),l.append("EndAcademicYear",r),l.append("StartTerm",s),l.append("EndTerm",r),swal({title:"Proceso de Solicitud",text:"¿Seguro que desea enviar la solicitud?",type:"warning",showCancelButton:!0,confirmButtonText:"Sí",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({url:"/ventanilla/solicitudes/generar",type:"POST",data:l,processData:!1,contentType:!1}).done((function(){e.history.load(),swal({type:"success",title:"Completado",text:"La solicitud ha sido enviado con éxito",confirmButtonText:"Excelente"})})).fail((function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:t.responseText})}))}))})}))},init:function(){a.onHistoric(),a.onRegisterRequest()}};return{init:function(){t.init(),a.init(),e.init()}}}();$((function(){InitApp.init()}));