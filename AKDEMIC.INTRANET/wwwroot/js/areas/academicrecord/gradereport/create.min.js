var creation_grade_report={init:function(){$.ajax({type:"GET",url:"/registrosacademicos/informes-de-grados/periodos/get".proto().parseURL(),success:function(e){$("#AdmissionTermId").select2({data:e}),$("#GraduationTermId").select2({data:e})}}).done((function(){$("#GraduationTermId").on("select2:close",(function(e){$(this).valid()}))})),$("#GraduationTermId").on("change",(function(){var e=$(this).val();null!=e&&$.ajax({type:"GET",url:`/registrosacademicos/informes-de-grados/obtener-fecha-finalizacion/${e}`.proto().parseURL(),success:function(e){$("#GraduationDate").val(e)}})})),$.ajax({type:"GET",url:"/registrosacademicos/informes-de-grados/obtener-modalidades-grados".proto().parseURL(),success:function(e){isIntegrated?$("#ProcedureId").select2({data:e}):$("#ConceptId").select2({data:e})}}),$("#btn-redirect").on("click",(function(){var e=$("#ResearchWorkURL").val();window.open(e,"_blank")})),$("#Date").datepicker(),$("#GraduationDate").datepicker(),$("#Year").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years"}),$("#AdmissionYear").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years"}),$("#GraduationYear").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years"}),$("#student-information").validate({submitHandler:function(e,a){a.preventDefault();var r=$(e).find("button[type='submit']");r.addLoader(),mApp.block("#div-rendering",{type:"loader",message:"Cargando..."});var t=$(e).find("input[id='username-search']").val();$.ajax({url:`/registrosacademicos/informes-de-grados/busqueda-por-alumno/${t}`.proto().parseURL(),type:"POST",success:function(e){null!=e?($("#student-fullname").html(`(Alumno : ${e.fullName} )`),$("#username-search").prop("disabled",!0),$("#grade-report-information input[name='StudentId']").val(e.id),$("#Code").val(e.code),$("#PaternalSurName").val(e.paternalSurname),$("#MaternalSurName").val(e.maternalSurname),$("#Name").val(e.name),$("#Faculty").val(e.facultyName),$("#Career").val(e.careerName),$("#CurricularSystem").val(e.curricularSystem),$("#Curriculum").val(e.curriculum),$("#AcademicProgram").val(e.academicProgram),$("#Year").val(e.year),$("#Date").val(e.date),$("#AdmissionTermId").val(e.admissionTermId).trigger("change"),$("#GraduationTermId").val(e.graduationTermId).trigger("change"),e.hasGraduationTerm?$("#GraduationTermId").is(":disabled")||$("#GraduationTermId").attr("disabled",!0):$("#GraduationTermId").attr("disabled",!1),$("#PromotionGrade").val(e.promotionGrade),$("#Credits").val(e.credits),$("#Number").val(e.number)):(mApp.unblock("#div-rendering"),r.removeLoader())},complete:function(){mApp.unblock("#div-rendering"),r.removeLoader()}})}}),$("#grade-report-information").validate({submitHandler:function(e,a){a.preventDefault();var r=new FormData($("#grade-report-information")[0]);if($(".d_requirement").each((function(e,a){var t=$($(a).find("div").find("input"))[0].files[0],n=$(a).find("textarea").val();r.append(`DegreeRequirements[${e}].DocumentFile`,t),r.append(`DegreeRequirements[${e}].Observation`,n),r.append(`DegreeRequirements[${e}].DegreeRequirementId`,$(a).attr("id"))})),""===$("#StudentId").val()||null===$("#StudentId").val()||void 0===$("#StudentId").val())return toastr.error("No se especificó el estudiante para la creación del informe de grados",_app.constants.toastr.title.error),!1;mApp.block("#grade-report-information",{type:"loader",message:"Cargando..."});var t=$(e).find("input[type='submit']");t.addLoader(),$.ajax({url:"/registrosacademicos/informes-de-grados/registrar-informe-grado".proto().parseURL(),type:"POST",data:r,contentType:!1,processData:!1,success:function(){toastr.success("Informe generado correctamente",_app.constants.toastr.title.success)}}).fail((function(e){toastr.error(e.responseText,_app.constants.toastr.title.error)})).done((function(e){$.fileDownload(`/registrosacademicos/informes-de-grados/generar-constancia-grado/${e}`.proto().parseURL())})).always((function(){mApp.unblock("#grade-report-information"),t.removeLoader()}))}}),$("#btn-reset").on("click",(function(e){e.preventDefault();var a=$("#grade-report-information").validate();$("#username-search").val(""),$("#username-search").prop("disabled",!1),$("#grade-report-information input[name='StudentId']").val(""),$("#Code").val(""),$("#PaternalSurName").val(""),$("#MaternalSurName").val(""),$("#Name").val(""),$("#Faculty").val(""),$("#Career").val(""),$("#CurricularSystem").val(""),$("#Curriculum").val(""),$("#AcademicProgram").val(""),$("#student-fullname").html(""),$("#GraduationDate").val(""),a.resetForm()})),$("#student-information button[type='submit']").trigger("submit")}};$((function(){creation_grade_report.init(),$("#GraduationTermId").trigger("change")}));