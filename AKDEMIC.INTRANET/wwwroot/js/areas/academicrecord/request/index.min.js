var indexrequ=function(){var t={object:null,options:{ajax:{url:"/registrosacademicos/solicitudes/get".proto().parseURL(),type:"GET",data:function(t){t.search=$("#search").val(),t.status=$("#status_select").val()}},columns:[{data:"date",title:"Fec. Solicitud"},{data:"username",title:"Cod. Estudiante"},{data:"student",title:"Nombre Completo"},{data:"code",title:"Código"},{data:"type",title:"Tipo"},{data:"receiptCode",title:"Recibo",render:function(t){return null===t?"Sin registrar":t}},{data:"status",title:"Estado",orderable:!1},{title:"Observaciones",data:null,render:function(t){return`<button data-id='${t.id}' class="btn btn-primary btn-sm m-btn m-btn--icon btn-observations" <span=""><i class="la la-eye"></i>Observaciones</button>`}},{data:null,title:"Opciones",render:function(t){var e="";return t.isTypeBachelor?e+=`<a href='/registrosacademicos/informes-de-grados/creacion-informe-grados/${t.username}/${t.id}' class='btn btn-secondary btn-sm m-btn--icon btn-grade'>Generar informe</a>`:t.isTypeJobTitle?e+=`<a href='/registrosacademicos/informes-de-titulos/creacion-informe-titulo/${t.username}/${t.id}' class='btn btn-secondary btn-sm m-btn--icon btn-grade'>Generar informe</a>`:(t.withProcedure||(e+=`<button data-id='${t.id}' type='button' class="btn btn-change-status btn-secondary m-btn m-btn--icon btn-sm m-btn--icon-only" title='Editar'><i class="la la-edit"></i></button>`),t.needData&&t.needToSaveFile?e+=`<button data-id='${t.id}' type='button' class="btn btn-need-data btn-secondary m-btn m-btn--icon btn-sm m-btn--icon-only" title='Imprimir'><i class="la la-eye"></i></button>`:t.needData&&!t.needToSaveFile?e+=`<a target="_blank" href='/documentos/${t.urlFile}' class="btn btn-secondary m-btn m-btn--icon btn-sm m-btn--icon-only" title='Imprimir Automatico'><i class="la la-print"></i></button>`:e+="<button data-id='"+t.id+"' class='ml-1 btn btn-secondary btn-sm m-btn--icon btn-print'><i class='la la-print'></i></button>"),e}}]},events:{onChangeStatus:function(){$("#datatable").on("click",".btn-change-status",(function(){var t=$(this).data("id");a.changeStatus.events.show(t)})),$("#datatable").on("click",".btn-grade",(function(){var t=$(this).data("identify"),e=$(this).data("id");window.location.href=`/registrosacademicos/informes-de-grados/creacion-informe-grados/${t}/${e}`.proto().parseURL()}))},onObservations:function(){$("#datatable").on("click",".btn-observations",(function(){var t=$(this).data("id");$("#recordHistoryId").val(t),e.reload(),$("#observation_modal").modal("show")}))},onPrint:function(){$("#datatable").on("click",".btn-print",(function(){var e=`/registrosacademicos/solicitudes/imprimir/${$(this).data("id")}`;t.object.ajax.reload(),window.open(e,"_blank")})),$("#datatable").on("click",".btn-need-data",(function(){var t=$(this).data("id");a.needData.events.show(t)}))},onReceipt:function(){$("#datatable").on("click",".btn-receipt",(function(){var t=$(this).data("id");$("#receipt_recordHistoryId").val(t),$("#receipt_modal").modal("show")}))},init:function(){this.onChangeStatus(),this.onPrint(),this.onObservations(),this.onReceipt()}},reload:function(){t.object.ajax.reload()},init:function(){t.object=$("#datatable").DataTable(t.options),t.events.init()}},e={object:null,options:getSimpleDataTableConfiguration({url:"/registrosacademicos/solicitudes/get-observaciones".proto().parseURL(),data:function(t){t.recordHistoryId=$("#recordHistoryId").val()},columns:[{title:"Fecha",data:"date"},{title:"Observación",data:"observation"},{title:"Generado con Estado",data:"status"}]}),reload:function(){e.object.ajax.reload()},init:function(){e.object=$("#table_observations").DataTable(e.options)}},a={update:{object:$("#change-status"),show:function(t,e,n){a.update.object.find("[name='UserInternalProcedureId']").val(e),a.update.object.find("[name='RecordHistoryId']").val(n),a.update.object.find("[name='Status']").val(t).trigger("change"),a.update.object.find("[name='Observation']").val("")},form:{object:$("#update-form"),validate:function(){a.update.form.object.validate({rules:{Status:{required:!0},Observation:{required:!0,maxlength:200}},submitHandler:function(t,e){e.preventDefault(),a.update.form.submit(t)}})},submit:function(e){var n=new FormData($(e)[0]);a.update.form.object.find("button[type='submit']").addClass("m-loader m-loader--right m-loader--light").attr("disabled",!0),$.ajax({url:"/registrosacademicos/solicitudes/actualizar-estado",type:"POST",data:n,contentType:!1,processData:!1}).done((function(t){a.update.object.modal("hide"),swal({type:"success",title:"Completado",text:"Estado Actualizado Satisfactoriamente.",confirmButtonText:"Aceptar"})})).fail((function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===t.status?"No hay respuesta del servidor":t.responseText})})).always((function(){t.reload(),a.update.form.object.find("button[type='submit']").removeClass("m-loader m-loader--right m-loader--light").attr("disabled",!1)}))},init:function(){this.validate()}},init:function(){a.update.form.init()}},receipt:{object:$("#receipt_modal"),form:{object:$("#receipt_form"),validate:function(){a.receipt.form.object.validate({rules:{Receipt:{required:!0,maxlength:100}},submitHandler:function(t,e){e.preventDefault(),a.receipt.form.submit(t)}})},submit:function(e){var n=new FormData($(e)[0]);a.receipt.form.object.find("button[type='submit']").addClass("m-loader m-loader--right m-loader--light").attr("disabled",!0),$.ajax({url:"/registrosacademicos/solicitudes/actualizar-recibo",type:"POST",data:n,contentType:!1,processData:!1}).done((function(t){a.receipt.object.modal("hide"),swal({type:"success",title:"Completado",text:"Recibo Actualizado Satisfactoriamente.",confirmButtonText:"Aceptar"})})).fail((function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===t.status?"No hay respuesta del servidor":t.responseText})})).always((function(){t.reload(),a.receipt.form.object.find("button[type='submit']").removeClass("m-loader m-loader--right m-loader--light").attr("disabled",!1)}))},events:function(){$("#receipt_modal").on("hidden.bs.modal",(function(){$("#receipt_form input[name=Receipt]").val("")}))},init:function(){this.events(),this.validate()}},init:function(){this.form.init()}},changeStatus:{object:$("#change_status_modal"),form:{object:$("#change_status_form").validate({submitHandler:function(e,n){var i=$("#change_status_form").find(".btn-primary");i.addLoader();var o=new FormData($(e)[0]);$.ajax({url:"/registrosacademicos/solicitudes/actualizar-estado",type:"POST",data:o,contentType:!1,processData:!1}).done((function(e){t.reload(),a.changeStatus.object.modal("hide"),swal({type:"success",title:"Hecho!",text:"Registro actualizado con éxito.",allowOutsideClick:!1,confirmButtonText:"Aceptar"})})).fail((function(){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===n.status?"No hay respuesta del servidor":n.responseText})})).always((function(){i.removeLoader()}))}})},events:{show:function(t){a.changeStatus.object.find("[name='RecordHistoryId']").val(t),a.changeStatus.object.find(":input").attr("disabled"),a.changeStatus.object.modal("show"),$.ajax({url:`/registrosacademicos/solicitudes/get-record?recordHistoryId=${t}`}).done((function(t){a.changeStatus.object.find("[name='Status']").val(t.status).trigger("change")})).fail((function(t){toastr.error("No se pudo obtener los datos del registro seleccionado","Error")}))},onHidden:function(){a.changeStatus.object.on("hidden.bs.modal",(function(t){a.changeStatus.form.object.resetForm()}))},init:function(){this.onHidden()}},init:function(){this.events.init()}},needData:{object:$("#edit_datainfo_modal"),events:{show:function(t){a.needData.object.modal("show"),a.needData.object.find("[name='RecordHistoryId']").val(t),mApp.block("#pdf_preview",{message:"Cargando previsualización..."}),$.ajax({url:`/registrosacademicos/solicitudes/imprimir/${t}?preview=true`,type:"GET"}).done((function(t){$("#preview_pdf_frame").attr("src",`data:application/pdf;base64,${t}`),mApp.unblock("#pdf_preview")}))},onSelect:function(){a.needData.object.find(".btn-automatic").on("click",(function(){var e=`/registrosacademicos/solicitudes/imprimir/${a.needData.object.find("[name='RecordHistoryId']").val()}?withBackground=${$("#with_background").is(":checked")}`;t.object.ajax.reload(),a.needData.object.modal("hide"),window.open(e,"_blank")})),a.needData.object.find(".btn-manual").on("click",(function(){var t=a.needData.object.find("[name='RecordHistoryId']").val(),e=($("#with_background").is(":checked"),`/registrosacademicos/solicitudes/guardar-informacion/${t}`);window.location.href=e}))},init:function(){this.onSelect()}},init:function(){this.events.init()}},init:function(){a.changeStatus.init(),a.update.init(),a.receipt.init(),a.needData.init()}},n={onSearch:function(){$("#search").doneTyping((function(){t.reload()}))},inputMaskReceipt:function(){$("[name='Receipt']").inputmask({mask:"****-99999999"})},init:function(){n.onSearch(),n.inputMaskReceipt()}},i={status:{init:function(){$(".m-select2").select2({minimumResultsForSearch:-1}),$("#status_select").on("change",(function(){t.reload()}))}},init:function(){i.status.init()}};return{init:function(){n.init(),t.init(),e.init(),i.init(),a.init()}}}();$((function(){indexrequ.init()}));