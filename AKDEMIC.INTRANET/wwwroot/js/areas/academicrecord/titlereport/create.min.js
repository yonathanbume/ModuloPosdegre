var creation_title_report={init:function(){$("#btn-redirect").on("click",(function(){var e=$("#ResearchWorkURL").val();window.open(e,"_blank")})),$.ajax({type:"GET",url:"/registrosacademicos/informes-de-grados/periodos/get".proto().parseURL(),success:function(e){$("#AdmissionTermId").select2({data:e}),$("#GraduationTermId").select2({data:e})}}),$.ajax({type:"GET",url:"/registrosacademicos/informes-de-titulos/obtener-modalidades-titulo".proto().parseURL(),success:function(e){isIntegrated?$("#ProcedureId").select2({data:e}):$("#ConceptId").select2({data:e})}}),$("#Date").datepicker(),$("#Year").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years"}),$("#AdmissionYear").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years"}),$("#GraduationYear").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years"}),$("#AdmissionYear").datepicker().on("changeDate",(function(e){$(this).valid(),$("#GraduationYear").datepicker("setStartDate",e.date)})),$("#GraduationYear").datepicker().on("changeDate",(function(e){$(this).valid(),$("#AdmissionYear").datepicker("setEndDate",e.date)})),$("#student-information").validate({submitHandler:function(e,a){a.preventDefault();var r=$(e).find("button[type='submit']");r.addLoader(),mApp.block("#div-rendering",{type:"loader",message:"Cargando..."});var t=$(e).find("input[id='username-search']").val();$.ajax({url:`/registrosacademicos/informes-de-titulos/busqueda-por-alumno/${t}`.proto().parseURL(),type:"POST",success:function(e){null!=e?($("#student-fullname").html(`(Estudiante : ${e.fullName} )`),$("#username-search").prop("disabled",!0),$("#title-report-information input[name='StudentId']").val(e.id),$("#Code").val(e.code),$("#PaternalSurName").val(e.paternalSurname),$("#MaternalSurName").val(e.maternalSurname),$("#Name").val(e.name),$("#Faculty").val(e.facultyName),$("#Career").val(e.careerName),$("#CurricularSystem").val(e.curricularSystem),$("#Curriculum").val(e.curriculum),$("#AcademicProgram").val(e.academicProgram),$("#Year").val(e.year),$("#Date").val(e.date),$("#AdmissionTermId").val(e.admissionTermId).trigger("change"),$("#GraduationTermId").val(e.graduationTermId).trigger("change"),$("#PromotionGrade").val(e.promotionGrade),$("#Credits").val(e.credits),$("#YearsStudied").val(e.yearsStudied),$("#SemesterStudied").val(e.semesterStudied),$("#ResearchWork").val(e.researchWork),$("#ResearchWorkURL").val(e.researchWorkURL),$("#BachelorOrigin").val(e.bachelorOrigin),$("#PedagogicalTitleOrigin").val(e.pedagogicalTitleOrigin),$("#StudyModality").val(e.studyModality).trigger("change"),$("#OriginDegreeCountry").val(e.originDegreeCountry),$("#Observation").val(e.observation),$("#Number").val(e.number),$("#GraduationDate").val(e.graduationDate)):(mApp.unblock("#div-rendering"),r.removeLoader())},complete:function(){mApp.unblock("#div-rendering"),r.removeLoader()}})}}),$("#title-report-information").validate({submitHandler:function(e,a){a.preventDefault();var r=new FormData($("#title-report-information")[0]);if($(".d_requirement").each((function(e,a){var t=$($(a).find("div").find("input"))[0].files[0],i=$(a).find("textarea").val();r.append(`DegreeRequirements[${e}].DocumentFile`,t),r.append(`DegreeRequirements[${e}].Observation`,i),r.append(`DegreeRequirements[${e}].DegreeRequirementId`,$(a).attr("id"))})),""===$("#StudentId").val()||null===$("#StudentId").val()||void 0===$("#StudentId").val())return toastr.error("No se especificó el estudiante para la creación del informe de título",_app.constants.toastr.title.error),!1;mApp.block("#title-report-information",{type:"loader",message:"Cargando..."});var t=$(e).find("input[type='submit']");t.addLoader(),$.ajax({url:"/registrosacademicos/informes-de-titulos/registrar-informe-titulo".proto().parseURL(),type:"POST",data:r,contentType:!1,processData:!1,success:function(){toastr.success("Informe generado correctamente",_app.constants.toastr.title.success)}}).fail((function(e){toastr.error(e.responseText,_app.constants.toastr.title.error)})).done((function(e){$.fileDownload(`/registrosacademicos/informes-de-titulos/generar-constancia-titulo/${e}`.proto().parseURL())})).always((function(){mApp.unblock("#title-report-information"),t.removeLoader()}))}}),$("#btn-reset").on("click",(function(e){e.preventDefault();var a=$("#title-report-information").validate();$("#username-search").val(""),$("#username-search").prop("disabled",!1),$("#title-report-information input[name='StudentId']").val(""),$("#Code").val(""),$("#PaternalSurName").val(""),$("#MaternalSurName").val(""),$("#Name").val(""),$("#Faculty").val(""),$("#Career").val(""),$("#CurricularSystem").val(""),$("#Curriculum").val(""),$("#AcademicProgram").val(""),$("#student-fullname").html(""),$("#GraduationDate").val(""),a.resetForm()})),$("#student-information button[type='submit']").trigger("submit")}};$((function(){creation_title_report.init()}));