var InvoiceDetailTable=function(){var e,t={data:{source:{read:{method:"GET",url:("/pagos/recibo/detalle/get/"+$("#invoice").val()).proto().parseURL()}}},sortable:!1,pagination:!1,columns:[{field:"concept",sortable:!1,filterable:!1,title:"Concepto"},{field:"cost",title:"Costo",sortable:!1,filterable:!1,template:function(e,t){return $("#canceled").val()?"<span class='m--font-danger'> S/. "+e.cost.toFixed(2)+"</span>":'<input hidden name="detail['+t+'].Id" value="'+e.id+'"><div class="input-group btn--icon-only" style="max-width: 200px"><input type="text" name="detail['+t+'].Cost" class="form-control m-detail-value m--align-right input-cost" placeholder= "0.00" value="'+e.cost.toFixed(2)+'"><div class="input-group-append"><button class="btn btn-primary m-btn m-btn--icon m-btn--icon-only" type="button" onclick="InvoiceDetailTable.updateCost(this)" data-id="'+e.id+'"><i class="la la-save"></i></button></div></div >'}}]};return{init:function(){e=$("#detail_table").mDatatable(t)},reload:function(){e.reload()},updateCost:function(e){!function(e){var t=$(e).data("id"),o=$(e).parent().prev(),a=Number(o.val());mApp.block(".m-portlet",{type:"loader",message:"Cargando..."}),$.ajax({url:"/pagos/recibo/detalle/post".proto().parseURL(),type:"POST",data:{id:t,newAmount:a}}).done((function(e){$("#total_amount").text(e.total.toFixed(2)),o.val(e.cost.toFixed(2))})).fail((function(e){o.val(e.responseJSON.cost.toFixed(2)),toastr.error(e.responseJSON.error,_app.constants.toastr.title.error)})).always((function(){mApp.unblock(".m-portlet")}))}(e)}}}(),VoucherTable=function(){var e,t,o=[],a={sortable:!1,pagination:!1,columns:[{field:"code",title:"CÃ³digo"},{field:"cost",title:"Monto",textAlign:"right",template:function(e){return"S/. "+Number(e.cost).toFixed(2)}},{field:"options",title:" ",textAlign:"right",template:function(e,t){return'<input hidden name="Vouchers['+t+'].Code" value="'+e.code+'"><input hidden name="Vouchers['+t+'].amount" value="'+e.cost+'"><button onclick="VoucherTable.deleteRow('+t+')" type="button" class="btn btn-danger m-btn btn-sm m-btn m-btn--icon btn-delete-voucher"'+($("#canceled").val()?" disabled":"")+'><span><i class="la la-trash"></i><span>Eliminar</span></span> </button>'}}]};$("#canceled").val()?a.data={source:{read:{method:"GET",url:("/pagos/recibo/vouchers/get/"+$("#invoice").val()).proto().parseURL()}}}:a.data={type:"local",source:o,pageSize:10};return{init:function(){e=$("#voucher_table").mDatatable(a),$("input[type=radio][name=PaymentType]").change((function(){2==this.value?$("#m_datatable_vouchers").collapse("show"):$("#m_datatable_vouchers").collapse("hide")})),t=$("#voucher_form").validate({submitHandler:function(){var e=$("input[name=code]").val(),o=$("input[name=amount]").val();VoucherTable.addRow(e,o),$("#voucher_modal").modal("hide"),t.resetForm()}})},addRow:function(t,a){o.push({code:t,cost:a}),e.originalDataSet=o,e.reload()},removeRow:function(t){o.splice(t,1),e.originalDataSet=o,e.reload()},getCount:function(){return e.getTotalRows()},reload:function(){e.reload()},deleteRow:function(e){!function(e){VoucherTable.removeRow(e)}(e)}}}(),InvoiceForm={init:function(){$("#invoice-form").validate({submitHandler:function(e){2!==$("input[name=PaymentType]:checked").val()||0!==VoucherTable.getCount()?(e.submit(),$(":input").prop("disabled",!0)):swal("No existen vouchers de pago","Debe ingresar por lo menos un voucher de pago para generar el recibo","error")}})}};jQuery(document).ready((function(){InvoiceDetailTable.init(),VoucherTable.init(),InvoiceForm.init()}));