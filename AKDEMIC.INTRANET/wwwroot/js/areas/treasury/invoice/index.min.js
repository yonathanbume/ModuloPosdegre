var UserProcedureTable=function(){var e,t={data:{source:{read:{method:"GET",url:null}}},columns:[{field:"id",title:"#",sortable:!1,width:40,textAlign:"center",selector:{class:"m-checkbox--solid m-checkbox--brand",name:"UserProcedures"}},{field:"concept",title:"Concepto"},{field:"status",title:"Estado"},{field:"totalamount",title:"Monto Total",textAlign:"right",template:function(e){return"S/. "+e.totalamount}},{field:"paidamount",title:"Monto Pagado",textAlign:"right",template:function(e){return"S/. "+e.paidamount}},{field:"pendingamount",title:"Monto Pendiente",textAlign:"right",template:function(e){return"S/. "+e.pendingamount}}]},o=function(){var e=$("#code_user").val();if(""===e)return UserProcedureTable.detroy(),void swal("Debe ingresar un usuario","Debe ingresar un código de usuario primero.","warning");mApp.blockPage(),$.ajax({type:"GET",url:("/pagos/usuario/get/"+e).proto().parseURL()}).done((function(){$("#user").val(e),UserProcedureTable.init(e)})).fail((function(){UserProcedureTable.detroy(),swal("Usuario incorrecto","El código de usuario ingresado no existe.","error")})).always((function(){mApp.unblockPage()}))};return{init:function(o){$("#empty-message").hide(),$("#btn-new").show(),void 0!==e&&$.trim($(".m-datatable").html()).length&&e.destroy(),t.data.source.read.url=("/pagos/usuario/tramites/get/"+o).proto().parseURL(),(e=$("#ajax_data").mDatatable(t)).on("m-datatable--on-check m-datatable--on-uncheck m-datatable--on-layout-updated",(function(t){var o=e.rows(".m-datatable__row--active").nodes().length;$("#m_datatable_selected_number").html(o),o>0?$("#m_datatable_group_action_form").collapse("show"):$("#m_datatable_group_action_form").collapse("hide")}))},reload:function(){e.reload()},detroy:function(){void 0!==e&&$.trim($(".m-datatable").html()).length&&e.destroy(),$("#empty-message").show(),$("#btn-new").hide()},codeEvents:function(){$("#code_search").on("click",(function(){o()})),$("#code_user").on("keypress",(function(e){13===e.keyCode&&o()}))}}}(),ProcedureListTable=function(){var e,t={data:{source:{read:{method:"GET",url:"/pagos/tramites/get".proto().parseURL()}}},columns:[{field:"category",title:"Categoría"},{field:"name",title:"Nombre"},{field:"totalamount",title:"Monto total"},{field:"options",title:"Opciones",template:function(e){return'<button onclick=ProcedureListTable.initProcedure("'+e.id+'") class="btn btn-outline-info btn-sm m-btn m-btn--icon"><span><i class="la la-file-text"></i><span> Iniciar </span></span></button>'}}],translate:{records:{noRecords:"No existen trámites disponibles"}}};return{init:function(){e=$("#procedures_table").mDatatable(t)},destroy:function(){e.destroy()},initProcedure:function(e){!function(e){swal({confirmButtonText:"Si",cancelButtonText:"No",showCancelButton:!0,title:"¿Desea solicitar el trámite?",text:"Se iniciará el trámite para el usuario seleccionado.",type:"warning",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((t=>{$.ajax({url:"/pagos/usuario/tramite/registrar".proto().parseURL(),type:"POST",data:{ProcedureId:e,UserName:$("#user").val()},success:function(e){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),$("#procedure_modal").modal("hide"),UserProcedureTable.reload()},error:function(e){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)},complete:function(){swal.close()}})})),allowOutsideClick:()=>!swal.isLoading()})}(e)}}}();jQuery(document).ready((function(){UserProcedureTable.codeEvents(),ProcedureListTable.init()}));