var InitApp=function(){var t={invoices:{object:null,options:{data:{source:{read:{url:"/caja/recibos/get".proto().parseURL()}}},columns:[{field:"number",title:"Nro. de recibo"},{field:"client",title:"Cliente"},{field:"amount",title:"Monto Total",textAlign:"right",template:function(t){return t.amount.toFixed(2)}},{field:"state",title:"Estado",template:function(t){return t.state?'<span class="m-badge m-badge--danger m-badge--wide">Anulado</span>':'<span class="m-badge m-badge--success m-badge--wide">Pagado</span>'}},{field:"detail",title:"Detalle",sortable:!1,filterable:!1,template:function(t){return'<button data-id="'+t.id+'" class="btn btn-secondary btn-sm m-btn m-btn--icon detail"><span><i class="la la-edit"></i><span> Detalle </span></span></button>'}},{field:"anulled",title:"Anular",sortable:!1,filterable:!1,template:function(t){return t.state?"---":'<button data-id="'+t.id+'" class="btn btn-danger btn-sm m-btn m-btn--icon delete"><span><i class="la la-edit"></i><span> Anular </span></span></button>'}}]},init:function(){t.invoices.object=$("#invoice_table").mDatatable(t.invoices.options),$("#invoice_table").on("click",".delete",(function(){var e=$(this).data("id");swal({title:"¿Anular el recibo generado?",text:"Una vez anulado no podrá cambiar su estado",type:"warning",showCancelButton:!0,confirmButtonText:"Si, anularlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar"}).then((function(a){a.value&&$.ajax({url:"/caja/recibo/anular".proto().parseURL(),type:"POST",data:{id:e}}).done((function(){t.invoices.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}))})).on("click",".detail",(function(){var e=$(this).data("id");$("#detail_modal").modal("show"),t.details.load(e)}))},reload:function(){t.invoices.object.reload()}},details:{object:null,options:{data:{source:{read:{url:null}}},columns:[{field:"concept",title:"Concepto"},{field:"cost",title:"<span>Costo</span>",textAlign:"right",width:70,template:function(t){return t.cost.toFixed(2)}}]},load:function(e){void 0!==t.details.object&&null!==t.details.object&&t.details.object.destroy(),t.details.options.data.source.read.url=`/caja/recibo/${e}/detalle/get`.proto().parseURL(),t.details.object=$("#detail_table").mDatatable(t.details.options)}},init:function(){t.invoices.init()}},e={simulator:function(){swal.queue([{title:"Simular cierre",confirmButtonText:"Continuar",cancelButtonText:"Cancelar",text:"Este cierre de caja solo es una simulación del cierre final a partir de los pagos realizados hasta el momento",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0}]).then((t=>{t.value&&swal({input:"number",title:"Monto recaudado",text:"Ingrese el monto total recaudado",showLoaderOnConfirm:!0,showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"}).then((t=>{t.value&&($.isNumeric(t.value)?window.location.href=`/caja/simulador/${t.value}`.proto().parseURL():swal({type:"error",title:"Valor incorrecto",text:"Debe ingresar un valor númerico válido"}))}))}))},close:function(){swal.queue([{title:"Cierre de caja",confirmButtonText:"Continuar",cancelButtonText:"Cancelar",text:"Se procederá a cerrar la caja chica, una vez cerrada no podrá registrar nuevos pagos en la misma",type:"warning",showLoaderOnConfirm:!0,showCancelButton:!0}]).then((t=>{t.value&&swal({input:"number",title:"Monto recaudado",text:"Ingrese el monto total recaudado",showLoaderOnConfirm:!0,showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"}).then((t=>{t.value&&($.isNumeric(t.value)?_app.modules.form.post("/caja/cierre".proto().parseURL(),{declaredAmount:t.value}):swal({type:"error",title:"Valor incorrecto",text:"Debe ingresar un valor númerico válido"}))}))}))},init:function(){$("#simulator").click((function(){e.simulator()})),$("#close").click((function(){e.close()}))}};return{init:function(){t.init(),e.init()}}}();$((function(){InitApp.init()}));