var InitApp=function(){var e,t={term:{init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(e){$("#termId").select2({placeholder:"Seleccione una periodo académico",minimumResultsForSearch:10,data:e.items,selected:e.selected})}))}},faculty:{init:function(){$.ajax({url:"/facultades/get".proto().parseURL()}).done((function(e){$("#facultyId").select2({data:e.items,placeholder:"Seleccione una facultad",minimumResultsForSearch:10}),$("#facultyId").val(null).trigger("change"),$("#facultyId").on("change",(function(){t.career.load($("#facultyId").val())}))}))}},career:{init:function(){$("#careerId").select2({placeholder:"Seleccione una escuela",disabled:!0}),$("#careerId").on("change",(function(){t.curriculum.load($("#careerId").val())}))},load:function(e){$.ajax({url:`/carreras/get?fid=${e}`.proto().parseURL()}).done((function(e){$("#careerId").empty(),$("#careerId").select2({placeholder:"Seleccione una escuela",data:e.items,disabled:!1,minimumResultsForSearch:10}),e.items.length>0?$("#careerId").trigger("change"):(t.curriculum.empty(),t.academicyear.empty(),t.course.empty())}))}},curriculum:{init:function(){$("#curriculumId").select2({placeholder:"Seleccione un plan",disabled:!0}),$("#curriculumId").on("change",(function(){t.academicyear.load($("#curriculumId").val())}))},load:function(e){$.ajax({url:`/carreras/${e}/planestudio/get`.proto().parseURL()}).done((function(e){$("#curriculumId").empty(),$("#curriculumId").select2({placeholder:"Seleccione un plan de estudios",data:e.items,disabled:!1}),e.items.length>0?$("#curriculumId").trigger("change"):(t.course.empty(),t.academicyear.empty())}))},empty:function(){$("#curriculumId").empty(),$("#curriculumId").select2({placeholder:"Seleccione un plan",disabled:!0})}},academicyear:{init:function(){$("#academicyear-select").select2({placeholder:"Seleccione un ciclo",disabled:!0}),$("#academicyear-select").on("change",(function(){t.course.load($("#curriculumId").val(),$("#academicyear-select").val())}))},load:function(e){$.ajax({url:`/planes-estudio/${e}/niveles/get`.proto().parseURL()}).done((function(e){$("#academicyear-select").empty(),$("#academicyear-select").select2({placeholder:"Seleccione un ciclo",data:e.items,disabled:!1,minimumResultsForSearch:-1}),e.items.length>0?$("#academicyear-select").trigger("change"):t.course.empty()}))},empty:function(){$("#academicyear-select").empty(),$("#academicyear-select").select2({placeholder:"Seleccione un curso",disabled:!0})}},course:{init:function(){$("#courseId").select2({placeholder:"Seleccione un curso",disabled:!0})},load:function(e,t){$.ajax({url:`/planes-estudio/${e}/niveles/${t}/get`.proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todos"}),$("#courseId").empty(),$("#courseId").select2({placeholder:"Seleccione un curso",data:e.items,disabled:!1})}))},empty:function(){$("#courseId").empty(),$("#courseId").select2({placeholder:"Seleccione un curso",disabled:!0})}},init:function(){t.term.init(),t.faculty.init(),t.career.init(),t.curriculum.init(),t.academicyear.init(),t.course.init(),$(".btn-find").on("click",(function(){if(null==$("#courseId").val()||""==$("#courseId").val())return toastr.error("Debe seleccionar un curso",_app.constants.toastr.title.error),!1;a()}))}},a=function(){mApp.block(".m-portlet__body","Cargando..."),$.ajax({url:"/director-carrera/notas-por-curso/get".proto().parseURL(),data:{termId:$("#termId").val(),courseId:$("#courseId").val(),curriculumId:$("#curriculumId").val(),academicYear:$("#academicyear-select").val()}}).done((function(t){var a=[];$.each(t.data,(function(e,c){a[e]=0==e?c/t.totalstudents*100:a[e-1]+c/t.totalstudents*100})),Highcharts.chart("container",{chart:{type:"column"},title:{text:"Reportes de notas por curso"},tooltip:{formatter:function(){return"<b>"+this.x+" ptos</b>: "+this.y+" estudiantes.<br/><sapn>"+(this.y/t.totalstudents*100).toFixed(2)+"% del total</span><br/><sapn> Percentil: "+a[this.point.index].toFixed(2)+"%</span>"}},yAxis:{title:{enabled:!0,text:"Cant. Estudiantes",style:{fontWeight:"normal"}}},xAxis:{categories:t.categories,labels:{formatter:function(){return this.value+" ptos."}}},series:[{name:"Notas ",data:t.data}]}),$(".highcharts-Average-1").text(" "+t.average+" ptos."),$(".highcharts-Median-1").text(" "+t.median+" ptos."),$(".highcharts-Deviation-1").text(" "+t.standarDeviation+" ptos."),$(".highcharts-Under-1").text(" "+t.undermedian+" %"),$(".highcharts-Over-1").text(" "+t.overmedian+" %"),null!=e&&null!=e&&(e.clear(),e.destroy());var c=0;e=$("#tbl-data").DataTable({serverSide:!1}),$.each(t.datatable,(function(t,a){c++,e.row.add([c,a.name,a.course,a.sectionCode,a.grade]).draw().node()})),$(".portlet-details").removeClass("m--hide"),$(".highcharts-figure").removeClass("m--hide")})).fail((function(e){toastr.info(e.responseText,"Información!")})).always((function(){mApp.unblock(".m-portlet__body")}))};return{init:function(){t.init(),$("#download_excel").on("click",(function(){var e=`/director-carrera/notas-por-curso/reporte-excel?termId=${$("#termId").val()}&courseId=${$("#courseId").val()}&curriculumId=${$("#curriculumId").val()}&academicYear=${$("#academicyear-select").val()}`,t=$(this);t.addLoader(),window.open(e,"_blank"),t.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito")}))}}}();$((function(){InitApp.init()}));