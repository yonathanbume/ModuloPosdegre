var InitApp=function(){var e=null,a=null,r={term:{init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(e){$("#termId").select2({placeholder:"Seleccione una periodo académico",minimumResultsForSearch:10,data:e.items,selected:e.selected})}))}},faculty:{init:function(){$.ajax({url:"/facultades/get".proto().parseURL()}).done((function(e){$("#facultyId").select2({data:e.items,placeholder:"Seleccione una facultad",minimumResultsForSearch:10}),$("#facultyId").val(null).trigger("change"),$("#facultyId").on("change",(function(){r.career.load($("#facultyId").val())}))}))}},career:{init:function(){$("#careerId").select2({placeholder:"Seleccione una escuela",disabled:!0}),$("#careerId").on("change",(function(){r.curriculum.load($("#careerId").val())}))},load:function(e){$.ajax({url:`/carreras/get?fid=${e}`.proto().parseURL()}).done((function(e){$("#careerId").empty(),$("#careerId").select2({placeholder:"Seleccione una escuela",data:e.items,disabled:!1,minimumResultsForSearch:10}),e.items.length>0?$("#careerId").trigger("change"):(r.curriculum.empty(),r.academicyear.empty())}))}},curriculum:{init:function(){$("#curriculumId").select2({placeholder:"Seleccione un plan",disabled:!0}),$("#curriculumId").on("change",(function(){r.academicyear.load($("#curriculumId").val())}))},load:function(e){$.ajax({url:`/carreras/${e}/planestudio/get`.proto().parseURL()}).done((function(e){$("#curriculumId").empty(),$("#curriculumId").select2({placeholder:"Seleccione un plan de estudios",data:e.items,disabled:!1}),e.items.length>0?$("#curriculumId").trigger("change"):r.academicyear.empty()}))},empty:function(){$("#curriculumId").empty(),$("#curriculumId").select2({placeholder:"Seleccione un plan",disabled:!0})}},academicyear:{init:function(){$("#academicyear-select").select2({placeholder:"Seleccione un ciclo",disabled:!0})},load:function(e){$.ajax({url:`/planes-estudio/${e}/niveles/get`.proto().parseURL()}).done((function(e){$("#academicyear-select").empty(),$("#academicyear-select").select2({placeholder:"Seleccione un ciclo",data:e.items,disabled:!1,minimumResultsForSearch:-1}),e.items.length>0&&$("#academicyear-select").trigger("change")}))},empty:function(){$("#academicyear-select").empty(),$("#academicyear-select").select2({placeholder:"Seleccione un ciclo",disabled:!0})}},init:function(){r.term.init(),r.faculty.init(),r.career.init(),r.curriculum.init(),r.academicyear.init(),$(".btn-find").on("click",(function(){if(null==$("#facultyId").val()||""==$("#facultyId").val())return toastr.error("Debe seleccionar una facultad",_app.constants.toastr.title.error),!1;var r=$(this),o=$("#termId").val(),c=$("#facultyId").val(),n=$("#careerId").val(),l=$("#curriculumId").val(),i=$("#academicyear-select").val();$.ajax({url:`/director-carrera/reporte-alumnos-competencias/nivel-de-logro-datos/${o}/${c}/${n}/${l}/${i}`.proto().parseURL(),type:"GET",dataType:"html",contextType:"application/json",beforeSend:function(){r.addLoader(),$(".portlet-details").addClass("m--hide"),$("#txt-detail").html("Listado detallado")}}).done((function(d){$("#container").html(d),r.removeLoader(),$(".competence-details").on("click",(function(){var r=$(this).data("typeavg"),t=$(this).data("competenceid");null!=e&&null!=e&&(e.clear(),e.destroy()),e=$("#tbl-data").DataTable({serverSide:!1,columnDefs:[{orderable:!0,targets:[0,1,2]}],dom:"Bfrtip",buttons:[{extend:"excel",footer:!1,exportOptions:{columns:[0,1,2]}},{extend:"pdf",footer:!1,exportOptions:{columns:[0,1,2]}}],searching:!1}),$.ajax({type:"GET",url:`/director-carrera/reporte-alumnos-competencias/obtener-datos-por-cantidad/${o}/${c}/${n}/${l}/${t}/${r}/${i}`.proto().parseURL(),beforeSend:function(){}}).done((function(r){if(null!=r&&r.rowChilds.length>0){$("#txt-detail").html(`${r.competenceName}`);for(var t=0;t<r.rowChilds.length;t++){var o=e.row.add([`${r.rowChilds[t].userName}`,`${r.rowChilds[t].studentFullName}`,`${r.rowChilds[t].average}`,`<button data-studentid =${r.rowChilds[t].studentId} data-compentenceid =${r.rowChilds[t].competenceId} data-typeavg =${r.rowChilds[t].type}  class='btn btn-sm btn-primary view-courses'> <i class='fa fa-eye'></i> </button>`]).draw().node();$(o).css("text-align","center")}e.on("click",".view-courses",(function(e){var r=$(this).data("studentid"),t=$(this).data("compentenceid"),o=$(this).data("typeavg"),c=$("#termId").val(),n=$("#facultyId").val(),l=$("#careerId").val(),i=$("#curriculumId").val(),d=$("#academicyear-select").val();$("#courses-modal").modal("show"),$.ajax({type:"GET",url:`/director-carrera/reporte-alumnos-competencias/obtener-datos-por-cantidad-por-estudiante/${c}/${n}/${l}/${i}/${t}/${o}/${d}/${r}`.proto().parseURL(),beforeSend:function(){mApp.block("#rendering-modal","Cargando...")}}).done((function(e){if(null!=a&&null!=a&&(a.clear(),a.destroy()),a=$("#tbl-data-2").DataTable({serverSide:!1,columnDefs:[{orderable:!1,targets:[0,1,2]}],dom:"Bfrtip",buttons:[{extend:"excel",footer:!1,exportOptions:{columns:[0,1,2]}},{extend:"pdf",footer:!1,exportOptions:{columns:[0,1,2]}}]}),null!=e&&($("#title-studentname").html(`Estudiante: ${e.studentFullName}`),e.rowChilds.length>0)){for(var r=0;r<e.rowChilds.length;r++){var t=a.row.add([`${e.rowChilds[r].courseName}`,`${e.rowChilds[r].credits}`,`${e.rowChilds[r].average}`]).draw().node();$(t).css("text-align","center")}mApp.unblock("#rendering-modal")}}))}))}$(".portlet-details").removeClass("m--hide"),mApp.unblock("#rendering")}))})),$("#btn-pdf").on("click",(function(){var e=$(this);e.addLoader(),$.fileDownload(`/director-carrera/reporte-alumnos-competencias/descargar/pdf/${o}/${c}/${n}/${l}/${i}`.proto().parseURL()).done((function(){e.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito")})).fail((function(a){e.removeLoader(),toastr.error("Ocurrió un error al generar el archivo","Error")}))})),$("#btn-excel").on("click",(function(){var e=$(this);e.addLoader(),$.fileDownload(`/director-carrera/reporte-alumnos-competencias/reporte-excel/${o}/${c}/${n}/${l}/${i}`.proto().parseURL()).done((function(){e.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito")})).fail((function(a){e.removeLoader(),toastr.error("Ocurrió un error al generar el archivo","Error")}))})),t()})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)})).always((function(){}))}))}},t=function(){$.ajax({url:"/director-carrera/reporte-alumnos-competencias/get".proto().parseURL(),data:{termId:$("#termId").val(),facultyId:$("#facultyId").val(),careerId:$("#careerId").val(),curriculumId:$("#curriculumId").val(),academicYear:$("#academicyear-select").val()},beforeSend:function(){mApp.block("#container-2","Cargando...")}}).done((function(e){console.log(e);var a=[];if(null!=e.rangeLevels&&null!=e.rangeLevels)for(var r=0;r<e.rangeLevels.length;r++)a.push({name:e.rangeLevels[r].name,data:e.rangeLevels[r].array});Highcharts.chart("container-2",{chart:{type:"column"},title:{text:"Niveles por competencias"},xAxis:{categories:e.competencesNames},yAxis:{min:0,title:{text:""},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:Highcharts.defaultOptions.title.style&&Highcharts.defaultOptions.title.style.color||"gray"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.defaultOptions.legend.backgroundColor||"white",borderColor:"#CCC",borderWidth:1,shadow:!1},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0}}},series:a,credits:{text:"",href:""},lang:{contextButtonTitle:"Opciones",viewFullscreen:"Ver en pantalla completa",printChart:"Imprimir",downloadPNG:"Descargar PNG",downloadJPEG:"Descargar JPEG",downloadPDF:"Descargar PDF",downloadSVG:"Descargar SVG",downloadCSV:"Descargar CSV",downloadXLS:"Descargar XLS",openInCloud:"Abrir editor online"}})})).fail((function(e){toastr.info(e.responseText,"Información!")})).always((function(){mApp.unblock("#container-2","Cargando...")}))};return{init:function(){r.init()}}}();$((function(){InitApp.init()}));