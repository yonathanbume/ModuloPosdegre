var InitApp=function(){var e=null,r=null,t={term:{init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(e){$("#termId").select2({placeholder:"Seleccione una periodo académico",minimumResultsForSearch:10,data:e.items,selected:e.selected})}))}},faculty:{init:function(){$.ajax({url:"/facultades/get".proto().parseURL()}).done((function(e){$("#facultyId").select2({data:e.items,placeholder:"Seleccione una facultad",minimumResultsForSearch:10}),$("#facultyId").val(null).trigger("change"),$("#facultyId").on("change",(function(){t.career.load($("#facultyId").val())}))}))}},career:{init:function(){$("#careerId").select2({placeholder:"Seleccione una escuela",disabled:!0}),$("#careerId").on("change",(function(){t.curriculum.load($("#careerId").val())}))},load:function(e){$.ajax({url:`/carreras/get?fid=${e}`.proto().parseURL()}).done((function(e){$("#careerId").empty(),$("#careerId").select2({placeholder:"Seleccione una escuela",data:e.items,disabled:!1,minimumResultsForSearch:10}),e.items.length>0?$("#careerId").trigger("change"):(t.curriculum.empty(),t.academicyear.empty(),t.course.empty())}))}},curriculum:{init:function(){$("#curriculumId").select2({placeholder:"Seleccione un plan",disabled:!0})},load:function(e){$.ajax({url:`/carreras/${e}/planestudio/get`.proto().parseURL()}).done((function(e){$("#curriculumId").empty(),$("#curriculumId").select2({placeholder:"Seleccione un plan de estudios",data:e.items,disabled:!1}),e.items.length>0&&$("#curriculumId").trigger("change")}))},empty:function(){$("#curriculumId").empty(),$("#curriculumId").select2({placeholder:"Seleccione un plan",disabled:!0})}},init:function(){t.term.init(),t.faculty.init(),t.career.init(),t.curriculum.init(),$(".btn-find").on("click",(function(){if(null==$("#facultyId").val()||""==$("#facultyId").val())return toastr.error("Debe seleccionar una facultad",_app.constants.toastr.title.error),!1;o(),a()}))}},a=function(){mApp.block("#container","Cargando...");var t=$("#termId").val(),a=$("#facultyId").val(),o=$("#careerId").val(),n=$("#curriculumId").val();$.ajax({url:`/director-carrera/notas-por-competencias/nivel-de-logro-datos/${t}/${a}/${o}/${n}`.proto().parseURL(),type:"GET",dataType:"html",contextType:"application/json",beforeSend:function(){$(".portlet-details").addClass("m--hide"),$("#txt-detail").html("Listado detallado")}}).done((function(c){$("#container").html(c),$(".competence-details").on("click",(function(){var c=$(this).data("typeavg"),l=$(this).data("competenceid");null!=e&&null!=e&&(e.clear(),e.destroy()),e=$("#tbl-data").DataTable({serverSide:!1,columnDefs:[{orderable:!0,targets:[0,1,2]}],dom:"Bfrtip",buttons:[{extend:"excel",footer:!1,exportOptions:{columns:[0,1,2]}},{extend:"pdf",footer:!1,exportOptions:{columns:[0,1,2]}}],searching:!1}),$.ajax({type:"GET",url:`/director-carrera/notas-por-competencias/obtener-datos-por-cantidad/${t}/${a}/${o}/${n}/${l}/${c}`.proto().parseURL(),beforeSend:function(){mApp.block("#rendering","Cargando...")}}).done((function(t){if(null!=t&&t.rowChilds.length>0){$("#txt-detail").html(`${t.competenceName}`);for(var a=0;a<t.rowChilds.length;a++){var o=e.row.add([`${t.rowChilds[a].userName}`,`${t.rowChilds[a].studentFullName}`,`${t.rowChilds[a].average}`,`<button data-studentid =${t.rowChilds[a].studentId} data-compentenceid =${t.rowChilds[a].competenceId} data-typeavg =${t.rowChilds[a].type}  class='btn btn-sm btn-primary view-courses'> <i class='fa fa-eye'></i> </button>`]).draw().node();$(o).css("text-align","center")}e.on("click",".view-courses",(function(e){var t=$(this).data("studentid"),a=$(this).data("compentenceid"),o=$(this).data("typeavg"),n=$("#termId").val(),c=$("#facultyId").val(),l=$("#careerId").val(),i=$("#curriculumId").val();$("#courses-modal").modal("show"),$.ajax({type:"GET",url:`/director-carrera/notas-por-competencias/obtener-datos-por-cantidad-por-estudiante/${n}/${c}/${l}/${i}/${a}/${o}/${t}`.proto().parseURL(),beforeSend:function(){mApp.block("#rendering-modal","Cargando...")}}).done((function(e){if(null!=r&&null!=r&&(r.clear(),r.destroy()),r=$("#tbl-data-2").DataTable({serverSide:!1,columnDefs:[{orderable:!1,targets:[0,1,2]}],dom:"Bfrtip",buttons:[{extend:"excel",footer:!1,exportOptions:{columns:[0,1,2]}},{extend:"pdf",footer:!1,exportOptions:{columns:[0,1,2]}}]}),null!=e&&($("#title-studentname").html(`Estudiante: ${e.studentFullName}`),e.rowChilds.length>0)){for(var t=0;t<e.rowChilds.length;t++){var a=r.row.add([`${e.rowChilds[t].courseName}`,`${e.rowChilds[t].credits}`,`${e.rowChilds[t].average}`]).draw().node();$(a).css("text-align","center")}mApp.unblock("#rendering-modal")}}))}))}$(".portlet-details").removeClass("m--hide"),mApp.unblock("#rendering")}))})),$("#btn-pdf").on("click",(function(){var e=$(this);e.addLoader(),$.fileDownload(`/director-carrera/notas-por-competencias/descargar/pdf/${t}/${a}/${o}/${n}`.proto().parseURL()).done((function(){e.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito")})).fail((function(r){e.removeLoader(),toastr.error("Ocurrió un error al generar el archivo","Error")}))})),$("#btn-excel").on("click",(function(){var e=$(this);e.addLoader(),$.fileDownload(`/director-carrera/notas-por-competencias/reporte-excel/${t}/${a}/${o}/${n}`.proto().parseURL()).done((function(){e.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito")})).fail((function(r){e.removeLoader(),toastr.error("Ocurrió un error al generar el archivo","Error")}))}))})).fail((function(e){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)})).always((function(){mApp.unblock("#container")}))},o=function(){$.ajax({url:"/director-carrera/notas-por-competencias/reporte".proto().parseURL(),data:{termId:$("#termId").val(),facultyId:$("#facultyId").val(),careerId:$("#careerId").val(),curriculumId:$("#curriculumId").val()},beforeSend:function(){mApp.block("#container-2","Cargando...")}}).done((function(e){console.log(e);var r=[];if(null!=e.rangeLevels&&null!=e.rangeLevels)for(var t=0;t<e.rangeLevels.length;t++)r.push({name:e.rangeLevels[t].name,data:e.rangeLevels[t].array});Highcharts.chart("container-2",{chart:{type:"column"},title:{text:"Niveles por competencias"},xAxis:{categories:e.competencesNames},yAxis:{min:0,title:{text:""},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:Highcharts.defaultOptions.title.style&&Highcharts.defaultOptions.title.style.color||"gray"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.defaultOptions.legend.backgroundColor||"white",borderColor:"#CCC",borderWidth:1,shadow:!1},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0}}},series:r,credits:{text:"",href:""},lang:{contextButtonTitle:"Opciones",viewFullscreen:"Ver en pantalla completa",printChart:"Imprimir",downloadPNG:"Descargar PNG",downloadJPEG:"Descargar JPEG",downloadPDF:"Descargar PDF",downloadSVG:"Descargar SVG",downloadCSV:"Descargar CSV",downloadXLS:"Descargar XLS",openInCloud:"Abrir editor online"}})})).fail((function(e){toastr.info(e.responseText,"Información!")})).always((function(){mApp.unblock("#container-2","Cargando...")}))};return{init:function(){t.init()}}}();$((function(){InitApp.init()}));