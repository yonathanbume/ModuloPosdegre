var RoleTable=function(){var t,e=0,n=[],s={search:{input:$("#search")},data:{type:"remote",source:{read:{method:"GET",url:"/admin/permisos/roles/get".proto().parseURL()}}},columns:[{field:"name",title:"Nombre",width:300},{field:"options",title:"Opciones",width:250,sortable:!1,filterable:!1,template:function(t){return`<button data-id="${t.id}" class="btn btn-primary btn-sm m-btn m-btn--icon btn-edit" title="Editar"><span><i class="la la-edit"></i><span>Editar</span></span></button> <button data-id="${t.id}" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete" title="Eliminar"><i class="la la-trash"></i></button>`}}]},a=function(){t.on("click",".btn-edit",(function(){var t;t=$(this).data("id"),$.ajax({url:("/admin/permisos/roles/"+t+"/get").proto().parseURL(),type:"GET",data:{id:t},success:function(s){$("#roleid").val(t),$("#role_modal").modal("show"),$("#rDescription").val(s.role.name),s.role.isStatic&&$("#rDescription").attr("disabled","disabled"),document.getElementById("role-permissions").innerHTML="";for(var a=0;a<s.permissions.length;a++){var i=s.permissions[a],o='<div id="p-'+ ++e+'" class="form-group col-lg-12" style="display:flex;"><input class="roleId" value="'+i.id+'" hidden/><input class="form-control m-input answer" style="margin-right: 10px;" required value="'+i.name+'" disabled><button class="btn btn-danger btn-sm m-btn--icon remove-permission" data-key="'+e+'" type="button"><span><i class="la la-trash"></i></span></button></div>';n.push({value:i.value,domkey:e});var r=document.createElement("div");r.innerHTML=o,document.getElementById("role-permissions").appendChild(r.firstChild)}},error:function(){toastr.error("Error al cargar los permisos",_app.constants.toastr.title.error)}})})),t.on("click",".btn-delete",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",text:"El rol será eliminado",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((n=>{$.ajax({url:"/admin/permisos/roles/eliminar/post".proto().parseURL(),type:"POST",data:{id:e},success:function(e){t.reload(),swal({type:"success",title:"Completado",text:"El rol ha sido eliminado con éxito",confirmButtonText:"Continuar"})},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Al parecer el rol tiene usuarios relacionados"})}})}))})})),$("#add-permission").click((function(){var t=$("#Permissions").find(":selected").text(),s=$("#Permissions").find(":selected").val(),a='<div id="p-'+ ++e+'" class="form-group col-lg-12" style="display:flex;"><input class="roleId" value="" hidden/><input value="'+t+'" class="form-control m-input answer" style="margin-right: 10px;" disabled><button class="btn btn-danger btn-sm m-btn--icon remove-permission" data-key="'+e+'" type="button"><span><i class="la la-trash"></i></span></button></div>';n.push({value:s,domkey:e});var i=document.createElement("div");i.innerHTML=a,document.getElementById("role-permissions").appendChild(i.firstChild)})),$("body").on("click",".remove-permission",(function(){event.preventDefault();var t=$(this).data("key");$("#p-"+t).remove(),n.splice(n.findIndex((e=>e.domkey===t)),1)})),$("#role_modal").on("hidden.bs.modal",(function(){$("#roleid").val(""),$("#rDescription").val(""),$("#rDescription").removeAttr("disabled"),e=0,n=[],document.getElementById("role-permissions").innerHTML=""}))},i=function(){t=$(".m-datatable").mDatatable(s),a(),$(".add").click((function(){var e;e=$("#roleid").val(),$.ajax({url:"/admin/permisos/registrar/post",type:"POST",data:{id:e,name:$("#rDescription").val(),listPermissions:n},beforeSend:function(){DefaultAjaxFunctions.beginAjaxCall()},success:function(){$("#role_modal").modal("hide"),$("#rDescription").val(""),document.getElementById("role-permissions").innerHTML="",toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error("No se puedo completar su solicitud",_app.constants.toastr.title.error)},complete:function(){t.reload(),DefaultAjaxFunctions.endAjaxCall()}})}))};return{init:function(){i()}}}(),DefaultAjaxFunctions={beginAjaxCall:function(){$(".btn-submit").each((function(t,e){$(this).addLoader()}))},endAjaxCall:function(){$(".btn-submit").each((function(t,e){$(this).removeLoader()}))},ajaxSuccess:function(){$("#role-permissions").modal("hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},createFailure:function(t){!function(t){null!==t.responseText&&""!==t.responseText?$("#create_msg_txt").html(t.responseText):$("#create_msg_txt").html(_app.constant.ajax.message.error),$("#create_msg").removeClass("m--hide").show()}(t)},editFailure:function(t){!function(t){null!==t.responseText&&""!==t.responseText?$("#edit_msg_txt").html(t.responseText):$("#edit_msg_txt").html("asdasd"),$("#edit_msg").removeClass("m--hide").show()}(t)}};$((function(){RoleTable.init()}));