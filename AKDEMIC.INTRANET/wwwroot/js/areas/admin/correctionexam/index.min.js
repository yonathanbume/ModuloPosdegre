var CourseTable=function(){var e=null,t={ajax:{type:"GET",dataType:"JSON",url:"/admin/examen-subsanacion/get-datatable".proto().parseURL(),data:function(e){delete e.columns;var t=$(".select2-areacareers").val(),a=$(".select2-plans").val(),n=$(".select2-cyccles").val(),c=$(".select2-terms").val();t=t===_app.constants.guid.empty?null:t,a=a===_app.constants.guid.empty?null:a,e.careerId=t,e.curriculumId=a,e.academicYear=n,e.termId=c,e.search=$("#search").val()}},pageLength:10,orderable:[],columns:[{title:"Código",data:"courseCode",orderable:!1},{title:"Nombre",data:"courseName",orderable:!1},{title:"Sección",data:"section",orderable:!1},{title:"Escuela Profesional",data:"career",orderable:!1},{data:null,orderable:!1,title:"Opciones",render:function(e){var t="";return t+=`<a href="/admin/examen-subsanacion/${e.id}/gestionar" class="btn btn-primary btn-sm m-btn  m-btn m-btn--icon"><span><i class="la la-cog"></i><span>Gestionar</span></span></a>`}}]},a={init:function(){this.careers.init(),this.plans.init(),this.course.init(),this.term.init(),this.cicles.init()},term:{load:function(){$.ajax({url:"/ultimos-periodos/get?yearDifference=4",type:"GET"}).done((function(t){$(".select2-terms").select2({placeholder:"Selecciona periodo",data:t.items}),$(".select2-terms").on("change",(function(){$("#cCareer").val();e.ajax.reload()})),$("#cCareer").trigger("change")}))},init:function(){this.load()}},careers:{init:function(){$(".select2-areacareers").empty(),$.ajax({url:"/carreras/get"}).done((function(t){t.items.unshift({id:_app.constants.guid.empty,text:"Todas"}),$(".select2-areacareers").select2({data:t.items}),$(".select2-areacareers").on("change",(function(){$(this).val()===_app.constants.guid.empty?(a.plans.empty(),a.course.empty(),a.cicles.empty(),e.ajax.reload()):(a.cicles.empty(),a.plans.load($(this).val()))}))}))}},plans:{init:function(){$(".select2-plans").select2({placeholder:"Seleccione un plan",disabled:!0}),$(".select2-plans").on("change",(function(){$(this).val()===_app.constants.guid.empty?(a.course.empty(),a.cicles.empty(),e.ajax.reload()):(a.course.load($(this).val()),a.cicles.load($(this).val()),e.ajax.reload())}))},load:function(e){$(".select2-plans").empty(),$.ajax({url:`/admin/examen-sustitutorio/carreras/${e}/planestudio/get`.proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todos"}),$(".select2-plans").select2({data:e.items,disabled:!1}).trigger("change")}))},empty:function(){$(".select2-plans").empty(),$(".select2-plans").select2({placeholder:"Seleccione un plan",disabled:!0})}},course:{init:function(){$(".select2-course").select2({placeholder:"Seleccione un Curso",disabled:!0}),$(".select2-course").on("change",(function(){$(this).val();e.ajax.reload()}))},load:function(e){$(".select2-course").empty(),$.ajax({url:`/curriculum/${e}/cursos/get`.proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todos"}),$(".select2-course").select2({data:e.items,disabled:!1}).trigger("change")}))},empty:function(){$(".select2-course").empty(),$(".select2-course").select2({placeholder:"Seleccione un Curso",disabled:!0})}},cicles:{init:function(){$(".select2-cyccles").select2({placeholder:"Seleccione un ciclo",disabled:!0}),$(".select2-cyccles").on("change",(function(){e.ajax.reload()}))},load:function(e){$(".select2-cyccles").empty(),$.ajax({url:`/planes-estudio/${e}/niveles/get`.proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todos"}),$(".select2-cyccles").select2({data:e.items,disabled:!1})}))},empty:function(){$(".select2-cyccles").empty(),$(".select2-cyccles").select2({placeholder:"Seleccione un ciclo",disabled:!0})}}},n=function(){null!==e?e.ajax.reload():e=$(".students-datatable").DataTable(t)},c={init:function(){this.careers.init(),this.course.init(),this.classroom.init(),this.section.init(),this.teacher.init()},teacher:{init:function(){$("#create_modal").find("[name='TeacherId']").select2({ajax:{delay:1e3,url:"/profesores/get/v2".proto().parseURL()},allowClear:!0,minimumInputLength:0,placeholder:"Seleccione Docente",dropdownParent:$("#create_modal")})}},careers:{init:function(){$("#cCareer").empty(),$.ajax({url:"/carreras/get"}).done((function(e){$("#cCareer").select2({data:e.items}),$("#cCareer").on("change",(function(){$(this).val()===_app.constants.guid.empty||c.course.load($(this).val())})),$("#cCareer").trigger("change")}))}},course:{init:function(){$("#cCourse").select2({placeholder:"Seleccione un Curso",disabled:!0}),$("#cCourse").on("change",(function(){var e=$(this).val();c.section.load(e)}))},load:function(e){var t=$("[name='TermId']").val();$("#cCourse").empty(),$.ajax({url:`/carreras/${e}/cursos/activos/get?termId=${t}`.proto().parseURL()}).done((function(e){$("#cCourse").select2({data:e.items,disabled:!1}).trigger("change")}))}},section:{init:function(){$("#cSection").select2({placeholder:"Seleccione un Grupo",disabled:!0})},load:function(e){var t=$("[name='TermId']").val();$("#cSection").empty(),$.ajax({url:`/cursos/${e}/secciones/get?termId=${t}`.proto().parseURL()}).done((function(e){$("#cSection").select2({data:e.items,disabled:!1}).trigger("change")}))},empty:function(){$("#cSection").empty(),$("#cSection").select2({placeholder:"Seleccione un grupo",disabled:!0})}},classroom:{load:function(){$("#create_modal").find("[name='ClassroomId']").select2({ajax:{delay:1e3,url:"/aular/get/v2".proto().parseURL()},allowClear:!0,minimumInputLength:0,placeholder:"Seleccione aula",dropdownParent:$("#create_modal")})},init:function(){this.load()}}},i={startDate:function(){$("#create_modal").find("[name='StartDate']").datepicker()},startTime:function(){$("#create_modal").find("[name='StartTime']").timepicker({minuteStep:5}).timepicker("setTime","7:00 AM"),$("#create_modal").find("[name='StartTime']").val("")},init:function(){this.startDate(),this.startTime()}},s={create:{init:function(){$("#create-form").validate({rules:{CareerId:{required:!0},CourseId:{required:!0}},submitHandler:function(e,t){t.preventDefault(),$("#create_modal .btn-submit").addLoader(),$(e).ajaxSubmit({success:function(e){toastr.success("Examen creado con éxito.","Hecho"),$("#create_modal").modal("hide"),n()},error:function(e){toastr.error(e.responseText,"Error")},complete:function(){$("#create_modal .btn-submit").removeLoader()}})}})}},init:function(){s.create.init()}},o=function(){$("#search").doneTyping((function(){n()}))};return{init:function(){a.init(),c.init(),s.create.init(),i.init(),o(),n()}}}();$((function(){CourseTable.init()}));