var ActivitiesTable=function(){var t,e={search:{input:$("#search")},data:{source:{read:{method:"GET",url:"/admin/actividades-extracurriculares-alumnos/get".proto().parseURL()}}},columns:[{field:"date",title:"Fecha"},{field:"activityCode",title:"Código Actividad"},{field:"activity",title:"Actividad"},{field:"name",title:"Estudiante"},{field:"credits",title:"Créditos"},{field:"options",title:"Opciones",textAlign:"center",width:125,sortable:!1,filterable:!1,template:function(t){var e="";return e+="<button data-id='"+t.id+"' class='btn btn-info btn-sm m-btn m-btn--icon btn-edit' data-toggle='modal' data-target='#edit_activity_modal'><span><i class='la la-edit'></i><span>Editar</span></span></button> ",e+="<button data-id='"+t.id+"' class='btn btn-danger btn-sm m-btn--icon btn-delete'><i class='la la-trash'></i></button>"}}]},a=function(){$(".btn-delete").on("click",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",text:"La actividad extracurricular del estudiante será eliminada",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarla",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({url:"/admin/actividades-extracurriculares-alumnos/eliminar".proto().parseURL(),type:"POST",data:{id:e},success:function(){t.reload(),swal({type:"success",title:"Completado",text:"La actividad extracurricular del estudiante ha sido eliminada con éxito",confirmButtonText:"Excelente"})},error:function(){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Error al eliminar la actividad extracurricular del estudiante"})}})}))})})),$(".btn-edit").on("click",(function(){var t=$(this).data("id");Form.Edit.show(t)}))};return{init:function(){void 0!==t&&t.destroy(),e.data.source.read.url="/admin/actividades-extracurriculares-alumnos/get".proto().parseURL(),t=$("#activities-datatable").mDatatable(e),$(t).on("m-datatable--on-layout-updated",(function(){a()}))},reload:function(){t.reload()}}}(),Form=function(){var t,a,i="#add_activity_modal",r="#edit_activity_modal",n=function(){$(i).one("hidden.bs.modal",(function(){s.reset.create()}))},s={submit:{create:function(t){$(t).serialize();var e=new FormData($(t)[0]);$(`${i} input, ${i} select, ${i} textarea`).attr("disabled",!0),$("#btnCreate").addLoader(),$.ajax({url:$(t).attr("action"),type:"POST",data:e,contentType:!1,processData:!1}).always((function(){$(`${i} input, ${i} select, ${i} textarea`).attr("disabled",!1),$("#btnCreate").removeLoader()})).done((function(){$(i).modal("toggle"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),ActivitiesTable.reload()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=t.responseText?$("#add_form_msg_txt").html(t.responseText):$("#add_form_msg_txt").html(_app.constants.ajax.message.error),$("#add_form_msg").removeClass("m--hide").show()}))},edit:function(t){$(t).serialize();var a=new FormData($(t)[0]);$(`${r} input, ${r} select, ${r} textarea`).attr("disabled",!0),$("#btnEdit").addLoader(),$.ajax({url:$(t).attr("action"),type:"POST",data:a,contentType:!1,processData:!1}).always((function(){$(`${r} input, ${r} select, ${r} textarea`).attr("disabled",!1),$("#btnEdit").removeLoader()})).done((function(){$(r).modal("toggle"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),ActivitiesTable.reload()})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=e.responseText?$("#edit_form_msg_txt").html(e.responseText):$("#edit_form_msg_txt").html(_app.constants.ajax.message.error),$("#edit_form_msg").removeClass("m--hide").show()}))}},reset:{create:function(){$("#add_form_msg").addClass("m--hide").hide(),$("#Add_StudentId").val(null).trigger("change.select2"),$("#Add_ExtracurricularActivityId").val(null).trigger("change.select2"),t.resetForm()},edit:function(){$("#edit_form_msg").addClass("m--hide").hide(),$("#Edit_StudentId").val(null).trigger("change.select2"),$("#Edit_ExtracurricularActivityId").val(null).trigger("change.select2"),a.reset()}},show:{edit:function(t){mApp.blockPage(),$.ajax({url:`/admin/actividades-extracurriculares-alumnos/${t}/get`.proto().parseURL()}).done((function(t){$("#edit-activity-form").get(0).elements.Edit_Id.value=t.id,$("#Edit_ExtracurricularActivityId").val(t.extracurricularActivityId).trigger("change"),$("#Edit_StudentId").append(`<option value="${t.studentId}" selected="selected">${t.student}</option>`),mApp.unblockPage(),$(r).one("hidden.bs.modal",(function(){s.reset.edit()}))})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}}},o={init:function(){$.ajax({url:"/extracurricular-activities/get".proto().parseURL()}).done((function(t){$("#Add_ExtracurricularActivityId").select2({placeholder:"Seleccione una actividad",dropdownParent:$("#add_activity_modal"),minimumResultsForSearch:1,data:t.items}),$("#Edit_ExtracurricularActivityId").select2({placeholder:"Seleccione una actividad",dropdownParent:$("#edit_activity_modal"),minimumResultsForSearch:1,data:t.items})})),$("#Add_StudentId").select2({width:"100%",placeholder:"Seleccione un estudiante",dropdownParent:$("#add_activity_modal"),ajax:{url:"/academico/alumnos/buscar".proto().parseURL(),dataType:"json",data:function(t){return{term:t.term,page:t.page}},processResults:function(t,e){return{results:t.items}},cache:!0},escapeMarkup:function(t){return t},minimumInputLength:3}),$("#Edit_StudentId").select2({width:"100%",placeholder:"Seleccione un estudiante",dropdownParent:$("#edit_activity_modal"),ajax:{url:"/academico/alumnos/buscar".proto().parseURL(),dataType:"json",data:function(t){return{term:t.term,page:t.page}},processResults:function(t,e){return{results:t.items}},cache:!0},escapeMarkup:function(t){return t},minimumInputLength:3})}},d={Add_Name:{required:!0,maxlength:100},Edit_Name:{required:!0,maxlength:100}},c=function(){t=$("#add-activity-form").validate({rules:d,submitHandler:function(t,e){e.preventDefault(),s.submit.create(t)}}),a=$("#edit-activity-form").validate({rules:d,submitHandler:function(t,e){e.preventDefault(),s.submit.edit(t)}})};return{init:function(){n(),c(),o.init()},Edit:{show:function(t){s.show.edit(t)}}}}();$((function(){ActivitiesTable.init(),Form.init()}));