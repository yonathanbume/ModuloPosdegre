var index=function(){var t={students:{object:null,options:{pageLength:10,ajax:{url:"/admin/estudiantes-egresados/get",type:"GET",data:function(t){t.facultyId=$("#faculty_select").val(),t.careerId=$("#career_select").val(),t.curriculumId=$("#curriculum_select").val(),t.searchValue=$("#search").val(),t.termId=$("#term_select").val()}},columns:[{title:"Código",data:"userName"},{title:"Estudiante",data:"fullName"},{title:"Escuela",data:"career"},{title:"Opciones",data:null,render:function(t){var e="";return e+=`<button data-id="${t.id}" class="btn btn-primary btn-sm m-btn m-btn--icon btn-change-status"><span><i class="la la-edit"></i><span>Cambiar Estado</span></span></button>`,e+=`<button data-id="${t.id}" class="ml-1 btn btn-info btn-sm m-btn m-btn--icon btn-history"><span><i class="la la-list-ul"></i><span>Historial</span></span></button>`}}],dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[0,1,2]}},{extend:"pdfHtml5",exportOptions:{columns:[0,1,2]}}]},events:{onHistory:function(){$("#data-table").on("click",".btn-history",(function(){var t=$(this).data("id");e.history.show(t)}))},onChangeStatus:function(){$("#data-table").on("click",".btn-change-status",(function(){var e=$(this).data("id");swal({type:"warning",title:"El estado del estudiante pasará a EGRESADO.",text:"¿Seguro que desea hacer el cambio?.",confirmButtonText:"Aceptar",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({type:"POST",url:`/admin/estudiantes-egresados/cambiar-estado?studentId=${e}`}).done((function(e){t.students.reload(),swal({type:"success",title:"Completado",text:"El estado del estudiante ha sido actualizado con éxito.",confirmButtonText:"Aceptar"})})).fail((function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===t.status?"No hay respuesta del servidor":t.responseText})}))}))})}))},init:function(){this.onHistory(),this.onChangeStatus()}},reload:function(){null===t.students.object?t.students.object=$("#data-table").DataTable(t.students.options):t.students.object.ajax.reload()},init:function(){t.students.events.init()}},history:{object:null,options:{pageLength:20,responsive:!0,processing:!0,serverSide:!1,filter:!0,lengthChange:!1,paging:!1,ordering:!1,orderMulti:!1,columnDefs:[{orderable:!1,targets:[]}],ajax:{url:"/admin/estudiantes-egresados/historial-academico/alumno",type:"GET",data:function(t){t.studentId=$("#StudentId").val()}},columns:[{data:"year",title:"Ciclo"},{data:"code",title:"Código"},{data:"course",title:"Curso"},{data:"credits",searchable:!1,title:"Créditos"},{title:"N° veces",searchable:!1,data:null,render:function(t){return 0===t.tries?" - ":t.tries}},{title:"Nota",searchable:!1,data:null,render:function(t){return t.validated?t.grade<=0?`<a href="#" data-id="${t.id}" class="show-equiv"><span class="m--font-info"> CE </span></a>`:`<a href="#" data-id="${t.id}" class="show-equiv"><span class="m--font-info"> ${t.grade} </span></a>`:0===t.tries?" - ":t.grade<11?`<span style="color: red;">${t.grade}</span>`:t.grade}},{title:"Semestre",searchable:!1,data:null,render:function(t){return 0===t.tries?" - ":t.term}},{title:"Estado",searchable:!1,data:"status"}]},reload:function(){null===t.history.object?t.history.object=$("#student_history").DataTable(t.history.options):t.history.object.ajax.reload()},init:function(){$("#history-search").on("keyup",(function(){t.history.object.search(this.value).draw()}))}},init:function(){t.students.init(),t.history.init()}},e={history:{object:$("#modal_student_history"),show:function(n){$("#StudentId").val(n),t.history.reload(),a.getApprovedCredits(n),e.history.object.modal("show")}}},a={getApprovedCredits:function(t){$.ajax({url:"/admin/estudiantes-egresados/creditos-aprobados/alumno?studentId="+t,type:"GET"}).done((function(t){$("#credit_approved").text(t)}))},onSearch:function(){$("#btn_search_student").click((function(){var e=$("#faculty_select").val(),a=$("#career_select").val(),n=$("#curriculum_select").val();null!==$("#term_select").val()?null!==e?null!==a?null!==n?t.students.reload():toastr.error("Es necesario seleccionar un plan de estudio.","Error!"):toastr.error("Es necesario seleccionar una escuela.","Error!"):toastr.error("Es necesario seleccionar una facultad.","Error!"):toastr.error("Es necesario seleccionar un periodo académico.","Error!")}))},init:function(){this.onSearch()}},n={academicYear:{load:function(){$("#academicyear-select").select2()},events:{onChange:function(){$("#academicyear-select").on("change",(function(){var e=this.value;console.log(e),"-1"==e&&(e=""),t.history.object.column(0).search(e).draw()}))},init:function(){this.onChange()}},init:function(){this.load(),this.events.init()}},faculty:{load:function(){$.ajax({url:"/facultades/get"}).done((function(t){$("#faculty_select").select2({data:t.items,placeholder:"Seleccionar facultad..."}),$("#faculty_select").val(null).trigger("change")}))},onChange:function(){$("#faculty_select").on("change",(function(){var t=$(this).val();n.careers.load(t)}))},init:function(){this.load(),this.onChange()}},careers:{load:function(t){$("#career_select").empty(),null===t||t===_app.constants.guid.empty?$("#career_select").select2({disabled:!0,placeholder:"Seleccionar escuela"}):$.ajax({url:`/facultades/${t}/carreras/v2/get?hasAll=false`}).done((function(t){$("#career_select").select2({data:t.items,disabled:!1}).trigger("change")}))},onChange:function(){$("#career_select").on("change",(function(){var t=$(this).val();n.curriculum.load(t)}))},init:function(){$("#career_select").select2({disabled:!0,placeholder:"Seleccionar escuela"}),this.onChange()}},curriculum:{load:function(t){$("#curriculum_select").empty(),null===t||t===_app.constants.guid.empty?$("#curriculum_select").select2({disabled:!0,placeholder:"Seleccionar plan de estudio"}):$.ajax({url:`/carreras/${t}/planestudio/get`}).done((function(t){$("#curriculum_select").select2({data:t.items,disabled:!1}).trigger("change")}))},init:function(){$("#curriculum_select").select2({disabled:!0,placeholder:"Seleccionar plan de estudio"})}},term:{load:function(){$.ajax({url:"/periodos/get"}).done((function(t){$("#term_select").select2({data:t.items,disabled:!1}).trigger("change")}))},init:function(){this.load()}},init:function(){this.academicYear.init(),this.faculty.init(),this.careers.init(),this.curriculum.init(),this.term.init()}};return{init:function(){t.init(),n.init(),a.init()}}}();$((()=>{index.init()}));