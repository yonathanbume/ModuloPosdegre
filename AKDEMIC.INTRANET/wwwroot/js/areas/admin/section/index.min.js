var sections=function(){var t,e={load:{getTeachers:function(t,a){var n=$(t).data("id"),s=$(t).data("teacher");e.list["sections-ajax-edit"]=$.ajax({type:"GET",url:"/admin/secciones/editar-seccion-profesor".proto().parseURL(),success:function(t,e,a){$("input[name='Id']").val(n),$("input[name='IdTeacher']").val(s),$("#Teacher-select2").select2({data:t.items}),$("#Teacher-select2").val(s).trigger("change")},error:function(t,e,a){toastr.error(_app.constants.toastr.message.update,_app.constants.toastr.title.error)}})},edit:function(a,n){var s=a.elements;e.list["sections-ajax-edit"]=$.ajax({data:{SectionId:s.Id.value,TeacherId:s.TeacherId.value},type:a.method,url:a.action,beforeSend:function(t,e){$(a).addLoader()},complete:function(t,e){$(a).removeLoader()},error:function(t,e,a){toastr.error(_app.constants.toastr.message.error.update,_app.constants.toastr.title.error)},success:function(a,n,s){t.reload(),e.list["sections-modal-edit"].modal("hide"),toastr.success(_app.constants.toastr.message.success.update,_app.constants.toastr.title.success)}})}},list:{}},a={list:{},load:{edit:function(){a.list["sections-modal-edit-form"]=$("#sections-modal-edit-form").validate({submitHandler:function(t,a){e.load.edit(t,a)}})}}},n={data:{source:{read:{method:"GET",url:""}}},columns:[{field:"code",title:"CÃ³digo",width:80},{field:"teacher",title:"Profesor(a)",width:120},{field:"vacancies",title:"Max.Vacantes",width:140},{field:"options",title:"Opciones",width:250,sortable:!1,filterable:!1,template:function(t){var e=`/admin/secciones/acta-final/${t.id}`.proto().parseURL();return"Finished"!=t.termfinished?'<button type="button" data-id="'+t.id+'" data-teacher="'+t.id_teacher+'" class="btn btn-info btn-sm m-btn m-btn--icon btn-edit" onClick="sections.initModal(this, event)"><span><i class="la la-edit"></i><span>Editar Profesor</span></span></button> '+`<a href="${e}" class="btn btn-primary btn-sm m-btn m-btn--icon"><span><i class="la la-file"></i><span>Acta final</span></span></a>`:'<button type="button" data-id="'+t.id+'" data-teacher="'+t.id_teacher+'" class="btn btn-info btn-sm m-btn m-btn--icon btn-edit" onClick="sections.initModal(this, event)" disabled><span><i class="la la-edit"></i><span>Editar Profesor</span></span></button> '+`<a href="${e}" class="btn btn-primary btn-sm m-btn m-btn--icon"><span><i class="la la-file"></i><span>Acta final</span></span></a>`}}]},s=function(){n.data.source.read.url=("/admin/secciones/"+$("#select_career").val()+"/periodo/"+$("#select_term").val()).proto().parseURL(),void 0!==t&&t.destroy(),t=$(".m-datatable").mDatatable(n)},i=function(){$.when(($("#select_career").select2({allowClear:!0,placeholder:"Buscar..",ajax:{type:"GET",url:"/admin/secciones/obtener-cursos".proto().parseURL(),delay:1e3,data:function(t){return{searchValue:t.term}},processResults:function(t){return{results:t.results}},escapeMarkup:function(t){return t},minimumInputLength:1}}),void $("#select_career").on("change",(function(){s()}))),$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(t){$("#select_term").select2({data:t.items}).val(t.selected).trigger("change"),$("#select_term").on("change",(function(t){s()}))}))).done((function(){s()}))};return{init:function(){i(),a.load.edit()},initModal:function(t,a){!function(t,a){var n=document.getElementById("sections-modal-edit-form");_app.modules.form.reset({element:n}),e.load.getTeachers(t,a),e.list["sections-modal-edit"]=$("#sections-modal-edit").modal("show")}(t,a)}}}();$((function(){sections.init()}));