var StudentTable=function(){var t={object:null,options:{responsive:!0,processing:!0,serverSide:!0,ajax:{url:"/admin/alumnos-bloqueados/get".proto().parseURL(),data:function(t){delete t.columns,t.search=$("#search").val(),t.facultyId=$(".select2-faculties").val(),t.careerId=$(".select2-careers").val(),t.programId=$(".select2-programs").val()}},columns:[{title:"Usuario",data:"user.userName"},{title:"Nombre y Apellidos",data:"user.fullName"},{title:"DNI",data:"user.dni"},{title:"Escuela",data:"career.name"},{title:"Teléfono",data:"user.phoneNumber"},{title:"Fec. Bloqueo",data:"user.address"},{title:"Opciones",data:null,orderable:!1,render:function(t){return`<a data-id="${t.userId}" data-toggle="modal" data-target="#EditLockdOutModal" class="btn btn-primary btn-sm m-btn m-btn--icon btn-edit text-white" title="Editar Motivo"><i class="la la-edit"></i>Editar</a> <button data-id="${t.userId}" class="btn btn-danger btn-sm m-btn m-btn--icon btn-unlock" title="Desbloquear"><i class="la la-unlock-alt"></i>Desbloquear</button>`}}]},init:function(){this.object=$(".students-datatable").DataTable(this.options)},reload:function(){this.object.ajax.reload()}},e={buttons:{unlock:function(){$(".students-datatable").on("click",".btn-edit",(function(){var t=$(this).data("id");$("#EditReason").prop("disabled",!0),$.ajax({url:("/admin/alumnos-bloqueados/get-motivo?userId="+t).proto().parseURL()}).done((function(e){$("#EditReason").val(e),$("#EditId").val(t)})).always((function(){$("#EditReason").prop("disabled",!1)}))})),$(".students-datatable").on("click",".btn-unlock",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, desbloquear",confirmButtonClass:"btn btn-success m-btn m-btn--custom",cancelButtonText:"Cancelar",html:'El usuario será desbloqueado.</br>\n                                       <div class="form-group m-form__group col-xl-12">\n                                            <div class="m-input  m-input--solid">\n                                                <label for="Reason2"></label>\n                                                <input type="text" placeholder="Motivo" class="form-control m-input" name="Reason2" id="Reason2" required>\n                                            </div>\n                                        </div>',preConfirm:()=>{var t=!0;if($.each({Reason2:"Introduzca un motivo"},(function(e,a){""==$('input[name="Reason2"]').val()?($('input[name="'+e+'"]').hasClass("invalid")||$('input[name="'+e+'"]').addClass("invalid").after('<div class="invalid-feedback">'+a+"</div>"),t=!1):($("input.invalid").removeClass("invalid"),$(".invalid-feedback").remove())})),!t)return!1},allowOutsideClick:()=>!swal.isLoading()}).then((a=>{if(a.value){var o=new FormData;o.append("reason",$('input[name="Reason2"]').val()),$.ajax({url:`/admin/alumnos-bloqueados/desbloquear/${e}`.proto().parseURL(),type:"POST",processData:!1,contentType:!1,data:o,success:function(e){swal({type:"success",title:"Completado",text:"El registro ha sido desbloqueado con éxito",confirmButtonText:"Excelente"}).then(t.reload())},error:function(t){var e="";e=null!==t.responseText&&""!==t.responseText?t.responseText:_app.constants.toastr.message.error.task,swal({type:"error",title:_app.constants.toastr.title.error,confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:e})}})}}))}))}},init:function(){this.buttons.unlock()}},a=function(){$("#add-form").validate({submitHandler:function(e){var a=$(e).find('button[type="submit"]');a.addLoader();var o=new FormData($("#add-form")[0]);$.ajax({type:"POST",url:"/admin/alumnos-bloqueados/guardar".proto().parseURL(),data:o,processData:!1,contentType:!1,success:function(){$("#AddLockdOutModal").modal("hide"),t.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),$("#add-form")[0].reset()},error:function(t){toastr.error(t.responseText,_app.constants.toastr.title.error)},complete:function(){a.removeLoader()}})}}),$("#edit-form").validate({submitHandler:function(t){var e=$(t).find('button[type="submit"]');e.addLoader();var a=new FormData($("#edit-form")[0]);$.ajax({type:"POST",url:"/admin/alumnos-bloqueados/guardar".proto().parseURL(),data:a,processData:!1,contentType:!1,success:function(){$("#EditLockdOutModal").modal("hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),$("#edit-form")[0].reset()},error:function(t){toastr.error(t.responseText,_app.constants.toastr.title.error)},complete:function(){e.removeLoader()}})}})},o={init:function(){this.faculties.init(),this.careers.init(),this.programs.init(),$("#add-user-select2").select2({placeholder:"Buscar...",dropdownParent:$("#AddLockdOutModal"),ajax:{url:"/admin/alumnos-bloqueados/usuarios/get".proto().parseURL(),dataType:"json",data:function(t){return{term:t.term}},processResults:function(t,e){return{results:t.items}},cache:!0},minimumInputLength:3})},faculties:{init:function(){$.ajax({url:"/facultades/get".proto().parseURL()}).done((function(e){$(".select2-faculties").select2({data:e.items}),$(".select2-faculties").on("change",(function(){o.careers.reload($(this).val()),t.reload()}))}))}},careers:{init:function(){$(".select2-careers").select2({placeholder:"Seleccione una carrera"}),$(".select2-careers").on("change",(function(){o.programs.reload($(this).val()),t.reload()}))},reload:function(t){$(".select2-careers").prop("disabled",!0),$(".select2-careers").empty(),$.ajax({url:`/carreras/get?fid=${t}`.proto().parseURL()}).done((function(t){t.items.unshift({id:"Todas",text:"Todas"}),$(".select2-careers").select2({data:t.items,placeholder:"Seleccione una carrera"}),t.items.length>1&&$(".select2-careers").prop("disabled",!1)}))}},programs:{init:function(){$(".select2-programs").select2(),$(".select2-programs").on("change",(function(){t.reload()}))},reload:function(t){$(".select2-programs").prop("disabled",!0),$(".select2-programs").empty(),$.ajax({url:`/carreras/${t}/programas/get`.proto().parseURL()}).done((function(t){t.items.unshift({id:"Todos",text:"Todos"}),$(".select2-programs").select2({data:t.items,placeholder:"Programas"}),t.items.length>1&&$(".select2-programs").prop("disabled",!1)}))}}},s=function(){$("#search").doneTyping((function(){t.reload()}))};return{init:function(){o.init(),s(),t.init(),a(),e.init()}}}();$((function(){StudentTable.init()}));