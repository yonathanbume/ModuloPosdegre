var Event=function(){var e=$(".e-id-entity").val(),t=function(){$.ajax({url:"/admin/eventos/roles/get".proto().parseURL()}).done((function(e){$(".select2-roles").select2({placeholder:"Roles",minimumInputLength:0,data:e.items}),$.each($("#SelectedRoles2").val().split(","),(function(e,t){$(".select2-roles option[value='"+t+"']").prop("selected",!0)})),$(".select2-roles").trigger("change")}))},a={file:{object:$("#modal_file"),form:{object:$("#form_file").validate({submitHandler:function(e,t){t.preventDefault();var i=$("#form_file").find("[name='File']")[0].files[0],l={id:null,name:$("#form_file").find("[name='Name']").val(),url:null,file:i,toDo:1,isNew:!0};n.file.localData.push(l),n.file.object.row.add([l.name,`<button type="button" data-id="${l.id}" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete" title="Eliminar"><span><i class="la la-trash"></i><span>Eliminar</span></span></button>`]).draw(!1),toastr.success("Archivo Agregado","Hecho!"),a.file.object.modal("hide")}})},events:{onHidden:function(){a.file.object.on("hidden.bs.modal",(function(e){a.file.form.object.resetForm(),$("#form_file").find("[name='File']").val(null).trigger("change"),a.file.object.find(".custom-file-label").text("Seleccionar un archivo")}))},init:function(){this.onHidden()}},init:function(){a.file.events.init()}},init:function(){this.file.init()}},n={file:{object:null,localData:[],options:{lengthMenu:[10,25,50],orderMulti:!1,pagingType:"full_numbers",processing:!0,responsive:!0,serverSide:!1,columns:[{title:"Nombre"},{title:"Opciones"}]},events:{onDelete:function(){$("#table_files").on("click",".btn-delete",(function(){var e=$(this).data("id"),t=$(this).parent().parent();swal({type:"error",title:"Elimnará el archivo.",text:"¿Seguro que desea eliminar el archivo seleccionado?.",confirmButtonText:"Aceptar",showCancelButton:!0}).then((function(a){if(a.value){var i=n.file.localData.filter((t=>t.id===e))[0];if(i.isNew){var l=n.file.localData.indexOf(i);n.file.localData.splice(l,1)}else i.toDo=3;n.file.object.row(t).remove().draw(!1)}}))}))},getData:function(){mApp.block("#table_files",{message:"Cargando archivos..."}),$.ajax({url:`/admin/eventos/get-archivos?eventId=${e}`,type:"get"}).done((function(e){n.file.object.rows().remove().draw(),n.file.localData=[];for(var t=0;t<e.length;t++){var a={id:e[t].id,name:e[t].name,url:e[t].urlFile,toDo:0,isNew:!1};n.file.localData.push(a),n.file.object.row.add([a.name,`<a href="/documentos/${a.url}" target="_blank" class="btn btn-primary btn-sm m-btn m-btn--icon" title="Descargar"><span><i class="la la-download"></i><span>Descargar</span></span></a> <button type="button" data-id="${a.id}" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete" title="Eliminar"><span><i class="la la-trash"></i><span>Eliminar</span></span></button>`]).draw(!1)}mApp.unblock("#table_files")}))},init:function(){this.onDelete(),this.getData()}},init:function(){n.file.object=$("#table_files").DataTable(n.file.options),n.file.events.init()}},init:function(){n.file.init()}};return{init:function(){$("#File").on("change",(function(e){var t=(e.target||window.event.srcElement).files;if(console.log(t[0]),FileReader&&t&&t.length){var a=new FileReader;a.onload=function(){$("#current-picture").attr("src",a.result)},a.readAsDataURL(t[0])}else console.log("File Reader not supported.")})),t(),formCreate=$("#create-form").validate({rules:{UrlVideo:{url:!0}},submitHandler:function(e,t){t.preventDefault();let a=new FormData($(e)[0]);for(var i=0;i<n.file.localData.length;i++)a.append(`EventFiles[${i}].Id`,n.file.localData[i].id),a.append(`EventFiles[${i}].Name`,n.file.localData[i].name),a.append(`EventFiles[${i}].File`,n.file.localData[i].file),a.append(`EventFiles[${i}].ToDo`,n.file.localData[i].toDo);$("#create-form input, #create-form select,#create-form textarea").attr("disabled",!0),$(".add").addLoader(),$.ajax({url:$(e).attr("action"),type:"POST",data:a,contentType:!1,processData:!1}).always((function(){$("#create-form input, #create-form select,#create-form textarea").attr("disabled",!1),$(".add").removeLoader()})).done((function(){swal({type:"success",title:"Éxito",text:"Evento editado correctamente",confirmButtonText:"Ok"}).then((function(){window.location="/admin/eventos".proto().parseURL()}))})).fail((function(e){var t="";t=null!==e.responseText?e.responseText:_app.constants.toastr.message.error.task,swal({type:"error",title:_app.constants.toastr.title.error,text:t,confirmButtonText:"Ok"})}))}}),$("#cRegistrationStartDate").datepicker().on("changeDate",(function(e){$("#cRegistrationEndDate").datepicker("setStartDate",e.date)})),$("#cRegistrationEndDate").datepicker().on("changeDate",(function(e){$("#cRegistrationStartDate").datepicker("setEndDate",e.date)})),$("#cEventDate").datepicker(),$("#Cost").keypress((function(e){e.which>31&&(e.which<48||e.which>57)&&46!=e.which&&e.preventDefault()})).on("paste",(function(e){e.preventDefault()})),$(document).on("change",".custom-file-input",(function(e){$("#File").valid(),$(this).next(".custom-file-label").html(e.target.files[0].name)})),n.init(),a.init()}}}();$((function(){Event.init()}));