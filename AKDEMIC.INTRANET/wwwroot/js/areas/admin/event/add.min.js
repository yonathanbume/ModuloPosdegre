var Event=function(){var e=function(){$.ajax({url:"/admin/eventos/roles/get".proto().parseURL()}).done((function(e){$(".select2-roles").select2({placeholder:"Roles",minimumInputLength:0,data:e.items})}))},t={file:{object:$("#modal_file"),form:{object:$("#form_file").validate({submitHandler:function(e,i){i.preventDefault();var a=$("#form_file").find("[name='File']")[0].files[0],o={id:null,name:$("#form_file").find("[name='Name']").val(),url:null,file:a};n.file.localData.push(o),n.file.object.row.add([o.name,`<button type="button" data-id="${o.id}" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete" title="Eliminar"><span><i class="la la-trash"></i><span>Eliminar</span></span></button>`]).draw(!1),toastr.success("Archivo Agregado","Hecho!"),t.file.object.modal("hide")}})},events:{onHidden:function(){t.file.object.on("hidden.bs.modal",(function(e){t.file.form.object.resetForm(),$("#form_file").find("[name='File']").val(null).trigger("change"),t.file.object.find(".custom-file-label").text("Seleccionar un archivo")}))},init:function(){this.onHidden()}},init:function(){t.file.events.init()}},init:function(){this.file.init()}},n={file:{object:null,localData:[],options:{lengthMenu:[10,25,50],orderMulti:!1,pagingType:"full_numbers",processing:!0,responsive:!0,serverSide:!1,columns:[{title:"Nombre"},{title:"Opciones"}]},events:{onDelete:function(){$("#table_files").on("click",".btn-delete",(function(){var e=$(this).data("id"),t=$(this).parent().parent();swal({type:"error",title:"Elimnará el archivo.",text:"¿Seguro que desea eliminar el archivo seleccionado?.",confirmButtonText:"Aceptar",showCancelButton:!0}).then((function(i){if(i.value){var a=n.file.localData.filter((t=>t.id===e))[0],o=n.file.localData.indexOf(a);n.file.localData.splice(o,1),n.file.object.row(t).remove().draw(!1)}}))}))},init:function(){this.onDelete()}},init:function(){n.file.object=$("#table_files").DataTable(n.file.options),n.file.events.init()}},init:function(){n.file.init()}};return{init:function(){$("#File").on("change",(function(e){var t=(e.target||window.event.srcElement).files;if(console.log(t[0]),FileReader&&t&&t.length){var n=new FileReader;n.onload=function(){$("#current-picture").attr("src",n.result)},n.readAsDataURL(t[0])}else console.log("File Reader not supported.")})),e(),formCreate=$("#create-form").validate({rules:{File:{required:!0},UrlVideo:{url:!0}},submitHandler:function(e,t){t.preventDefault();for(var i=new FormData($(e)[0]),a=0;a<n.file.localData.length;a++)i.append(`EventFiles[${a}].Id`,n.file.localData[a].id),i.append(`EventFiles[${a}].Name`,n.file.localData[a].name),i.append(`EventFiles[${a}].File`,n.file.localData[a].file);$("#create-form input, #create-form select,#create-form textarea").attr("disabled",!0),$(".add").addLoader(),$.ajax({url:$(e).attr("action"),type:"POST",data:i,contentType:!1,processData:!1}).always((function(){$("#create-form input, #create-form select,#create-form textarea").attr("disabled",!1),$(".add").removeLoader()})).done((function(){swal({type:"success",title:"Éxito",text:"Evento agregado correctamente",confirmButtonText:"Ok"}).then((function(){window.location="/admin/eventos".proto().parseURL()}))})).fail((function(e){var t="";t=null!==e.responseText?e.responseText:_app.constants.toastr.message.error.task,swal({type:"error",title:_app.constants.toastr.title.error,text:t,confirmButtonText:"Ok"})}))}}),$("#cRegistrationStartDate").datepicker().on("changeDate",(function(e){$("#cRegistrationEndDate").datepicker("setStartDate",e.date)})),$("#cRegistrationEndDate").datepicker().on("changeDate",(function(e){$("#cRegistrationStartDate").datepicker("setEndDate",e.date)})),$("#cEventDate").datepicker(),$("#Cost").keypress((function(e){e.which>31&&(e.which<48||e.which>57)&&46!=e.which&&e.preventDefault()})).on("paste",(function(e){e.preventDefault()})),$(document).on("change",".custom-file-input",(function(e){$("#File").valid(),$(this).next(".custom-file-label").html(e.target.files[0].name)})),n.init(),t.init()}}}();$((function(){Event.init()}));