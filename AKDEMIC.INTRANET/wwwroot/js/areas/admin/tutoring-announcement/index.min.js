var TutoringAnnouncement=function(){var e=null,t=null,n=null,a={responsive:!0,processing:!0,serverSide:!0,ajax:{url:"/admin/comunicados/get".proto().parseURL(),data:function(e){"-1"!=e&&(e.published=$("#status-filter").val(),e.search=$("#search").val().toUpperCase())}},columns:[{title:"Asunto",data:"title"},{title:"Roles",data:"tutoringAnnouncementRoles",render:function(e,t,n){return n.allRoles?"Todos":[e.slice(0,-1).join(", "),e.slice(-1)[0]].join(e.length<2?"":" y ")}},{title:"Escuelas",data:"tutoringAnnouncementCareers",render:function(e,t,n){return n.allCareers?"Todas":[e.slice(0,-1).join(", "),e.slice(-1)[0]].join(e.length<2?"":" y ")}},{title:"Fecha de Publicación",data:"displayTime"},{title:"Fecha fin de Publicación",data:"endTime"},{title:"Opciones",data:null,orderable:!1,render:function(e,t,n){var a="";return a+=`<button data-id="${n.id}" class="btn btn-info btn-sm m-btn m-btn--icon btn-edit">`,a+='<span><i class="la la-edit"></i><span>Editar</span></span></button> ',a+=`<button data-id="${n.id}" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete">`,a+='<span><i class="la la-trash"></i><span>Eliminar</span></span></button>'}}]},o=function(){$("#search").doneTyping((function(){r.init()}))},r={init:function(){null===e?(e=$(".announcements-datatable").DataTable(a),this.initEvents()):e.ajax.reload()},initEvents:function(){e.on("click",".btn-edit",(function(){let e=$(this).data("id");c.edit.load(e)})),e.on("click",".btn-delete",(function(){let t=$(this).data("id");swal({title:"¿Está seguro?",text:"El comunicado será eliminado permanentemente",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((n=>{$.ajax({url:"/admin/comunicados/eliminar/post".proto().parseURL(),type:"POST",data:{id:t},success:function(t){e.ajax.reload(),swal({type:"success",title:"Completado",text:"El comunicado ha sido eliminado con éxito",confirmButtonText:"Excelente"})},error:function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Ocurrió un error al intentar eliminar el comunicado"})}})}))})}))}},i={init:function(){this.careers.init(),this.roles.init(),this.status.init()},careers:{init:function(){$.ajax({url:"/carreras/v3/get".proto().parseURL()}).done((function(e){$(".select2-careers").select2({data:e.items,placeholder:"Carreras",allowClear:!0})}))}},roles:{init:function(){$.ajax({url:"/roles-anuncios".proto().parseURL()}).done((function(e){$(".select2-roles").select2({data:e.items,placeholder:"Roles",allowClear:!0})}))}},status:{init:function(){$(".select2-status").on("change",(function(){r.init()})).select2({minimumResultsForSearch:-1}).trigger("change")}}},s=function(){var e=new Date;e.setDate(e.getDate()),$(".input-datepicker").datetimepicker({format:_app.constants.formats.datetimepicker,showMeridian:!0,startDate:e})},l=function(){$("#Add_AllRoles").change((function(){this.checked?($("#Add_TutoringAnnouncementRoleIds").parent().find(".form-control-label").removeClass("required-form-label"),$("#Add_TutoringAnnouncementRoleIds").val(null).trigger("change"),$("#Add_TutoringAnnouncementRoleIds").prop("disabled",!0)):($("#Add_TutoringAnnouncementRoleIds").parent().find(".form-control-label").addClass("required-form-label"),$("#Add_TutoringAnnouncementRoleIds").prop("disabled",!1))})),$("#Add_AllCareers").change((function(){this.checked?($("#Add_TutoringAnnouncementCareerIds").parent().find(".form-control-label").removeClass("required-form-label"),$("#Add_TutoringAnnouncementCareerIds").val(null).trigger("change"),$("#Add_TutoringAnnouncementCareerIds").prop("disabled",!0)):($("#Add_TutoringAnnouncementCareerIds").parent().find(".form-control-label").addClass("required-form-label"),$("#Add_TutoringAnnouncementCareerIds").prop("disabled",!1))})),$("#Edit_AllRoles").change((function(){this.checked?($("#Edit_TutoringAnnouncementRoleIds").parent().find(".form-control-label").removeClass("required-form-label"),$("#Edit_TutoringAnnouncementRoleIds").val(null).trigger("change"),$("#Edit_TutoringAnnouncementRoleIds").prop("disabled",!0)):($("#Edit_TutoringAnnouncementRoleIds").parent().find(".form-control-label").addClass("required-form-label"),$("#Edit_TutoringAnnouncementRoleIds").prop("disabled",!1))})),$("#Edit_AllCareers").change((function(){this.checked?($("#Edit_TutoringAnnouncementCareerIds").parent().find(".form-control-label").removeClass("required-form-label"),$("#Edit_TutoringAnnouncementCareerIds").val(null).trigger("change"),$("#Edit_TutoringAnnouncementCareerIds").prop("disabled",!0)):($("#Edit_TutoringAnnouncementCareerIds").parent().find(".form-control-label").addClass("required-form-label"),$("#Edit_TutoringAnnouncementCareerIds").prop("disabled",!1))}))},d=function(){$("#add-modal").on("shown.bs.modal",(function(){$("#Add_TutoringAnnouncementRoleIds").select2({placeholder:"Roles"}),$("#Add_TutoringAnnouncementCareerIds").select2({placeholder:"Escuelas"})})).on("hidden.bs.modal",(function(){c.add.reset()})),$("#edit-modal").on("shown.bs.modal",(function(){$("#Edit_TutoringAnnouncementRoleIds").select2({placeholder:"Roles"}),$("#Edit_TutoringAnnouncementCareerIds").select2({placeholder:"Escuelas"})})).on("hidden.bs.modal",(function(){c.edit.reset()})),$('[data-toggle="m-tooltip"]').tooltip()},c={add:{submit:function(t){var n=new FormData($(t).get(0));$(t).find(".btn-submit").addLoader(),$(t).find("input, select, textarea").prop("disabled",!0),$.ajax({url:$(t).attr("action"),type:"POST",data:n,contentType:!1,processData:!1}).always((function(){$(t).find(".btn-submit").removeLoader(),$(t).find("input, select, textarea").prop("disabled",!1)})).done((function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.ajax.reload(),$("#add-modal").modal("hide")})).fail((function(e){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=e.responseText?$("#createAlertText").html(e.responseText):$("#createAlertText").html(_app.constants.ajax.message.error),$("#createAlert").removeClass("m--hide").show()}))},reset:function(){t.resetForm(),$("#createAlert").addClass("m--hide").hide(),$("#Add_TutoringAnnouncementRoleIds").prop("disabled",!1),$("#Add_TutoringAnnouncementCareerIds").prop("disabled",!1)}},edit:{load:function(e){mApp.blockPage(),$.ajax({url:`/admin/comunicados/${e}/get`.proto().parseURL()}).always((function(){mApp.unblockPage()})).done((function(t){var n=$("#edit-form").get(0).elements;n.Edit_Id.value=e,n.Edit_Title.value=t.title,n.Edit_Message.value=t.message,$("#Edit_TutoringAnnouncementRoleIds").val(t.roles).trigger("change"),$("#Edit_TutoringAnnouncementCareerIds").val(t.careers).trigger("change"),$("#Edit_DisplayTime").val(t.displayTime).trigger("change"),$("#Edit_EndTime").val(t.endTime).trigger("change"),$("#Edit_AllRoles").prop("checked",t.allRoles).trigger("change"),$("#Edit_AllCareers").prop("checked",t.allCareers).trigger("change"),$("#edit-modal").modal("show")})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))},submit:function(t){var n=new FormData($(t).get(0));$(t).find(".btn-submit").addLoader(),$(t).find("input, select, textarea").prop("disabled",!0),$.ajax({type:"POST",url:$(t).attr("action"),data:n,contentType:!1,processData:!1}).always((function(){$(t).find(".btn-submit").removeLoader(),$(t).find("input, select, textarea").prop("disabled",!1)})).done((function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.ajax.reload(),$("#edit-modal").modal("hide")})).fail((function(e){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=e.responseText?$("#editAlertText").html(e.responseText):$("#editAlertText").html(_app.constants.ajax.message.error),$("#editAlert").removeClass("m--hide").show()}))},reset:function(){n.resetForm(),$("#editAlert").addClass("m--hide").hide(),$("#Edit_TutoringAnnouncementRoleIds").prop("disabled",!1),$("#Edit_TutoringAnnouncementCareerIds").prop("disabled",!1)}}},u=function(){t=$("#add-form").validate({submitHandler:function(e,t){t.preventDefault(),c.add.submit(e)}}),n=$("#edit-form").validate({submitHandler:function(e,t){t.preventDefault(),c.edit.submit(e)}})};return{init:function(){o(),i.init(),s(),l(),d(),u()}}}();$((function(){TutoringAnnouncement.init()}));