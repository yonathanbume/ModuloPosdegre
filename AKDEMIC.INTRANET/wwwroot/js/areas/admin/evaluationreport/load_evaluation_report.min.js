var index=function(){var a={evaluation_report:{data:[],object:null,options:{lengthMenu:[10,25,50],orderMulti:!1,pagingType:"full_numbers",processing:!0,responsive:!0,serverSide:!1,data:[],rowCallback:function(a,t,e){t.Valid?$(a).closest("tr").css("background-color",""):$(a).closest("tr").css("background-color","rgb(255 90 90 / 46%)")},columns:[{title:"Periodo",data:"Term"},{title:"Código",data:"Code"},{title:"Fec. Recepción",data:"ReceptionDate"},{title:"Observaciones",data:"Observations"}]},init:function(){a.evaluation_report.object=$("#data-table").DataTable(a.evaluation_report.options)}},init:function(){a.evaluation_report.init()}},t={onLoadFile:function(){$("#btn_load_file").on("click",(function(){var t=$(this),e=$("#input_file").prop("files");if(e.length<1)toastr.info("Debe ingresar un archivo.","Información");else{var o=new FormData;o.append("file",e[0]),mApp.block("#data-table_wrapper",{message:"Cargando actas..."}),t.addLoader(),a.evaluation_report.data=[],a.evaluation_report.object.rows().remove().draw(!1),$.ajax({url:"/admin/generacion-actas/cargar-actas-historicas/cargar-excel",contentType:!1,processData:!1,type:"POST",data:o}).done((function(t){for(var e=0;e<t.length;e++){var o={Term:t[e].term,TermId:t[e].termId,Code:t[e].code,ReceptionDate:t[e].receptionDate,Valid:t[e].valid,Observations:t[e].observations,EvaluationReportId:t[e].evaluationReportId,New:t[e].new};a.evaluation_report.data.push(o),a.evaluation_report.object.clear().rows.add(a.evaluation_report.data).draw(),a.evaluation_report.object.columns.adjust().draw()}})).fail((function(a){})).always((function(){t.removeLoader(),mApp.unblock("#data-table_wrapper")}))}}))},onProccessEvaluationReports:function(){$("#btn_proccess").on("click",(function(){var t=$(this);if(a.evaluation_report.data.length<1)swal({type:"info",title:"Información",text:"No se encontraron registros.",confirmButtonText:"Ok"});else{for(var e=a.evaluation_report.data.some((a=>0==a.Valid)),o=new FormData,n=0;n<a.evaluation_report.data.length;n++)o.append(`EvaluationReports[${n}].EvaluationReportId`,a.evaluation_report.data[n].EvaluationReportId),o.append(`EvaluationReports[${n}].Code`,a.evaluation_report.data[n].Code),o.append(`EvaluationReports[${n}].Term`,a.evaluation_report.data[n].Term),o.append(`EvaluationReports[${n}].TermId`,a.evaluation_report.data[n].TermId),o.append(`EvaluationReports[${n}].ReceptionDate`,a.evaluation_report.data[n].ReceptionDate),o.append(`EvaluationReports[${n}].Observations`,a.evaluation_report.data[n].Observations),o.append(`EvaluationReports[${n}].Valid`,a.evaluation_report.data[n].Valid),o.append(`EvaluationReports[${n}].New`,a.evaluation_report.data[n].New);e?swal({title:"¿Seguro que desea continuar?",text:"Se encontraron actas que no han sido procesadas correctamente",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, continuar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((e=>{t.addLoader(),$.ajax({url:"/admin/generacion-actas/cargar-actas-historicas",type:"POST",contentType:!1,processData:!1,data:o}).done((function(t){swal({type:"success",title:"Actas cargadas!",text:t,confirmButtonText:"Ok",allowOutsideClick:!1}),a.evaluation_report.data=[],a.evaluation_report.object.rows().remove().draw(!1)})).fail((function(a){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===a.status?"No hay respuesta del servidor":a.responseText})})).always((function(a){t.removeLoader()}))}))}):(t.addLoader(),$.ajax({url:"/admin/generacion-actas/cargar-actas-historicas",type:"POST",contentType:!1,processData:!1,data:o}).done((function(t){swal({type:"success",title:"Actas cargadas!",text:t,confirmButtonText:"Ok",allowOutsideClick:!1}),a.evaluation_report.data=[],a.evaluation_report.object.rows().remove().draw(!1)})).fail((function(a){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===a.status?"No hay respuesta del servidor":a.responseText})})).always((function(a){t.removeLoader()})))}}))},init:function(){this.onLoadFile(),this.onProccessEvaluationReports()}};return{init:function(){t.init(),a.init()}}}();$((()=>{index.init()}));