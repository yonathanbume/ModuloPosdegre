var InitApp=function(){var e={reports:{object:null,options:getSimpleDataTableConfiguration({url:"/admin/generacion-actas/get".proto().parseURL(),data:function(e){delete e.columns,e.typeSearch=$("#cbx_filters").bootstrapSwitch("state")?1:2,e.termId=$("#term_select").val(),e.academicDepartmentId=$("#department_select").val(),e.teacherId=$("#teacher_select").val(),e.teacherCode=$("#teacher_code").val(),e.careerId=$("#career_select").val(),e.curriculum=$("#curriculum_select").val(),e.courseSearch=$("#course_search").val(),e.academicYear=$("#academic_year_select").val()},pageLength:50,orderable:[],columns:[{data:"career",title:"Escuela"},{data:"course",title:"Curso"},{data:"section",title:"Sección",width:100},{data:"teachers",title:"Profesor(es)"},{data:"printQuantity",title:"Impresiones Realizadas",width:100},{data:"status",title:"Estado",width:100,render:function(e){var t={Recibido:{title:"Recibido",class:" m-badge--success"},Generado:{title:"Generado",class:" m-badge--warning"},Pendiente:{title:"Pendiente",class:" m-badge--metal"}};return'<span class="m-badge '+t[e].class+' m-badge--wide">'+t[e].title+"</span>"}},{data:null,title:"Detalle",render:function(e){return`<button data-id=${e.id} class="btn btn-primary btn-sm m-btn m-btn--icon btn-preview-details"><i class="la la-eye"></i></button> `}},{data:null,title:"Opciones",orderable:!1,width:220,render:function(e){var t="",a=`/admin/generacion-actas/acta-final/${e.id}`.proto().parseURL(),n=`/admin/generacion-actas/acta-final-detallada/${e.id}`.proto().parseURL(),r=`/admin/generacion-actas/acta-final-registro/${e.id}`.proto().parseURL();return e.hasSustituteExams&&(t='<button class="btn btn-primary btn-sm m-btn m-btn--icon btn-sustitute-exams" download><span><i class="la la-file-text-o"></i><span> Generar </span></span></button>'),e.wasGenerated?(t=`<button data-url=${a} class="btn btn-brand btn-sm m-btn m-btn--icon btn-report2" download><span><i class="la la-file-text-o"></i><span> Imprimir </span></span></button>`,t+=`<button data-url=${r} class="ml-1 btn btn-brand btn-sm m-btn m-btn--icon btn-report-registerv2" download><span><i class="la la-file-text-o"></i><span> Registro</span></span></button>`):t=e.complete?`<button data-url=${a} class="btn btn-primary btn-sm m-btn m-btn--icon btn-report" download><span><i class="la la-file-text-o"></i><span> Generar </span></span></button>`:`<button data-url=${a} class="btn btn-primary btn-sm m-btn m-btn--icon btn-report-incomplete" download><span><i class="la la-file-text-o"></i><span> Generar </span></span></button>`,e.isUNAMAD&&(t+=` <button data-url=${n} class="btn btn-brand btn-sm m-btn m-btn--icon btn-detailed-report" download><span><i class="la la-file-pdf"></i><span> Detallado </span></span></button>`),t}}]}),init:function(){this.object=$("#data-table").DataTable(this.options),$("#data-table").on("click",".btn-report",(function(){var t=$(this).data("url"),a=$(this);a.addLoader(),$.fileDownload(t,{httpMethod:"GET",successCallback:function(){a.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito"),e.reports.reload()},failCallback:function(e,t){a.removeLoader(),e=(e=e.replace('<pre style="word-wrap: break-word; white-space: pre-wrap;">',"")).replace("</pre>",""),toastr.error(e,"Error")}})})),$("#data-table").on("click",".btn-report2",(function(){var t=$(this).data("url"),a=$(this);a.addLoader(),$.fileDownload(t,{httpMethod:"GET",successCallback:function(){a.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito"),e.reports.reload()},failCallback:function(e,t){a.removeLoader(),e=(e=e.replace('<pre style="word-wrap: break-word; white-space: pre-wrap;">',"")).replace("</pre>",""),toastr.error(e,"Error")}})})),$("#data-table").on("click",".btn-report-registerv2",(function(){var t=$(this).data("url"),a=$(this);a.addLoader(),$.fileDownload(t,{httpMethod:"GET",successCallback:function(){a.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito"),e.reports.reload()},failCallback:function(e,t){a.removeLoader(),e=(e=e.replace('<pre style="word-wrap: break-word; white-space: pre-wrap;">',"")).replace("</pre>",""),toastr.error(e,"Error")}})})),$("#data-table").on("click",".btn-detailed-report",(function(){var t=$(this).data("url"),a=$(this);a.addLoader(),$.fileDownload(t,{httpMethod:"GET",successCallback:function(){a.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito"),e.reports.reload()},failCallback:function(e,t){a.removeLoader(),e=(e=e.replace('<pre style="word-wrap: break-word; white-space: pre-wrap;">',"")).replace("</pre>",""),toastr.error(e,"Error")}})})),$("#data-table").on("click",".btn-report-incomplete",(function(){var t=$(this).data("url"),a=$(this);swal({title:"Evaluaciones sin notas registradas",text:"Existen evaluaciones sin notas registradas, ¿desea generar el acta de todos modos?",type:"warning",showCancelButton:!0,confirmButtonText:"Si",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar"}).then((function(n){n.value&&(a.addLoader(),$.fileDownload(t,{httpMethod:"GET",successCallback:function(){a.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito"),e.reports.reload()},failCallback:function(e,t){a.removeLoader(),e=(e=e.replace('<pre style="word-wrap: break-word; white-space: pre-wrap;">',"")).replace("</pre>",""),toastr.error(e,"Error")}}))}))})),$("#data-table").on("click",".btn-sustitute-exams",(function(){swal({title:"Información",text:"Existen examenes sustitorios pendientes, no se puede generar el acta.",type:"warning",confirmButtonText:"Aceptar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom"})})),$("#data-table").on("click",".btn-preview-details",(function(){var e=$(this).data("id");$("#preview-datatable").html(""),$("#previewView").modal("show"),mApp.block("#preview-datatable"),$.ajax({url:`/admin/generacion-actas/obtener-vista-previa/${e}`.proto().parseURL(),type:"GET",dataType:"html",contextType:"application/json"}).done((function(e){$("#preview-datatable").html(e)})).fail((function(e){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)})).always((function(){mApp.unblock("#preview-datatable")}))})),$("#teacher_code").doneTyping((function(){e.reports.reload()})),$("#course_search").doneTyping((function(){e.reports.reload()}))},reload:function(){this.object.ajax.reload()}}},t={academicYear:{init:function(){$("#academic_year_select").select2({minimumResultsForSearch:-1,placeholder:"Seleccione un ciclo",disabled:!0}),t.academicYear.events.init()},load:function(e,t){$("#academic_year_select").empty(),t===_app.constants.guid.empty||" "===t||null==t?e===_app.constants.guid.empty||" "===e||void 0===e||null==e?$("#academic_year_select").select2({disabled:!0,placeholder:"Seleccionar..."}):$.ajax({url:`/carrera/${e}/niveles/get`.proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todas"}),$("#academic_year_select").select2({minimumResultsForSearch:-1,data:e.items,disabled:!1})})):$.ajax({url:`/planes-estudio/${t}/niveles/get`.proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todas"}),$("#academic_year_select").select2({minimumResultsForSearch:-1,data:e.items,disabled:!1})}))},events:{onChange:function(){$("#academic_year_select").on("change",(function(){e.reports.reload()}))},init:function(){this.onChange()}}},career:{events:{load:function(){$.ajax({url:"/carreras/get".proto().parseURL()}).done((function(e){$("#career_select").select2({data:e.items})}))},onChange:function(){$("#career_select").on("change",(function(){var a=$(this).val();t.curriculum.events.load(a),t.academicYear.load(a,null),e.reports.reload()}))},init:function(){this.load(),this.onChange()}},init:function(){t.career.events.init()}},curriculum:{events:{load:function(e){if($("#curriculum_select").empty(),e===_app.constants.guid.empty||" "===e||void 0===e)$("#curriculum_select").select2({disabled:!0,placeholder:"Seleccionar plan de estudio"});else{var t=$("#term_select").val();$.ajax({url:`/planes-estudio/${e}/activos/${t}/get`.proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todos"}),$("#curriculum_select").select2({data:e.items,disabled:!1})}))}},onChange:function(){$("#curriculum_select").on("change",(function(){t.academicYear.load(null,$(this).val()),e.reports.reload()}))},init:function(){this.load(),this.onChange()}},init:function(){t.curriculum.events.init()}},academicDepartments:{events:{load:function(){$.ajax({url:"/departamentos-academicos/get".proto().parseURL()}).done((function(e){$(".department-select").select2({data:e})}))},onChange:function(){$(".department-select").on("change",(function(){$(this).val()===_app.constants.guid.empty?($("#teacher_code").attr("disabled",!0),$("#teacher_select").attr("disabled",!0),t.teacher.events.clean(),$("#teacher_code").val("")):($("#teacher_code").attr("disabled",!1),$("#teacher_select").attr("disabled",!1)),e.reports.reload()}))},init:function(){this.load(),this.onChange()}},init:function(){t.academicDepartments.events.init()}},teacher:{events:{load:function(){$("#teacher_select").select2({ajax:{delay:1e3,url:"/profesores/get/v2".proto().parseURL(),data:function(e){return{q:e.term,academicDepartmentId:$("#department_select").val()}}},allowClear:!0,minimumInputLength:1,placeholder:"Seleccione docente"})},onChange:function(){$("#teacher_select").on("change",(function(){e.reports.reload(),""===$(this).val()||null===$(this).val()?($("#print_block_register").addClass("d-none"),$("#print_block").addClass("d-none")):($("#print_block_register").removeClass("d-none"),$("#print_block").removeClass("d-none"))}))},clean:function(){$("#teacher_select").val("").trigger("change")},init:function(){t.teacher.events.load(),t.teacher.events.onChange()}},init:function(){t.teacher.events.init()}},term:{events:{load:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(a){$("#term_select").select2({data:a.items}),$("#term_select").val(a.selected).trigger("change"),$("#term_select").on("change",(function(){var a=$("#career_select").val();t.curriculum.events.load(a),e.reports.reload()}))}))},init:function(){this.load()}},init:function(){this.events.init()}},init:function(){t.career.init(),t.teacher.init(),t.term.init(),t.curriculum.init(),this.academicDepartments.init(),t.academicYear.init()}},a={modal:$("#signature_modal"),imageUrl:null,hasChanged:!1,form:{object:$("#form_signature"),validate:function(){a.form.object.validate({rules:{Signature:{required:!0}},submitHandler:function(e,t){t.preventDefault(),a.form.submit(e)}})},submit:function(e){var t=new FormData($(e)[0]);a.form.object.find("button[type='submit']").addClass("m-loader m-loader--right m-loader--light").attr("disabled",!0),$.ajax({url:"/admin/generacion-actas/subir-firma",type:"POST",data:t,contentType:!1,processData:!1}).done((function(e){a.modal.modal("hide"),swal({type:"success",title:"Completado",text:"Firma actualizada satisfactoriamente.",confirmButtonText:"Aceptar"})})).fail((function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===e.status?"No hay respuesta del servidor":e.responseText})})).always((function(){a.form.object.find("button[type='submit']").removeClass("m-loader m-loader--right m-loader--light").attr("disabled",!1)}))},init:function(){this.validate()}},events:{getSignature:function(){a.modal.find("button[type='submit']").attr("disabled",!0),a.modal.find(":input").attr("disabled",!0),$.ajax({url:"/admin/generacion-actas/get-firma",type:"GET"}).done((function(e){if(null!=e){var t=`/imagenes/${e.urlSignature}`;a.imageUrl=t,a.modal.find(".custom-file-label").text("C:\\fakepath\\firma.jpg"),$("#img_signature").attr("src",t)}else a.modal.find(".custom-file-label").text(""),a.modal.find("[name='file']").val(""),$("#img_signature").attr("src","")})).always((function(){a.modal.find("button[type='submit']").attr("disabled",!1),a.modal.find(":input").attr("disabled",!1)}))},onChange:function(){a.form.object.find("[name='file']").on("change",(function(){var e=$(this),t=new FileReader,n=e[0].files[0];null!=n&&(t.readAsDataURL(n),t.onload=function(e){$("#img_signature").attr("src",e.target.result)},a.hasChanged=!0)}))},onHide:function(){a.modal.on("hide.bs.modal",(function(e){a.hasChanged&&(a.events.getSignature(),a.hasChanged=!1)}))},init:function(){this.getSignature(),this.onHide(),this.onChange()}},init:function(){a.form.init(),a.events.init()}},n={onDownloadBlock:function(){$("#print_block").on("click",(function(){var t="Solo se tomaran en cuenta las actas que posean evaluaciones registradas y no tengan ningún examen sustitorio pendiente. ¿Seguro que desea generar las actas de todos modos?";$(this).hasClass("isUNAMAD")&&(t="¿Seguro que desea generar las actas en bloque?");var a=$(this);swal({title:"Impresión del Bloque",text:t,type:"warning",showCancelButton:!0,confirmButtonText:"Si",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar"}).then((function(t){t.value&&(a.addLoader(),$.fileDownload("/admin/generacion-actas/imprimir-bloque-acta-final/v2",{httpMethod:"GET",data:{teacherId:$("#teacher_select").val(),termId:$("#term_select").val()},successCallback:function(){a.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito"),e.reports.reload()}}).fail((function(){a.removeLoader(),toastr.error("No se encontraron actas que cumplan con los requisitos indicados previamente.")})))}))})),$("#print_block_register").on("click",(function(){var t=$("#teacher_select").val(),a=$("#term_select").val();if(""!==t&&""!==a){var n=$(this),r=`/admin/generacion-actas/acta-final-registro/bloque/${a}/${t}`;swal({title:"Impresión de Registro en Bloque",text:"Solo se tomará en cuenta las actas emitidas.",type:"warning",showCancelButton:!0,confirmButtonText:"Si",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar"}).then((function(t){t.value&&(n.addLoader(),$.fileDownload(r,{httpMethod:"GET",successCallback:function(){n.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito"),e.reports.reload()}}).fail((function(){n.removeLoader(),toastr.error("No se encontraron actas que cumplan con los requisitos indicados previamente.")})))}))}else toastr.info("Es necesario seleccionar un docente.")}))},onChangeFilters:function(){$("#cbx_filters").is(":checked")?$(".bootstrap-switch-label").text("Por Curso"):$(".bootstrap-switch-label").text("Por Docente"),$("#cbx_filters").on("switchChange.bootstrapSwitch",(function(){$(this).bootstrapSwitch("state")?($(".bootstrap-switch-label").text("Por Curso"),$("#div_by_teacher").removeClass("d-none"),$("#div_by_course").addClass("d-none")):($(".bootstrap-switch-label").text("Por Docente"),$("#div_by_teacher").addClass("d-none"),$("#div_by_course").removeClass("d-none")),e.reports.reload()}))},init:function(){n.onChangeFilters(),n.onDownloadBlock()}};return{init:function(){t.init(),a.init(),e.reports.init(),n.init()}}}();$((function(){InitApp.init()}));