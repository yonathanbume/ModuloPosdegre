var report=function(){var e={evaluationreports:{object:null,options:{ajax:{url:"/admin/generacion-actas/buscador/datatable/no-emitidas",data:function(e){delete e.columns,e.termId=$("#term_select").val(),e.careerId=$("#career_select").val(),e.curriculumId=$("#curriculum_select").val()}},columns:[{title:"Código",data:"courseCode",orderable:!1},{title:"Curso",data:"courseName",orderable:!1},{title:"Sección",data:"section",orderable:!1},{title:"Profesor(es)",data:"teachers",orderable:!1},{title:"Periodo académico",data:"academicYear",orderable:!1},{title:"Opciones",data:null,orderable:!1,render:function(e){var a="";return a+=`<button data-id=${e.id} class="btn btn-primary btn-sm m-btn m-btn--icon btn-preview-details"><i class="la la-eye"></i></button> `,a+=`<button data-id='${e.id}' class="btn btn-primary btn-sm m-btn m-btn--icon btn-assign"><span><i class="la la-edit"></i><span>Asignar</span></span></button>`}}],rowGroup:{dataSrc:"academicYear"},columnDefs:[{visible:!1,targets:0}]},reload:function(){null===e.evaluationreports.object?e.evaluationreports.object=$("#data-table").DataTable(e.evaluationreports.options):e.evaluationreports.object.ajax.reload()},events:function(){$("#data-table").on("click",".btn-assign",(function(){var e=$(this).data("id");n.assignCode.show(e)})),$("#data-table").on("click",".btn-preview-details",(function(){var e=$(this).data("id");$("#preview-datatable").html(""),$("#previewView").modal("show"),mApp.block("#preview-datatable"),$.ajax({url:`/admin/generacion-actas/obtener-vista-previa/${e}`.proto().parseURL(),type:"GET",dataType:"html",contextType:"application/json"}).done((function(e){$("#preview-datatable").html(e)})).fail((function(e){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)})).always((function(){mApp.unblock("#preview-datatable")}))}))},init:function(){e.evaluationreports.events()}},init:function(){e.evaluationreports.init()}},a={terms:{init:function(){a.terms.load()},load:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(a){$("#term_select").select2({data:a.items}),e.evaluationreports.object=$("#data-table").DataTable(e.evaluationreports.options),$("#term_select").on("change",(function(){e.evaluationreports.reload()}))}))}},careers:{init:function(){a.careers.load(),a.careers.events()},load:function(){$.ajax({url:"/carreras/v2/get".proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todas"}),$("#career_select").select2({placeholder:"Seleccionra escuela",data:e.items})}))},events:function(){$("#career_select").on("change",(function(t,n){a.curriculums.load(),e.evaluationreports.reload()}))}},curriculums:{init:function(){$("#curriculum_select").select2(),a.curriculums.events()},load:function(){$("#curriculum_select").prop("disabled",!1),$("#curriculum_select").html("<option value='0' disabled selected>Seleccione un Plan</option>"),$.ajax({url:`/carreras/${$("#career_select").val()}/planestudio/get`.proto().parseURL()}).done((function(e){$("#curriculum_select").select2({data:e.items})}))},events:function(){$("#curriculum_select").on("change",(function(a,t){e.evaluationreports.reload()}))}},init:function(){a.terms.init(),a.careers.init(),a.curriculums.init()}},t={onValidateCode:function(){$(".validate_evaluationrepot").on("click",(function(){var e=$(this),a=$("[name='EvaluationReportCode']").val(),t=$("[name='SectionId']").val();null!=a&&""!=a?(e.addLoader(),$.ajax({url:`/admin/generacion-actas/validar-codigo-acta-seccion?code=${a}&sectionId=${t}`,type:"GET"}).done((function(e){$("[name='EvaluationReportId']").val(e.id),n.assignCode.object.find("[name='ReceptionDate']").attr("disabled",!1),n.assignCode.object.find("[name='ReceptionDate']").datepicker("destroy"),$("[name='ReceptionDate']").val(e.receptionDate).trigger("change"),n.assignCode.object.find("[name='ReceptionDate']").datepicker()})).fail((function(e){toastr.error(e.responseText,"Error"),n.assignCode.object.find("[name='ReceptionDate']").attr("disabled",!0),n.assignCode.object.find("[name='ReceptionDate']").val(""),n.assignCode.object.find("[name='EvaluationReportId']").val("")})).always((function(a){e.removeLoader()}))):toastr.info("Es necesario ingresar el código de acta","Información")}))},init:function(){this.onValidateCode()}},n={assignCode:{object:$("#modal_assign_code"),form:{object:$("#generate_evaluation_report").validate({submitHandler:function(){var a=$("#submit_evaluation_assign"),t=n.assignCode.object.find("[name='SectionId']").val(),o=n.assignCode.object.find("[name='EvaluationReportId']").val(),i=n.assignCode.object.find("[name='ReceptionDate']").val();if(""!=o&&null!=o&&null!=o){var r=`/admin/generacion-actas/asignar-acta-codigo-seccion?evaluationReportId=${o}&sectionId=${t}&receptionDate=${i}`;a.addLoader(),$.ajax({url:r,type:"POST"}).done((function(a){toastr.success("Acta asignada con éxito","Error"),e.evaluationreports.reload(),n.assignCode.object.modal("hide")})).fail((function(e){toastr.error(e.responseText,"Error al asignar el acta")})).always((function(){a.removeLoader()}))}else toastr.error("Es necesario validar el acta.","Error")}})},show:function(e){n.assignCode.object.find("[name='SectionId']").val(e),this.object.modal("show")},onHidden:function(){n.assignCode.object.on("hidden.bs.modal",(function(e){n.assignCode.object.find("[name='SectionId']").val(""),n.assignCode.object.find("[name='EvaluationReportId']").val(""),n.assignCode.object.find("[name='EvaluationReportCode']").val(""),n.assignCode.object.find("[name='ReceptionDate']").val(""),n.assignCode.object.find("[name='ReceptionDate']").attr("disabled",!0)}))},init:function(){this.onHidden()}},init:function(){this.assignCode.init()}},o=function(){n.assignCode.object.find("[name='IssueDate']").datepicker(),n.assignCode.object.find("[name='ReceptionDate']").datepicker()};return{init:function(){a.init(),e.init(),o(),n.init(),t.init()}}}();$((()=>{report.init()}));