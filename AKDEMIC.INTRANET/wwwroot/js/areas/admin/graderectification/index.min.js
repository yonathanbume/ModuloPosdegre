var InitApp=function(){var e={requests:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:"/admin/correccion-rectificacion-notas/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(e){delete e.columns,e.searchValue=$("#search").val()}},pageLength:50,orderable:[],columns:[{data:"term",title:"Periodo"},{data:"teacher",title:"Docente"},{data:"course",title:"Curso"},{data:"code",title:"Código"},{data:"student",title:"Estudiante"},{data:"evaluation",title:"Evaluación"},{data:null,title:"Nota Ant.",render:function(e,t,a){return a.gradePrevious}},{data:null,title:"Nota Nue.",render:function(e,t,a){return 0!=e.gradeNew?e.gradeNew:"--"}},{data:"state",title:"Estado"}]},init:function(){this.object=$("#ajax_data").DataTable(this.options)},reload:function(){this.object.ajax.reload()}}},t={create:{submit:function(t){var a=$(t).serialize();$("#create-form").find(".btn-submit").addLoader(),$("#create-form").attr("disabled",!0),$.ajax({contentType:!1,processData:!1,data:a,type:"POST",url:"/admin/correccion-rectificacion-notas/crear/post".proto().parseURL()}).always((function(){$("#create-form").find(".btn-submit").removeLoader(),$("#create-form select").attr("disabled",!1)})).done((function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),$("#request_modal").modal("hide"),e.requests.reload()})).fail((function(e){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=e.responseText?$("#createAlertText").html(e.responseText):$("#createAlertText").html(_app.constants.ajax.message.error),$("#createAlert").removeClass("m--hide").show()}))}}},a=function(){$("#request_modal").on("hidden.bs.modal",(function(){t.reset.tutors()})),$(".type1").hide(),$(".type").hide(),$(".select2-evaluation").prop("required",!0),$("input[type=radio][name=Type]").change((function(){"1"==this.value?($("#SectionId").empty(),n.course.init(this.value),$(".type").show(),$(".type1").show(),$(".select2-evaluation").prop("required",!0)):"2"==this.value&&($("#SectionId").empty(),n.course.init(this.value),$(".type1").hide(),$(".type").show(),$(".select2-evaluation").prop("required",!1))}))},n={init:function(){this.term.init()},term:{init:function(){$.ajax({url:"/periodos-pasados/get".proto().parseURL()}).done((function(e){$("#TermId").select2({data:e.items}),$("#TermId").on("change",(function(){null!==$("#TermId").val()&&($(".select2-teachers").empty(),$("#SectionId").empty(),$("#EvaluationId").empty(),$("input[type=radio][name=Type]").prop("checked",!1),$(".type1").hide(),$(".type").hide(),$(".select2-evaluation").prop("required",!0),n.teacher.init())})),$("#TermId").trigger("change")})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}},teacher:{init:function(){n.teacher.load(),n.teacher.onChange()},load:function(){$(".select2-teachers").select2({ajax:{data:function(e){return console.log(e),{q:e.term||e.q||"",query:e.q||e.term||"",type:e._type,page:e.page||1}},delay:300,type:"GET",url:`/periodo/${$("#TermId").val()}/profesor/get`.proto().parseURL()},placeholder:"Seleccione Docente",allowClear:!0,minimumInputLength:3,dropdownParent:$(".select2-teachers").closest(".modal-body")})},onChange:function(){$(".select2-teachers").on("change",(function(){null!==$(".select2-teachers").val()&&($("#SectionId").empty(),$("input[type=radio][name=Type]").prop("checked",!1),$(".type1").hide(),$(".type").hide(),$(".select2-evaluation").prop("required",!0))})),$(".select2-teachers").trigger("change")},clean:function(){$(".select2-teachers").val("").trigger("change")}},course:{init:function(e){$.ajax({url:`/cursos/docente/${$("#TeacherId").val()}/periodo/${$("#TermId").val()}/tipo/${e}/get`.proto().parseURL()}).done((function(t){$("#SectionId").select2({data:t,placeholder:"Seleccione Curso",dropdownParent:$("#SectionId").closest(".modal-body")}),$("#SectionId").on("change",(function(){null!==$("#SectionId").val()&&($("#EvaluationId").empty(),1==e?n.evaluation.init():n.studentEvaluation.init())})),$("#SectionId").trigger("change")})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}},evaluation:{init:function(){$.ajax({url:`/cursos/${$("#SectionId").val()}/periodo/${$("#TermId").val()}/evaluacion/get`.proto().parseURL()}).done((function(e){$("#EvaluationId").select2({data:e,placeholder:"Seleccione Evaluación",dropdownParent:$("#EvaluationId").closest(".modal-body")}),$("#EvaluationId").on("change",(function(){null!==$("#EvaluationId").val()&&($("#StudentIds").empty(),n.studentEvaluation.init())})),$("#EvaluationId").trigger("change")})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}},studentEvaluation:{init:function(){n.studentEvaluation.load(),n.studentEvaluation.onChange()},load:function(){$("#StudentIds").select2({ajax:{data:function(e){return console.log(e),{q:e.term||e.q||"",query:e.q||e.term||"",type:e._type,page:e.page||1}},delay:300,type:"GET",url:`/alumnos/seccion/${$("#SectionId").val()}/evaluacion/${$("#EvaluationId").val()}/get`.proto().parseURL()},placeholder:"Seleccione Alumno",allowClear:!0,dropdownParent:$("#StudentIds").closest(".modal-body")})},onChange:function(){$("#StudentIds").on("change",(function(){$("#StudentIds").val()})),$("#StudentIds").trigger("change")},clean:function(){$("#StudentIds").val("").trigger("change")}}},o=function(){$("#create-form").validate({submitHandler:function(e,a){a.preventDefault(),t.create.submit(e)}})},r=function(){$("#search").doneTyping((function(){e.requests.reload()}))};return{init:function(){n.init(),a(),r(),o(),e.requests.init()},reloadTable:function(){e.requests.reload()}}}();$((function(){InitApp.init()}));