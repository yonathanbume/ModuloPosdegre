var UserAssistance=function(){var e,t=null,a=XLSX,r="xlsx",n="./xlsxworker.js",o=[],i={destroy:function(){t.destroy(),t=null,$("#m-users-datatable").hide()},init:function(e){null!==t&&this.destroy(),t=$("#m-users-datatable").DataTable({serverSide:!1,paging:!1,ordering:!1,info:!1,filter:!0,data:e,columns:[{title:"Usuario",data:"UserName"},{title:"Rol",data:"Role"},{title:"Fecha",data:"Date",render:function(e,t,a){return new Date(e).toLocaleDateString()}},{title:"Entrada (Turno Mañana)",data:"FirstEntryTime",render:function(e,t,a){return new Date(e).toLocaleString()}},{title:"Salida (Turno Mañana)",data:"FirstExitTime",render:function(e,t,a){return new Date(e).toLocaleString()}},{title:"Marcado de Entrada (Turno Mañana)",data:"FirstEntry",render:function(e,t,a){return e?new Date(e).toLocaleString():""}},{title:"Marcado de Salida (Turno Mañana)",data:"FirstExit",render:function(e,t,a){return e?new Date(e).toLocaleString():""}},{title:"Entrada (Turno Tarde)",data:"SecondEntryTime",render:function(e,t,a){return new Date(e).toLocaleString()}},{title:"Salida (Turno Tarde)",data:"SecondExitTime",render:function(e,t,a){return new Date(e).toLocaleString()}},{title:"Marcado de Entrada (Turno Tarde)",data:"SecondEntry",render:function(e,t,a){return e?new Date(e).toLocaleString():""}},{title:"Marcado de Salida (Turno Tarde)",data:"SecondExit",render:function(e,t,a){return e?new Date(e).toLocaleString():""}}]}),$("#m-users-datatable").show()}},s=function(){document.getElementById("m-users-datatable");return function(e){e;var t,r;r={},(t=e).SheetNames.forEach((function(e){var n=a.utils.sheet_to_json(t.Sheets[e],{header:1});n.length&&(r[e]=n)})),(o=function(e){var t=[];for(var a in e)if(e.hasOwnProperty(a)){for(var r in e[a])if("0"!==r&&""!==e[a][r][0]){var n={UserName:e[a][r][0],Role:e[a][r][2],Date:e[a][r][3],FirstEntryTime:e[a][r][4],FirstExitTime:e[a][r][5],FirstEntry:e[a][r][6],FirstExit:e[a][r][7],SecondEntryTime:e[a][r][8],SecondExitTime:e[a][r][9],SecondEntry:e[a][r][10],SecondExit:e[a][r][11]};t.push(n)}break}return t}(r)).length>0?(l.change.toSubmit(),i.init(o)):toastr.error("El archivo se encuentra vacío.",_app.constants.toastr.title.error),mApp.unblock(".m-portlet")}}(),d=function(){var e="undefined"!=typeof FileReader&&(FileReader.prototype||{}).readAsBinaryString;domrabs=!0;var t="undefined"!=typeof Worker;domwork=!1;return function(o){e=domrabs,t=domwork;var i=new FileReader;i.onload=function(o){var i=o.target.result;e||(i=new Uint8Array(i)),t?function(t,a){var o=new Worker(n);o.onmessage=function(e){switch(e.data.t){case"ready":break;case"e":console.error(e.data.d);break;case r:a(JSON.parse(e.data.d))}},o.postMessage({d:t,b:e?"binary":"array"})}(i,s):s(a.read(i,{type:e?"binary":"array"}))},e?i.readAsBinaryString(o):i.readAsArrayBuffer(o)}}(),c=function(){$("#input-file").on("change",(function(e){var t=(e.target||window.event.srcElement).files;if(t[0]){if(t[0].size>15728640)return swal("Archivo demasiado grande","Por favor, asegúrese de que el peso de su archivo no exceda los 15MB.","error"),void l.change.toUpload();mApp.block(".m-portlet",{type:"loader",message:"Cargando..."}),$(".custom-file-label").text(t[0].name),d(t[0])}else l.change.toUpload()})),$(".btn-template").on("click",(function(){var e=$(this);return e.addLoader(),$.fileDownload("/admin/asistencia-personal/plantilla/get".proto().parseURL()).always((function(){e.removeLoader()})).done((function(){toastr.success("Archivo descargado satisfactoriamente","Éxito")})).fail((function(){toastr.error("No se pudo descargar el archivo","Error")})),!1})),$("#btnCancel").on("click",(function(){l.change.toUpload()}))},l={submit:function(t){$("#user-assistance input").attr("disabled",!0),$("#btnSave").addLoader(),$.ajax({data:{model:o},type:"POST",url:$(t).attr("action")}).always((function(){$("#user-assistance input").attr("disabled",!1),$("#btnSave").removeLoader(),l.change.toUpload()})).done((function(t){e.resetForm(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)})).fail((function(e){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=e.responseText?$("#alert-text").html(e.responseText):$("#alert-text").html(_app.constants.toastr.message.error.task),$("#m-form_alert").removeClass("m--hide").show()}))},change:{toSubmit:function(){$("#btnSave").prop("disabled",!1),$("#btnCancel").prop("disabled",!1).show()},toUpload:function(){$("#btnSave").prop("disabled",!0),$("#btnCancel").prop("disabled",!0).hide(),$(".custom-file-label").text("Escoja un archivo"),e.resetForm(),null!==t&&i.destroy()}}},u=function(){e=$("#user-assistance").validate({submitHandler:function(e){0!==o.length?l.submit(e):swal("Ningún Archivo Subido","Por favor, asegúrese de subir un archivo Excel con la asistencia del Personal.","error")}})};return{init:function(){$("#m-users-datatable").hide(),u(),c()}}}();$((function(){UserAssistance.init()}));