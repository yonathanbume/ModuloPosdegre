var InitApp=function(){var e=$("#TeacherId").val(),t=$("#TermId").val(),a={assistance:{object:null,options:{serverSide:!1,ajax:{url:"/admin/reporte-docentes/detalle/asistencia/get".proto().parseURL(),type:"GET",data:function(e){e.sectionId=$("#section_select2").val()}},columns:[{data:"student",title:"Estudiante"},{data:"absences",title:"Faltas"},{data:"assisted",title:"Asistidas"},{data:"dictated",title:"Dictadas"}],dom:"Bfrtip",buttons:[{text:"Excel",action:function(e,t,a,n){window.location.href=`/admin/reporte-docentes/seccion/${$("#section_select2").val()}/control-asistencia-excel`.proto().parseURL()}},{text:"Pdf",action:function(e,t,a,n){window.location.href=`/admin/reporte-docentes/detalle/${$("#section_select2").val()}/asistencia/pdf?teacherId=${$("#TeacherId").val()}`.proto().parseURL()}}]},reload:function(){null!==$("#section_select2").val()&&(null===this.object?a.assistance.object=$("#assistance-table").DataTable(this.options):a.assistance.object.ajax.reload())}},grade:{reload:function(){$("#grades_partial").html(""),mApp.block("#grades_partial",{message:"Cargando datos..."}),$.ajax({url:`/admin/reporte-docentes/detalle/notas/get?sectionId=${$("#section_select2").val()}`,type:"GET",dataType:"HTML"}).done((function(e){$("#grades_partial").html(e)}))}}},n={course:{load:function(){$.ajax({url:`/cursos/docente/${e}?termId=${t}`,type:"GET"}).done((function(e){$("#course_select2").select2({placeholder:"Seleccionar cursos",data:e}).trigger("change")}))},events:{onChange:function(){$("#course_select2").on("change",(function(){var e=$(this).val();n.sections.load(e)}))},init:function(){this.onChange()}},init:function(){this.events.init(),this.load()}},sections:{load:function(a){$("#section_select2").empty(),$.ajax({url:`/secciones-por-curso/${a}/docente/${e}?termId=${t}`,type:"GET"}).done((function(e){$("#section_select2").select2({placeholder:"Seleccionar secciones",data:e}).trigger("change")}))},events:{onChange:function(){$("#section_select2").on("change",(function(){var e=$(this).val();null!==e&&""!==e&&(a.assistance.reload(),a.grade.reload(),n.dictatedClasses.load())}))},init:function(){this.onChange()}},init:function(){this.events.init(),this.load()}},dictatedClasses:{load:function(){var e=$("#section_select2").val(),t=i.cleanClasses.object.find("[name='StartDate']").val(),a=i.cleanClasses.object.find("[name='EndDate']").val();i.cleanClasses.object.find("[name='ClassesId']").empty(),$.ajax({url:"/admin/reporte-docentes/get-clases-dictadas",data:{sectionId:e,startDate:t,endDate:a}}).done((function(e){i.cleanClasses.object.find("[name='ClassesId']").select2({data:e,dropdownParent:i.cleanClasses.object,placeholder:"Seleccionar clases a eliminar"}).val(null).trigger("change")}))},init:function(){this.load()}},init:function(){n.course.init(),n.sections.init()}},s={object:null,defaultSettings:{allDaySlot:!1,aspectRatio:2,businessHours:{dow:[1,2,3,4,5,6],end:"24:00",start:"07:00"},columnFormat:"dddd",contentHeight:600,defaultView:"agendaWeek",editable:!1,eventRender:function(e,t){t.hasClass("fc-day-grid-event")?(t.data("content",e.description),t.data("placement","top"),mApp.initPopover(t)):t.hasClass("fc-time-grid-event")?t.find(".fc-title").append('<div class="fc-description">'+e.description+"</div>"):0!==t.find(".fc-list-item-title").length&&t.find(".fc-list-item-title").append('<div class="fc-description">'+e.description+"</div>");var a=t.find(".fc-title").clone().children().remove().end().text();t.css("border-color","#"+a.proto().toRGB()).css("border-width","2px")},events:{className:"m-fc-event--primary",error:function(){toastr.error("Ocurrió un problema con el servidor","Error")},url:`/admin/carga-lectiva/get-horario/${$("#TeacherId").val()}`},eventAfterAllRender:function(){mApp.unblock(".m-calendar__container")},firstDay:1,header:{left:"prev,next today",center:"title"},height:600,locale:"es",maxTime:"24:00:00",minTime:"06:00:00",monthNames:monthNames,dayNames:dayNames,monthNamesShort:monthNamesShort,dayNamesShort:dayNamesShort,buttonText:{today:"hoy",month:"mes",week:"semana",day:"día"},slotDuration:"00:30:00",timeFormat:"h(:mm)A"},load:function(){mApp.block("#schedule",{message:"Cargando horario..."}),s.object=$("#schedule").fullCalendar(s.defaultSettings)}},o={firstTime:!0,onShowCalendarModal:function(){$("#show_schedule").click((function(){$("#modal_calendar").modal("show")})),$("#modal_calendar").on("shown.bs.modal",(function(e){o.firstTime&&(o.firstTime=!1,s.load())}))},cleanGrades:function(){$("#clean_grades").on("click",(function(){var e=$("#section_select2").val(),t=$("#course_select2").select2("data")[0].text,n=$("#section_select2").text();swal({type:"warning",text:`¿Seguro que desea eliminar las asistencias del curso ${t} - ${n}? Esta acción no es recuperable.`,title:"Eliminar asistencias",confirmButtonText:"Aceptar",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({type:"POST",url:`/admin/reporte-docentes/detalle/${e}/limpiar-asistencias`}).done((function(e){a.assistance.reload(),swal({type:"success",title:"Completado",text:e,confirmButtonText:"Aceptar"})})).fail((function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===e.status?"No hay respuesta del servidor":e.responseText})}))}))})}))},init:function(){this.onShowCalendarModal(),this.cleanGrades()}},i={cleanClasses:{object:$("#modal_clean_classes"),form:{object:$("#form_clean_classes").validate({submitHandler:function(e,t){t.preventDefault();var s=$("#section_select2").val(),o=$("#course_select2").select2("data")[0].text,c=$("#section_select2").text(),l=new FormData(e);l.append("SectionId",s),swal({type:"warning",text:`¿Seguro que desea eliminar las asistencias del curso ${o} - ${c}? Esta acción no es recuperable.`,title:"Eliminar asistencias",confirmButtonText:"Aceptar",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({type:"POST",url:`/admin/reporte-docentes/detalle/${s}/borrar-asistencias-seleccionadas`,data:l,contentType:!1,processData:!1}).done((function(e){a.assistance.reload(),n.dictatedClasses.load(),i.cleanClasses.object.modal("hide"),swal({type:"success",title:"Completado",text:e,confirmButtonText:"Aceptar"})})).fail((function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===e.status?"No hay respuesta del servidor":e.responseText})}))}))})}})},show:function(){$("#clean_classes").on("click",(function(){i.cleanClasses.object.modal("show")}))},onHidden:function(){i.cleanClasses.object.on("hidden.bs.modal",(function(e){i.cleanClasses.form.object.resetForm(),i.cleanClasses.object.find("[name='ClassesId']").val(null).trigger("change"),n.dictatedClasses.load()}))},init:function(){this.onHidden(),this.show()}},init:function(){i.cleanClasses.init()}},c=function(){i.cleanClasses.object.find("[name='StartDate']").datepicker(),i.cleanClasses.object.find("[name='EndDate']").datepicker(),i.cleanClasses.object.find("[name='StartDate']").on("change",(function(){n.dictatedClasses.load()})),i.cleanClasses.object.find("[name='EndDate']").on("change",(function(){n.dictatedClasses.load()}))};return{init:function(){n.init(),o.init(),i.init(),c()}}}();$((function(){InitApp.init()}));