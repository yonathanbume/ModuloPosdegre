var announcement={datatable:{list:{},load:{get:function(){announcement.datatable.list.ajax_data=$("#ajax_data").mDatatable({data:{source:{read:{method:"GET",url:"/admin/anuncios/get".proto().parseURL()}}},columns:[{field:"title",title:"Título",width:350},{field:"startdate",title:"Fecha inicio",width:200},{field:"enddate",title:"Fecha fin",width:200},{field:"options",title:"Opciones",width:400,sortable:!1,filterable:!1,template:function(t){var a="";return a+=' <a class="btn btn-primary btn-sm m-btn m-btn--icon" href=',a+=`/admin/anuncios/editar/get/${t.id}`.proto().parseURL(),a+='><span><i class="la la-edit"></i><span>Editar</span></span></a>',a+=` <button data-id ="${t.id}" class="delete btn btn-danger btn-sm m-btn m-btn--icon "   > <span><i class="la la-trash"></i><span>Eliminar</span></span></button> `}}]})},addform:function(){window.location.href="/admin/anuncios/agregar/get".proto().parseURL()},add:function(){$("#add-form").validate({rules:{Title:{required:!0},Description:{required:!0},StartDate:{required:!0},EndDate:{required:!0}},submitHandler:function(t,a){var e=new FormData($(t).get(0));a.preventDefault(),$("#btnSave").addLoader(),$.ajax({type:"POST",url:"/admin/anuncios/crear/post".proto().parseURL(),data:e,contentType:!1,processData:!1,success:function(){window.location.href="/admin/anuncios".proto().parseURL()},complete:function(){$("#btnSave").removeLoader()}})}})},delete:function(){$("#ajax_data").on("click",".delete",(function(t){t.preventDefault();var a=$(this).data("id");swal({title:"¿Está seguro?",text:"El anuncio será eliminado permanentemente",type:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar"}).then((function(t){t.value&&$.ajax({url:`/admin/anuncios/eliminar/post/${a}`.proto().parseURL(),type:"POST",success:function(){announcement.datatable.list.ajax_data.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error("El anuncio tiene información relacionada",_app.constants.toastr.title.error)}})}))}))},edit:function(){$("#edit-form").validate({rules:{Title:{required:!0},Description:{required:!0},StartDate:{required:!0},EndDate:{required:!0}},submitHandler:function(t,a){var e=new FormData($(t).get(0)),n=$("#Id").val();a.preventDefault(),$("#btnSave").addLoader(),$.ajax({type:"POST",url:`/admin/anuncios/editar/post/${n}`.proto().parseURL(),data:e,contentType:!1,processData:!1,success:function(){window.location.href="/admin/anuncios".proto().parseURL()},error:function(){toastr.error(_app.constants.toastr.message.error.create,_app.constants.toastr.title.error)},complete:function(){$("#btnSave").removeLoader()}})}})},picture:function(){$("#Picture").on("change",(function(t){var a=(t.target||window.event.srcElement).files;if(console.log(a[0]),FileReader&&a&&a.length){var e=new FileReader;e.onload=function(){$("#current-picture").attr("src",e.result)},e.readAsDataURL(a[0])}else console.log("File Reader not supported.")}))},roles:{init:function(){$.ajax({url:"/roles_todos/get".proto().parseURL()}).done((function(t){$(".select2-roles").select2({placeholder:"Roles",minimumInputLength:0,data:t.items})}))}},startEndDate:{init:function(){$("#StartDate").datepicker({format:_app.constants.formats.datepicker}).one("changeDate",(function(t){$(this).valid(),$("#EndDate").datepicker("setStartDate",t.date)})),$("#EndDate").datepicker({format:_app.constants.formats.datepicker}).one("changeDate",(function(t){$("#StartDate").datepicker("setEndDate",t.date)}))}}}}};$((function(){announcement.datatable.load.get(),announcement.datatable.load.add(),announcement.datatable.load.edit(),announcement.datatable.load.delete(),announcement.datatable.load.picture(),announcement.datatable.load.roles.init(),announcement.datatable.load.startEndDate.init()}));