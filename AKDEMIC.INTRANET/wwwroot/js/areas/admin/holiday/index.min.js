let Datatable=function(){let t,e="#datatable",a={ajax:{data:function(t,e){t.searchValue=$("#search").val()},url:"/admin/feriados/listar".proto().parseURL()},columns:[{data:"name",title:"Nombre"},{data:"date",title:"Fecha"},{data:null,title:"Tipo",render:function(t,e,a){return 0===a.type?"Nacional":"Universitario"}},{data:"options",title:"Opciones",className:"text-center",orderable:!1,render:function(t,e,a){let n="";return n+="<button data-id='"+a.id+"' class='btn btn-info btn-sm m-btn m-btn--icon btn-edit' data-toggle='modal' data-target='#edit-modal'><span><i class='la la-edit'></i>Editar</span></button> ",n+="<button data-id='"+a.id+"' class='btn btn-danger btn-sm m-btn--icon btn-delete'><i class='la la-trash'></i></button>",n}}]},n=function(){$(e).on("click",".btn-edit",(function(){let t=$(this).data("id");Form.Edit.show(t)})),$(e).on("click",".btn-delete",(function(){let e=$(this).data("id");swal({title:"¿Está seguro?",text:"El feriado será eliminado",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({url:"/admin/feriados/eliminar".proto().parseURL(),type:"POST",data:{id:e},success:function(e){t.ajax.reload(),swal({type:"success",title:"Completado",text:e,confirmButtonText:"Excelente"})},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:502===t.status?"No hay respuesta del servidor":t.responseText})}})}))})}))},r=function(){$.when($.ajax({url:"/tipos-feriado".proto().parseURL()})).then((function(t){$("#Add_Type").select2({placeholder:"Seleccione tipo feriado",minimumResultsForSearch:-1,allowClear:!0,data:t.items,dropdownParent:$("#add-form")}),$("#Add_Type").val("").trigger("change"),$("#Edit_Type").select2({placeholder:"Seleccione tipo feriado",minimumResultsForSearch:-1,allowClear:!0,data:t.items,dropdownParent:$("#edit-form")}),$("#Edit_Type").val("").trigger("change")}))};var o=function(){$(".datepicker-input").datepicker({clearBtn:!0,orientation:"bottom",format:_app.constants.formats.datepicker})};return{init:function(){$("#search").doneTyping((function(){t.ajax.reload()})),t=$(e).DataTable(a),n(),r(),o()},reload:function(){t.ajax.reload()}}}(),Form=function(){let t,e,a="#add-modal",n="#edit-modal",r=function(){$(a).on("hidden.bs.modal",(function(){o.reset.create()}))},o={submit:{create:function(t){let e=new FormData($(t)[0]);$(`${a} input, ${a} select, ${a} textarea`).attr("disabled",!0),$("#btnCreate").addLoader(),$.ajax({url:$(t).attr("action"),type:"POST",data:e,contentType:!1,processData:!1}).always((function(){$(`${a} input, ${a} select, ${a} textarea`).attr("disabled",!1),$("#btnCreate").removeLoader()})).done((function(){$(a).modal("hide"),swal({type:"success",title:"Completado",text:"El feriado se creó correctamente",confirmButtonText:"Excelente"}),Datatable.reload()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!==t.responseText?$("#add_form_msg_txt").html(t.responseText):$("#add_form_msg_txt").html(_app.constants.ajax.message.error),$("#add_form_msg").removeClass("m--hide").show()}))},edit:function(t){let e=new FormData($(t)[0]);$("#btnEdit").addLoader(),$.ajax({url:$(t).attr("action"),type:"POST",data:e,contentType:!1,processData:!1}).always((function(){$("#btnEdit").removeLoader()})).done((function(){$(n).modal("hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),Datatable.reload()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!==t.responseText?$("#edit_form_msg_txt").html(t.responseText):$("#edit_form_msg_txt").html(_app.constants.ajax.message.error),$("#edit_form_msg").removeClass("m--hide").show()}))}},reset:{create:function(){$("#add_form_msg").addClass("m--hide").hide(),$("#Add_Type").val("").trigger("change"),$(".datepicker-input").datepicker("update",""),t.resetForm()},edit:function(){$("#edit_form_msg").addClass("m--hide").hide(),$("#Edit_Type").val("").trigger("change"),$(".datepicker-input").datepicker("update",""),e.reset()}},show:{edit:function(t){mApp.blockPage(),$.ajax({url:`/admin/feriados/${t}`.proto().parseURL()}).done((function(t){let e=$("#edit-form").get(0).elements;console.log(t),e.Edit_Id.value=t.id,e.Edit_Name.value=t.name,e.Edit_Date.value=t.date,$(e.Edit_Date).attr("disabled",!0),$(e.Edit_Type).attr("disabled",!0),$(e.Edit_NeedReschedule).prop("checked",t.needReschedule),$(e.Edit_NeedReschedule).attr("disabled",!0),$("#Edit_Type").val(t.type).trigger("change"),mApp.unblockPage(),$(n).on("hidden.bs.modal",(function(){o.reset.edit()}))})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}}},i={Add_Name:{required:!0,maxlength:100},Edit_Name:{required:!0,maxlength:100},Add_Type:{required:!0},Edit_Type:{required:!0},Add_Date:{required:!0},Edit_Date:{required:!0}},d=function(){t=$("#add-form").validate({rules:i,submitHandler:function(t,e){e.preventDefault(),o.submit.create(t)}}),e=$("#edit-form").validate({rules:i,submitHandler:function(t,e){e.preventDefault(),o.submit.edit(t)}})};return{init:function(){r(),d()},Edit:{show:function(t){o.show.edit(t)}}}}();$((function(){Datatable.init(),Form.init()}));