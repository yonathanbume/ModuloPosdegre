var ActivitiesTable=function(){var t,e={search:{input:$("#search")},data:{source:{read:{method:"GET",url:"/admin/actividades-extracurriculares/get".proto().parseURL()}}},columns:[{field:"code",title:"Código"},{field:"name",title:"Nombre"},{field:"credits",title:"Créditos"},{field:"options",title:"Opciones",textAlign:"center",width:125,sortable:!1,filterable:!1,template:function(t){var e="";return e+="<button data-id='"+t.id+"' class='btn btn-info btn-sm m-btn m-btn--icon btn-edit' data-toggle='modal' data-target='#edit_activity_modal'><span><i class='la la-edit'></i><span>Editar</span></span></button> ",e+="<button data-id='"+t.id+"' class='btn btn-danger btn-sm m-btn--icon btn-delete'><i class='la la-trash'></i></button>"}}]},a=function(){$(".btn-delete").on("click",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",text:"La actividad extracurricular será eliminada",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarla",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({url:"/admin/actividades-extracurriculares/eliminar".proto().parseURL(),type:"POST",data:{id:e},success:function(){t.reload(),swal({type:"success",title:"Completado",text:"La actividad extracurricular ha sido eliminada con éxito",confirmButtonText:"Excelente"})},error:function(){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"La actividad extracurricular tiene información relacionada"})}})}))})})),$(".btn-edit").on("click",(function(){var t=$(this).data("id");Form.Edit.show(t)}))};return{init:function(){void 0!==t&&t.destroy(),e.data.source.read.url="/admin/actividades-extracurriculares/get".proto().parseURL(),t=$("#activities-datatable").mDatatable(e),$(t).on("m-datatable--on-layout-updated",(function(){a()}))},reload:function(){t.reload()}}}(),Form=function(){var t,e,a="#add_activity_modal",i="#edit_activity_modal",r=function(){$(a).one("hidden.bs.modal",(function(){n.reset.create()})),$("#Edit_Credits").on("blur",(function(){var t=parseInt(this.value);isNaN(t)&&(t=0),this.value=t,this.value<0&&(this.value=0)})),$("#Add_Credits").on("blur",(function(){var t=parseInt(this.value);isNaN(t)&&(t=0),this.value=t,this.value<0&&(this.value=0)}))},n={submit:{create:function(t){$(t).serialize();var e=new FormData($(t)[0]);$(`${a} input, ${a} select, ${a} textarea`).attr("disabled",!0),$("#btnCreate").addLoader(),$.ajax({url:$(t).attr("action"),type:"POST",data:e,contentType:!1,processData:!1}).always((function(){$(`${a} input, ${a} select, ${a} textarea`).attr("disabled",!1),$("#btnCreate").removeLoader()})).done((function(){$(a).modal("toggle"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),ActivitiesTable.reload()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=t.responseText?$("#add_form_msg_txt").html(t.responseText):$("#add_form_msg_txt").html(_app.constants.ajax.message.error),$("#add_form_msg").removeClass("m--hide").show()}))},edit:function(t){$(t).serialize();var e=new FormData($(t)[0]);$(`${i} input, ${i} select, ${i} textarea`).attr("disabled",!0),$("#btnEdit").addLoader(),$.ajax({url:$(t).attr("action"),type:"POST",data:e,contentType:!1,processData:!1}).always((function(){$(`${i} input, ${i} select, ${i} textarea`).attr("disabled",!1),$("#btnEdit").removeLoader()})).done((function(){$(i).modal("toggle"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),ActivitiesTable.reload()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=t.responseText?$("#edit_form_msg_txt").html(t.responseText):$("#edit_form_msg_txt").html(_app.constants.ajax.message.error),$("#edit_form_msg").removeClass("m--hide").show()}))}},reset:{create:function(){$("#add_form_msg").addClass("m--hide").hide(),t.resetForm()},edit:function(){$("#edit_form_msg").addClass("m--hide").hide(),e.reset()}},show:{edit:function(t){mApp.blockPage(),$.ajax({url:`/admin/actividades-extracurriculares/${t}/get`.proto().parseURL()}).done((function(t){var e=$("#edit-activity-form").get(0).elements;e.Edit_Id.value=t.id,e.Edit_Code.value=t.code,e.Edit_Name.value=t.name,e.Edit_Credits.value=t.credits,e.Edit_Description.value=t.description,e.Edit_TermId.value=t.termId,e.Edit_AreaId.value=t.areaId,mApp.unblockPage(),$(i).one("hidden.bs.modal",(function(){n.reset.edit()}))})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}}},s={Add_Name:{required:!0,maxlength:100},Edit_Name:{required:!0,maxlength:100}},o=function(){t=$("#add-activity-form").validate({rules:s,submitHandler:function(t,e){e.preventDefault(),n.submit.create(t)}}),e=$("#edit-activity-form").validate({rules:s,submitHandler:function(t,e){e.preventDefault(),n.submit.edit(t)}})},d={terms:{init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(t){$("#Add_TermId").select2({placeholder:"Seleccione un periodo",dropdownParent:$(a),data:t.items}),$("#Edit_TermId").select2({placeholder:"Seleccione un periodo",dropdownParent:$(i),data:t.items}),null!==t.selected&&($("#Add_TermId").val(t.selected),$("#Add_TermId").trigger("change.select2"),$("#Edit_TermId").val(t.selected),$("#Edit_TermId").trigger("change.select2"))}))}},areas:{init:function(){$.ajax({url:"/areas-extracurriculares/actividades/get".proto().parseURL()}).done((function(t){$("#Add_AreaId").select2({placeholder:"Seleccione un área",dropdownParent:$(a),data:t.items}),$("#Edit_AreaId").select2({placeholder:"Seleccione un área",dropdownParent:$(i),data:t.items})}))}},init:function(){this.terms.init(),this.areas.init()}};return{init:function(){r(),o(),d.init()},Edit:{show:function(t){n.show.edit(t)}}}}();$((function(){ActivitiesTable.init(),Form.init()}));