var forums={ajax:{list:{},load:{create:function(e,t){e.elements,forums.ajax.list["forums-ajax-create"]=$.ajax({data:$(e).serialize(),type:e.method,url:e.action,beforeSend:function(t,a){mApp.block($(e).closest(".modal-content"))},complete:function(t,a){mApp.unblock($(e).closest(".modal-content"))},error:function(e,t,a){toastr.error(_app.constants.toastr.message.error.create,_app.constants.toastr.title.error)},success:function(e,t,a){forums.datatable.list.ajax_data.reload(),forums.modal.list["forums-modal-create"].modal("hide"),toastr.success(_app.constants.toastr.message.success.create,_app.constants.toastr.title.success)}})},editById:function(e,t){var a=$(e).data("id");forums.ajax.list["forums-ajax-edit"]=$.ajax({data:{Id:a},type:"GET",url:("/admin/foros/editar/"+a).proto().parseURL(),error:function(e,t,a){toastr.error(_app.constants.toastr.message.error.create,_app.constants.toastr.title.error)},success:function(e,t,a){$("#forums-modal-edit-form");let s=e.active;$("#activeForum option[value='"+s+"']").prop("selected",!0),$("#activeForum").trigger("change"),$("input[name='Name']").val(e.name),$("textarea[name='Description']").val(e.description),$("input[name='Id']").val(e.id),$("select[name='Careers']").val(e.careers),$("select[name='Careers']").trigger("change")}})},edit:function(e,t){e.elements,forums.ajax.list["forums-ajax-edit"]=$.ajax({data:$(e).serialize(),type:e.method,url:e.action,beforeSend:function(t,a){mApp.block($(e).closest(".modal-content"))},complete:function(t,a){mApp.unblock($(e).closest(".modal-content"))},error:function(e,t,a){toastr.error(_app.constants.toastr.message.error.update,_app.constants.toastr.title.error)},success:function(e,t,a){forums.datatable.list.ajax_data.reload(),forums.modal.list["forums-modal-edit"].modal("hide"),toastr.success(_app.constants.toastr.message.success.update,_app.constants.toastr.title.success)}})}}},datatable:{list:{},load:{get:function(){forums.datatable.list.ajax_data=$("#ajax_data").mDatatable({data:{source:{read:{method:"GET",url:"/admin/foros/get".proto().parseURL()}}},columns:[{field:"name",title:"Nombre"},{field:"description",title:"Descripción"},{field:"state",title:"Estado",template:function(e){return e.state?'<span class="m-badge m-badge--success m-badge--wide">Activo</span>':'<span class="m-badge  m-badge--metal m-badge--wide">Inactivo</span>'}},{field:"options",title:"Opciones",sortable:!1,filterable:!1,template:function(e){var t="";return t+='<button type="button" data-id="'+e.id+'" class="btn btn-info btn-sm m-btn m-btn--icon btn-edit" onClick="forums.modal.load.edit(this, event)"><span><i class="la la-edit"></i><span>Editar</span></span></button>',t+=' <button class="btn btn-danger m-btn btn-sm m-btn--icon" onclick ="forums.swal.load.delete(this, event, \'',t+="/admin/foros/eliminar/post".proto().parseURL(),t+="', '",t+=e.proto().encode(),t+='\')"><i class="la la-trash"></i></button>'}}]})}}},select2:{init:function(){this.careers.init()},events:{init:function(){$("#careers-select1").on("select2:select",(function(){var e=$("#careers-select1").val();if(null!=e&&e.length>0){var t=e.length;if(e.filter((e=>e===_app.constants.guid.empty)).length>0){t>1&&toastr.success("Se ha seleccionado 'TODOS' como valor único.","ADVERTENCIA");var a=e.filter((e=>e===_app.constants.guid.empty));$("#careers-select1").val(a).trigger("change")}}else $("#careers-select1").val("").trigger("change"),$("#careers-select1").prop("disabled",!1)})),$("#careers-select2").on("select2:select",(function(){var e=$("#careers-select2").val();if(null!=e&&e.length>0){var t=e.length;if(e.filter((e=>e===_app.constants.guid.empty)).length>0){t>1&&toastr.success("Se ha seleccionado 'TODOS' como valor único.","ADVERTENCIA");var a=e.filter((e=>e===_app.constants.guid.empty));$("#careers-select2").val(a).trigger("change")}}else $("#careers-select2").val("").trigger("change"),$("#careers-select2").prop("disabled",!1)}))}},careers:{init:function(){$(".select2-careers").prop("disabled",!0),$.ajax({url:"/admin/foros/carreras".proto().parseURL()}).done((function(e){$(".select2-careers").empty(),e.unshift({id:_app.constants.guid.empty,text:"Todas"}),$(".select2-careers").select2({data:e,placeholder:"Carrera"}),e.length>1&&$(".select2-careers").prop("disabled",!1),$(".select2-careers").trigger("change"),forums.select2.events.init()}))}}},modal:{list:{},load:{create:function(e,t){var a=document.getElementById("forums-modal-create-form");$(".select2-forumactive").select2(),_app.modules.form.reset({element:a}),forums.modal.list["forums-modal-create"]=$("#forums-modal-create").modal("show")},edit:function(e,t){var a=document.getElementById("forums-modal-edit-form");_app.modules.form.reset({element:a}),forums.ajax.load.editById(e,t),forums.modal.list["forums-modal-edit"]=$("#forums-modal-edit").modal("show")}}},swal:{list:{},load:{delete:function(e,t,a,s){s=s.proto().decode(),forums.swal.list["forums-swal-delete"]=swal({title:_app.constants.swal.title.delete,type:"warning",showCancelButton:!0,showLoaderOnConfirm:!0,preConfirm:()=>new Promise(((e,t)=>{$.ajax({data:{id:s.id},type:"POST",url:a,beforeSend:function(e,t){},complete:function(t,a){e()},success:function(e,t,a){forums.datatable.list.ajax_data.reload(),toastr.success(_app.constants.toastr.message.success.delete,_app.constants.toastr.title.success)},error:function(e,t,a){toastr.error("La categoría tiene información relacionada",_app.constants.toastr.title.error)}})}))})}}},validate:{list:{},load:{create:function(){forums.validate.list["forums-modal-create-form"]=$("#forums-modal-create-form").validate({submitHandler:function(e,t){t.preventDefault(),forums.ajax.load.create(e,t)}})},edit:function(){forums.validate.list["forums-modal-edit-form"]=$("#forums-modal-edit-form").validate({submitHandler:function(e,t){forums.ajax.load.edit(e,t)}})}}}};window.onload=function(){forums.datatable.load.get(),forums.validate.load.create(),forums.validate.load.edit(),forums.select2.init(),$("#activeForum").select2()};