var Form=function(){var e=function(){$("#Name").attr("disabled",!0),$("#PaternalSurname").attr("disabled",!0),$("#MaternalSurname").attr("disabled",!0)},t={dependencies:{init:function(){$.ajax({url:"/dependencias/todas".proto().parseURL()}).done((function(e){$(".select2-dependencies").select2({placeholder:"Dependencias",data:e.items}),t.dependencies.load()}))},load:function(){var e=$("#Id").val();mApp.block(".m-content",{type:"loader",message:"Cargando..."}),$.ajax({url:("/admin/usuarios/"+e+"/dependencias/get").proto().parseURL()}).done((function(e){var t=[];e.items.forEach((function(e){t.push(e.id)})),$(".select2-dependencies").val(t).trigger("change")})).always((function(e){mApp.unblock(".m-content")}))}},roles:{init:function(){$.ajax({url:"/roles/get".proto().parseURL()}).done((function(e){$(".select2-roles").select2({placeholder:"Roles",minimumInputLength:0,data:e.items}),t.roles.load()}))},load:function(){var e=$("#Id").val();mApp.block(".m-content",{type:"loader",message:"Cargando..."}),$.ajax({url:`/admin/usuarios/${e}/roles/get`.proto().parseURL()}).done((function(e){console.log(e),e.items.forEach((function(e){var t=new Option(e.text,e.id,!0,!0);$(".select2-roles").append(t).trigger("change")}))})).always((function(e){mApp.unblock(".m-content")}))}}},n={init:function(){this.picture.init()},picture:{init:function(){$("#Picture").on("change",(function(e){var t=(e.target||window.event.srcElement).files;if(FileReader&&t&&t.length){var n=new FileReader;n.onload=function(){$("#current-picture").attr("src",n.result)},n.readAsDataURL(t[0])}else console.log("File Reader not supported.")}))}}},o=function(){$("#Dni").keypress((function(e){(46===e.which||e.which<48||e.which>57)&&e.preventDefault()})).on("paste",(function(e){e.preventDefault()})),$("#PhoneNumber").keypress((function(e){(46===e.which||e.which<48||e.which>57)&&e.preventDefault()})).on("paste",(function(e){e.preventDefault()}))},a={init:function(){this.status.init()},status:{init:function(){$("#IsActive").on("change",(function(){var e=$(this).prop("checked"),t=!e;swal({title:`Estás ${e?"habilitando":"deshabilitando"} al usuario <strong>${$("#current-username").val()}</strong> ¿Desea continuar?`,text:"Los cambios se guardarán permanentemente",type:"warning",showCancelButton:!0,confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,confirmButtonText:"Sí, continuar",allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((n=>{$.ajax({url:`/admin/usuarios/${$("#Id").val()}/editar/estado/post`.proto().parseURL(),data:{isActive:e},type:"POST",success:function(e){swal({type:"success",title:"Completado",text:`Se actualizó el estado del usuario ${$("#current-username").val()}`,confirmButtonText:"Excelente"})},error:function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Ocurrió un error al intentar actualizar el estado del usuario"}),$("#IsActive").prop("checked",t)}})}))}).then((e=>{e.value||$("#IsActive").prop("checked",t)}))}))}}},r={init:function(){this.birthDate.init()},birthDate:{init:function(){$("#BirthDate").datepicker("setEndDate",moment().format(_app.constants.formats.datepickerJsMoment))}}},i=function(e){var t=new FormData($(e)[0]);mApp.block(".m-content"),console.log("test123"),$.ajax({url:$(e).attr("action"),type:"POST",data:t,contentType:!1,processData:!1}).done((function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)})).fail((function(e){null!=e.responseText?$("#alert-text").html(e.responseText):$("#alert-text").html(_app.constants.toastr.message.error.task),$("#m-form_alert").removeClass("m--hide").show(),$("body,html").animate({scrollTop:$("#m-form_alert").offset().top-70},800)})).always((function(){console.log("test"),mApp.unblock(".m-content")}))},s={form:$("#edit-form").validate({rules:{ConfirmedPassword:{equalTo:"#Password"}},messages:{PhoneNumber:{pattern:"El campo no tiene el formato correcto (Ejemplo: 989419189 o 3255564 )"},Dni:{pattern:"Por favor, el Dni solo debe contener números.",maxlength:"Por favor, el Dni solo debe 8 contener dígitos.",minlength:"Por favor, el Dni debe 8 contener dígitos."}},submitHandler:function(t,n){n.preventDefault(),$.ajax({url:"/admin/usuarios/validar-correo".proto().parseURL(),data:{email:$("#Email").val(),userId:$("#Id").val()}}).done((function(n){1==n||"true"==n?swal({type:"warning",title:"Correo ya registrado",text:"Ya existe un usuario con el correo especificado. ¿Desea continuar y usar el mismo correo?",confirmButtonText:"Aceptar",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{i(t),e(),swal.close()}))}):(i(t),e())}))}}),reset:function(){s.form.resetForm()}};return{init:function(){t.dependencies.init(),t.roles.init(),n.init(),a.init(),r.init(),o(),e()}}}();$((function(){Form.init()}));