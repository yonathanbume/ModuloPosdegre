var dependency=function(){var e={ajax:{objects:{}},datatable:{load:{get:function(){$("#search").doneTyping((function(){e.datatable.objects["dependency-datatable-get"].draw()})),e.datatable.objects["dependency-datatable-get"]=$("#dependency-datatable-get").DataTable({ajax:{data:function(e,t){e.searchValue=$("#search").val(),e.userId=$("#dependency-header-form .user-select2").val()},url:"/admin/dependencias/datatable/get".proto().parseURL(),type:"GET"},columns:[{data:"name",name:"name",title:"Nombre de la Dependencia"},{data:"acronym",name:"acronym",title:"Acrónimo"},{data:"user.fullName",name:"user.fullName",render:function(e,t,a,n){var d="";return null!=a.user?d+=a.user.fullName:d+="---",d},title:"Director"},{orderable:!1,render:function(e,t,a,n){return`\n                                        <button class="btn btn-primary btn-sm m-btn m-btn--icon" onclick="dependency.modal.load.detail(this, event, '${a.proto().encode()}')"><span><i class="la la-eye"></i><span> Detalle </span></span></button> \n                                        <button class="btn btn-primary btn-sm m-btn m-btn--icon" onclick="dependency.modal.load.update(this, event, '${a.proto().encode()}')"><span><i class="la la-edit"></i><span> Editar </span></span></button> \n                                        <button class="btn btn-danger btn-sm m-btn m-btn--icon m-btn--icon-only" onclick="dependency.swal.load.delete(this, event, '${"/admin/dependencias/eliminar/post".proto().parseURL()}', '${a.proto().encode()}')"><i class="la la-trash"></i></button> \n                                    `},title:"Opciones"}]})}},objects:{}},modal:{objects:{}},select2:{load:{dependencyUser:function(){$("#dependency-modal-create-form .dependency-user-select2, #dependency-modal-update-form .dependency-user-select2").each((function(t,a){var n=$(a),d=n.parents(".modal"),o=d.length>0?d:null;e.select2.objects[`dependency-user-select2-${t}`]=n.select2({ajax:{delay:1e3,url:"/admin/usuarios/dependencias/select2/get".proto().parseURL()},allowClear:!0,dropdownParent:o})}))},user:function(){$("#dependency-header-form .user-select2").each((function(t,a){var n=$(a),d=n.parents(".modal"),o=d.length>0?d:null;e.select2.objects[`user-select2-${t}`]=n.select2({ajax:{delay:1e3,url:"/admin/usuarios/select2/get".proto().parseURL()},allowClear:!0,dropdownParent:o})})),$("#dependency-header-form .user-select2").on("change select2:select",(function(t){e.datatable.objects["dependency-datatable-get"].draw()}))}},objects:{}},swal:{objects:{}},validate:{load:{create:function(){e.validate.objects["dependency-modal-create-form"]=$("#dependency-modal-create-form").validate({submitHandler:function(e,t){t.preventDefault(),dependency.ajax.load.create(e,t)}})},update:function(){e.validate.objects["dependency-modal-update-form"]=$("#dependency-modal-update-form").validate({submitHandler:function(e,t){t.preventDefault(),dependency.ajax.load.update(e,t)}})}},objects:{}}};return{ajax:{load:{create:function(t,a){var n=t.elements,d=new FormData;d.append("UserId",n.UserId.value),d.append("Acronym",n.Acronym.value),d.append("Name",n.Name.value),d.proto().appendFiles(n.SignatureFile.files,"SignatureFile"),mApp.block(".modal-content"),e.ajax.objects["dependency-ajax-create"]=$.ajax({contentType:!1,data:d,processData:!1,type:t.method,url:t.action,xhr:function(){var e=new window.XMLHttpRequest;return n.SignatureFile.files.length>0&&($(n.SignatureFile).parent().addProgressBar(),e.upload.onprogress=function(e){if(e.lengthComputable){var a=e.loaded/e.total*100;$(t).find(".progress-bar").width(`${a}%`)}}),e}}).always((function(e,t,a){mApp.unblock(".modal-content"),$(n.SignatureFile).parent().removeProgressBar()})).done((function(e,a,n){_app.modules.form.reset({element:t}),dependency.datatable.getObject("dependency-datatable-get").draw(),dependency.modal.getObject("dependency-modal-create").modal("hide"),toastr.success(_app.constants.toastr.message.success.create,_app.constants.toastr.title.success)})).fail((function(e,t,a){var n=e.responseText;""!=n&&400==e.status?toastr.error(n,_app.constants.toastr.title.error):toastr.error(_app.constants.toastr.message.error.create,_app.constants.toastr.title.error)}))},delete:function(e,t){$.ajax({data:{Id:e.id},type:"POST",url:t}).always((function(e,t,a){swal.close()})).done((function(e,t,a){dependency.datatable.getObject("dependency-datatable-get").draw(),toastr.success(_app.constants.toastr.message.success.delete,_app.constants.toastr.title.success)})).fail((function(e,t,a){toastr.error(_app.constants.toastr.message.error.delete,_app.constants.toastr.title.error)}))},update:function(t,a){var n=t.elements,d=new FormData;d.append("Id",n.Id.value),d.append("UserId",n.UserId.value),d.append("Acronym",n.Acronym.value),d.append("Name",n.Name.value),d.proto().appendFiles(n.SignatureFile.files,"SignatureFile"),mApp.block(".modal-content"),e.ajax.objects["dependency-ajax-update"]=$.ajax({contentType:!1,data:d,processData:!1,type:t.method,url:t.action,xhr:function(){var e=new window.XMLHttpRequest;return n.SignatureFile.files.length>0&&($(n.SignatureFile).parent().addProgressBar(),e.upload.onprogress=function(e){if(e.lengthComputable){var a=e.loaded/e.total*100;$(t).find(".progress-bar").width(`${a}%`)}}),e}}).always((function(e,t,a){mApp.unblock(".modal-content"),$(n.SignatureFile).parent().removeProgressBar()})).done((function(e,t,a){dependency.datatable.getObject("dependency-datatable-get").draw(),dependency.modal.getObject("dependency-modal-update").modal("hide"),toastr.success(_app.constants.toastr.message.success.update,_app.constants.toastr.title.success)})).fail((function(e,t,a){var n=e.responseText;""!=n&&400==e.status?toastr.error(n,_app.constants.toastr.title.error):toastr.error(_app.constants.toastr.message.error.update,_app.constants.toastr.title.error)}))}},getObject:function(t){return e.ajax.objects[t]}},datatable:{getObject:function(t){return e.datatable.objects[t]}},file:{load:{signatureFileCreate:function(e,t){var a=(t.target||window.event.srcElement).files,n=a.length,d=new FileReader;FileReader&&a&&n>0&&(d.onload=function(e){var t="";t+=`\n                                <div class="m--space-20"></div>\n                                <img src="${e.target.result}" alt="Signature" height="300" width="300">\n                            `,document.getElementById("dependency-modal-create-signature-content").innerHTML=t},d.readAsDataURL(a[0]))},signatureFileUpdate:function(e,t){var a=(t.target||window.event.srcElement).files,n=a.length,d=new FileReader;FileReader&&a&&n>0&&(d.onload=function(e){var t="";t+=`\n                                <div class="m--space-20"></div>\n                                <img src="${e.target.result}" alt="Signature" height="300" width="300">\n                            `,document.getElementById("dependency-modal-update-signature-content").innerHTML=t},d.readAsDataURL(a[0]))}}},init:function(){e.datatable.load.get(),e.select2.load.dependencyUser(),e.select2.load.user(),e.validate.load.create(),e.validate.load.update()},modal:{load:{create:function(t,a){var n=document.getElementById("dependency-modal-create-form");n.SignatureFile.value=null,n.SignatureFile.nextElementSibling.innerHTML="Seleccione archivos",document.getElementById("dependency-modal-create-signature-content").innerHTML="",e.modal.objects["dependency-modal-create"]=$("#dependency-modal-create").modal("show")},detail:function(t,a,n){var d=document.getElementById("dependency-modal-detail-form"),o="";n=n.proto().decode(),_app.modules.form.reset({element:d}),_app.modules.form.fill({element:d,data:{Id:n.id,UserName:null!=n.user?n.user.name:"---",Acronym:n.acronym,Name:n.name}}),null!=n.signature?o+=`<img src="${n.signature}" alt="Signature" height="300" width="300">`:o+="<label>No hay una imágen disponible</label>",document.getElementById("dependency-modal-detail-signature-content").innerHTML=o,e.modal.objects["dependency-modal-detail"]=$("#dependency-modal-detail").modal("show")},update:function(t,a,n){var d=document.getElementById("dependency-modal-update-form"),o="";n=n.proto().decode(),_app.modules.form.reset({element:d}),_app.modules.form.fill({element:d,data:{Id:n.id,UserId:n.userId,Acronym:n.acronym,Name:n.name}}),$("#dependency-modal-update .dependency-user-select2").val(null).trigger("change"),null!=n.user&&$("#dependency-modal-update .dependency-user-select2").append(new Option(n.user.fullName,n.userId,!0,!0)).trigger("change"),null!=n.signature&&(o+=`\n                            <div class="m--space-20"></div>\n                            <img src="${n.signature}" alt="Signature" height="300" width="300">\n                        `),document.getElementById("dependency-modal-update-signature-content").innerHTML=o,e.modal.objects["dependency-modal-update"]=$("#dependency-modal-update").modal("show")}},getObject:function(t){return e.modal.objects[t]}},select2:{getObject:function(t){return e.select2.objects[t]}},swal:{load:{delete:function(t,a,n,d){d=d.proto().decode(),e.swal.objects["dependency-swal-delete"]=swal({preConfirm:function(){return new Promise((function(e,t){dependency.ajax.load.delete(d,n)}))},title:_app.constants.swal.title.delete,type:"warning",showCancelButton:!0,showLoaderOnConfirm:!0})}},getObject:function(t){return e.swal.objects[t]}},validate:{getObject:function(t){return e.validate.objects[t]}}}}();$((function(){dependency.init()}));