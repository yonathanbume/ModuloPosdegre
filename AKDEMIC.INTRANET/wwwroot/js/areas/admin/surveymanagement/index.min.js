var InitApp=function(){var t=$("#surveyRequiredFeature").val(),e={surveys:{object:null,options:getSimpleDataTableConfiguration({url:"/admin/gestion-encuestas/get".proto().parseURL(),data:function(t){t.searchValue=$("#search").val()},pageLength:50,orderable:[],columns:[{title:"Código",data:"code"},{title:"Estado",data:"status"},{title:"Nombre",data:"title"},{title:"Fecha Publicación",data:"publishDate"},{title:"Fecha Finalización",data:"finishDate"},{title:"Opciones",data:null,render:function(t){var e="",a=`/admin/gestion-encuestas/editar/${t.id}`.proto().parseURL(),n=`/admin/gestion-encuestas/respuestas/${t.id}`.proto().parseURL();return e+=`<a href="${a}"  `,e+="class='btn btn-secondary ",e+="m-btn btn-sm m-btn--icon' ",e+=" data-id='"+t.id+"'>",e+="<span><i class='la la-edit'></i><span>Detalle</span></span></a> ",e+=`<a href="${n}"  `,e+="class='btn btn-secondary ",e+="m-btn btn-sm m-btn--icon' ",e+=" data-id='"+t.id+"'>",e+="<span><i class='la la-eye'></i><span>Respuestas</span></span></a> ",t.statusId==_app.constants.survey_states.notsent&&(e+="<button ",e+="class='btn btn-danger btn-delete ",e+="m-btn btn-sm  m-btn--icon-only' ",e+=" data-id='"+t.id+"'>",e+="<i class='la la-trash'></i></button>"),e}}]}),init:function(){e.surveys.object=$("#data-table").DataTable(e.surveys.options),e.surveys.events()},reload:function(){e.surveys.object.ajax.reload()},events:function(){$("#data-table").on("click",".btn-delete",(function(t){var e=$(this).data("id");a.delete(e)}))}},init:function(){e.surveys.init()}},a={create:{object:$("#create-form").validate({submitHandler:function(t){$("#btn-Add").addLoader(),$.ajax({url:$(t).attr("action"),type:"POST",data:$(t).serialize()}).done((function(){$("#create_modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.surveys.reload()})).fail((function(t){null!==t.responseText&&""!==t.responseText?$("#create_msg_txt").html(t.responseText):$("#create_msg_txt").html(_app.constant.ajax.message.error),$("#create_msg").removeClass("m--hide").show(),$("#btn-Add").removeLoader()}))}}),show:function(){$("#create_modal").modal("toggle"),$("#btn-Add").removeLoader(),a.create.clear()},events:function(){$("#addSurvey").on("click",(function(){a.create.show()}))},clear:function(){a.create.object.resetForm(),$("#create_msg").addClass("m--hide"),$("#PublicationDate").datepicker("update",""),$("#FinishDate").datepicker("update",""),$("#PublicationDate").datepicker("setStartDate",moment().toDate()),$("#PublicationDate").datepicker("setEndDate",!1),$("#FinishDate").datepicker("setStartDate",moment().add(1,"d").toDate()),$("#FinishDate").datepicker("setEndDate",!1)}},delete:function(t){swal({title:"¿Está seguro?",text:"La encuesta será eliminada permanentemente",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarla",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((a=>{$.ajax({url:"/admin/gestion-encuestas/eliminar".proto().parseURL(),type:"POST",data:{id:t},success:function(t){swal({type:"success",title:"Completado",text:"La Encuesta ha sido eliminada con exito",confirmButtonText:"Excelente"}).then(e.surveys.reload())},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"La Encuesta presenta información relacionada"})}})})),allowOutsideClick:()=>!swal.isLoading()})},init:function(){a.create.events()}},n=function(){$("#PublicationDate").datepicker("setStartDate",moment().toDate()),$("#FinishDate").datepicker("setStartDate",moment().add(1,"d").toDate()),$("#PublicationDate").datepicker({clearBtn:!0,orientation:"bottom",format:_app.constants.formats.datepicker}).on("changeDate",(function(t){$("#FinishDate").datepicker("setStartDate",moment(t.date).add(1,"d").toDate())})),$("#FinishDate").datepicker({clearBtn:!0,orientation:"bottom",format:_app.constants.formats.datepicker}).on("changeDate",(function(t){$("#PublicationDate").datepicker("setEndDate",t.date)}))},s=function(){$("#search").doneTyping((function(){e.surveys.reload()}))};return{init:function(){t&&$("#requiredContainer").css("display","block"),e.init(),a.init(),s(),n()}}}();$((function(){InitApp.init()}));