var InitApp=function(){var e=$("#SurveyId").val(),a=[],t={users:{object:null,options:getSimpleDataTableConfiguration({url:"/admin/gestion-encuestas/getusers".proto().parseURL(),data:function(e){e.facultyId=$("#faculties").val(),e.careerId=$("#careers").val(),e.specialtyId=$("#specialties").val(),e.academicDepartmentId=$("#academicDepartments").val(),e.rol=$("#roles").val(),e.onlyEnrolled=$("#onlyEnrolled").is(":checked"),e.academicYears=JSON.stringify($("#academicYears").val())},pageLength:20,orderable:[],columns:[{title:"#",data:null,orderable:!1,render:function(e){var t="";return 1==a.includes(e.id)?t+=`<label class="m-checkbox m-checkbox--solid m-checkbox--single m-checkbox--brand"><input type="checkbox" data-id="${e.id}" onchange="InitApp.select(this);" checked><span></span></label>`:t+=`<label class="m-checkbox m-checkbox--solid m-checkbox--single m-checkbox--brand"><input type="checkbox" data-id="${e.id}" onchange="InitApp.select(this);"><span></span></label>`,t}},{title:"Nombre Completo",data:"fullName",orderable:!1},{title:"Correo",data:"email",orderable:!1}]}),init:function(){$(".btn-custom-send").prop("disabled",!0),t.users.object=$("#users_table").DataTable(t.users.options)},reload:function(){t.users.object.ajax.reload()}},init:function(){this.users.init()}},s={init:function(){this.faculties.init(),this.careers.init(),this.speciality.init(),this.roles.init(),this.academicDepartments.init(),this.academicYears.init()},academicYears:{init:function(){$("#academicYears").selectpicker({actionsBox:!0,selectAllText:"Marcar todos",deselectAllText:"Desmarcar todos",noneSelectedText:"Seleccionar",size:10}),$("#academicYears").selectpicker("refresh")}},academicDepartments:{init:function(){this.load()},load:function(){$.ajax({url:"/departamentos-academicos/get".proto().parseURL()}).done((function(e){$("#academicDepartments").html('<option value="0" selected>Todas</option>'),$(".select2-academicDepartments").select2({data:e})}))}},faculties:{init:function(){this.load(),this.events()},load:function(){$.ajax({url:"/facultades/get".proto().parseURL()}).done((function(e){$("#faculties").html('<option value="0" selected>Todas</option>'),$(".select2-faculties").select2({data:e.items})}))},events:function(){$("#faculties").on("change",(function(){$("#specialties").val("0").trigger("change",[!1]),$("#specialties").prop("disabled",!0),s.careers.load()}))}},careers:{init:function(){$("#careers").prop("disabled",!0),this.events()},load:function(){$("#careers").prop("disabled",!1),$.ajax({url:`/carrerasporfacultad/${$("#faculties").val()}/get`.proto().parseURL()}).done((function(e){$("#careers").html('<option value="0" selected>Todas</option>'),$(".select2-careers").select2({data:e.items})}))},events:function(){$("#careers").on("change",(function(e,a){if(void 0!==a&&a)return!1;s.speciality.load()}))}},speciality:{init:function(){$("#specialties").prop("disabled",!0)},load:function(){$("#specialties").prop("disabled",!1),$.ajax({url:`/especialidadporcarrera/${$("#careers").val()}/get`.proto().parseURL()}).done((function(e){$("#specialties").html('<option value="0" selected>Todas</option>'),$(".select2-specialties").select2({data:e.items})}))}},roles:{init:function(){this.load(),this.events()},load:function(){$.ajax({url:"/roles_selected/get".proto().parseURL()}).done((function(e){$(".select2-roles").select2({data:e.items})}))},events:function(){$("#roles").on("change",(function(e,a){var t=$("#roles option:selected").text();"Alumnos"===t?($("#onlyEnrolledContainer").css("display","block"),$("#facultiesContainer").css("display","block"),$("#careersContainer").css("display","block"),$("#specialtiesContainer").css("display","block"),$("#academicDepartmentsContainer").css("display","none")):"Docentes"===t?($("#onlyEnrolledContainer").css("display","none"),$("#facultiesContainer").css("display","none"),$("#careersContainer").css("display","none"),$("#specialtiesContainer").css("display","none"),$("#academicDepartmentsContainer").css("display","block"),$("#academicYearsContainer").css("display","none"),$("#onlyEnrolled").prop("checked",!1).trigger("change"),$("#academicYears").selectpicker("deselectAll")):($("#onlyEnrolledContainer").css("display","none"),$("#facultiesContainer").css("display","none"),$("#careersContainer").css("display","none"),$("#specialtiesContainer").css("display","none"),$("#academicDepartmentsContainer").css("display","none"),$("#academicYearsContainer").css("display","none"),$("#onlyEnrolled").prop("checked",!1).trigger("change"),$("#academicYears").selectpicker("deselectAll"))}))}}},n=function(){$("#onlyEnrolled").on("change",(function(){$("#onlyEnrolled").is(":checked")?$("#academicYearsContainer").css("display","block"):($("#academicYearsContainer").css("display","none"),$("#academicYears").selectpicker("deselectAll"))})),$("#btn-apply").on("click",(function(){t.users.reload()})),$(".btn-send").on("click",(function(){$(".btn-send").addLoader(),$.ajax({url:"/admin/gestion-encuestas/enviar/validar".proto().parseURL(),type:"POST",data:{facultyId:$("#faculties").val(),careerId:$("#careers").val(),specialtyId:$("#specialties").val(),academicDepartmentId:$("#academicDepartments").val(),rol:$("#roles").val(),onlyEnrolled:$("#onlyEnrolled").is(":checked"),academicYears:JSON.stringify($("#academicYears").val())}}).done((function(a){a>1e3?swal({title:"¿Está seguro?, Se enviarán más de 1000 encuestas...",text:"Las encuestas pueden tardar en ser enviadas debido a la cantidad de usuarios seleccionados.En este caso la encuesta estará disponible para los usuarios en unas horas.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, enviar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((a=>{$(".btn-send").addLoader(),$.ajax({url:`/admin/gestion-encuestas/job/enviar/usuarios/${e}`.proto().parseURL(),type:"POST",async:!0,data:{facultyId:$("#faculties").val(),careerId:$("#careers").val(),specialtyId:$("#specialties").val(),academicDepartmentId:$("#academicDepartments").val(),rol:$("#roles").val(),onlyEnrolled:$("#onlyEnrolled").is(":checked"),academicYears:JSON.stringify($("#academicYears").val())}}),setTimeout((function(){location.href="/admin/gestion-encuestas".proto().parseURL()}),5e3)})),allowOutsideClick:()=>!swal.isLoading()}):$.ajax({url:`/admin/gestion-encuestas/nojob/enviar/usuarios/${e}`.proto().parseURL(),type:"POST",data:{facultyId:$("#faculties").val(),careerId:$("#careers").val(),specialtyId:$("#specialties").val(),academicDepartmentId:$("#academicDepartments").val(),rol:$("#roles").val(),onlyEnrolled:$("#onlyEnrolled").is(":checked"),academicYears:JSON.stringify($("#academicYears").val())}}).done((function(e){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),setTimeout((function(){location.href="/admin/gestion-encuestas".proto().parseURL()}),2e3)})).fail((function(e){toastr.error(e.responseText,_app.constants.toastr.title.error),setTimeout((function(){location.href="/admin/gestion-encuestas".proto().parseURL()}),2e3)}))})).fail((function(e){toastr.error(e.responseText,_app.constants.toastr.title.error),setTimeout((function(){location.href="/admin/gestion-encuestas".proto().parseURL()}),3e3)}))})),$(".btn-custom-send").on("click",(function(){0!=a.length?($(".btn-custom-send").addLoader(),$.ajax({url:"/admin/gestion-encuestas/sendSurveys".proto().parseURL(),type:"POST",data:{users:a,surveyId:e}}).done((function(e){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),setTimeout((function(){location.href="/admin/gestion-encuestas".proto().parseURL()}),3e3)})).fail((function(e){toastr.error(e.responseText,_app.constants.toastr.title.error),setTimeout((function(){location.href="/admin/gestion-encuestas".proto().parseURL()}),3e3)}))):toastr.error("Seleccione los usuarios a enviar la encuesta.",_app.constants.toastr.title.error)}))};return{init:function(){t.init(),s.init(),n()},select:function(e){!function(e){const t=$(e).prop("checked"),s=$(e).data("id");!0===t?(a.push(s),$(".btn-custom-send").prop("disabled",!1)):0===(a=a.filter((function(e){return e!==s}))).length&&$(".btn-custom-send").prop("disabled",!0),$("#tableinfo").html(a.length)}(e)}}}();$((function(){InitApp.init()}));