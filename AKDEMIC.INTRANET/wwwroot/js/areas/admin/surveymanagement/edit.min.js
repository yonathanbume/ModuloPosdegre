var InitApp=function(){var e=$("#Sended").val(),t=$("#SurveyId").val(),n={create:{object:$("#add-section-form").validate({submitHandler:function(e,t){t.preventDefault(),mApp.block("#add_section_modal"),$.ajax({url:$(e).attr("action"),type:"POST",data:$(e).serialize()}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),n.create.clear(),i.loadData()})).fail((function(e){null!==e.responseText&&""!==e.responseText?$("#add_sectionform_msg_txt").html(e.responseText):$("#add_sectionform_msg_txt").html(_app.constants.ajax.message.error),$("#add_sectionform_msg").removeClass("m--hide").show()})).always((function(){mApp.unblock("#add_section_modal")}))}}),show:function(){$("#add_section_modal").modal("toggle"),$("#add_section_modal").one("hidden.bs.modal",(function(e){n.create.clear()}))},clear:function(){n.create.object.resetForm()}},delete:function(e){swal({title:"¿Está seguro?",text:"La Sección y sus preguntas serán eliminadas.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarla",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((t=>{$.ajax({url:"/admin/gestion-encuestas/item/eliminar".proto().parseURL(),type:"POST",data:{id:e},success:function(e){swal({type:"success",title:"Completado",text:"La Sección y sus preguntas han sido eliminadas con exito",confirmButtonText:"Excelente"}).then(i.loadData())},error:function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"La Sección y sus preguntas presentan información relacionada"})}})})),allowOutsideClick:()=>!swal.isLoading()})},edit:{object:$("#edit-section-form").validate({submitHandler:function(t){1==e?toastr.error("Esta encuesta ya fue enviada, no puede ser editada",_app.constants.toastr.title.error):0==e&&(console.log($("#edit_Id").val()),mApp.block("#edit_section_modal"),$.ajax({url:"/admin/gestion-encuestas/encuesta-seccion/editar",type:"POST",data:{id:$("#edit_Id").val(),title:$("#edit_Title").val(),isLikert:$("#edit-section-form  input[name=IsLikert]").is(":checked")}}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),n.edit.clear(),i.loadData()})).fail((function(e){null!==e.responseText&&""!==e.responseText?$("#edit_sectionform_msg_txt").html(e.responseText):$("#edit_sectionform_msg_txt").html(_app.constants.ajax.message.error),$("#edit_sectionform_msg").removeClass("m--hide").show(),toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)})).always((function(){mApp.unblock("#edit_section_modal")})))}}),show:function(t){1==e?toastr.error("Esta encuesta ya fue enviada, no puede ser editada",_app.constants.toastr.title.error):0==e&&(this.load(t),$("#edit_section_modal").modal("toggle"))},load:function(e){$.ajax({url:`/admin/gestion-encuestas/encuesta-seccion/${e}/get`,type:"GET"}).done((function(e){console.log(e),$("#edit_Id").val(e.id),$("#edit_Title").val(e.title),$("#edit-section-form input[name=IsLikert]").prop("checked",e.isLikert)}))},clear:function(){this.object.resetForm()},events:function(){$("#edit_section_modal").one("hidden.bs.modal",(function(e){n.edit.clear()}))}},init:function(){this.edit.events()}},s={create:{object:$("#add-likert-question-form").validate({submitHandler:function(e,t){t.preventDefault(),mApp.block("#add_likertquestion_modal"),$("#btnAddLikert").addLoader(),$.ajax({url:$(e).attr("action"),type:"POST",data:$(e).serialize()}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),s.create.clear(),i.loadData(),$("#btnAddLikert").removeLoader()})).fail((function(e){null!==e.responseText&&""!==e.responseText?$("#add_likertquestionform_msg_txt").html(e.responseText):$("#add_likertquestionform_msg_txt").html(_app.constants.ajax.message.error),$("#add_likertquestionform_msg").removeClass("m--hide").show(),$("#btnAddLikert").removeLoader()})).always((function(){mApp.unblock("#add_likertquestion_modal")}))}}),clear:function(){s.create.object.resetForm()},show:function(e){$("#add-likert-question-form input[name=SurveyItemId]").val(e),$("#add_likert_question_modal").modal("toggle")},events:function(){$("#add_likert_question_modal").on("hidden.bs.modal",(function(e){s.create.clear()}))}},edit:{object:$("#edit-likert-question-form").validate({submitHandler:function(e,t){t.preventDefault(),mApp.block("#edit_likertquestion_modal"),$("#btnEditLikert").addLoader(),$.ajax({url:$(e).attr("action"),type:"POST",data:$(e).serialize()}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),i.loadData(),$("#btnEditLikert").removeLoader()})).fail((function(e){null!==e.responseText&&""!==e.responseText?$("#edit_likertquestionform_msg_txt").html(e.responseText):$("#edit_likertquestionform_msg_txt").html(_app.constants.ajax.message.error),$("#edit_likertquestionform_msg").removeClass("m--hide").show(),$("#btnEditLikert").removeLoader()})).always((function(){mApp.unblock("#edit_likertquestion_modal")}))}}),show:function(e){this.load(e),$("#edit_likert_question_modal").modal("toggle")},load:function(e){$.ajax({url:`/admin/gestion-encuestas/pregunta/get/${e}`.proto().parseURL()}).done((function(e){$("#edit-likert-question-form input[name=QuestionId]").val(e.id),$("#edit-likert-question-form input[name=SurveyItemId]").val(e.surveyItemId),$("#edit-likert-question-form input[name=Description]").val(e.description)}))}},init:function(){this.create.events()}},a={create:{object:$("#add-question-form").validate({submitHandler:function(e,n){n.preventDefault(),mApp.block("#add_question_modal");var s=parseInt($("#Type").val()),o=[],r=document.getElementsByClassName("answer"),d=document.getElementsByClassName("answerId");if(r.length<2&&parseInt($("#Type").val())!==_app.constants.survey.text_question)return mApp.unblock("#add_question_modal"),void toastr.error("Agregue por lo menos dos respuestas",_app.constants.toastr.title.error);if(parseInt($("#Type").val())!==_app.constants.survey.text_question)for(var c=0;c<r.length;c++){if(""===r[c].value)return mApp.unblock("#add_question_modal"),void toastr.error("Campos vacíos",_app.constants.toastr.title.error);var l={description:r[c].value,id:d[c].value};o.push(l)}$.ajax({url:"/admin/gestion-encuestas/registrar/pregunta/post".proto().parseURL(),type:"POST",data:{surveyId:t,surveyItemId:$("#SurveyItemId").val(),type:s,description:$("#add-question-form input[name='Description']").val(),answers:o}}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),a.create.clear(),i.loadData()})).fail((function(e){null!==e.responseText&&""!==e.responseText?$("#add_questionform_msg_txt").html(e.responseText):$("#add_questionform_msg_txt").html(_app.constants.ajax.message.error),$("#add_questionform_msg").removeClass("m--hide").show()})).always((function(){mApp.unblock("#add_question_modal")}))}}),show:function(e){$(".select2-questionType").val("").trigger("change"),$("#add-question-form input[name=SurveyItemId]").val(e),$("#add_question_modal").modal("toggle")},clear:function(){a.create.object.resetForm(),$(".formanswers").empty()},events:function(){$("#Type").on("change",(function(){switch(this.value){case"1":$("#question-text").css("display","block"),$("#question-multiple").css("display","none"),$("#question-answers").css("display","none"),$(".formanswers").empty();break;case"2":case"3":$("#question-text").css("display","none"),$("#question-multiple").css("display","block"),$("#question-answers").css("display","block")}})),$("#add-answer").on("click",(function(){var e=document.createElement("div");e.innerHTML='<div class="form-group col-lg-12" style="display:flex;"><input class="answerId" value="" hidden/><input class="form-control m-input answer" style="margin-right: 10px;" required><button class="btn btn-danger btn-sm m-btn--icon delete-answer" type="button" onclick="this.parentNode.outerHTML = \'\';"><span><i class="la la-trash"></i></span></button></div>',document.getElementById("question-answers").appendChild(e.firstChild)})),$("#add_question_modal").one("hidden.bs.modal",(function(e){a.create.clear()}))}},delete:function(e){swal({title:"¿Está seguro?",text:"La Pregunta se eliminará.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarla",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((t=>{$.ajax({url:"/admin/gestion-encuestas/preguntas/eliminar".proto().parseURL(),type:"POST",data:{id:e},success:function(e){swal({type:"success",title:"Completado",text:"La pregunta ha sido eliminada con exito",confirmButtonText:"Excelente"}).then(i.loadData())},error:function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"La Pregunta presenta información relacionada"})}})})),allowOutsideClick:()=>!swal.isLoading()})},edit:{object:$("#edit-question-form").validate({submitHandler:function(e){mApp.block("#edit_question_modal");var t=parseInt($("#Edit_Type").val()),n=[],s=document.getElementsByClassName("Edit_answer"),o=document.getElementsByClassName("Edit_answerId");if(s.length<2&&t!==_app.constants.survey.text_question)return mApp.unblock("#edit_question_modal"),void toastr.error("Agregue por lo menos dos respuestas",_app.constants.toastr.title.error);if(t!==_app.constants.survey.text_question)for(var r=0;r<s.length;r++){if(""===s[r].value)return mApp.unblock("#edit_question_modal"),void toastr.error("Campos vacíos",_app.constants.toastr.title.error);var d={description:s[r].value,id:o[r].value};n.push(d)}$.ajax({url:"/admin/gestion-encuestas/editar/pregunta/post".proto().parseURL(),type:"POST",data:{id:$("#questionId").val(),type:t,description:$("#Edit_Description").val(),answers:n}}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),a.edit.clear(),i.loadData()})).fail((function(e){null!==e.responseText&&""!==e.responseText?$("#edit_questionform_msg_txt").html(e.responseText):$("#edit_questionform_msg_txt").html(_app.constants.ajax.message.error),$("#edit_questionform_msg").removeClass("m--hide").show()})).always((function(){mApp.unblock("#edit_question_modal")}))}}),show:function(e){$("#questionId").val(e),mApp.unblock("#edit_question_modal"),$("#edit_question_modal").modal("toggle"),$("#edit_question_modal").one("shown.bs.modal",(function(t){mApp.block("#edit_question_modal .modal-content",{type:"loader",message:"Cargando..."}),a.edit.load(e),mApp.unblock("#edit_question_modal .modal-content")})),$("#edit_question_modal").one("hidden.bs.modal",(function(e){a.edit.clear()}))},clear:function(){a.edit.object.resetForm(),$(".formanswers").empty()},events:function(){$("#Edit_Type").on("change",(function(){switch(this.value){case"1":$("#edit-question-form .question-text").css("display","block"),$("#edit-question-form .question-multiple").css("display","none"),$("#edit-question-form .question-answers").css("display","none"),$("#edit-question-form .formanswers").css("display","none"),$(".formanswers").empty();break;case"2":case"3":$("#edit-question-form .question-text").css("display","none"),$("#edit-question-form .question-multiple").css("display","block"),$("#edit-question-form .question-answers").css("display","block"),$("#edit-question-form .formanswers").css("display","block")}})),$("#edit-question-form .add-answer").on("click",(function(){var e=document.createElement("div");e.innerHTML='<div class="form-group col-lg-12" style="display:flex;"><input class="Edit_answerId" value="" hidden/><input class="form-control m-input Edit_answer" style="margin-right: 10px;" required><button class="btn btn-danger btn-sm m-btn--icon delete-answer" type="button" onclick="this.parentNode.outerHTML = \'\';"><span><i class="la la-trash"></i></span></button></div>',$("#edit-question-form .formanswers").append(e.firstChild)}))},load:function(e){$.ajax({url:`/admin/gestion-encuestas/pregunta/get/${e}`.proto().parseURL()}).done((function(e){if($("#Edit_questionId").val(e.id),$("#Edit_Type").val(e.type).trigger("change"),$("#Edit_Description").val(e.description),e.type!==_app.constants.survey.text_question){$("#edit-question-form .question-text").css("display","none"),$("#edit-question-form .question-multiple").css("display","block"),$("#edit-question-form .question-answers").css("display","block");for(var t=0;t<e.answers.length;t++){var n='<div class="form-group col-lg-12" style="display:flex;"><input class="Edit_answerId" value="'+e.answers[t].id+'" hidden/><input class="form-control m-input Edit_answer" style="margin-right: 10px;" required value="'+e.answers[t].description+'" /> <button class="btn btn-danger btn-sm m-btn--icon delete-answer" type="button" onclick="this.parentNode.outerHTML = \'\';"><span><i class="la la-trash"></i></span></button></div> ',s=document.createElement("div");s.innerHTML=n,$("#edit-question-form .formanswers").append(s.firstChild)}$("#edit-question-form .formanswers").css("display","block")}else $("#edit-question-form .question-text").css("display","block"),$("#edit-question-form .question-multiple").css("display","none"),$("#edit-question-form .question-answers").css("display","none"),$("#edit-question-form .formanswers").css("display","none")}))}},events:function(){a.create.events(),a.edit.events()}},o={editDate:{object:$("#edit-survey-form").validate({submitHandler:function(e,n){n.preventDefault(),mApp.block("#edit-survey-form"),$("#btn-edit-date-survey").addLoader(),$.ajax({url:"/admin/gestion-encuestas/editar/cambiarfechas".proto().parseURL(),type:"POST",data:{id:t,publicationDate:$("#PublicationDate").val(),finishDate:$("#FinishDate").val()}}).done((function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)})).fail((function(e){toastr.error(e.responseText,_app.constants.toastr.title.error)})).always((function(){mApp.unblock("#edit-survey-form"),$("#btn-edit-date-survey").removeLoader()}))}})},edit:{object:$("#edit-survey-form").validate({submitHandler:function(e,n){n.preventDefault(),mApp.block("#edit-survey-form"),$("#btn-edit-Survey").addLoader(),$.ajax({url:"/admin/gestion-encuestas/editar/post".proto().parseURL(),type:"POST",data:{id:t,name:$("#Name").val(),publicationDate:$("#PublicationDate").val(),finishDate:$("#FinishDate").val(),code:$("#Code").val(),description:$("#Description").val(),isRequired:$("#IsRequired").is(":checked"),isAnonymous:$("#IsAnonymous").is(":checked")}}).done((function(){toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)})).fail((function(e){toastr.error(e.responseText,_app.constants.toastr.title.error)})).always((function(){mApp.unblock("#edit-survey-form"),$("#btn-edit-Survey").removeLoader()}))}}),load:function(e){$.ajax({url:("/admin/gestion-encuestas/get/"+e).proto().parseURL(),type:"GET",data:{id:e},success:function(e){$("#Name").val(e.name),$("#Name").prop("disabled",!0),$("#Code").val(e.code),$("#Description").val(e.description),$("#Description").prop("disabled",!0),$("#PublicationDate").datepicker("update",e.publicationDate),$("#FinishDate").datepicker("update",e.finishDate),$("#PublicationDate").datepicker("setEndDate",e.finishDate),$("#FinishDate").datepicker("setStartDate",e.publicationDate),$("#IsRequired").prop("checked",e.isRequired),$("#IsRequired").prop("disabled",!0),$("#IsAnonymous").prop("checked",e.isAnonymous),$("#IsAnonymous").prop("disabled",!0)},error:function(){toastr.error("Error al cargar la encuesta",_app.constants.toastr.title.error)}})}},send:{validate:function(e){$("#send-survey").addLoader(),$.ajax({url:"/admin/gestion-encuestas/general/enviar/validate".proto().parseURL(),type:"POST",data:{id:e}}).done((function(t){location.href=`/admin/gestion-encuestas/enviar/${e}`.proto().parseURL()})).fail((function(e){toastr.error("Debes agregar al menos una pregunta para poder enviar la encuesta",_app.constants.toastr.title.error),$("#send-survey").removeLoader()}))},events:function(){$(".btn-send").on("click",(function(){var e=t;o.send.validate(e)}))},init:function(){o.send.events()}},init:function(){o.send.init()}},i={loadData:function(){$.ajax({type:"GET",url:`/admin/gestion-encuestas/items/get/${t}`.proto().parseURL()}).done((function(e){$("#section_container").html(e)}))},events:function(){$("#manage_section").on("click",".btn-add",(function(){n.create.show()})),$("#manage_section").on("click",".btn-add-question",(function(){var e=$(this).data("id");$.ajax({url:`/admin/gestion-encuestas/seccion/${e}/validar-likert`.proto().parseURL(),type:"GET"}).done((function(t){t.isLikert?s.create.show(e):a.create.show(e)})).fail((function(e){window.location.href=window.location.href}))})),$("#manage_section").on("click",".delete",(function(){var e=$(this).data("id");a.delete(e)})),$("#manage_section").on("click",".btn-edit-section",(function(){var e=$(this).data("id");n.edit.show(e)})),$("#manage_section").on("click",".delete-item",(function(){var e=$(this).data("id");n.delete(e)})),$("#manage_section").on("click",".edit",(function(){var e=$(this).data("id");$.ajax({url:`/admin/gestion-encuestas/pregunta/${e}/validar-likert`.proto().parseURL(),type:"GET"}).done((function(t){t.isLikert?s.edit.show(e):a.edit.show(e)})).fail((function(e){window.location.href=window.location.href}))}))},init:function(){i.loadData(),a.events(),i.events()}},r=function(){$("#PublicationDate").datepicker().on("changeDate",(function(e){$("#FinishDate").datepicker("setStartDate",e.date)})),$("#FinishDate").datepicker().on("changeDate",(function(e){$("#PublicationDate").datepicker("setEndDate",e.date)}))},d={init:function(){this.questionType.init()},questionType:{init:function(){$.ajax({url:"/tipospregunta/get".proto().parseURL()}).done((function(e){$(".select2-questionType").select2({data:e.items,minimumResultsForSearch:-1})}))}}};return{init:function(){i.init(),d.init(),s.init(),n.init(),o.init(),o.edit.load(t),r()}}}();$((function(){InitApp.init()}));