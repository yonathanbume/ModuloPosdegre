var DeanFacultyManagement=function(){var t=function(){$("#search").doneTyping((function(){a.reload()}))},a={object:null,options:{ajax:{url:"/admin/gestion-de-decanos/obtener-decanos".proto().parseURL(),data:function(t){delete t.columns,t.searchValue=$("#search").val()}},columns:[{data:"name",title:"Facultad"},{data:"deanGrade",title:"Grado"},{data:"dean.fullName",title:"Decano"},{data:"secretary.fullName",title:"Secretario"},{data:"administrativeAssistant.fullName",title:"Asistente administrativo"},{data:null,title:"Opciones",render:function(t,a,e,n){var i="";return null!=t.deanResolutionFile&&""!=t.deanResolutionFile&&(i+=` <a href='/file/${t.deanResolutionFile}' target='_blank' class="btn btn-primary btn-sm m-btn m-btn--icon"><span><i class="la la-download"></i><span>Resolución</span></span></a>`),i+=` <button data-id="${t.id}" class="btn btn-info btn-sm m-btn m-btn--icon btn-edit" title="Asignar"><span><i class="la la-eye"></i><span>Asignar</span></span></button>`,i+=` <button data-id="${t.id}" class="btn btn-success btn-sm m-btn m-btn--icon btn-history" title="Historial de Encargados"><span><i class="la la-history"></i><span>Historial</span></span></button>`}}]},init:function(){this.object=$("#tbl-data").DataTable(this.options),$("#tbl-data").on("click",".btn-edit",(function(t){var a=$(this).data("id");e.edit.load(a)})),$("#tbl-data").on("click",".btn-history",(function(){var t=$(this).data("id");n.load(t)}))},reload:function(){this.object.ajax.reload()}},e={edit:{object:$("#edit-form").validate({submitHandler:function(t){mApp.block("#edit_term_modal .modal-content");var n=new FormData(t);$.ajax({url:$(t).attr("action"),type:"POST",data:n,contentType:!1,processData:!1}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),a.reload(),e.edit.clear()})).fail((function(t){null!==t.responseText&&""!==t.responseText?$("#edit-form-alert-txt").html(t.responseText):$("#edit-form-alert-txt").html(_app.constants.ajax.message.error),$("#edit-form-alert").removeClass("m--hide").show()})).always((function(){mApp.unblock("#edit_term_modal .modal-content")}))}}),load:function(t){$.ajax({url:`/admin/gestion-de-decanos/obtener-decano/${t}`,type:"GET"}).done((function(a){if($("#Id").val(t),null!=a.dean&&null!=a.dean){var e=new Option(a.dean.fullName,a.deanId,!1,!1);$("#DeanId").append(e),$("#DeanId").val(a.deanId).trigger("change")}if(null!=a.secretary&&null!=a.secretary){var n=new Option(a.secretary.fullName,a.secretaryId,!1,!1);$("#SecretaryId").append(n),$("#SecretaryId").val(a.secretaryId).trigger("change")}if(null!=a.administrativeAssistant&&null!=a.administrativeAssistant){e=new Option(a.administrativeAssistant.fullName,a.administrativeAssistantId,!1,!1);$("#AdministrativeAssistantId").append(e),$("#AdministrativeAssistantId").val(a.administrativeAssistantId).trigger("change")}null!=a.dean&&null!=a.dean||$("#DeanId").val(null).trigger("change"),null!=a.secretary&&null!=a.secretary||$("#SecretaryId").val(null).trigger("change"),null!=a.administrativeAssistant&&null!=a.administrativeAssistant||$("#AdministrativeAssistantId").val(null).trigger("change"),$("#DeanGrade").val(a.deanGrade),$("#edit-form").find("[name='Resolution']").val(a.deanResolution),$("#edit_term_modal").modal("toggle")}))},clear:function(){e.edit.object.resetForm(),$(".custom-file-label").text("Seleccione un archivo"),$("[name='ResolutionFile']").val(null).trigger("change")}}},n={load:function(t){$("#history_modal").modal("toggle");var a=`/admin/gestion-de-decanos/historial?id=${t}`.proto().parseURL(),e=n.options;e.ajax.url=a,null!=n.object&&n.object.destroy(),n.object=$("#history_table").DataTable(e)},object:null,options:{serverSide:!1,filter:!1,lengthChange:!1,paging:!1,ajax:{url:"/admin/carreras/historial?id={id}".proto().parseURL(),type:"GET"},columns:[{data:"date",title:"Fecha inicio"},{data:"dateEnd",title:"Fecha fin"},{data:"dean",title:"Decano"},{data:"secretary",title:"Secretario"},{data:"resolution",title:"Resolución"},{data:null,title:"Archivo Res.",render:function(t){var a="";return null!=t.resolutionFile&&""!=t.resolutionFile?a+=` <a href='/file/${t.resolutionFile}' target='_blank' class="btn btn-primary btn-sm m-btn m-btn--icon"><span><i class="la la-download"></i><span>Descargar</span></span></a>`:a="Sin archivo",a}}]}};return{init:function(){a.init(),t(),$("#DeanId").select2({dropdownParent:$("#edit_term_modal"),width:"100%",ajax:{url:"/admin/gestion-de-decanos/obtener-usuarios".proto().parseURL(),dataType:"json",data:function(t){return{term:t.term,page:t.page}},processResults:function(t,a){return{results:t.items.results}},cache:!0},escapeMarkup:function(t){return t}}),$("#SecretaryId").select2({dropdownParent:$("#edit_term_modal"),width:"100%",ajax:{delay:1e3,url:"/administrativos".proto().parseURL(),data:function(t){return{term:t.term,page:t.page||1}}},allowClear:!0,minimumInputLength:0,placeholder:"Seleccione..."}),$("#AdministrativeAssistantId").select2({dropdownParent:$("#edit_term_modal"),width:"100%",ajax:{delay:1e3,url:"/administrativos".proto().parseURL(),data:function(t){return{term:t.term,page:t.page||1}}},allowClear:!0,minimumInputLength:0,placeholder:"Seleccione..."})}}}();$((function(){DeanFacultyManagement.init()}));