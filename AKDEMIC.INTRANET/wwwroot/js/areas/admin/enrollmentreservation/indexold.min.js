var enrollmentReservation=function(){var e={ajax:{objects:{}},datatable:{load:{get:function(){e.datatable.objects["enrollment-reservation-datatable-get"]=$("#enrollment-reservation-datatable-get").mDatatable({data:{source:{read:{method:"GET",url:"/admin/matricula/reservas/get".proto().parseURL()}}},columns:[{field:"user.fullName",title:"Nombre del Solicitante"},{field:"total",title:"Total",template:function(e){var t="";return t+="S/. ",t+=e.total.toFixed(2)}},{field:"paidAmount",title:"Monto Pagado",template:function(e){var t="";return t+="S/. ",t+=e.paidAmount.toFixed(2)}},{field:"paid",title:"Pagado",template:function(e){var t="";return e.paid?t+="Sí":t+="No",t}},{field:"term.name",title:"Periodo",template:function(e){var t="";return null!=e.term?t+=e.term.name:t+="---",t}},{field:"parsedCreatedAt",title:"Fecha de Solicitud"},{field:"options",title:"Opciones",sortable:!1,filterable:!1,template:function(e){var t="";return t+='<button class="btn btn-danger btn-sm m-btn m-btn--icon" onclick="enrollmentReservation.swal.load.deny(this, event, \'',t+="/admin/matricula/reservas/aceptar/post".proto().parseURL(),t+="', '",t+=e.proto().encode(),t+='\')"><i class="la la-close"></i></button> ',t+='<button class="btn btn-success btn-sm m-btn m-btn--icon" onclick="enrollmentReservation.swal.load.accept(this, event, \'',t+="/admin/matricula/reservas/denegar/post".proto().parseURL(),t+="', '",t+=e.proto().encode(),t+='\')"><i class="la la-check"></i></button> '}}]})}},objects:{}},select2:{load:{user:function(){$("#enrollment-reservation-header-form .user-select2").on("select2:select",(function(e){var t=$(this).select2("data")[0],a=enrollmentReservation.datatable.getObject("enrollment-reservation-datatable-get");a.setDataSourceParam("userId",t.id),a.load()}))}}},swal:{objects:{}}};return{ajax:{getObject:function(t){return e.ajax.objects[t]},load:{accept:function(t,a){e.ajax.objects["enrollment-reservation-ajax-accept"]=$.ajax({data:{Id:t.id},type:"POST",url:a}).always((function(e,t,a){swal.close()})).done((function(e,t,a){enrollmentReservation.datatable.getObject("enrollment-reservation-datatable-get").reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)})).fail((function(e,t,a){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))},deny:function(t,a){e.ajax.objects["enrollment-reservation-ajax-deny"]=$.ajax({data:{Id:t.id},type:"POST",url:a}).always((function(e,t,a){swal.close()})).done((function(e,t,a){enrollmentReservation.datatable.getObject("enrollment-reservation-datatable-get").reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)})).fail((function(e,t,a){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))},user:function(){e.ajax.objects["enrollment-reservation-ajax-user"]=$.ajax({type:"GET",url:"/admin/usuarios/2/get".proto().parseURL()}).done((function(e,t,a){$("#enrollment-reservation-header-form .user-select2").proto().htmlElement((function(t){var a=$(t);a.val();a.hasClass("select2-hidden-accessible")&&(a.select2("destroy"),a.html("")),_app.modules.select.fill({data:e,element:t,name:"fullName",nullable:!0});var n=a.parents(".modal"),o={};n.length>0&&(o.dropdownParent=n),a.select2(o)}))})).fail((function(e,t,a){toastr.error(_app.constants.toastr.message.error.get,_app.constants.toastr.title.error)}))}}},datatable:{getObject:function(t){return e.datatable.objects[t]}},init:function(){e.datatable.load.get(),e.select2.load.user(),enrollmentReservation.ajax.load.user()},swal:{getObject:function(t){return e.swal.objects[t]},load:{accept:function(t,a,n,o){o=o.proto().decode(),e.swal.objects["enrollment-reservation-swal-accept"]=swal({preConfirm:function(){return new Promise((function(e,t){enrollmentReservation.ajax.load.accept(o,n)}))},title:"¿Desea aceptar la reserva de matrícula de "+o.user.fullName+"?",type:"warning",showCancelButton:!0,showLoaderOnConfirm:!0})},deny:function(t,a,n,o){o=o.proto().decode(),e.swal.objects["enrollment-reservation-swal-deny"]=swal({preConfirm:function(){return new Promise((function(e,t){enrollmentReservation.ajax.load.deny(o,n)}))},title:"¿Desea denegar la reserva de matrícula de "+o.user.fullName+"?",type:"warning",showCancelButton:!0,showLoaderOnConfirm:!0})}}}}}();$((function(){enrollmentReservation.init()}));