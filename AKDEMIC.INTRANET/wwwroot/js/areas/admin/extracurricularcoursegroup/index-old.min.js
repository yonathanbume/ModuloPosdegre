var extracurricularcoursegroupTable=function(){var t,e={search:{input:$("#search")},data:{source:{read:{method:"GET",url:"/admin/gruposextracurriculares/get".proto().parseURL()}}},columns:[{field:"code",title:"Código"},{field:"name",title:"Curso"},{field:"teacher",title:"Docente"},{field:"options",title:"Opciones",textAlign:"center",sortable:!1,filterable:!1,template:function(t){var e="";return e+="<button data-toggle='modal' data-target='#edit_extracurricularcoursegroup_modal' data-id='"+t.id+"' class='btn btn-info btn-sm m-btn m-btn--icon btn-edit'><span><i class='la la-edit'></i><span>Editar</span></span></button> ",e+="<button data-id='"+t.id+"' class='btn btn-danger btn-sm m-btn--icon btn-delete' title='Eliminar'><i class='la la-trash'></i></button> ",e+="<button data-id='"+t.id+"' class='btn btn-primary btn-sm m-btn--icon btn-assign' title='Alumnos'><i class='la la-user'></i></button>"}}]},a=function(){t.on("click",".btn-delete",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",text:"El grupo será eliminado",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarla",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({url:"/admin/gruposextracurriculares/eliminar/post".proto().parseURL(),type:"POST",data:{id:e},success:function(){t.reload(),swal({type:"success",title:"Completado",text:"El grupo ha sido eliminado con éxito",confirmButtonText:"Excelente"})},error:function(){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Al parecer el grupo tiene información relacionada"})}})}))})})),t.on("click",".btn-assign",(function(){var t=$(this).data("id");studentsTable.init(t)})),t.on("click",".btn-edit",(function(){var t=$(this).data("id");Form.Edit.show(t)})),$(".letters").keypress((function(t){var e=t.which;e>=65&&e<=120||32==e||0==e||t.preventDefault()}))};return{init:function(){void 0!==t&&t.destroy(),e.data.source.read.url="/admin/gruposextracurriculares/get".proto().parseURL(),t=$("#extracurricularcoursegroup-datatable").mDatatable(e),$(t).on("m-datatable--on-layout-updated",(function(){a()}))},reload:function(){t.reload()}}}(),Form=function(){var t,e,a="#add_extracurricularcoursegroup_modal",r="#edit_extracurricularcoursegroup_modal",n="#edit-extracurricularcoursegroup-form",o=function(){$(".btn-add").on("click",(function(){$(a).one("hidden.bs.modal",(function(){s.reset.create()}))}))},s={submit:{create:function(t){var e=$(t).serialize();$(`${a} input, ${a} select`).attr("disabled",!0),$("#btnCreate").addLoader(),$.ajax({url:$(t).attr("action"),type:"POST",data:e}).always((function(){$(`${a} input, ${a} select`).attr("disabled",!1),$("#btnCreate").removeLoader()})).done((function(){$(a).modal("toggle"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),extracurricularcoursegroupTable.reload()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=t.responseText?$("#add_form_msg_txt").html(t.responseText):$("#add_form_msg_txt").html(_app.constants.ajax.message.error),$("#add_form_msg").removeClass("m--hide").show()}))},edit:function(t){var e=$(t).serialize();$(`${r} input, ${r} select`).attr("disabled",!0),$("#btnEdit").addLoader(),$.ajax({url:$(t).attr("action"),type:"POST",data:e}).always((function(){$(`${r} input, ${r} select`).attr("disabled",!1),$("#btnEdit").removeLoader()})).done((function(){$(r).modal("toggle"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),extracurricularcoursegroupTable.reload()})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error),null!=t.responseText?$("#edit_form_msg_txt").html(t.responseText):$("#edit_form_msg_txt").html(_app.constants.ajax.message.error),$("#edit_form_msg").removeClass("m--hide").show()}))}},reset:{create:function(){$("#add_form_msg").addClass("m--hide").hide(),$("#Add_TeacherId").val(null).trigger("change.select2"),$("#Add_ExtracurricularCourseId").val(null).trigger("change.select2"),t.resetForm()},edit:function(){$("#edit_form_msg").addClass("m--hide").hide(),$("#Edit_TeacherId").val(null).trigger("change.select2"),$("#Edit_ExtracurricularCourseId").val(null).trigger("change.select2"),e.resetForm()}},show:{edit:function(t){$.ajax({url:`/admin/gruposextracurriculares/${t}/get`.proto().parseURL()}).done((function(t){var e=$(n).get(0).elements;e.Edit_Id.value=t.id,e.Edit_Code.value=t.code,$("#Edit_TeacherId").empty().append(`<option value="${t.teacherid}">${t.teacherName}</option>`).val(`${t.teacherid}`).trigger("change"),$("#Edit_ExtracurricularCourseId").val(t.extracurricularcourseid).trigger("change.select2")})).fail((function(t){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}}},i={init:function(){$.ajax({url:"/cursosextracurriculares/get".proto().parseURL(),success:function(t){$("#Add_ExtracurricularCourseId").select2({placeholder:"Seleccione un curso",dropdownParent:$(a),data:t.items}),$("#Edit_ExtracurricularCourseId").select2({placeholder:"Seleccione un curso",dropdownParent:$(r),data:t.items})}}),$("#Add_TeacherId").select2({ajax:{url:"/profesores/get",type:"GET",datatype:"json",delay:250,data:function(t){return{q:t.term,page:t.page}},processResults:function(t,e){return e.page=e.page||1,{results:t.items.results,pagination:{more:30*e.page<t.total_count}}},cache:!0},placeholder:"Buscar docentes",minimumInputLength:3}),$("#Edit_TeacherId").select2({ajax:{url:"/profesores/get",type:"GET",datatype:"json",delay:250,data:function(t){return{q:t.term,page:t.page}},processResults:function(t,e){return e.page=e.page||1,{results:t.items.results,pagination:{more:30*e.page<t.total_count}}},cache:!0},placeholder:"Buscar docentes",minimumInputLength:3})}},c={init:function(){this.create.init(),this.edit.init()},create:{init:function(){t=$("#add-extracurricularcoursegroup-form").validate({submitHandler:function(t,e){e.preventDefault(),s.submit.create(t)}})}},edit:{init:function(){e=$(n).validate({submitHandler:function(t,e){e.preventDefault(),s.submit.edit(t)}})}}};return{init:function(){c.init(),o(),i.init()},Edit:{show:function(t){s.show.edit(t)}}}}();$((function(){extracurricularcoursegroupTable.init(),Form.init()}));