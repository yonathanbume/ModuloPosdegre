var InitApp=function(){const t=$("#data-table"),e=$("#students-table"),a="#create-modal",n="#edit-modal";var o={groups:{object:null,options:{ajax:{url:"/admin/grupos-extracurriculares/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){t.search=$("#search").val()}},columns:[{title:"Periodo",data:"term"},{title:"Curso",data:"course"},{title:"Código",data:"code"},{title:"Docente",data:"teacher"},{title:"Opciones",data:null,orderable:!1,render:function(t){return`<button type="button" data-object="${t.proto().encode()}" class="btn btn-info btn-sm m-btn m-btn--icon btn-edit" title=""><i class="la la-edit"></i> Editar</button> <button class="btn btn-danger m-btn btn-sm m-btn--icon m-btn--icon-only btn-delete" data-id="${t.id}"><i class="la la-trash"></i></button> <button class="btn btn-primary btn-sm m-btn--icon m-btn--icon-only btn-students" data-id="${t.id}"><i class="la la-user"></i></button>`}}]},init:function(){this.object=t.DataTable(this.options),t.on("click",".btn-edit",(function(t){var e=$(this).data("object");e=e.proto().decode(),r.edit.load(e)})),t.on("click",".btn-delete",(function(t){var e=$(this).data("id");r.delete.load(e)})),t.on("click",".btn-students",(function(t){var e=$(this).data("id");o.students.load(e)}))},reload:function(){this.object.ajax.reload()}},students:{object:null,options:{serverSide:!1,ajax:{url:"/admin/grupos-extracurriculares/alumnos/get".proto().parseURL(),type:"GET",dataType:"JSON",dataSrc:"",data:function(t){t.id=$("#groupId").val()}},columns:[{title:"Código",data:"username"},{title:"Nombre",data:"name"}]},load:function(t){$("#groupId").val(t),null==this.object?this.object=e.DataTable(this.options):(this.object.clear().draw(),this.object.ajax.reload()),$("#students-modal").modal("show")}}},r={create:{object:$("#create-form").validate({submitHandler:function(t){mApp.block(`${a} .modal-content`),$.ajax({url:$(t).attr("action"),type:"POST",data:$(t).serialize()}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),o.groups.reload(),r.create.clear()})).fail((function(t){null!==t.responseText&&""!==t.responseText?$("#create-form-alert-txt").html(t.responseText):$("#create-form-alert-txt").html(_app.constants.ajax.message.error),$("#create-form-alert").removeClass("m--hide").show()})).always((function(){mApp.unblock("#create-modal .modal-content")}))}}),clear:function(){r.create.object.resetForm()}},edit:{object:$("#edit-form").validate({submitHandler:function(t){mApp.block(`${n} .modal-content`),$.ajax({url:$(t).attr("action"),type:"POST",data:$(t).serialize()}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),o.groups.reload(),r.edit.clear()})).fail((function(t){null!==t.responseText&&""!==t.responseText?$("#edit-form-alert-txt").html(t.responseText):$("#edit-form-alert-txt").html(_app.constants.ajax.message.error),$("#edit-form-alert").removeClass("m--hide").show()})).always((function(){mApp.unblock("#edit-modal .modal-content")}))}}),load:function(t){$("#Edit_Id").val(t.id),$("#Edit_Code").val(t.code),$("#Edit_TermId").val(t.termId).trigger("change"),$("#Edit_ExtracurricularCourseId").val(t.courseId).trigger("change"),$("#Edit_TeacherId").empty().append(`<option value="${t.teacherId}">${t.teacher}</option>`).val(`${t.teacherId}`).trigger("change"),$(n).modal("toggle")},clear:function(){r.edit.object.resetForm()}},delete:{load:function(t){swal({title:"¿Está seguro?",text:"El grupo será elimininado permanentemente. En caso de tener información relacionada no podrá eliminarse.",type:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar"}).then((function(e){e.value&&$.ajax({url:"/admin/actividades-extracurriculares/eliminar",type:"POST",data:{id:t},success:function(){o.groups.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}})}))}}},s={terms:{init:function(){$.ajax({url:"/periodos/pendientes/get".proto().parseURL()}).done((function(t){$("#Add_TermId").select2({placeholder:"Seleccione un periodo",dropdownParent:$(a),data:t.items}),$("#Edit_TermId").select2({placeholder:"Seleccione un periodo",dropdownParent:$(n),data:t.items}),null!==t.selected&&($("#Add_TermId").val(t.selected),$("#Add_TermId").trigger("change.select2"),$("#Edit_TermId").val(t.selected),$("#Edit_TermId").trigger("change.select2"))}))}},courses:{init:function(){$.ajax({url:"/cursosextracurriculares/get".proto().parseURL()}).done((function(t){$("#Add_ExtracurricularCourseId").select2({placeholder:"Seleccione un curso",dropdownParent:$(a),data:t.items}),$("#Edit_ExtracurricularCourseId").select2({placeholder:"Seleccione un curso",dropdownParent:$(n),data:t.items})}))}},teachers:{init:function(){$("#Add_TeacherId").select2({ajax:{url:"/profesores/get",type:"GET",datatype:"json",delay:250,data:function(t){return{q:t.term,page:t.page}},processResults:function(t,e){return e.page=e.page||1,{results:t.items.results,pagination:{more:30*e.page<t.total_count}}},cache:!0},placeholder:"Buscar docentes",minimumInputLength:3}),$("#Edit_TeacherId").select2({ajax:{url:"/profesores/get",type:"GET",datatype:"json",delay:250,data:function(t){return{q:t.term,page:t.page}},processResults:function(t,e){return e.page=e.page||1,{results:t.items.results,pagination:{more:30*e.page<t.total_count}}},cache:!0},placeholder:"Buscar docentes",minimumInputLength:3})}},init:function(){this.terms.init(),this.courses.init(),this.teachers.init()}},i=function(){$("#search").doneTyping((function(){o.groups.reload()}))};return{init:function(){o.groups.init(),s.init(),i()}}}();$((function(){InitApp.init()}));