var InitApp=function(){var e={categories:{object:null,options:{ajax:{url:"/admin/tipos-portafolio/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(e){e.search=$("#search").val()}},columns:[{title:"Nombre",data:"name"},{title:"Tipo",data:"typeName"},{title:"Dependencia",data:"dependency"},{title:"¿Puede subirlo el estudiante?",data:null,render:function(e){var t="";return t+=e.canUploadStudent?"Sí":"No"}},{title:"Opciones",data:null,render:function(e){return`<button type="button" data-object="${e.proto().encode()}" class="btn btn-info btn-sm m-btn m-btn--icon btn-edit" title="Editar"><i class="la la-edit"></i> Editar</button> <button class="btn btn-danger m-btn btn-sm m-btn--icon m-btn--icon-only btn-delete" data-id="${e.id}"><i class="la la-trash"></i></button>`}}]},init:function(){this.object=$("#data-table").DataTable(this.options),$("#data-table").on("click",".btn-edit",(function(e){var a=$(this).data("object");a=a.proto().decode(),t.edit.load(a)})),$("#data-table").on("click",".btn-delete",(function(e){var a=$(this).data("id");t.delete.load(a)}))},reload:function(){this.object.ajax.reload()}}},t={create:{object:$("#create-form").validate({submitHandler:function(a){mApp.block("#create-modal .modal-content"),$.ajax({url:$(a).attr("action"),type:"POST",data:$(a).serialize()}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.categories.reload(),t.create.clear(),$("#Type").val(null).trigger("change"),$("#eCanUploadStudent").prop("ckecked",!1)})).fail((function(e){null!==e.responseText&&""!==e.responseText?$("#create-alert-text").html(e.responseText):$("#create-alert-text").html(_app.constants.ajax.message.error),$("#create-alert").removeClass("m--hide").show()})).always((function(){mApp.unblock("#create-modal .modal-content")}))}}),clear:function(){this.object.resetForm(),$(".create-dependency-select").val(null).trigger("change"),$("#edit-form").find("[name='Type']").val(1).trigger("change")}},delete:{load:function(t){swal({title:"¿Está seguro?",text:"Se eliminará el tipo de portafolio seleccionado.",type:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar"}).then((function(a){a.value&&$.ajax({url:"/admin/tipos-portafolio/eliminar",type:"POST",data:{id:t},success:function(){e.categories.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error("Hay información relacionada al tipo",_app.constants.toastr.title.error)}})}))}},edit:{object:$("#edit-form").validate({submitHandler:function(a){mApp.block("#edit-modal .modal-content"),$.ajax({url:$(a).attr("action"),type:"POST",data:$(a).serialize()}).done((function(){$(".modal").modal("hide"),$(".m-alert").addClass("m--hide"),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),e.categories.reload(),t.edit.clear()})).fail((function(e){null!==e.responseText&&""!==e.responseText?$("#edit-alert-text").html(e.responseText):$("#edit-alert-text").html(_app.constants.ajax.message.error),$("#edit-alert").removeClass("m--hide").show()})).always((function(){mApp.unblock("#edit-modal .modal-content")}))}}),clear:function(){t.edit.object.resetForm(),$(".edit-dependency-select").val(null).trigger("change")},load:function(e){$("#edit-id").val(e.id),$("#eName").val(e.name),$("#eDependencyId").val(e.dependencyId).trigger("change"),e.canUploadStudent?$("#eCanUploadStudent").prop("checked",!0):$("#eCanUploadStudent").prop("checked",!1),$("#edit-modal").modal("show")}},init:function(){}},a={dependency:{init:function(){$.ajax({url:"/dependencias/todas".proto().parseURL()}).done((function(e){$(".create-dependency-select").select2({data:e.items,placeholder:"Seleccione una dependencia",dropdownParent:$("#create-modal"),allowClear:!0}),$(".edit-dependency-select").select2({data:e.items,placeholder:"Seleccione una dependencia",dropdownParent:$("#edit-modal"),allowClear:!0})}))}},type:{init:function(){$("#create-modal").find("[name='Type']").select2({dropdownParent:$("#create-modal"),placeholder:"Seleccione un tipo"})}},init:function(){this.type.init(),this.dependency.init()}},n=function(){$("#create-modal").on("hidden.bs.modal",(function(){t.create.clear(),$(".m-alert").addClass("m--hide")})),$("#edit-modal").on("hidden.bs.modal",(function(){t.edit.clear(),$(".m-alert").addClass("m--hide")}))};return{init:function(){e.categories.init(),a.init(),t.init(),n()}}}();$((function(){InitApp.init()}));