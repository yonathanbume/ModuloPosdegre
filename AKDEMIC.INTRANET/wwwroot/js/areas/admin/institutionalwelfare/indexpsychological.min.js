var PsicologyPage=function(){var t=$("#Id").val(),a=$("#DoctorView").val(),i=$("#CurrentPsychologicalDiagnostic").val(),e=null,o=null,n=null,s=null,l=null,r=null,c=null,d=null,m=null,u=[],p=[],h=[],b=[],_=[],f={data:{source:{read:{method:"GET",url:""}}},columns:[{field:"description",title:"Descripción",width:500},{field:"answer",title:"Respuesta",width:150,sortable:!1,filterable:!1,template:function(t){return 1==t.answer?'<span class="m-badge  m-badge--success m-badge--wide">Si</span>':'<span class="m-badge  m-badge--danger m-badge--wide">No</span>'}}]},g={data:{type:"local",source:u},columns:[{field:"description",title:"Descripción",width:700},{field:"datehistorical",title:"Fecha",width:100},{field:"options",title:"Opciones",width:200,template:function(t,a){var i="";return 1==t.editable?i+=`<button onclick="PsicologyPage.removeRow_consult_reason(${a})" type="button" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete"<span><i class="la la-trash"> </i> </span> Eliminar </span></span></button>`:i}}]},y={data:{type:"local",source:p},columns:[{field:"description",title:"Descripción",width:700},{field:"datehistorical",title:"Fecha",width:100},{field:"options",title:"Opciones",width:200,template:function(t,a){var i="";return 1==t.editable?i+=`<button onclick="PsicologyPage.removeRow_personal_history(${a})" type="button" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete"<span><i class="la la-trash"> </i> </span> Eliminar </span></span></button>`:i}}]},v={data:{type:"local",source:h},columns:[{field:"description",title:"Descripción",width:700},{field:"datehistorical",title:"Fecha",width:100},{field:"options",title:"Opciones",width:200,template:function(t,a){var i="";return 1==t.editable?i+=`<button onclick="PsicologyPage.removeRow_family_history(${a})" type="button" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete"<span><i class="la la-trash"> </i> </span> Eliminar </span></span></button>`:i}}]},w={data:{type:"local",source:b},columns:[{field:"description",title:"Descripción",width:700},{field:"datehistorical",title:"Fecha",width:100},{field:"options",title:"Opciones",width:200,template:function(t,a){var i="";return 1==t.editable?i+=`<button onclick="PsicologyPage.removeRow_observation(${a})" type="button" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete"<span><i class="la la-trash"> </i> </span> Eliminar </span></span></button>`:i}}]},D={data:{type:"local",source:_},columns:[{field:"description",title:"Descripción",width:300},{field:"datehistorical",title:"Fecha",width:100},{field:"options",title:"Opciones",width:200,template:function(t,a){var i="";return 1==t.editable?i+=`<button onclick="PsicologyPage.removeRow_diagnostic_impression(${a})" type="button" class="btn btn-danger btn-sm m-btn m-btn--icon btn-delete"<span><i class="la la-trash"> </i> </span> Eliminar </span></span></button>`:i}}]},R={data:{source:{read:{method:"GET",url:`/doctor/horario-citas/test-psicologico/${t}`.proto().parseURL()}}},columns:[{field:"name",title:"Descripción",width:300},{field:"options",title:"Opciones",width:250,sortable:!1,filterable:!1,template:function(t){var a="";return a+=`<button data-date="${t.date}" class="btn btn-primary btn-sm m-btn m-btn--icon btn-test-detail"<span><i class="la flaticon-eye"> </i> </span> Ver Detalle</span></span></button> `,a+=`  <button data-date="${t.date}" class="btn btn-primary btn-sm m-btn m-btn--icon btn-test-detail-points"<span><i class="la flaticon-eye"> </i> </span> Ver Puntuación</span></span></button> `}}]},S={data:{source:{read:{method:"GET",url:`/doctor/horario-citas/test-actual/${t}`.proto().parseURL()}}},columns:[{field:"name",title:"Descripción de la categoría",width:600},{field:"count",title:"Puntuación",width:100}]},F={data:{source:{read:{method:"GET",url:""}}},columns:[{field:"name",title:"Descripción de la categoría",width:600},{field:"count",title:"Puntuación",width:100}]},L={data:{source:{read:{type:"GET",url:`/admin/bienestar_institucional/diagnostico-historico/${t}/get`.proto().parseURL()}}},columns:[{field:"description",title:"Descripción",width:600},{field:"code",title:"Código",width:150},{field:"datehistorical",title:"Fecha",width:100}]},P=function(){e=$(".m-datatable_consult_reason").mDatatable(g)},k=function(){o=$(".m-datatable_personal_history").mDatatable(y)},G=function(){n=$(".m-datatable_family_history").mDatatable(v)},x=function(){s=$(".m-datatable_observations").mDatatable(w)},E=function(){l=$(".m-datatable_diagnostic_impressions").mDatatable(D)},T=function(){(r=$(".m-datatable_test_psicology").mDatatable(R)).on("click",".btn-test-detail",(function(a){a.preventDefault();var i=$(this).data("date");!function(t,a){$("#modal_test_psychologic_detail").modal("show"),$("#modal_test_psychologic_detail").on("shown.bs.modal",(function(i){null!==c&&(c.destroy(),c=null),$("#modal_test_psychologic_detail > div > div > div h5").html("Detalle del test psicológico "+a),f.data.source.read.url=`/doctor/horario-citas/test-psicologico-detalle?pid=${t}&date=${a}`.proto().parseURL(),(c=$(".m-datatable_test_psicology_detail").mDatatable(f)).adjustCellsWidth()}))}(t,i)})),r.on("click",".btn-test-detail-points",(function(a){a.preventDefault();var i=$(this).data("date");!function(t,a){$("#modal_test_psychologic_detail_point").modal("show"),$("#modal_test_psychologic_detail_point").on("shown.bs.modal",(function(i){null!==m&&(m.destroy(),m=null),F.data.source.read.url=`/doctor/horario-citas/test-psicologico-puntuacion-historica?pid=${t}&date=${a}`.proto().parseURL(),(m=$(".m-datatable_test_psicology_detail_point").mDatatable(F)).adjustCellsWidth()}))}(t,i)}))};return{load:function(){$.ajax({type:"GET",url:`/admin/bienestar_institucional/${t}/ficha_psicologica_motivo_consulta/get`.proto().parseURL(),success:function(t){u=t,g.data.source=u,P()}}),$.ajax({type:"GET",url:`/admin/bienestar_institucional/${t}/ficha_psicologica_antecedentes_personales/get`.proto().parseURL(),success:function(t){p=t,y.data.source=p,k()}}),$.ajax({type:"GET",url:`/admin/bienestar_institucional/${t}/ficha_psicologica_historia_familiar/get`.proto().parseURL(),success:function(t){h=t,v.data.source=h,G()}}),$.ajax({type:"GET",url:`/admin/bienestar_institucional/${t}/ficha_psicologica_observaciones/get`.proto().parseURL(),success:function(t){b=t,w.data.source=b,x()}}),$.ajax({type:"GET",url:`/admin/bienestar_institucional/${t}/ficha_psicologica_impresiones_diagnosticas/get`.proto().parseURL(),success:function(t){_=t,D.data.source=_,E()}}),$(".btn-1").on("click",(function(){$("#modal_consult_reason").modal("show")})),$(".btn-2").on("click",(function(t){t.preventDefault(),$("#modal_personal_history").modal("show")})),$(".btn-3").on("click",(function(t){t.preventDefault(),$("#modal_family_history").modal("show")})),$(".btn-4").on("click",(function(t){t.preventDefault(),$("#modal_observations").modal("show")})),$(".btn-5").on("click",(function(t){t.preventDefault(),$("#modal_diagnostic_impressions").modal("show")})),$("#IsRehabilitaded").bootstrapSwitch({onColor:"primary",offColor:"danger",onText:"SI",offText:"NO"}),consult_reasion_Form=$("#form_consult_reason").validate({submitHandler:function(){var t=$("textarea[name=Description]").val(),a=(new Date).toLocaleDateString("en-GB");u.push({description:t,datehistorical:a,editable:!0}),e.originalDataSet=u,e.reload(),$("#modal_consult_reason").modal("hide"),consult_reasion_Form.resetForm()}}),personal_history_Form=$("#form_personal_history").validate({submitHandler:function(){var t=$("#form_personal_history textarea[name=Description]").val(),a=(new Date).toLocaleDateString("en-GB");p.push({description:t,datehistorical:a,editable:!0}),o.originalDataSet=p,o.reload(),$("#modal_personal_history").modal("hide"),personal_history_Form.resetForm()}}),family_history_Form=$("#form_family_history").validate({submitHandler:function(){var t=$("#form_family_history textarea[name=Description]").val(),a=(new Date).toLocaleDateString("en-GB");h.push({description:t,datehistorical:a,editable:!0}),n.originalDataSet=h,n.reload(),$("#modal_family_history").modal("hide"),family_history_Form.resetForm()}}),observations_Form=$("#form_observations").validate({submitHandler:function(){var t=$("#form_observations textarea[name=Description]").val(),a=(new Date).toLocaleDateString("en-GB");b.push({description:t,datehistorical:a,editable:!0}),s.originalDataSet=b,s.reload(),$("#modal_observations").modal("hide"),observations_Form.resetForm()}}),diagnostic_impressions_Form=$("#form_diagnostic_impressions").validate({submitHandler:function(){var t=$("#form_diagnostic_impressions textarea[name=Description]").val(),a=(new Date).toLocaleDateString("en-GB");_.push({description:t,datehistorical:a,editable:!0}),l.originalDataSet=_,l.reload(),$("#modal_diagnostic_impressions").modal("hide"),diagnostic_impressions_Form.resetForm()}}),$(".m-datatable_historical_diagnostics").mDatatable(L),$.ajax({url:"/diagnostics-psicologicos/get".proto().parseURL()}).done((function(t){i==_app.constants.guid.empty?$("#select-historical-diagnostics").select2({data:t.items,placeholder:{id:"-1",text:" No tiene un diagnóstico actualizado",selected:"selected"}}).val(-1).trigger("change"):$("#select-historical-diagnostics").select2({data:t.items}).val(i).trigger("change")})),T(),null!==d&&(d.destroy(),d=null),d=$(".m-datatable_current_test").mDatatable(S),$(".btn-mc").on("click",(function(t){t.preventDefault(),$("#modal_consult_reason").modal("show")})),$(".btn-ap").on("click",(function(t){t.preventDefault(),$("#modal_personal_history").modal("show")})),$(".btn-hf").on("click",(function(t){t.preventDefault(),$("#modal_family_history").modal("show")})),$(".btn-oc").on("click",(function(t){t.preventDefault(),$("#modal_observations").modal("show")})),$(".btn-di").on("click",(function(t){t.preventDefault(),$("#modal_diagnostic_impressions").modal("show")})),$("#medical-form").validate({submitHandler:function(t,i){var e=[],o=[],n=[],s=[],l=[];$.each(u,(function(t,a){!1!==a.editable&&e.push(a)})),$.each(p,(function(t,a){!1!==a.editable&&o.push(a)})),$.each(h,(function(t,a){!1!==a.editable&&n.push(a)})),$.each(b,(function(t,a){!1!==a.editable&&s.push(a)})),$.each(_,(function(t,a){!1!==a.editable&&l.push(a)}));var r=e,c=o,d=n,m=s,f=l,g=JSON.stringify(r),y=JSON.stringify(c),v=JSON.stringify(d),w=JSON.stringify(m),D=JSON.stringify(f),R=$("#medical-form").serializeArray();R.push({name:"listmedicalconsultreason",value:r}),R.push({name:"listmedicalpersonalhistory",value:c}),R.push({name:"listmedicalfamilyhistory",value:d}),R.push({name:"listmedicalobservation",value:m}),R.push({name:"listmedicaldiagnosticimpression",value:f});var S=!1;!0===$("#IsRehabilitaded")[0].checked&&(S=!0),$.ajax({type:"POST",url:"/admin/bienestar_institucional/GuardarTodo".proto().parseURL(),data:{listmedicalconsultreason:g,listmedicalpersonalhistory:y,listmedicalfamilyhistory:v,listmedicalobservation:w,listmedicaldiagnosticimpression:D,Id:$("#Id").val(),medicalappointmet:$("#MedicalAppointmet").val(),doctorview:$("#DoctorView").val(),currenthistoricaldiagnostic:$("#select-historical-diagnostics").val(),isRehabilitaded:S},complete:function(){location.href="false"===a?"/admin/bienestar_institucional".proto().parseURL():"/doctor/horario-citas".proto().parseURL()}})}})},removeRow_consult_reason:function(t){u.splice(t,1),e.originalDataSet=u,e.reload()},removeRow_personal_history:function(t){p.splice(t,1),o.originalDataSet=p,o.reload()},removeRow_family_history:function(t){h.splice(t,1),n.originalDataSet=h,n.reload()},removeRow_observation:function(t){b.splice(t,1),s.originalDataSet=b,s.reload()},removeRow_diagnostic_impression:function(t){_.splice(t,1),l.originalDataSet=_,l.reload()}}}();$((function(){PsicologyPage.load()}));