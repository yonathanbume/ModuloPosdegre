var index=function(){var e={evaluations:{object:null,options:{ajax:{url:"/admin/evaluacion-extraordinaria/get-evaluaciones-extraordinarias",type:"GET",data:function(e){e.searchValue=$("#search").val(),e.type=$("#Type_filter").val()}},columns:[{title:"Código",data:"courseCode"},{title:"Curso",data:"courseName"},{title:"Escuela",data:"career"},{title:"Plan de Estudio",data:"curriculum"},{title:"Docente Presidente",data:"teacher"},{title:"Tipo",data:"type"},{title:"Opciones",data:null,render:function(e){var t="";return t+=`<a href="/admin/evaluacion-extraordinaria/detalles/${e.id}" title="Gestionar" class="btn btn-info m-btn m-btn--icon btn-sm m-btn--icon-only"><i class="la la-cog"></i></a>`,t+=`<button data-id="${e.id}" title="Editar" class="ml-1 btn btn-primary m-btn m-btn--icon btn-sm m-btn--icon-only btn-edit"><i class="la la-edit"></i></button>`,t+=`<button data-id="${e.id}" title="Eliminar" class="ml-1 btn btn-danger m-btn m-btn--icon btn-sm m-btn--icon-only btn-delete"><i class="la la-trash"></i></button>`}}]},events:{onDelete:function(){$("#datatable").on("click",".btn-delete",(function(){var t=$(this).data("id");swal({type:"warning",title:"Eliminará la evaluación seleccionada.",text:"¿Seguro que desea eliminarla?.",confirmButtonText:"Aceptar",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({type:"POST",url:`/admin/evaluacion-extraordinaria/eliminar-evaluacion-extraordinaria?id=${t}`}).done((function(t){e.evaluations.reload(),swal({type:"success",title:"Completado",text:"Evaluación eliminada con éxito.",confirmButtonText:"Aceptar"})})).fail((function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===e.status?"No hay respuesta del servidor":e.responseText})}))}))})}))},onEdit:function(){$("#datatable").on("click",".btn-edit",(function(){var e=$(this).data("id");t.evaluation.edit.events.show(e)}))},init:function(){this.onEdit(),this.onDelete()}},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#datatable").DataTable(this.options)}},init:function(){this.evaluations.init(),this.evaluations.events.init()}},t={evaluation:{add:{object:$("#add_evaluation_modal"),form:{object:$("#add_evaluation_form").validate({submitHandler:function(t,a){a.preventDefault();var n=new FormData(t);$("#add_evaluation_form").find("button[type='submit']").addClass("m-loader m-loader--right m-loader--light").attr("disabled",!0),$.ajax({url:"/admin/evaluacion-extraordinaria/agregar-evaluacion-extraordinaria",type:"POST",data:n,contentType:!1,processData:!1}).done((function(t){e.evaluations.reload(),$("#add_evaluation_modal").modal("hide"),swal({type:"success",title:"Hecho!",text:"Evaluación editada satisfactoriamente.",confirmButtonText:"Aceptar"}).then((function(e){e&&(window.location.href=`/admin/evaluacion-extraordinaria/detalles/${t}`)}))})).fail((function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===e.status?"No hay respuesta del servidor":e.responseText})})).always((function(){$("#add_evaluation_form").find("button[type='submit']").removeClass("m-loader m-loader--right m-loader--light").attr("disabled",!1)}))}})},events:{onHidden:function(){t.evaluation.add.object.on("hidden.bs.modal",(function(e){t.evaluation.add.form.object.resetForm(),a.courses.clear(),a.teacher.clear(),a.career.clear(),t.evaluation.add.object.find("[name='ResolutionFile']").val(null),t.evaluation.add.object.find(".custom-file-label").text("Seleccionar archivo"),a.type.clear(t.evaluation.add.object),a.curriculum.clear()}))},init:function(){this.onHidden()}},init:function(){this.events.init()}},edit:{object:$("#edit_evaluation_modal"),form:{object:$("#edit_evaluation_form").validate({submitHandler:function(a,n){n.preventDefault();var i=new FormData(a);$("#edit_evaluation_form").find("button[type='submit']").addClass("m-loader m-loader--right m-loader--light").attr("disabled",!0),$.ajax({url:"/admin/evaluacion-extraordinaria/editar-evaluacion-extraordinaria",type:"POST",data:i,contentType:!1,processData:!1}).done((function(a){e.evaluations.reload(),t.evaluation.edit.object.modal("hide"),swal({type:"success",title:"Hecho!",text:"Evaluación agregada satisfactoriamente.",confirmButtonText:"Aceptar"})})).fail((function(e){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===e.status?"No hay respuesta del servidor":e.responseText})})).always((function(){$("#edit_evaluation_form").find("button[type='submit']").removeClass("m-loader m-loader--right m-loader--light").attr("disabled",!1)}))}})},events:{show:function(e){t.evaluation.edit.object.modal("show"),t.evaluation.edit.object.find(":input").attr("disabled",!0),$.ajax({url:`/admin/evaluacion-extraordinaria/get-evaluacion-extraordinaria?id=${e}`}).done((function(e){$("#edit_file_url").addClass("d-none"),t.evaluation.edit.object.find("[name='Id']").val(e.id),t.evaluation.edit.object.find("[name='Course']").val(e.course),null!=e.teacherId?a.teacher.setValue(t.evaluation.edit.object.find("[name='TeacherId']"),e.teacher,e.teacherId):t.evaluation.edit.object.find("[name='TeacherId']").val(null).trigger("change"),a.teacher.setValues(t.evaluation.edit.object.find("[name='Committee']"),e.committee),t.evaluation.edit.object.find("[name='Resolution']").val(e.resolution),t.evaluation.edit.object.find(":input").attr("disabled",!1),t.evaluation.edit.object.find("[name='Type']").val(e.type).trigger("change"),null!==e.resolutionFileUrl&&void 0!==e.resolutionFileUrl&&($("#edit_file_url").removeClass("d-none"),t.evaluation.edit.object.find("[name='FileUrl']").attr("href",`/documentos/${e.resolutionFileUrl}`))}))},onHidden:function(){t.evaluation.edit.object.on("hidden.bs.modal",(function(e){t.evaluation.edit.form.object.resetForm(),t.evaluation.edit.object.find("[name='ResolutionFile']").val(null),t.evaluation.edit.object.find(".custom-file-label").text("Seleccionar archivo")}))},init:function(){this.onHidden()}},init:function(){this.events.init()}}},init:function(){this.evaluation.add.init(),this.evaluation.edit.init()}},a={courses:{load:function(e){t.evaluation.add.object.find("[name='CourseId']").empty(),null===e?t.evaluation.add.object.find("[name='CourseId']").select2({placeholder:"Seleccionar curso",dropdownParent:$("#add_evaluation_form")}).trigger("change"):$.ajax({url:`/curriculum/${e}/cursos/get`,type:"get"}).done((function(e){t.evaluation.add.object.find("[name='CourseId']").select2({data:e.items,placeholder:"Seleccionar curso",dropdownParent:$("#add_evaluation_form")}).trigger("change")}))},clear:function(){t.evaluation.add.object.find("[name='CourseId']").val(null).trigger("change")},init:function(){t.evaluation.add.object.find("[name='CourseId']").select2({placeholder:"Seleccionar cursos",dropdownParent:$("#add_evaluation_form")})}},teacher:{load:function(){t.evaluation.add.object.find("[name='TeacherId']").select2({ajax:{delay:300,url:"/profesores/get".proto().parseURL(),processResults:function(e){return{results:e.items.results,pagination:e.items.pagination}},cache:!0},allowClear:!0,minimumInputLength:2,placeholder:"Seleccione profesor",dropdownParent:$("#add_evaluation_form")}),t.evaluation.add.object.find("[name='Committee']").select2({ajax:{delay:300,url:"/profesores/get".proto().parseURL(),processResults:function(e){return{results:e.items.results,pagination:e.items.pagination}},cache:!0},allowClear:!0,minimumInputLength:1,placeholder:"Seleccione el comité",dropdownParent:$("#add_evaluation_form")}),t.evaluation.edit.object.find("[name='TeacherId']").select2({ajax:{delay:300,url:"/profesores/get".proto().parseURL(),processResults:function(e){return{results:e.items.results,pagination:e.items.pagination}},cache:!0},allowClear:!0,minimumInputLength:2,placeholder:"Seleccione profesor",dropdownParent:$("#edit_evaluation_form")}),t.evaluation.edit.object.find("[name='Committee']").select2({ajax:{delay:300,url:"/profesores/get".proto().parseURL(),processResults:function(e){return{results:e.items.results,pagination:e.items.pagination}},cache:!0},allowClear:!0,minimumInputLength:1,placeholder:"Seleccione el comité",dropdownParent:$("#edit_evaluation_form")})},setValue:function(e,t,a){if(e.find("option[value='"+a+"']").length)e.val(a).trigger("change");else{var n=new Option(t,a,!0,!0);e.append(n).trigger("change")}},setValues:function(e,t){var a=[];$.each(t,(function(t,n){if(!e.find("option[value='"+n.id+"']").length){var i=new Option(n.text,n.id);e.append(i)}a.push(n.id)})),e.val(a).trigger("change")},clear:function(){t.evaluation.add.object.find("[name='TeachersCommitee']").val(null).trigger("change"),t.evaluation.add.object.find("[name='TeacherId']").val(null).trigger("change")},init:function(){a.teacher.load()}},career:{load:function(){$.ajax({url:"/carreras/v3/get".proto().parseURL(),type:"get"}).done((function(e){t.evaluation.add.object.find("[name='CareerId']").select2({data:e.items,allowClear:!0,placeholder:"Seleccionar Escuela",dropdownParent:$("#add_evaluation_form")}).trigger("change")}))},events:{onChange:function(){t.evaluation.add.object.find("[name='CareerId']").on("change",(function(){var e=$(this).val();a.curriculum.load(e)}))},init:function(){this.onChange()}},clear:function(){t.evaluation.add.object.find("[name='CareerId']").val(null).trigger("change")},init:function(){a.career.load(),a.career.events.init()}},curriculum:{load:function(e){t.evaluation.add.object.find("[name='CurriculumId']").empty(),null===e?t.evaluation.add.object.find("[name='CurriculumId']").select2({placeholder:"Seleccionar plan de estudio",dropdownParent:$("#add_evaluation_form")}).trigger("change"):$.ajax({url:`/carreras/${e}/planestudio/get`,type:"get"}).done((function(e){t.evaluation.add.object.find("[name='CurriculumId']").select2({data:e.items,placeholder:"Seleccionar plan de estudio",dropdownParent:$("#add_evaluation_form")}).trigger("change")}))},clear:function(){t.evaluation.add.object.find("[name='CurriculumId']").empty(),t.evaluation.add.object.find("[name='CurriculumId']").select2({placeholder:"Seleccionar plan de estudio",dropdownParent:$("#add_evaluation_form")})},events:{onChange:function(){t.evaluation.add.object.find("[name='CurriculumId']").on("change",(function(){var e=$(this).val();a.courses.load(e)}))},init:function(){this.onChange()}},init:function(){t.evaluation.add.object.find("[name='CurriculumId']").select2({placeholder:"Seleccionar plan de estudio"}),this.events.init()}},type:{load:function(){$("[name='Type']").select2({minimumResultsForSearch:-1,placeholder:"Seleccionar tipo"}),$("#add_evaluation_modal").find("[name='Type']").on("change",(function(){var e=$(this).val();"1"==e||null==e?($(".add_select_teacherId").text("Seleccione el Profesor Presidente"),$(".add_select_committee").text("Seleccione el comité")):($(".add_select_teacherId").text("Seleccione el Profesor Principal"),$(".add_select_committee").text("Seleccione profesores complementarios"))})),$("#Type_filter").select2({minimumResultsForSearch:-1,placeholder:"Seleccionar tipo"})},clear:function(e){e.find("[name='Type']").val(null).trigger("change")},events:{onChange:function(){$("#Type_filter").on("change",(function(){e.evaluations.reload()}))},init:function(){this.onChange()}},init:function(){this.load(),this.events.init()}},init:function(){this.career.init(),this.curriculum.init(),this.teacher.init(),this.courses.init(),this.type.init()}},n={onSearch:function(){$("#search").doneTyping((function(){e.evaluations.reload()}))},init:function(){this.onSearch()}};return{init:function(){e.init(),a.init(),t.init(),n.init()}}}();$((()=>{index.init()}));