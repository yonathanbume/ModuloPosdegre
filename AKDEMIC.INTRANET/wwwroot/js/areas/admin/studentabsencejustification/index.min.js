var InitApp=function(){const t={1:{title:"Solicitado",class:" m-badge--metal"},2:{title:"Visto docente",class:" m-badge--info"},3:{title:"Observada",class:" m-badge--warning"},4:{title:"Aprobada",class:" m-badge--success"},5:{title:"Rechazada",class:" m-badge--danger"}};var a={justifications:{object:null,options:{ajax:{url:"/admin/justificacion-inasistencias/alumnos/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){delete t.columns,t.search=$("#search").val(),t.status=$("#state-select").val(),t.termId=$("#select_term").val()}},columns:[{title:"F. Solicitud",data:"date"},{title:"Código",data:"code"},{title:"Estudiante",data:"name"},{title:"Curso",data:"course"},{title:"Estado",data:"status",className:"text-center",render:function(a){return'<span class="m-badge '+t[a].class+' m-badge--wide">'+t[a].title+"</span>"}},{title:"Opciones",data:null,orderable:!1,render:function(t){var a="";return a=`<button class="btn btn-default m-btn btn-sm m-btn--icon m-btn--icon-only btn-detail" data-object="${t.proto().encode()}" title="Ver detalle"><i class="la la-eye"></i></button>`,2!=t.status&&3!=t.status||(a+=' <button class="btn btn-success m-btn btn-sm m-btn--icon m-btn--icon-only approve" data-id="'+t.id+'" title="Aprobar"><i class="la la-check"></i></button>',a+=' <button class="btn btn-danger m-btn btn-sm m-btn--icon m-btn--icon-only disapprove" data-id="'+t.id+'" title="Rechazar"><i class="la la-remove"></i></button>'),a}}]},init:function(){this.object=$("#data-table").DataTable(this.options),$("#data-table").on("click",".btn-detail",(function(a){var e=$(this).data("object");e=e.proto().decode(),$("#detail-student").val(e.name),$("#detail-teacher").val(e.teacher),$("#detail-course").val(e.course),$("#detail-class").val(`Clase dictada el ${e.classDate}`),$("#detail-date").val(e.date),$("#detail-status").val(t[e.status].title),$("#detail-description").val(e.description),null!=e.observation&&""!=e.observation?($("#teacher-observation").show(),$("#detail-observation").val(e.observation)):$("#teacher-observation").hide(),e.file?($("#fileDiv").show(),$("#file-url").attr("href",`/admin/justificacion-inasistencias/alumnos/${e.id}/archivo/descargar`.proto().parseURL())):$("#fileDiv").hide(),$("#detail_modal").modal("toggle")})),$("#data-table").on("click",".approve",(function(){var t=$(this).data("id");e.approve.load(t)})),$("#data-table").on("click",".disapprove",(function(){var t=$(this).data("id");e.disapprove.load(t)}))},reload:function(){this.object.ajax.reload()}}},e={approve:{load:function(t){swal({title:"¿Está seguro?",text:"La solicitud será aprobada",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, continuar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((e=>{$.ajax({url:"/admin/justificacion-inasistencias/alumnos/post",type:"POST",data:{id:t,approved:!0},success:function(){a.justifications.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)},complete:function(){swal.close()}})}))})}},disapprove:{load:function(t){swal({title:"¿Está seguro?",text:"La solicitud será desaprobada",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, continuar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((e=>{$.ajax({url:"/admin/justificacion-inasistencias/alumnos/post",type:"POST",data:{id:t,approved:!1},success:function(){a.justifications.reload(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)},complete:function(){swal.close()}})}))})}}},s=function(){$("#search").doneTyping((function(){a.justifications.reload()}))},n={term:{init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(t){$("#select_term").select2({data:t.items}),$("#select_term").on("change",(function(){null!==$("#select_term").val()&&a.justifications.reload()}))})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}},states:{init:function(){$("#state-select").select2(),$("#state-select").on("change",(function(){a.justifications.reload()}))}},init:function(){n.term.init(),n.states.init()}};return{init:function(){a.justifications.init(),s(),n.init()}}}();$((function(){InitApp.init()}));