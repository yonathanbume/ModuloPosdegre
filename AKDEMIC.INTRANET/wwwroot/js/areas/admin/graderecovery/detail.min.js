var detail=function(){var t=$("#GradeRecoveryExamId").val(),e=[],a={students:{object:null,options:{pageLength:5,serverSide:!1,ajax:{url:`/admin/recuperacion-notas/get-estudiantes/${t}`,method:"GET",dataSrc:""},columns:[{data:"userName",title:"Código"},{data:"fullName",title:"Estudiante"},{data:"finalGrade",title:"Nota Final"},{data:null,title:"Asignar",render:function(t){var a="",n=t.isAssigned?"checked":"";return n&&(e.includes(t.id)||e.push(t.id)),a+=`<span class="m-switch m-switch--outline m-switch--icon m-switch--primary">\n                                <label>\n                                    <input type="checkbox" ${n} class="students_check" data-id="${t.id}">\n                                    <span></span>\n                                </label>\n                            </span>`}}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#students_table").DataTable(this.options)}},assignedStudents:{object:null,options:{ajax:{url:`/admin/recuperacion-notas/get-estudiantes-asignados/${t}`,method:"GET",data:function(t){t.searchValue=$("#search").val()}},columns:[{data:"userName",title:"Usuario"},{data:"fullName",title:"Estudiante"},{data:"minGrade",title:"Nota a Reemplazar"},{data:"evaluation",title:"Evaluación"}]},reload:function(){this.object.ajax.reload()},init:function(){this.object=$("#assigned_students").DataTable(this.options)}},studentsExecuted:{object:null,options:{ajax:{url:"/admin/recuperacion-notas/get-estudiantes-asignados-examen-concluido",data:function(e){e.gradeRecoveryExamId=t},method:"GET",dataSrc:""},bPaginate:!1,bLengthChange:!1,bFilter:!0,bInfo:!1,columns:[{data:"userName",title:"Usuario"},{data:"fullName",title:"Estudiante"},{data:"prevFinalScore",title:"Nota Reemplazada"},{data:"evaluation",title:"Evaluación"},{data:"examScore",title:"Nota Obtenida"}]},init:function(){this.object=$("#assigned_students_executed").DataTable(this.options)}},init:function(){this.students.init(),this.studentsExecuted.init(),this.assignedStudents.init()}},n={onChangeStudentStatus:function(){$("#students_table").on("click",".students_check",(function(){$(this).attr("disabled",!0);var t=$(this).data("id");if($(this).is(":checked"))e.includes(t)||e.push(t);else{var a=e.indexOf(t);a>-1&&e.splice(a,1)}$(this).attr("disabled",!1)}))},onAssignStudents:function(){$("#assign_students_button").on("click",(function(){var n=$(this);n.addClass("m-loader m-loader--right m-loader--light").attr("disabled",!0);var i=new FormData;i.append("GradeRecoveryExamId",t);for(var s=0;s<e.length;s++)i.append(`Students[${s}]`,e[s]);$.ajax({url:"/admin/recuperacion-notas/asignar-estudiantes",type:"POST",data:i,contentType:!1,processData:!1}).done((function(t){a.students.reload(),a.assignedStudents.reload(),swal({type:"success",title:"Hecho!",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:"Estudiantes asignados satisfactoriamente."})})).fail((function(t){n.removeClass("m-loader m-loader--right m-loader--light").attr("disabled",!1),swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===t.status?"No hay respuesta del servidor":t.responseText})})).always((function(){n.removeClass("m-loader m-loader--right m-loader--light").attr("disabled",!1),$("#assigned_students_modal").modal("hide")}))}))},onConfirmExam:function(){$("#confirm_exam").on("click",(function(){var e=$(this);swal({title:"¿Seguro que desea confirmar el exámen?",text:"Ya no se podrá asignar o remover estudiantes",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, confirmar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((a=>{$.ajax({url:`/admin/recuperacion-notas/confirmar-examen?gradeRecoveryExamId=${t}`,type:"POST"}).done((function(){window.location.reload()})).fail((function(t){e.removeClass("m-loader m-loader--right m-loader--light").attr("disabled",!1),swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Aceptar",text:502===t.status?"No hay respuesta del servidor":t.responseText})}))}))})}))},onSearch:function(){$("#search").doneTyping((function(){a.assignedStudents.reload()}))},init:function(){this.onSearch(),this.onAssignStudents(),this.onChangeStudentStatus(),this.onConfirmExam()}};return{init:function(){a.init(),n.init()}}}();$((()=>{detail.init()}));