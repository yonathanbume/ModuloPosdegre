var index=function(){var t={student:{object:null,options:{ajax:{url:"/admin/actualizar-nota-estudiante/get-courses-datatable",type:"GET",data:function(t){t.termId=$("#term_select").val(),t.studentId=$("#student_select").val(),t.type=$("#academic_history_type").val()}},columns:[{data:"courseCode",title:" Código"},{data:"courseName",title:"Curso"},{data:"section",title:"Sección"},{data:"grade",title:"Nota"},{data:null,title:"Opciones",render:function(t){var e="";return t.isRegular?e+=`<button data-id="${t.id}" class="btn btn-view-grades btn-sm btn-primary m-btn m-btn--custom m-btn--icon"><span><i class="la la-eye"></i><span>Ver Notas</span></span></button>`:e+=`<button data-id="${t.id}" data-grade="${t.grade}" data-course="${t.courseCode}-${t.courseName}" class="btn btn-history btn-sm btn-primary m-btn m-btn--custom m-btn--icon"><span><i class="la la-edit"></i><span>Editar nota</span></span></button>`,e}}]},reload:function(){null==t.student.object?t.student.object=$("#datatable_courses").DataTable(t.student.options):t.student.object.ajax.reload()},events:{onViewGrades:function(){$("#datatable_courses").on("click",".btn-view-grades",(function(){var t=$(this).data("id");n.viewGrades.events.show(t)}))},onViewHistory:function(){$("#datatable_courses").on("click",".btn-history",(function(){var t=$(this).data("id"),e=$(this).data("grade"),a=$(this).data("course");n.viewHistory.events.show(t,e,a)}))},init:function(){this.onViewGrades(),this.onViewHistory()}},init:function(){this.events.init()}},grades:{object:null,options:{ajax:{url:"/admin/actualizar-nota-estudiante/get-notas-datatable",type:"GET",data:function(t){t.academicHistoryId=$("#Current_Grades_AcademicHistoryId").val()}},columns:[{data:"name",title:" Evaluación"},{data:"value",title:"Nota"},{data:null,title:"Opciones",render:function(t){var e="";return e+=`<button type="button" data-id="${t.id}" data-fullname="${t.fullName}" data-evaluation="${t.name}-${t.value}" class="btn-show-form btn btn-sm btn-primary m-btn m-btn--custom m-btn--icon"><span><i class="la la-edit"></i><span>Modificar</span></span></button>`}}]},events:{onShowForm:function(){$("#datatable_grades").on("click",".btn-show-form",(function(){var t=$(this).data("fullname"),e=$(this).data("evaluation"),a=$(this).data("id");n.viewGrades.events.showForm(a,t,e)}))},init:function(){this.onShowForm()}},reload:function(){null==t.grades.object?t.grades.object=$("#datatable_grades").DataTable(t.grades.options):t.grades.object.ajax.reload()},init:function(){this.events.init()}},init:function(){t.student.init(),t.grades.init()}},e={term:{init:function(){$.ajax({url:"/periodos/get"}).done((function(t){$("#term_select").select2({data:t.items,placeholder:"Seleccionar periodo académico"}),null!=t.selected&&$("#term_select").val(t.selected).trigger("change")}))}},student:{init:function(){$("#student_select").select2({width:"100%",placeholder:"Buscar...",ajax:{url:"/academico/alumnos/buscar".proto().parseURL(),dataType:"json",data:function(t){return{term:t.term,page:t.page}},processResults:function(t,e){return{results:t.items}},cache:!0},escapeMarkup:function(t){return t},minimumInputLength:3})}},academic_history_type:{init:function(){$("#academic_history_type").select2({minimumResultsForSearch:-1})}},init:function(){e.term.init(),e.student.init(),e.academic_history_type.init()}},a={onSearch:function(){$("#btn_search").click((function(){t.student.reload()}))},init:function(){this.onSearch()}},n={viewGrades:{form:{object:$("#form_grade").validate({submitHandler:function(e,a){a.preventDefault();var i=new FormData(e);$(".btn-submit-grades").addLoader(),$.ajax({url:"/admin/actualizar-nota-estudiante/actualizar-nota-estudiante",method:"POST",data:i,contentType:!1,processData:!1}).done((function(e){n.viewGrades.object.modal("hide"),t.grades.reload(),t.student.reload(),swal({type:"success",title:"Completado",text:"Nota actualizada con éxito",confirmButtonText:"Excelente"})})).fail((function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:502===t.status?"No hay respuesta del servidor":t.responseText})})).always((function(){$(".btn-submit-grades").removeLoader()}))}})},object:$("#modal_grades"),events:{show:function(e){$("#Current_Grades_AcademicHistoryId").val(e),t.grades.reload(),n.viewGrades.object.modal("show")},showForm:function(t,e,a){$("#container_form_grades_academicHistory").removeClass("d-none"),$("#container_datatable_grades").addClass("d-none"),$("#form_grade").find("[name='StudentFUllName']").val(e),$("#form_grade").find("[name='Evaluation']").val(a),$("#form_grade").find("[name='Id']").val(t)},onHidden:function(){n.viewGrades.object.on("hidden.bs.modal",(function(t){$("#container_form_grades_academicHistory").addClass("d-none"),$("#container_datatable_grades").removeClass("d-none"),n.viewGrades.form.object.resetForm(),$("#form_grade").find("[name='Resolution']").val(null).trigger("change"),$(".custom-file-label").text("Seleccione un archivo")}))},init:function(){this.onHidden()}},init:function(){n.viewGrades.events.init()}},viewHistory:{object:$("#modal_history"),form:{object:$("#form_history").validate({submitHandler:function(e,a){a.preventDefault();var i=new FormData(e);$(".btn-submit-history").addLoader(),$.ajax({url:"/admin/actualizar-nota-estudiante/actualizar-historial-academico",method:"POST",data:i,contentType:!1,processData:!1}).done((function(e){n.viewHistory.object.modal("hide"),t.student.reload(),swal({type:"success",title:"Completado",text:"Nota actualizada con éxito",confirmButtonText:"Excelente"})})).fail((function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:502===t.status?"No hay respuesta del servidor":t.responseText})})).always((function(){$(".btn-submit-history").removeLoader()}))}})},events:{show:function(t,e,a){n.viewHistory.object.modal("show"),n.viewHistory.object.find("[name='AcademicHistoryId']").val(t),n.viewHistory.object.find("[name='Course']").val(a),n.viewHistory.object.find("[name='OldGrade']").val(e)},onHidden:function(){n.viewHistory.object.on("hidden.bs.modal",(function(t){n.viewHistory.form.object.resetForm(),$("#form_history").find("[name='Resolution']").val(null).trigger("change"),$(".custom-file-label").text("Seleccione un archivo")}))},init:function(){this.onHidden()}},init:function(){n.viewHistory.events.init()}},init:function(){n.viewGrades.init(),n.viewHistory.init()}};return{init:function(){e.init(),a.init(),n.init(),t.init()}}}();$((()=>{index.init()}));