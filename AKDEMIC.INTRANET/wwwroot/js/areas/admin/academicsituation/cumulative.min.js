var AcademicSituation=function(){var e={init:function(){this.terms.init(),this.faculties.init(),this.careers.init(),this.orders.init()},terms:{init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(e){$(".select2-terms").select2({data:e.items}),null!==e.selected&&$(".select2-terms").val(e.selected).trigger("change"),t.students.init(),$(".select2-terms").on("change",(function(e){t.students.reload()}))}))}},faculties:{init:function(){$.ajax({url:"/facultades/get"}).done((function(a){a.items.unshift({id:_app.constants.guid.empty,text:"Todas"}),$(".select2-faculties").select2({data:a.items}),$(".select2-faculties").on("change",(function(){var a=$(".select2-faculties").val();a===_app.constants.guid.empty?($(".select2-careers").empty(),$(".select2-careers").select2({placeholder:"Seleccione una facultad",disabled:!0})):e.careers.load(a),t.students.reload()}))}))}},careers:{init:function(){$(".select2-careers").select2({placeholder:"Seleccione una facultad",disabled:!0}),$(".select2-careers").on("change",(function(){t.students.reload()}))},load:function(e){$(".select2-careers").empty(),$.ajax({url:`/carreras/get?fid=${e}`.proto().parseURL()}).done((function(e){e.items.unshift({id:_app.constants.guid.empty,text:"Todas"}),$(".select2-careers").select2({data:e.items,placeholder:"Seleccione una carrera",disabled:!1})}))}},orders:{init:function(){$(".select2-orders").select2().on("change",(function(){t.students.reload()}))}}},t={students:{object:null,options:{ajax:{url:"/admin/situacion-academica/acumulado/get".proto().parseURL(),data:function(e){e.fid=$(".select2-faculties").val(),e.cid=$(".select2-careers").val(),e.tid=$(".select2-terms").val(),e.academicOrder=$(".select2-orders").val(),e.searchValue=$("#search").val()}},order:[[3,"asc"]],columns:[{title:"Código",data:"code",width:"100px"},{title:"Estudiante",data:"name"},{title:"Escuela Profesional",data:"career",width:"250px"},{title:"Orden de Mérito",data:"order",width:"120px"},{title:"PPA",data:"grade",width:"80px"},{title:"Clasificación",data:null,width:"120px",render:function(e,t,a){if(null!==a.meritType&&a.meritType>1){var c={0:{text:_app.constants.academicOrder.none.text,value:_app.constants.academicOrder.none.value,class:"m-badge--info"},1:{text:_app.constants.academicOrder.none.text,value:_app.constants.academicOrder.none.value,class:"m-badge--info"},2:{text:_app.constants.academicOrder.upperThird.text,value:_app.constants.academicOrder.upperThird.value,class:"m-badge--metal"},3:{text:_app.constants.academicOrder.upperFifth.text,value:_app.constants.academicOrder.upperFifth.value,class:"m-badge--accent"},4:{text:_app.constants.academicOrder.upperTenth.text,value:_app.constants.academicOrder.upperTenth.value,class:"m-badge--focus"},5:{text:_app.constants.academicOrder.upperHalf.text,value:_app.constants.academicOrder.upperHalf.value,class:"m-badge--warning"}};return"<span class='m-badge "+c[a.meritType].class+" m-badge--wide'>"+c[a.meritType].text+"</span>"}return"Ninguno"}},{title:"Créditos Aprob.",width:"120px",data:"approvedCredits"}]},init:function(){this.object=$(".students-datatable").DataTable(this.options)},reload:function(){this.object.ajax.reload()}}},a={onDownloadExcel:function(){$("#download_excel").on("click",(function(){var e=`/admin/situacion-academica/reporte-excel?termId=${$(".select2-terms").val()}&facultyId=${$(".select2-faculties").val()}&careerId=${$(".select2-careers").val()}&academicOrder=${$(".select2-orders").val()}`,t=$(this);t.addLoader(),$.fileDownload(e,{httpMethod:"GET",successCallback:function(){t.removeLoader(),toastr.success("Archivo descargado satisfactoriamente","Éxito")}})}))},init:function(){this.onDownloadExcel()}},c=function(){$("#search").doneTyping((function(){t.students.reload()}))};return{init:function(){e.init(),c(),a.init()}}}();$((function(){AcademicSituation.init()}));