var UniversityAuthorityManagement=function(){var t={objects:{}},e=function(){$("#search").doneTyping((function(){t.objects["tbl-data"].draw()})),$("#add-user-select2").select2({placeholder:"Buscar...",dropdownParent:$("#AddAuthorityModal"),ajax:{url:"/admin/gestion-de-autoridades/usuarios/get".proto().parseURL(),dataType:"json",data:function(t){return{term:t.term}},processResults:function(t,e){return{results:t.items}},cache:!0},minimumInputLength:3}),$("#edit-user-select2").select2({placeholder:"Buscar...",dropdownParent:$("#EditAuthorityModal"),ajax:{url:"/admin/gestion-de-autoridades/usuarios/get".proto().parseURL(),dataType:"json",data:function(t){return{term:t.term}},processResults:function(t,e){return{results:t.items}},cache:!0},minimumInputLength:3}),$("#ResolutionDateAdd, #ResolutionDateEdit").datepicker({format:_app.constants.formats.datepicker}),$("#ResolutionFile").on("change",(function(t){$(this).valid(),$(this).next(".custom-file-label").html(t.target.files[0].name)}))},a={ajax:{type:"GET",dataType:"JSON",url:"/admin/gestion-de-autoridades/obtener-autoridades".proto().parseURL(),data:function(t){t.searchValue=$("#search").val()}},columns:[{data:"name",title:"Nombres Completos"},{data:"type",title:"Tipo"},{data:null,title:"Opciones",render:function(t,e,a,o){return`<button data-id="${t.id}" class="btn btn-success btn-sm m-btn m-btn--icon btn-history" title="Historial de Autoridad"><span><i class="la la-history"></i><span>Historial</span></span></button>\n                            <button data-toggle="modal" data-target="#EditAuthorityModal" data-id="${t.id}" class="btn btn-sm btn-info edit"> <i class= "fa fa-edit"></i> </button>\n                            <button data-id="${t.id}" class="btn btn-sm btn-danger delete"> <i class="fa fa-trash"></i> </button>`}}]},o=function(){$("#add-university-authority-form").validate({submitHandler:function(e){var a=$(e).find('button[type="submit"]');a.addLoader();var o=new FormData($("#add-university-authority-form")[0]);o.append("File.File",$("#FileAdd")[0].files[0]),$.ajax({type:"POST",url:"/admin/gestion-de-autoridades/guardar-autoridad".proto().parseURL(),data:o,processData:!1,contentType:!1,success:function(){$("#AddAuthorityModal").modal("hide"),t.objects["tbl-data"].draw(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),$("#add-university-authority-form")[0].reset()},error:function(t){toastr.error(t.responseText,_app.constants.toastr.title.error)},complete:function(){a.removeLoader()}})}})},n=function(){$("#edit-university-authority-form").validate({submitHandler:function(e){var a=$(e).find('button[type="submit"]');a.addLoader();var o=new FormData($("#edit-university-authority-form")[0]);o.append("File.File",$("#FileEdit")[0].files[0]),$.ajax({type:"POST",url:"/admin/gestion-de-autoridades/editar-autoridad".proto().parseURL(),data:o,processData:!1,contentType:!1,success:function(){$("#EditAuthorityModal").modal("hide"),t.objects["tbl-data"].draw(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success),$("#edit-university-authority-form")[0].reset()},error:function(t){toastr.error(t.responseText,_app.constants.toastr.title.error)},complete:function(){a.removeLoader()}})}})},i={load:function(t){$("#history_modal").modal("toggle");var e=`/admin/gestion-de-autoridades/historial?id=${t}`.proto().parseURL(),a=i.options;a.ajax.url=e,null!=i.object&&i.object.destroy(),i.object=$("#history_table").DataTable(a)},object:null,options:{serverSide:!1,filter:!1,lengthChange:!1,paging:!1,ajax:{url:"/admin/gestion-de-autoridades?id={id}".proto().parseURL(),type:"GET"},columns:[{data:"date",title:"Fecha"},{data:"name",title:"Nombres Completos"},{data:"type",title:"Tipo"},{data:null,title:"Opciones",render:function(t,e,a,o){return`<a href="/file/${t.fileUrl}" class="btn btn-sm btn-primary"> <i class="la la-download"></i> </a>`}}]}},r=function(){t.objects["tbl-data"].on("click",".btn-history",(function(){var t=$(this).data("id");i.load(t)})),t.objects["tbl-data"].on("click",".edit",(function(){var t=$(this).data("id");$.ajax({url:`/admin/gestion-de-autoridades/obtener-autoridad/${t}`.proto().parseURL(),type:"GET",contentType:"application/json",success:function(t){var e=new Option(t.fullName,t.userId,!0,!0);$("#edit-user-select2").append(e).trigger("change"),$("#edit-university-authority-form select[name='Type']").val(t.type).trigger("change"),$("#edit-university-authority-form input[name='Id']").val(t.id)}})})),t.objects["tbl-data"].on("click",".delete",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",text:"El registro será eliminado permanentemente",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarlo",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:()=>new Promise((a=>{$.ajax({url:`/admin/gestion-de-autoridades/eliminar/${e}`.proto().parseURL(),type:"POST",data:{id:e},success:function(e){swal({type:"success",title:"Completado",text:"El registro ha sido eliminado con éxito",confirmButtonText:"Excelente"}).then(t.objects["tbl-data"].draw())},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"El registro presenta información relacionada"})}})})),allowOutsideClick:()=>!swal.isLoading()})}))},s=function(){t.objects["tbl-data"]=$("#tbl-data").DataTable(a),r()};return{init:function(){s(),e(),o(),n()}}}();$((function(){UniversityAuthorityManagement.init()}));