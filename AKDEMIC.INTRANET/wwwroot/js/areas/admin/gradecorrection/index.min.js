var InitApp=function(){var t={requests:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:"/admin/correccion-notas/get".proto().parseURL(),type:"GET",dataType:"JSON",data:function(e){delete e.columns,e.id=$("#select_term").val(),e.searchValue=$("#search").val(),e.state=$("#state-select").val()}},pageLength:50,orderable:[],columns:[{data:"course",title:"Curso"},{data:"section",title:"Sección"},{data:"code",title:"Código"},{data:"student",title:"Estudiante"},{data:"evaluation",title:"Evaluación"},{data:"grade",title:"Nueva Nota"},{data:null,title:"Estado",orderable:!1,render:function(e){if(e.termActive)switch(e.state){case 1:return'<span class="m-badge m-badge--metal m-badge--wide">Pendiente</span>';case 2:return'<span class="m-badge m-badge--primary m-badge--wide">Aprobado</span>';case 3:return'<span class="m-badge m-badge--danger m-badge--wide">Rechazado</span>';case 4:return'<span class="m-badge m-badge--warning m-badge--wide">Solicitado</span>';default:return"-"}else switch(e.state){case 2:return"<span class='m-badge m-badge--success m-badge--wide'> Aprobado </span>";case 3:return"<span class='m-badge m-badge--danger m-badge--wide'> Rechazado </span>";default:return"<span class='m-badge m-badge--metal m-badge--wide'> Vencido </span>"}}},{data:null,title:" ",width:100,orderable:!1,render:function(e){var t=`<button class="btn btn-info m-btn btn-sm m-btn--icon m-btn--icon-only btn-detail" data-object="${e.proto().encode()}" title="Ver detalle"><i class="la la-eye"></i></button> `;return 1==e.state&&e.termActive&&(t+=`<button class="btn btn-success m-btn btn-sm m-btn--icon m-btn--icon-only approve" data-id="${e.id}" title="Aprobar"><i class="la la-check"></i></button> `,t+=`<button class="btn btn-danger m-btn btn-sm m-btn--icon m-btn--icon-only disapprove" data-id="${e.id}" title="Rechazar"><i class="la la-remove"></i></button>`),t}}]},init:function(){this.object=$("#ajax_data").DataTable(this.options),this.object.on("click",".approve",(function(){var e=$(this).data("id");a.approve.load(e,this)})),this.object.on("click",".disapprove",(function(){var e=$(this).data("id");a.disapprove.load(e,this)})),this.object.on("click",".btn-detail",(function(){var e=$(this).data("object");if(e=e.proto().decode(),$("#observations").val(e.observations),$("#prev-grade").val(e.prevGrade),$("#new-grade").val(e.grade),$("#date").val(e.date),$("#teacher").val(e.teacher),$("#preview_notTaken").attr("checked",e.notTaken),2==e.state||3==e.state?$("#updatedby").val(e.approvedBy):$("#updatedby").val(""),null!=e.file&&""!=e.file){var t=`/admin/correccion-notas/archivo/${e.file}`.proto().parseURL();$("#file-url").prop("href",t),$("#file-container").show()}else $("#file-container").hide();$("#request_modal").modal("show")}))},reload:function(){this.object.ajax.reload()}}},a={approve:{load:function(e,t){swal({title:"Confirmar aprobación de la solicitud",text:"Se aprobará la solicitud indicada y se cambiará la nota de manera automática",type:"warning",showCancelButton:!0,confirmButtonText:"Si, aprobarla",confirmButtonClass:"btn btn-success",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((a=>{$.ajax({url:"/admin/correccion-notas/post",type:"POST",data:{Id:e,Status:!0},success:function(){$(t).parent().parent().children("td")[6].innerHTML="<span class='m-badge m-badge--success m-badge--wide'> Aprobado </span>",$(t).parent().parent().children("td").eq(7).children("button.disapprove").remove(),$(t).parent().parent().children("td").eq(7).children("button.approve").remove(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(e){toastr.error(e.responseText,_app.constants.toastr.title.error)},complete:function(){swal.close()}})}))})}},disapprove:{load:function(t,a){swal({title:"Rechazar la solicitud",text:"Se rechazará la solicitud indicada ¿Desea continuar?",type:"warning",showCancelButton:!0,confirmButtonText:"Si, rechazar",confirmButtonClass:"btn btn-danger",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((n=>{$.ajax({url:"/admin/correccion-notas/post",type:"POST",data:{Id:t,Status:!1},success:function(){$(a).parent().parent().children("td")[6].innerHTML="<span class='m-badge m-badge--danger m-badge--wide'> Rechazado </span>",$(a).parent().parent().children("td").eq(7).children("button.approve").remove(),$(a).parent().parent().children("td").eq(7).children("button.disapprove").remove(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error(e.responseText,_app.constants.toastr.title.error)},complete:function(){swal.close()}})}))})}}},n={init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(e){$("#select_term").select2({data:e.items}),null!==e.selected&&($("#select_term").val(e.selected),$("#select_term").trigger("change.select2")),t.requests.init(),$("#select_term").on("change",(function(){null!==$("#select_term").val()&&t.requests.reload()}))})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}},s={init:function(){$("#state-select").select2(),$("#state-select").on("change",(function(){t.requests.reload()}))}},r=function(){$("#search").doneTyping((function(){t.requests.reload()}))};return{init:function(){n.init(),s.init(),r()},reloadTable:function(){t.requests.reload()}}}();$((function(){InitApp.init()}));