var InitApp=function(){var t={requests:{object:null,options:{serverSide:!0,filter:!1,lengthChange:!1,ajax:{url:"/admin/correccion-notas/get-sustitutorio".proto().parseURL(),type:"GET",dataType:"JSON",data:function(t){delete t.columns,t.id=$("#select_term").val(),t.searchValue=$("#search").val(),t.state=$("#state-select").val()}},pageLength:50,orderable:[],columns:[{data:"course",title:"Curso"},{data:"section",title:"Sección"},{data:"code",title:"Código"},{data:"student",title:"Estudiante"},{data:"grade",title:"Nueva Nota"},{data:null,title:"Estado",orderable:!1,render:function(t){switch(t.state){case 2:return"<span class='m-badge m-badge--success m-badge--wide'> Aprobado </span>";case 3:return"<span class='m-badge m-badge--danger m-badge--wide'> Rechazado </span>";default:return"<span class='m-badge m-badge--metal m-badge--wide'> Pendiente </span>"}}},{data:null,title:" ",width:100,orderable:!1,render:function(t){var e=`<button class="btn btn-info m-btn btn-sm m-btn--icon m-btn--icon-only btn-detail" data-object="${t.proto().encode()}" title="Ver detalle"><i class="la la-eye"></i></button> `;return 1==t.state&&(e+=`<button class="btn btn-success m-btn btn-sm m-btn--icon m-btn--icon-only approve" data-id="${t.id}" title="Aprobar"><i class="la la-check"></i></button> `,e+=`<button class="btn btn-danger m-btn btn-sm m-btn--icon m-btn--icon-only disapprove" data-id="${t.id}" title="Rechazar"><i class="la la-remove"></i></button>`),e}}]},init:function(){this.object=$("#ajax_data").DataTable(this.options),this.object.on("click",".approve",(function(){var t=$(this).data("id");e.approve.load(t,this)})),this.object.on("click",".disapprove",(function(){var t=$(this).data("id");e.disapprove.load(t,this)})),this.object.on("click",".btn-detail",(function(){var t=$(this).data("object");if(t=t.proto().decode(),console.log(t),$("#observations").val(t.observations),$("#prev-grade").val(t.prevGrade),$("#new-grade").val(t.grade),$("#date").val(t.date),$("#teacher").val(t.teacher),null!=t.file&&""!=t.file){var e=`/admin/correccion-notas/archivo/${t.file}`.proto().parseURL();$("#file-url").prop("href",e),$("#file-container").show()}else $("#file-container").hide();$("#request_modal").modal("show")}))},reload:function(){this.object.ajax.reload()}}},e={approve:{load:function(t,e){swal({title:"Confirmar aprobación de la solicitud",text:"Se aprobará la solicitud indicada y se cambiará la nota de manera automática",type:"warning",showCancelButton:!0,confirmButtonText:"Si, aprobarla",confirmButtonClass:"btn btn-success",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((a=>{$.ajax({url:"/admin/correccion-notas/post-sustitutorio",type:"POST",data:{Id:t,Status:!0},success:function(){$(e).parent().parent().children("td")[6].innerHTML="<span class='m-badge m-badge--success m-badge--wide'> Aprobado </span>",$(e).parent().parent().children("td").eq(7).children("button.disapprove").remove(),$(e).parent().parent().children("td").eq(7).children("button.approve").remove(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)},complete:function(){swal.close()}})}))})}},disapprove:{load:function(t,e){swal({title:"Rechazar la solicitud",text:"Se rechazará la solicitud indicada ¿Desea continuar?",type:"warning",showCancelButton:!0,confirmButtonText:"Si, rechazar",confirmButtonClass:"btn btn-danger",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((a=>{$.ajax({url:"/admin/correccion-notas/post-sustitutorio",type:"POST",data:{Id:t,Status:!1},success:function(){$(e).parent().parent().children("td")[6].innerHTML="<span class='m-badge m-badge--danger m-badge--wide'> Rechazado </span>",$(e).parent().parent().children("td").eq(7).children("button.approve").remove(),$(e).parent().parent().children("td").eq(7).children("button.disapprove").remove(),toastr.success(_app.constants.toastr.message.success.task,_app.constants.toastr.title.success)},error:function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)},complete:function(){swal.close()}})}))})}}},a={init:function(){$.ajax({url:"/periodos/get".proto().parseURL()}).done((function(e){$("#select_term").select2({data:e.items}),null!==e.selected&&($("#select_term").val(e.selected),$("#select_term").trigger("change.select2")),t.requests.init(),$("#select_term").on("change",(function(){null!==$("#select_term").val()&&t.requests.reload()}))})).fail((function(){toastr.error(_app.constants.toastr.message.error.task,_app.constants.toastr.title.error)}))}},n={init:function(){$("#state-select").select2(),$("#state-select").on("change",(function(){t.requests.reload()}))}},s=function(){$("#search").doneTyping((function(){t.requests.reload()}))};return{init:function(){a.init(),n.init(),s()},reloadTable:function(){t.requests.reload()}}}();$((function(){InitApp.init()}));