var Absences=function(){$("#add-form").validate();var t,e={data:{type:"remote",source:{read:{method:"GET",url:"/admin/justificacion-inasistencias/personal/get".proto().parseURL()}}},columns:[{field:"user",title:"Personal",width:200},{field:"date",title:"Fecha de Inasistencia",width:200},{field:"registerDate",title:"Fecha de la Solicitud",textAlign:"center",width:220},{field:"status",title:"Estado",textAlign:"center",width:150,template:function(t){var e={3:{text:_app.constants.request.inProcess.text,value:_app.constants.request.inProcess.value,class:"m-badge--metal"},4:{text:_app.constants.request.approved.text,value:_app.constants.request.approved.value,class:"m-badge--success"},5:{text:_app.constants.request.disapproved.text,value:_app.constants.request.disapproved.value,class:"m-badge--danger"}};return'<span class="m-badge '+e[t.status].class+' m-badge--wide">'+e[t.status].text+"</span>"}},{field:"details",title:"Detalle",width:120,template:function(t){return"<button class='btn btn-default m-btn btn-sm m-btn--icon btn-detail' data-id='"+t.id+"'><span><i class='la la-eye'></i><span>Ver Detalle</span></span></button>"}},{field:"options",title:"Opciones",width:180,template:function(t){var e="";return t.status===_app.constants.request.inProcess.value&&(e+='<button class="btn btn-success m-btn btn-sm m-btn--icon m-btn--icon-only approve" data-id="'+t.id+'" title="Aprobar"><i class="la la-check"></i></button> ',e+='<button class="btn btn-danger m-btn btn-sm m-btn--icon m-btn--icon-only disapprove" data-id="'+t.id+'" title="Rechazar"><i class="la la-remove"></i></button>'),e}}]},a=function(){t.on("click",".btn-detail",(function(){var t=$(this).data("id");n.show(t)})),t.on("click",".approve",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",text:"La solicitud será aprobada",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, continuar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((a=>{$.ajax({url:"/admin/justificacion-inasistencias/personal/post",type:"POST",data:{id:e,approved:!0},success:function(e){t.reload(),swal({type:"success",title:"Completado",text:"La solicitud ha sido aprobada con éxito",confirmButtonText:"Excelente"})},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Ocurrió un error al intentar modificar la solicitud"})}})}))})})),t.on("click",".disapprove",(function(){var e=$(this).data("id");swal({title:"¿Está seguro?",text:"La solicitud será desaprobada",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, continuar",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((a=>{$.ajax({url:"/admin/justificacion-inasistencias/personal/post",type:"POST",data:{id:e,approved:!1},success:function(e){t.reload(),swal({type:"success",title:"Completado",text:"La solicitud ha sido desaprobada con éxito",confirmButtonText:"Excelente"})},error:function(t){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Ocurrió un error al intentar modificar la solicitud"})}})}))})}))},n={show:function(t){mApp.blockPage(),$.ajax({url:("/admin/justificacion-inasistencias/personal/"+t+"/get").proto().parseURL()}).done((function(e){var a=$("#detail-form").get(0).elements;a.DetailUser.value=e.user,a.DetailDate.value=e.date,a.DetailRegisterDate.value=e.registerDate;var i={3:{text:_app.constants.request.inProcess.text},4:{text:_app.constants.request.approved.text},5:{text:_app.constants.request.disapproved.text}};a.DetailStatus.value=i[e.status].text,a.DetailJustification.value=e.justification,e.file?($("#fileDiv").show(),$("#fileUrl").attr("href",`/admin/justificacion-inasistencias/personal/${t}/archivo/descargar`.proto().parseURL())):$("#fileDiv").hide(),mApp.unblockPage(),$("#detail_modal").modal("toggle"),$("#detail_modal").on("hidden.bs.modal",(function(){n.reset()}))}))},reset:function(){var t=$("#detail-form").get(0).elements;t.DetailStudent.value=null,t.DetailCourse.value=null,t.DetailClass.value=null,t.DetailRegisterDate.value=null,t.DetailStatus.value=null,t.DetailJustification.value=null}};return{Table:{init:function(){t=$(".m-datatable").mDatatable(e),a()}}}}();$((function(){Absences.Table.init()}));