var InitApp=function(){var t={init:function(){t.types.init(),t.students.init(),t.academic_record.init()},academic_record:{init:function(){$.ajax({url:"/registros_academicos/get".proto().parseURL()}).done((function(t){$("#academic_record_select").select2({placeholder:"Seleccionar usuario",data:t})}))}},types:{init:function(){$.ajax({url:"/academico/constancias/tipos/get".proto().parseURL()}).done((function(t){$("#type_select").select2({data:t.items}).on("change",(function(){18!=$(this).val()||""!=$("#student_select").val()&&null!=$("#student_select").val()?18==$(this).val()&&""!=$("#student_select").val()&&null!=$("#student_select").val()?($("#term_select").select2({disabled:!1}),$(".term-select").show()):($("#term_select").select2("data",null),$(".term-select").hide()):($("#term_select").select2({disabled:!0}),$(".term-select").show())}))}))}},students:{init:function(){$("#student_select").select2({width:"100%",placeholder:"Buscar...",ajax:{url:"/academico/alumnos/buscar".proto().parseURL(),dataType:"json",data:function(t){return{term:t.term,page:t.page}},processResults:function(t,e){return{results:t.items}},cache:!0},escapeMarkup:function(t){return t},minimumInputLength:3}).on("change",(function(){18==$("#type_select").val()&&(studentId=$(this).val(),$.ajax({url:`/periodos-por-estudiante/get?studentId=${studentId}`.proto().parseURL()}).done((function(t){$("#term_select").select2({data:t.items,disabled:!1})})))}))}}},e={history:{object:null,options:getSimpleDataTableConfiguration({serverSide:!1,url:"/academico/constancias/historial/get".proto().parseURL(),data:function(t){delete t.columns,t.studentId=$("#student_select").val(),t.type=$("#type_select").val(),t.academicrecordId=$("#academic_record_select").val()},pageLength:50,orderable:[],columns:[{title:"Fecha emisión",data:"date"},{title:"Nro. constancia",data:"number"},{title:"Observaciones",data:"observations"},{title:"Opciones",data:null,render:function(t){return`<div class="table-options-section"> \n                                <a href="${`/academico/constancias/imprimir/${t.id}`.proto().parseURL()}" class="btn btn-primary btn-sm m-btn m-btn--icon btn-detail" <span=""><i class="la la-file"></i>Imprimir</a>\n                            </div>`}}]}),load:function(){void 0!==this.object&&null!==this.object?this.object.ajax.reload():this.object=$("#data-table").DataTable(this.options)}}},n={onHistoric:function(){$("#btn-history").click((function(){if(""==$("#student_select").val()||null==$("#student_select").val())return toastr.error("Debe completar todos los campos",_app.constants.toastr.title.error),!1;e.history.load()}))},onRegisterRequest:function(){$("#btn-create").click((function(){var t=$("#type_select").val(),n=$("#student_select").val(),a=$("#academic_record_select").val();if(""==n||null==n)return toastr.error("Debe completar todos los campos",_app.constants.toastr.title.error),!1;if(18==t&&(""==t||null==t))return toastr.error("Debe completar todos los campos",_app.constants.toastr.title.error),!1;if(""===a||null===a)return toastr.error("Debe completar todos los campos",_app.constants.toastr.title.error),!1;var o=new FormData;o.append("StudentId",n),o.append("RecordType",t),o.append("AcademicRecordStaffId",a),swal({title:"Proceso de Solicitud",text:"¿Seguro que desea enviar la solicitud?",type:"warning",showCancelButton:!0,confirmButtonText:"Sí",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,allowOutsideClick:()=>!swal.isLoading(),preConfirm:()=>new Promise((()=>{$.ajax({url:"/academico/constancias/generar",type:"POST",data:o,processData:!1,contentType:!1}).done((function(){e.history.load(),swal({type:"success",title:"Completado",text:"La solicitud ha sido enviado con éxito",confirmButtonText:"Excelente"})})).fail((function(){swal({type:"error",title:"Error",confirmButtonClass:"btn btn-danger m-btn m-btn--custom",confirmButtonText:"Entendido",text:"Error al enviar la solicitud"})}))}))})}))},init:function(){n.onHistoric(),n.onRegisterRequest()}};return{init:function(){t.init(),n.init()}}}();$((function(){InitApp.init()}));