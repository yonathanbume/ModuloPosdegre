@model AKDEMIC.REPOSITORY.Repositories.Intranet.Templates.EvaluationReport.EvaluationReportInformationTemplate
@using Microsoft.AspNetCore.Hosting;
@using AKDEMIC.CORE.Helpers
@using AKDEMIC.CORE.Extensions;
@inject IWebHostEnvironment _webHostEnvironment
@{
    Layout = null;
    Model.Course.Section.Students = Model.Course.Section.Students.Where(x => x.Status != ConstantHelpers.STUDENT_SECTION_STATES.WITHDRAWN).ToList();

    var maxPerPage = 30;
    if (Model.Course.Section.Students.Count() <= maxPerPage)
    {
        for (int i = Model.Course.Section.Students.Count(); i < maxPerPage; i++)
        {
            Model.Course.Section.Students.Add(new AKDEMIC.REPOSITORY.Repositories.Intranet.Templates.EvaluationReport.EvaluationReportStudent());
        }
    }
    else
    {
        var rounded = Model.Course.Section.Students.Count() / maxPerPage;
        for (int i = Model.Course.Section.Students.Count(); i < (maxPerPage * (rounded + 1)); i++)
        {
            Model.Course.Section.Students.Add(new AKDEMIC.REPOSITORY.Repositories.Intranet.Templates.EvaluationReport.EvaluationReportStudent());
        }
    }

    var colspan = 6 + Model.Course.PartialAveragesCount;
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Acta de notas</title>
    <link href="@(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, @"css/views/evaluation_report/evaluation_report_fonts.css"))" rel="stylesheet" type="text/css" />
    
    <style>
        body {
            /*font-family: 'Times New Roman';*/
            font-family: "DejaVu Sans Condensed";
            font-size: 13px;
        }

        h1 {
            margin-bottom: 5px !important;
            font-size: 28px;
        }

        h2 {
            margin: 0px;
            font-size: 18px;
        }

        img {
            top: 0;
            left: 0;
            max-height: 60px;
        }

        header {
            width: 100%;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-weight: normal;
        }

            table > tbody > tr {
                page-break-inside: avoid !important;
            }

            table td {
                font-size: 13px !important;
                height: 15px !important;
            }

        .bordered {
            border: 1px solid black;
            padding: 3px 3px !important;
        }

        .headerformat .bordered {
            border: 1px solid black;
            padding: 3px 3px !important;
        }

        .headerformat .unbordered {
            border: 0px;
            padding: 3px 3px !important;
        }

        .no-background {
            background-color: transparent !important;
        }

        .unbordered {
            border: 0px !important;
            padding: 3px 3px !important;
        }

        th {
            font-weight: normal;
            text-align: left;
        }

        .red {
            color: red;
        }

        .blue {
            color: blue;
        }

        .bold {
            font-weight: bold;
            background-color: lightgray;
        }

        .center {
            text-align: center;
        }

        .header2 {
            font-size: 10px;
            padding: 3px 0px !important;
        }

        .header > th {
            border: 1px solid black;
            padding: 5px 3px !important;
        }

        .td-header {
            border: none;
            padding: 0px !important;
        }

        .detail-header {
            font-size: 11px;
            text-align: left;
            font-weight: 600;
        }

        .footer {
            font-size: 15px;
            text-align: center;
            font-style: italic;
            bottom: 0;
            left: 0;
            right: 0;
            margin-bottom: -6px;
        }

        .thd {
            border: 1px solid black;
            padding: 2px;
            font-size: 14px;
        }

        .negrita {
            font-weight: bold;
        }

        table tbody tr th {
            font-size: 13px !important;
        }

        .center {
            text-align: center;
        }

        .unk-header {
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
        }

        .university-title {
            margin-top: 10px !important;
            font-size: 20px;
        }

        .header-title {
            margin-top: 13px !important;
            font-size: 18px;
        }

        .subheader-title {
            font-size: 16px;
        }

        .title {
            margin-top: 13px !important;
            margin-bottom: 20px !important;
            font-size: 18px;
        }

        .trstudents th {
            font-size: 11px !important;
            height: 16px !important;
        }
    </style>
</head>
<body>
    <table>
        <thead class="headerformat">

            <tr class="unbordered">
                <th colspan="@colspan">
                    <div style="position:absolute; float:left;">
                        <img src="@Model.Img" style="max-height:130px !important;" />
                    </div>
                    <div class="unk-header center">
                        <p style="margin:0px;text-transform: uppercase" class="negrita university-title">@GeneralHelpers.GetInstitutionName().ToUpper()</p>
                        <!--<p style="margin:0px; margin-top:4px !important; margin-bottom:10px !important;" class="negrita header-title">-->@*(Creada por Ley Nª 29658)*@<!--&emsp;</p>-->
                        <p style="margin:0px;" class="negrita header-title">@Model.Header</p>
                        <p style="margin:0px; margin-bottom:10px !important;" class="negrita subheader-title">@Model.SubHeader</p>
                        <p style="margin:0px;" class="negrita title">REGISTRO DE EVALUACIÓN</p>
                    </div>
                </th>
            </tr>
            <tr class="unbordered" style="font-size:13px !important;">
                <th class="unbordered" colspan="@colspan" style="padding:unset !important">
                    <table class="unbordered" style="padding:0px !important;">
                        <tbody class="unbordered">
                            <tr class="unbordered">
                                <td class="bold unbordered no-background" style="width:22% !important">ESCUELA PROFESIONAL</td>
                                <td class="bold unbordered no-background" style="width:1% !important;">:</td>
                                <td class="bold unbordered no-background">&emsp;</td>
                                <td class="unbordered bold no-background" style="width:10% !important;">@Model.Course.Career.Code</td>
                                <td class="unbordered" colspan="2">@Model.Course.Career.Name</td>
                            </tr>
                            <tr class="unbordered">
                                <td class="bold unbordered no-background">ASIGNATURA</td>
                                <td class="bold unbordered no-background">:</td>
                                <td class="bold unbordered no-background">&emsp;</td>
                                <td class="unbordered bold no-background">@Model.Course.Code</td>
                                <td class="unbordered" colspan="2">@Model.Course.Name.ToUpper()</td>
                            </tr>
                            <tr class="unbordered">
                                <td class="bold unbordered no-background">CICLO</td>
                                <td class="bold unbordered no-background">:</td>
                                <td class="bold unbordered no-background">&emsp;</td>
                                <td class="unbordered bold no-background">@(ConstantHelpers.ACADEMIC_YEAR.ROMAN_NUMERALS.ContainsKey(Model.Course.AcademicYear) ? ConstantHelpers.ACADEMIC_YEAR.ROMAN_NUMERALS[Model.Course.AcademicYear] : "-")</td>
                                <td class="unbordered" colspan="2">&emsp;</td>
                            </tr>
                            <tr class="unbordered">
                                <td class="bold unbordered no-background">CRÉDITOS</td>
                                <td class="bold unbordered no-background">:</td>
                                <td class="bold unbordered no-background">&emsp;</td>
                                <td class="unbordered bold no-background">@Model.Course.Credits</td>
                                <td class="unbordered" colspan="2">&emsp;</td>
                            </tr>
                            <tr class="unbordered">
                                <td class="bold unbordered no-background">DOCENTE</td>
                                <td class="bold unbordered no-background">:</td>
                                <td class="bold unbordered no-background">&emsp;</td>
                                <td colspan="3" class="unbordered no-background">@Model.Course.Section.Teacher</td>
                            </tr>

                            <tr class="unbordered">
                                <td class="bold unbordered no-background">PLAN DE ESTUDIOS</td>
                                <td class="bold unbordered no-background">:</td>
                                <td class="bold unbordered no-background">&emsp;</td>
                                <td colspan="3" class="unbordered bold no-background">@Model.Course.Curriculum</td>
                            </tr>
                            <tr class="unbordered">
                                <td class="bold unbordered no-background">TIPO DE ACTA</td>
                                <td class="bold unbordered no-background">:</td>
                                <td class="bold unbordered no-background">&emsp;</td>
                                <td colspan="2" class="unbordered bold no-background">@(AKDEMIC.CORE.Helpers.ConstantHelpers.Intranet.EvaluationReportType.NAMES.ContainsKey(Model.BasicInformation.Type) ? AKDEMIC.CORE.Helpers.ConstantHelpers.Intranet.EvaluationReportType.NAMES[Model.BasicInformation.Type].ToUpper() : "-")</td>
                                <td class="unbordered" style="text-align:right !important; font-weight:bold !important;">@Model.Term.Name</td>
                            </tr>
                        </tbody>
                    </table>
                </th>
            </tr>

            <tr class="bordered">
                <th class="center bordered" style="padding:10px !important; font-weight:bold;">NRO</th>
                <th class="center bordered" style="padding:10px !important; font-weight:bold;">CÓDIGO</th>
                <th class="center bordered" style="padding:10px !important; font-weight:bold;">APELLIDOS Y NOMBRES</th>


                @if (ConstantHelpers.GENERAL.Institution.Value == ConstantHelpers.Institution.UNAH)
                {
                    foreach (var item in Model.Course.Evaluations)
                    {
                        <th class="center bordered" style="padding:10px !important; font-weight:bold;">@item.Name</th>
                    }
                }
                else
                {
                    @for (int i = 1; i <= Model.Course.PartialAveragesCount; i++)
                    {
                        <th class="center bordered" style="padding:10px !important; font-weight:bold;">EP.@(i.ToString("00"))</th>
                    }
                }
                <th class="center bordered" style="padding:10px !important; font-weight:bold;">EXAM <br />SUST.</th>
                <th class="center bordered" style="padding:10px !important; font-weight:bold;">PROMEDIO <br />FINAL</th>
                <th class="center bordered" style="padding:10px !important; font-weight:bold;">LETRAS </th>
            </tr>

        </thead>

        <tbody>
            @for (var i = 0; i < Model.Course.Section.Students.Count(); i++)
            {
            <tr class="bordered trstudents" style="border:1px solid black !important;">
                <th class="thd center" style="width:5% !important;">@(i+1)</th>
                <th class="thd center" style="border-right:0px !important;">@Model.Course.Section.Students[i].UserName</th>
                <th class="thd" style="border-right:0px !important; width:60% !important;">@Model.Course.Section.Students[i].FullName</th>

                @if (string.IsNullOrEmpty(Model.Course.Section.Students[i].UserName))
                {

                    @for (int v = 0; v < Model.Course.PartialAveragesCount; v++)
                    {
                        <th class="thd center" style="border-right:0px !important;">&emsp;</th>
                    }
                    <th class="thd center">&emsp;</th>
                    <th class="thd center">&emsp;</th>

                    <th class="thd center">&emsp;</th>
                }
                else
                {

                    @for (int v = 0; v < Model.Course.Section.Students[i].Averages.Count(); v++)
                    {
                        @if (!Model.Course.Section.Students[i].Averages[v].Average.HasValue)
                        {
                            <th class="thd center" style="border-right:0px !important;">-</th>
                        }
                        else if (Model.Course.Section.Students[i].Averages[v].Approved)
                        {
                            <th class="thd blue center">@Model.Course.Section.Students[i].Averages[v].Average.Value.ToString("00")</th>
                        }
                        else
                        {
                            <th class="red thd center">@Model.Course.Section.Students[i].Averages[v].Average.Value.ToString("00")</th>
                        }
                    }

                    @if (Model.Course.Section.Students[i].HasGradeRecovery && Model.Course.Section.Students[i].GradeRecoveryValue.HasValue)
                    {
                        @if (Model.Course.Section.Students[i].GradeRecoveryValue.Value >= Model.Term.MinGrade)
                        {
                            <th class="thd blue center">@Model.Course.Section.Students[i].GradeRecoveryValue.Value.ToString("00")</th>
                        }
                        else
                        {
                            <th class="thd red center">@Model.Course.Section.Students[i].GradeRecoveryValue.Value.ToString("00")</th>
                        }
                    }
                    else
                    {
                        <th class="thd center">&emsp;</th>
                    }

                    @if (Model.Course.Section.Students[i].Approved)
                    {
                        <th class="thd blue center" style="font-weight:bold;">@Model.Course.Section.Students[i].FinalGrade.ToString("00") </th>
                        <th class="thd blue center" style="font-weight:bold;">@Model.Course.Section.Students[i].FinalGradeText @(Model.Course.Section.Students[i].HasGradeRecovery ? "(*)" : "")</th>
                    }
                    else
                    {
                        <th class="red thd center" style="font-weight:bold;">@Model.Course.Section.Students[i].FinalGrade.ToString("00") </th>
                        <th class="red thd center" style="font-weight:bold;">@Model.Course.Section.Students[i].FinalGradeText @(Model.Course.Section.Students[i].HasGradeRecovery ? "(*)" : "")</th>
                    }
                }
            </tr>
            }
        </tbody>
        <tfoot>
            <tr class="unbordered">
                <td colspan="5" style="font-size:12px !important; font-weight:bold !important;">(*)Examen sustitutorio</td>
            </tr>

            <tr class="unbordered">
                <td colspan="5" style="font-size:16px !important; font-weight:bold !important;">TOTAL DE ALUMNOS &emsp;: @Model.Course.Section.Students.Where(x => !string.IsNullOrEmpty(x.UserName)).Count()</td>
            </tr>

            <tr style="padding:0px !important; font-size:10px !important; height:30px !important;">
                @{
                    var datetime = DateTime.UtcNow.ToDefaultTimeZone();
                    var month = ConstantHelpers.MONTHS.VALUES[datetime.Month];
                }
                <td colspan="@colspan" style=" text-align:right !important; padding:0px !important; margin:0px !important;">@ConstantHelpers.Institution.Locations[ConstantHelpers.GENERAL.Institution.Value], @datetime.Day de @month de @datetime.Year</td>
            </tr>

            <tr>
                <td colspan="@colspan" style="height:280px !important;">
                    <table style="margin:0px !important; padding:0px !important;">
                        <tr style="padding:0px !important; margin:0px !important; height:70px !important;">
                            <th style="width:10%; border:0px !important;">&emsp;</th>
                            <th style="width:32%; border:0px !important;"></th>
                            <th style="width:16%; border:0px !important;">&emsp;</th>
                            <th style="width:32%; border:0px !important;"></th>
                            <th style="width:10%; border:0px !important;">&emsp;</th>
                        </tr>
                        <tr style="padding:0px !important; margin:0px !important;">
                            <th style="border:0px !important;">&emsp;</th>
                            <th style="font-size: 10px !important; border: 0px !important;">&emsp; &emsp;</th>
                            <th style="border:0px !important;">&emsp;</th>
                            <th style="font-size: 10px !important; border: 0px !important;">&emsp; &emsp;</th>
                            <th style="border:0px !important;">&emsp;</th>
                        </tr>
                        <tr style="padding:0px !important; margin:0px !important; height:90px !important;">
                            <th style="border:0px !important;">&emsp;</th>
                            <th style="border:0px !important;"></th>
                            <th style="border:0px !important;">&emsp;</th>
                            <th style="border:0px !important;"></th>
                            <th style="border:0px !important;">&emsp;</th>
                        </tr>
                        <tr style="padding:0px !important; margin:0px !important;">
                            <th style="border:0px !important;">&emsp;</th>
                            <th style="font-size: 10px !important; text-align: center; border-bottom: 0px !important; padding-bottom: 10px !important; border-right: 0px !important; border-left: 0px !important; border-top: 1px solid black">&emsp; DIRECTOR DE DEPARTAMENTO ACADÉMICO &emsp;</th>
                            <th style="border:0px !important;">&emsp;</th>
                            <th style="font-size: 10px !important; text-align: center; border-bottom: 0px !important;border-right: 0px !important; border-left: 0px !important; border-top: 1px solid black">&emsp; DOCENTE &emsp;</th>
                            <th style="border:0px !important;">&emsp;</th>
                        </tr>
                    </table>
                </td>
            </tr>
        </tfoot>
    </table>
</body>
</html>
